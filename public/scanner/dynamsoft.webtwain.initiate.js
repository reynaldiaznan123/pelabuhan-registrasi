/*!
* Dynamsoft JavaScript Library
* Product: Dynamsoft Web Twain
* Web Site: http://www.dynamsoft.com
*
* Copyright 2016, Dynamsoft Corporation 
* Author: Dynamsoft Support Team
* Version: 11.3.2
*/
var Dynamsoft=Dynamsoft||{Lib:{},WebTwainEnv:{}};if(!Dynamsoft.WebTwainEnv)Dynamsoft.WebTwainEnv={};
Dynamsoft.WebTwainEnv.IfUseActiveXForIE10Plus = false;
var KISSY=function(b){function e(f){var i={},j;for(j in c){(function(g,k){g[k]=function(l){return h.log(l,k,f)}})(i,j)}return i}var h,d=0,c={debug:10,info:20,warn:30,error:40};h={__BUILD_TIME:"20131209235320",Env:{host:this},Config:{debug:"",fns:{}},version:"1.41",config:function(p,j){var l,i,o=this,f,n=h.Config,k=n.fns;h.isObject(p)?h.each(p,function(m,g){(f=k[g])?f.call(o,m):n[g]=m}):(l=k[p],j===b?i=l?l.call(o):n[p]:l?i=l.call(o,j):n[p]=j);return i},log:function(){return b},getLogger:function(f){return e(f)},error:function(){},guid:function(f){return(f||"")+d++},Logger:{}};h.Logger.Level={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error"};return h}();(function(x,r){function s(){}function p(P,L,Q,O,J,M){if(!L||!P){return P}var N,C,A,H;L[v]=P;M.push(L);A=x.keys(L);H=A.length;for(N=0;N<H;N++){if(C=A[N],C!==v){var K=P,c=L,G=Q,B=O,y=J,g=M;if(G||!(C in K)||y){var i=K[C],l=c[C];if(i===l){i===r&&(K[C]=i)}else{if(B&&(l=B.call(c,C,l)),y&&l&&(x.isArray(l)||x.isPlainObject(l))){l[v]?K[C]=l[v]:(c=i&&(x.isArray(i)||x.isPlainObject(i))?i:x.isArray(l)?[]:{},K[C]=c,p(c,l,G,B,n,g))}else{if(l!==r&&(G||!(C in K))){K[C]=l}}}}}}return P}function o(b,c){return"constructor"===b?r:c}var v="__MIX_CIRCULAR",q=this,n=!0,w=Object,u=w.create,j=!{toString:1}.propertyIsEnumerable("toString"),t="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toString,toLocaleString,valueOf".split(",");(function(e,f){for(var c in f){e[c]=f[c]}})(x,{stamp:function(i,g,f){var f=f||"__~ks_stamped",h=i[f];if(!h&&!g){try{h=i[f]=x.guid(f)}catch(k){h=r}}return h},keys:w.keys||function(f){var g=[],e,h;for(e in f){f.hasOwnProperty(e)&&g.push(e)}if(j){for(h=t.length-1;0<=h;h--){e=t[h],f.hasOwnProperty(e)&&g.push(e)}}return g},mix:function(A,g,z,c,l){"object"===typeof z&&(c=z.whitelist,l=z.deep,z=z.overwrite);if(c&&"function"!==typeof c){var k=c,c=function(f,e){return x.inArray(f,k)?e:r}}z===r&&(z=n);var y=[],i=0;for(p(A,g,z,c,l,y);g=y[i++];){delete g[v]}return A},merge:function(h){var h=x.makeArray(arguments),f={},g,i=h.length;for(g=0;g<i;g++){x.mix(f,h[g])}return f},augment:function(y,A){var l=x.makeArray(arguments),z=l.length-2,g=1,i,k,C=l[z],B=l[z+1];l[1]=A;x.isArray(B)||(C=B,B=r,z++);"boolean"!==typeof C&&(C=r,z++);for(;g<z;g++){k=l[g];if(i=k.prototype){k=x.mix({},i,!0,o)}x.mix(y.prototype,k,C,B)}return y},extend:function(f,g,h,i){var d=g.prototype;d.constructor=g;u?g=u(d):(s.prototype=d,g=new s);g.constructor=f;f.prototype=x.mix(g,f.prototype);f.superclass=d;h&&x.mix(g,h);i&&x.mix(f,i);return f},namespace:function(){var z=x.makeArray(arguments),i=z.length,y=null,A,h,l,k=z[i-1]===n&&i--;for(A=0;A<i;A++){l=(""+z[A]).split(".");y=k?q:this;for(h=q[l[0]]===y?1:0;h<l.length;++h){y=y[l[h]]=y[l[h]]||{}}}return y}})})(KISSY);(function(r,n){var o=Array.prototype,j=o.indexOf,e=o.lastIndexOf,p=o.filter,m=o.every,d=o.some,q=o.map;r.mix(r,{each:function(i,f,h){if(i){var l,g,k=0;l=i&&i.length;g=l===n||"function"===r.type(i);h=h||null;if(g){for(g=r.keys(i);k<g.length&&!(l=g[k],!1===f.call(h,i[l],l,i));k++){}}else{for(g=i[0];k<l&&!1!==f.call(h,g,k,i);g=i[++k]){}}}return i},indexOf:j?function(f,c){return j.call(c,f)}:function(g,f){for(var h=0,i=f.length;h<i;++h){if(f[h]===g){return h}}return -1},lastIndexOf:e?function(f,c){return e.call(c,f)}:function(f,c){for(var g=c.length-1;0<=g&&c[g]!==f;g--){}return g},unique:function(f,l){var i=f.slice();l&&i.reverse();for(var h=0,g,k;h<i.length;){for(k=i[h];(g=r.lastIndexOf(k,i))!==h;){i.splice(g,1)}h+=1}l&&i.reverse();return i},inArray:function(f,g){return -1<r.indexOf(f,g)},filter:p?function(f,c,g){return p.call(f,c,g||this)}:function(f,i,h){var g=[];r.each(f,function(k,c,l){i.call(h||this,k,c,l)&&g.push(k)});return g},map:q?function(b,g,f){return q.call(b,g,f||this)}:function(h,g,l){for(var t=h.length,i=Array(t),s=0;s<t;s++){var k="string"===typeof h?h.charAt(s):h[s];if(k||s in h){i[s]=g.call(l||this,k,s,h)}}return i},reduce:function(h,g,l){var s=h.length;if("function"!==typeof g){throw new TypeError("callback is not function!")}if(0===s&&2===arguments.length){throw new TypeError("arguments invalid")}var i=0,k;if(3<=arguments.length){k=l}else{do{if(i in h){k=h[i++];break}i+=1;if(i>=s){throw new TypeError}}while(1)}for(;i<s;){i in h&&(k=g.call(n,k,h[i],i,h)),i++}return k},every:m?function(f,c,g){return m.call(f,c,g||this)}:function(g,f,i){for(var k=g&&g.length||0,h=0;h<k;h++){if(h in g&&!f.call(i,g[h],h,g)){return !1}}return !0},some:d?function(f,c,g){return d.call(f,c,g||this)}:function(g,f,i){for(var k=g&&g.length||0,h=0;h<k;h++){if(h in g&&f.call(i,g[h],h,g)){return !0}}return !1},makeArray:function(g){if(null==g){return[]}if(r.isArray(g)){return g}var k=typeof g.length,i=typeof g;if("number"!==k||g.alert||"string"===i||"function"===i&&!("item" in g&&"number"===k)){return[g]}for(var k=[],i=0,h=g.length;i<h;i++){k[i]=g[i]}return k}})})(KISSY);(function(v,q){function r(d){var c=typeof d;return null==d||"object"!==c&&"function"!==c}function o(){if(u){return u}var b=t;v.each(p,function(c){b+=c+"|"});b=b.slice(0,-1);return u=RegExp(b,"g")}function n(){if(s){return s}var c=t;v.each(j,function(b){c+=b+"|"});c+="&#(\\d{1,5});";return s=RegExp(c,"g")}var t="",p={"&amp;":"&","&gt;":">","&lt;":"<","&#x60;":"`","&#x2F;":"/","&quot;":'"',"&#x27;":"'"},j={},u,s,e=/[\-#$\^*()+\[\]{}|\\,.?\s]/g;(function(){for(var b in p){j[p[b]]=b}})();v.mix(v,{urlEncode:function(b){return encodeURIComponent(""+b)},urlDecode:function(b){return decodeURIComponent(b.replace(/\+/g," "))},fromUnicode:function(b){return b.replace(/\\u([a-f\d]{4})/ig,function(d,c){return String.fromCharCode(parseInt(c,16))})},escapeHtml:function(b){return(b+"").replace(o(),function(c){return j[c]})},escapeRegExp:function(b){return b.replace(e,"\\$&")},unEscapeHtml:function(b){return b.replace(n(),function(d,c){return p[d]||String.fromCharCode(+c)})},param:function(z,y,l,f){y=y||"&";l=l||"=";f===q&&(f=!0);var x=[],C,g,w,B,A,c=v.urlEncode;for(C in z){if(A=z[C],C=c(C),r(A)){x.push(C),A!==q&&x.push(l,c(A+t)),x.push(y)}else{if(v.isArray(A)&&A.length){g=0;for(B=A.length;g<B;++g){w=A[g],r(w)&&(x.push(C,f?c("[]"):t),w!==q&&x.push(l,c(w+t)),x.push(y))}}}}x.pop();return x.join(t)},unparam:function(B,z,A){if("string"!==typeof B||!(B=v.trim(B))){return{}}for(var A=A||"=",y={},x,g=v.urlDecode,B=B.split(z||"&"),l=0,w=B.length;l<w;++l){x=B[l].indexOf(A);if(-1===x){z=g(B[l]),x=q}else{z=g(B[l].substring(0,x));x=B[l].substring(x+1);try{x=g(x)}catch(C){"decodeURIComponent error : "+x,C}v.endsWith(z,"[]")&&(z=z.substring(0,z.length-2))}z in y?v.isArray(y[z])?y[z].push(x):y[z]=[y[z],x]:y[z]=x}return y}});v.escapeHTML=v.escapeHtml;v.unEscapeHTML=v.unEscapeHtml})(KISSY);(function(b){function c(f,m,i){function n(){}var j=[].slice,e=j.call(arguments,3),d=function(){var g=j.call(arguments);return m.apply(this instanceof n?this:i||this,f?g.concat(e):e.concat(g))};n.prototype=m.prototype;d.prototype=new n;return d}b.mix(b,{noop:function(){},bind:c(0,c,null,0),rbind:c(0,c,null,1),later:function(o,n,j,q,m){var n=n||0,i=o,e=b.makeArray(m),p;"string"===typeof o&&(i=q[o]);i||"method undefined";o=function(){i.apply(q,e)};p=j?setInterval(o,n):setTimeout(o,n);return{id:p,interval:j,cancel:function(){this.interval?clearInterval(p):clearTimeout(p)}}},throttle:function(h,e,d){e=e||150;if(-1===e){return function(){h.apply(d||this,arguments)}}var i=b.now();return function(){var f=b.now();f-i>e&&(i=f,h.apply(d||this,arguments))}},buffer:function(j,i,d){function l(){l.stop();e=b.later(j,i,0,d||this,arguments)}i=i||150;if(-1===i){return function(){j.apply(d||this,arguments)}}var e=null;l.stop=function(){e&&(e.cancel(),e=0)};return l}})})(KISSY);(function(d,n){function o(c,s,q){var r=c,h,i,t,f;if(!c){return r}if(c[m]){return q[c[m]].destination}if("object"===typeof c){f=c.constructor;if(d.inArray(f,[Boolean,String,Number,Date,RegExp])){r=new f(c.valueOf())}else{if(h=d.isArray(c)){r=s?d.filter(c,s):c.concat()}else{if(i=d.isPlainObject(c)){r={}}}}c[m]=f=d.guid("c");q[f]={destination:r,input:c}}if(h){for(c=0;c<r.length;c++){r[c]=o(r[c],s,q)}}else{if(i){for(t in c){if(t!==m&&(!s||s.call(c,c[t],t,c)!==p)){r[t]=o(c[t],s,q)}}}}return r}function j(f,l,q,k){if(f[b]===l&&l[b]===f){return e}f[b]=l;l[b]=f;var i=function(h,c){return null!==h&&h!==n&&h[c]!==n},g;for(g in l){!i(f,g)&&i(l,g)&&q.push("expected has key "+g+'", but missing from actual.')}for(g in f){!i(l,g)&&i(f,g)&&q.push('expected missing key "'+g+'", but present in actual.')}for(g in l){g!==b&&(d.equals(f[g],l[g],q,k)||k.push('"'+g+'" was "'+(l[g]?l[g].toString():l[g])+'" in expected, but was "'+(f[g]?f[g].toString():f[g])+'" in actual.'))}d.isArray(f)&&d.isArray(l)&&f.length!==l.length&&k.push("arrays were not the same length");delete f[b];delete l[b];return 0===q.length&&0===k.length}var e=!0,p=!1,m="__~ks_cloned",b="__~ks_compared";d.mix(d,{equals:function(f,h,i,g){i=i||[];g=g||[];return f===h?e:f===n||null===f||h===n||null===h?null==f&&null==h:f instanceof Date&&h instanceof Date?f.getTime()===h.getTime():"string"===typeof f&&"string"===typeof h||"number"===typeof f&&"number"===typeof h?f===h:"object"===typeof f&&"object"===typeof h?j(f,h,i,g):f===h},clone:function(f,h){var i={},g=o(f,h,i);d.each(i,function(k){k=k.input;if(k[m]){try{delete k[m]}catch(c){k[m]=n}}});i=null;return g},now:Date.now||function(){return +new Date}})})(KISSY);(function(b,e){var h=/^[\s\xa0]+|[\s\xa0]+$/g,d=String.prototype.trim,c=/\\?\{([^{}]+)\}/g;b.mix(b,{trim:d?function(f){return null==f?"":d.call(f)}:function(f){return null==f?"":(f+"").replace(h,"")},substitute:function(g,i,j){return"string"!==typeof g||!i?g:g.replace(j||c,function(f,k){return"\\"===f.charAt(0)?f.slice(1):i[k]===e?"":i[k]})},ucfirst:function(f){f+="";return f.charAt(0).toUpperCase()+f.substring(1)},startsWith:function(f,g){return 0===f.lastIndexOf(g,0)},endsWith:function(g,i){var j=g.length-i.length;return 0<=j&&g.indexOf(i,j)===j}})})(KISSY);(function(b,e){var h={},d=Object.prototype,c=d.toString;b.mix(b,{type:function(f){return null==f?""+f:h[c.call(f)]||"object"},isNull:function(f){return null===f},isUndefined:function(f){return f===e},isEmptyObject:function(f){for(var g in f){if(g!==e){return !1}}return !0},isPlainObject:function(k){if(!k||"object"!==b.type(k)||k.nodeType||k.window==k){return !1}var i,j;try{if((j=k.constructor)&&!d.hasOwnProperty.call(k,"constructor")&&!d.hasOwnProperty.call(j.prototype,"isPrototypeOf")){return !1}}catch(g){return !1}for(i in k){}return i===e||d.hasOwnProperty.call(k,i)}});b.each("Boolean,Number,String,Function,Date,RegExp,Object,Array".split(","),function(g,f){h["[object "+g+"]"]=f=g.toLowerCase();b["is"+g]=function(i){return b.type(i)===f}});b.isArray=Array.isArray||b.isArray})(KISSY);(function(b){function l(){for(var f=0,c;c=m[f++];){try{c()}catch(g){g.stack||g,"error",setTimeout(function(){throw g},0)}}1<f&&(m=[]);e=0}var m=[],e=0;b.setImmediate=function(c){m.push(c);e||(e=1,d())};var d;if("function"===typeof setImmediate){d=function(){setImmediate(l)}}else{if("undefined"!==typeof process&&"function"===typeof process.nextTick){d=function(){process.nextTick(l)}}else{if("undefined"!==typeof MessageChannel){var n=new MessageChannel;n.port1.onmessage=function(){d=j;n.port1.onmessage=l;l()};var j=function(){n.port2.postMessage(0)};d=function(){setTimeout(l,0);j()}}else{d=function(){setTimeout(l,0)}}}}})(KISSY);(function(b){function d(i,m){for(var k=0,j=i.length-1,h=[],l;0<=j;j--){l=i[j],"."!==l&&(".."===l?k++:k?k--:h[h.length]=l)}if(m){for(;k--;k){h[h.length]=".."}}return h=h.reverse()}var e=/^(\/?)([\s\S]+\/(?!$)|\/)?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/]*)?)$/,c=b.Path={resolve:function(){var l="",m,k=arguments,j,g=0;for(m=k.length-1;0<=m&&!g;m--){j=k[m],"string"===typeof j&&j&&(l=j+"/"+l,g="/"===j.charAt(0))}l=d(b.filter(l.split("/"),function(f){return !!f}),!g).join("/");return(g?"/":"")+l||"."},normalize:function(i){var j="/"===i.charAt(0),g="/"===i.slice(-1),i=d(b.filter(i.split("/"),function(f){return !!f}),!j).join("/");!i&&!j&&(i=".");i&&g&&(i+="/");return(j?"/":"")+i},join:function(){var g=b.makeArray(arguments);return c.normalize(b.filter(g,function(f){return f&&"string"===typeof f}).join("/"))},relative:function(n,p){var n=c.normalize(n),p=c.normalize(p),k=b.filter(n.split("/"),function(f){return !!f}),j=[],i,o,h=b.filter(p.split("/"),function(f){return !!f});o=Math.min(k.length,h.length);for(i=0;i<o&&k[i]===h[i];i++){}for(o=i;i<k.length;){j.push(".."),i++}j=j.concat(h.slice(o));return j=j.join("/")},basename:function(f,i){var h;h=(f.match(e)||[])[3]||"";i&&h&&h.slice(-1*i.length)===i&&(h=h.slice(0,-1*i.length));return h},dirname:function(f){var g=f.match(e)||[],f=g[1]||"",g=g[2]||"";if(!f&&!g){return"."}g&&(g=g.substring(0,g.length-1));return f+g},extname:function(f){return(f.match(e)||[])[4]||""}}})(KISSY);(function(z,t){function u(c){c._queryMap||(c._queryMap=z.unparam(c._query))}function q(b){this._query=b||""}function p(d,c){return encodeURI(d).replace(c,function(b){b=b.charCodeAt(0).toString(16);return"%"+(1===b.length?"0"+b:b)})}function x(c){if(c instanceof x){return c.clone()}var e=this;z.mix(e,{scheme:"",userInfo:"",hostname:"",port:"",path:"",query:"",fragment:""});c=x.getComponents(c);z.each(c,function(d,g){d=d||"";if("query"===g){e.query=new q(d)}else{try{d=z.urlDecode(d)}catch(f){f+"urlDecode error : "+d}e[g]=d}});return e}var s=/[#\/\?@]/g,o=/[#\?]/g,y=/[#@]/g,w=/#/g,n=RegExp("^(?:([\\w\\d+.-]+):)?(?://(?:([^/?#@]*)@)?([\\w\\d\\-\\u0100-\\uffff.+%]*|\\[[^\\]]+\\])(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),v=z.Path,j={scheme:1,userInfo:2,hostname:3,port:4,path:5,query:6,fragment:7};q.prototype={constructor:q,clone:function(){return new q(this.toString())},reset:function(b){this._query=b||"";this._queryMap=null;return this},count:function(){var e=0,f,g;u(this);f=this._queryMap;for(g in f){z.isArray(f[g])?e+=f[g].length:e++}return e},has:function(c){var e;u(this);e=this._queryMap;return c?c in e:!z.isEmptyObject(e)},get:function(d){var c;u(this);c=this._queryMap;return d?c[d]:c},keys:function(){u(this);return z.keys(this._queryMap)},set:function(e,f){var g;u(this);g=this._queryMap;"string"===typeof e?this._queryMap[e]=f:(e instanceof q&&(e=e.get()),z.each(e,function(d,c){g[c]=d}));return this},remove:function(b){u(this);b?delete this._queryMap[b]:this._queryMap={};return this},add:function(f,e){var g,h;if("string"===typeof f){u(this),g=this._queryMap,h=g[f],h=h===t?e:[].concat(h).concat(e),g[f]=h}else{for(g in f instanceof q&&(f=f.get()),f){this.add(g,f[g])}}return this},toString:function(c){u(this);return z.param(this._queryMap,t,t,c)}};x.prototype={constructor:x,clone:function(){var c=new x,e=this;z.each(j,function(b,d){c[d]=e[d]});c.query=c.query.clone();return c},resolve:function(c){"string"===typeof c&&(c=new x(c));var i=0,h,e=this.clone();z.each("scheme,userInfo,hostname,port,path,query,fragment".split(","),function(b){if(b==="path"){if(i){e[b]=c[b]}else{if(b=c.path){i=1;if(!z.startsWith(b,"/")){if(e.hostname&&!e.path){b="/"+b}else{if(e.path){h=e.path.lastIndexOf("/");h!==-1&&(b=e.path.slice(0,h+1)+b)}}}e.path=v.normalize(b)}}}else{if(b==="query"){if(i||c.query.toString()){e.query=c.query.clone();i=1}}else{if(i||c[b]){e[b]=c[b];i=1}}}});return e},getScheme:function(){return this.scheme},setScheme:function(b){this.scheme=b;return this},getHostname:function(){return this.hostname},setHostname:function(b){this.hostname=b;return this},setUserInfo:function(b){this.userInfo=b;return this},getUserInfo:function(){return this.userInfo},setPort:function(b){this.port=b;return this},getPort:function(){return this.port},setPath:function(b){this.path=b;return this},getPath:function(){return this.path},setQuery:function(b){"string"===typeof b&&(z.startsWith(b,"?")&&(b=b.slice(1)),b=new q(p(b,y)));this.query=b;return this},getQuery:function(){return this.query},getFragment:function(){return this.fragment},setFragment:function(c){z.startsWith(c,"#")&&(c=c.slice(1));this.fragment=c;return this},isSameOriginAs:function(b){return this.hostname.toLowerCase()===b.hostname.toLowerCase()&&this.scheme.toLowerCase()===b.scheme.toLowerCase()&&this.port.toLowerCase()===b.port.toLowerCase()},toString:function(d){var i=[],h,e;if(h=this.scheme){i.push(p(h,s)),i.push(":")}if(h=this.hostname){i.push("//");if(e=this.userInfo){i.push(p(e,s)),i.push("@")}i.push(encodeURIComponent(h));if(e=this.port){i.push(":"),i.push(e)}}if(e=this.path){h&&!z.startsWith(e,"/")&&(e="/"+e),e=v.normalize(e),i.push(p(e,o))}if(d=this.query.toString.call(this.query,d)){i.push("?"),i.push(d)}if(d=this.fragment){i.push("#"),i.push(p(d,w))}return i.join("")}};x.Query=q;x.getComponents=function(e){var f=(e||"").match(n)||[],g={};z.each(j,function(d,c){g[c]=f[d]});return g};z.Uri=x})(KISSY);(function(x,r){function s(d){var c=0;return parseFloat(d.replace(/\./g,function(){return 0===c++?".":""}))}function p(e,c){var f;c.trident=0.1;if((f=e.match(/Trident\/([\d.]*)/))&&f[1]){c.trident=s(f[1])}c.core="trident"}function o(e){var c,f;return(c=e.match(/MSIE ([^;]*)|Trident.*; rv(?:\s|:)?([0-9.]+)/))&&(f=c[1]||c[2])?s(f):0}function v(A){var z,l="",y="",k,i=[6,9],g,C=n&&n.createElement("div"),B=[],f={webkit:r,trident:r,gecko:r,presto:r,chrome:r,safari:r,firefox:r,ie:r,ieMode:r,opera:r,mobile:r,core:r,shell:r,phantomjs:r,os:r,ipad:r,iphone:r,ipod:r,ios:r,android:r,nodejs:r};C&&C.getElementsByTagName&&(C.innerHTML="<!--[if IE {{version}}]><s></s><![endif]-->".replace("{{version}}",""),B=C.getElementsByTagName("s"));if(0<B.length){p(A,f);k=i[0];for(i=i[1];k<=i;k++){if(C.innerHTML="<!--[if IE {{version}}]><s></s><![endif]-->".replace("{{version}}",k),0<B.length){f[y="ie"]=k;break}}if(!f.ie&&(g=o(A))){f[y="ie"]=g}}else{if((k=A.match(/AppleWebKit\/([\d.]*)/))&&k[1]){f[l="webkit"]=s(k[1]);if((k=A.match(/OPR\/(\d+\.\d+)/))&&k[1]){f[y="opera"]=s(k[1])}else{if((k=A.match(/Chrome\/([\d.]*)/))&&k[1]){f[y="chrome"]=s(k[1])}else{if((k=A.match(/\/([\d.]*) Safari/))&&k[1]){f[y="safari"]=s(k[1])}}}if(/ Mobile\//.test(A)&&A.match(/iPad|iPod|iPhone/)){f.mobile="apple";if((k=A.match(/OS ([^\s]*)/))&&k[1]){f.ios=s(k[1].replace("_","."))}z="ios";if((k=A.match(/iPad|iPod|iPhone/))&&k[0]){f[k[0].toLowerCase()]=f.ios}}else{if(/ Android/i.test(A)){if(/Mobile/.test(A)&&(z=f.mobile="android"),(k=A.match(/Android ([^\s]*);/))&&k[1]){f.android=s(k[1])}}else{if(k=A.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/)){f.mobile=k[0].toLowerCase()}}}if((k=A.match(/PhantomJS\/([^\s]*)/))&&k[1]){f.phantomjs=s(k[1])}}else{if((k=A.match(/Presto\/([\d.]*)/))&&k[1]){if(f[l="presto"]=s(k[1]),(k=A.match(/Opera\/([\d.]*)/))&&k[1]){f[y="opera"]=s(k[1]);if((k=A.match(/Opera\/.* Version\/([\d.]*)/))&&k[1]){f[y]=s(k[1])}if((k=A.match(/Opera Mini[^;]*/))&&k){f.mobile=k[0].toLowerCase()}else{if((k=A.match(/Opera Mobi[^;]*/))&&k){f.mobile=k[0]}}}}else{if(g=o(A)){f[y="ie"]=g,p(A,f)}else{if(k=A.match(/Gecko/)){f[l="gecko"]=0.1;if((k=A.match(/rv:([\d.]*)/))&&k[1]){f[l]=s(k[1]),/Mobile|Tablet/.test(A)&&(f.mobile="firefox")}if((k=A.match(/Firefox\/([\d.]*)/))&&k[1]){f[y="firefox"]=s(k[1])}}}}}}z||(/windows|win32/i.test(A)?z="windows":/macintosh|mac_powerpc/i.test(A)?z="macintosh":/linux/i.test(A)?z="linux":/rhino/i.test(A)&&(z="rhino"));f.os=z;f.core=f.core||l;f.shell=y;f.ieMode=f.ie&&n.documentMode||f.ie;return f}var q=x.Env.host,n=q.document,q=q.navigator,w=KISSY.UA=v(q&&q.userAgent||"");if("object"===typeof process){var u,j;if((u=process.versions)&&(j=u.node)){w.os=process.platform,w.nodejs=s(j)}}w.getDescriptorFromUserAgent=v;u="webkit,trident,gecko,presto,chrome,safari,firefox,ie,opera".split(",");j=n&&n.documentElement;var t="";j&&(x.each(u,function(b){var c=w[b];c&&(t+=" ks-"+b+(parseInt(c)+""),t+=" ks-"+b)}),x.trim(t)&&(j.className=x.trim(j.className+t)))})(KISSY);
(function(L,F){var G=L.Env.host,D=L.UA,B=["","Webkit","Moz","O","ms"],J=G.document||{},E,A,K,I,z,H,u,C=J.documentElement,y,w=!0,t=!1,x="ontouchstart" in J&&!D.phantomjs,p=D.ieMode;
if(C){
C.querySelector&&8!==p&&(t=!0),y=C.style,L.each(B,function(b){var e=b?b+"Transition":"transition",d=b?b+"Transform":"transform";z===F&&e in y&&(z=b,K=e);H===F&&d in y&&(H=b,I=d)}),w="classList" in C,D=G.navigator||{},E="msPointerEnabled" in D,A="pointerEnabled" in D;
if(I){try{J=J.createElement("p"),C.insertBefore(J,C.firstChild),J.style[I]="translate3d(1px,1px,1px)",D=G.getComputedStyle(J),D=D.getPropertyValue(I)||D[I],C.removeChild(J),u=D!==F&&0<D.length&&"none"!==D}catch(_F){u=true}};
};
L.Features={isMsPointerSupported:function(){return E},isPointerSupported:function(){return A},isTouchEventSupported:function(){return x},isTouchGestureSupported:function(){return x||A||E},isDeviceMotionSupported:function(){return !!G.DeviceMotionEvent},isHashChangeSupported:function(){return"onhashchange" in G&&(!p||p>7)},isTransitionSupported:function(){return z!==F},isTransformSupported:function(){return H!==F},isTransform3dSupported:function(){return u},isClassListSupported:function(){return w},isQuerySelectorSupported:function(){return !L.config("dom/selector")&&t},isIELessThan:function(b){return !!(p&&p<b)},getTransitionPrefix:function(){return z},getTransformPrefix:function(){return H},getTransitionProperty:function(){return K},getTransformProperty:function(){return I}}})(KISSY);
(function(b){(b.Loader={}).Status={ERROR:-1,INIT:0,LOADING:1,LOADED:2,READY_TO_ATTACH:3,ATTACHING:4,ATTACHED:5}})(KISSY);(function(L){function F(f){if("string"===typeof f){return G(f)}for(var e=[],g=0,h=f.length;g<h;g++){e[g]=G(f[g])}return e}function G(c){"/"===c.charAt(c.length-1)&&(c+="index");L.endsWith(c,".js")&&(c=c.slice(0,-3));return c}function D(f,h){var i=h.indexOf("!");if(-1!==i){var g=h.substring(0,i),h=h.substring(i+1);L.use(g,{sync:!0,success:function(b,d){d.alias&&(h=d.alias(f,h,g))}})}return h}function B(d){var c;(c=d.match(/^\s*["']([^'"\s]+)["']\s*$/))||"can not find required mod in require call: "+d;return c[1]}var J=L.Loader,E=L.Path,A=L.Env.host,K=L.startsWith,I=J.Status,z=I.ATTACHED,H=I.READY_TO_ATTACH,u=I.LOADED,C=I.ATTACHING,y=I.ERROR,w=J.Utils={},t=A.document;L.mix(w,{docHead:function(){return t.getElementsByTagName("head")[0]||t.documentElement},normalDepModuleName:function(b,g){var h=0,f;if(!g){return g}if("string"===typeof g){return K(g,"../")||K(g,"./")?E.resolve(E.dirname(b),g):E.normalize(g)}for(f=g.length;h<f;h++){g[h]=w.normalDepModuleName(b,g[h])}return g},createModulesInfo:function(c,e){L.each(e,function(b){w.createModuleInfo(c,b)})},createModuleInfo:function(c,k,j){var k=G(k),i=c.Env.mods,f=i[k];return f?f:i[k]=f=new J.Module(L.mix({name:k,runtime:c},j))},getModules:function(j,q){var r=[j],o,n,l,k,i=j.Env.mods;L.each(q,function(b){o=i[b];!o||"css"!==o.getType()?(n=w.unalias(j,b),(l=L.reduce(n,function(d,c){k=i[c];return d&&k&&k.status>=C},!0))?r.push(i[n[0]].exports):r.push(null)):r.push(void 0)});return r},attachModsRecursively:function(f,e){var g,h=f.length;for(g=0;g<h;g++){w.attachModRecursively(f[g],e)}},checkModsLoadRecursively:function(s,r,o,q,n){var o=o||[],n=n||{},l,k=1,j=s.length,i=o.length;for(l=0;l<j;l++){k=k&&w.checkModLoadRecursively(s[l],r,o,q,n),o.length=i}return !!k},checkModLoadRecursively:function(i,e,m,n,l){var k,j=e.Env.mods[i];if(i in l){return l[i]}if(!j){return l[i]=!1}k=j.status;return k===y?(n.push(j),l[i]=!1):k>=H?l[i]=!0:k!==u?l[i]=!1:w.checkModsLoadRecursively(j.getNormalizedRequires(),e,m,n,l)?(j.status=H,l[i]=!0):l[i]=!1},attachModRecursively:function(e,c){var f=c.Env.mods[e];f.status>=C||(f.status=C,f.cjs||w.attachModsRecursively(f.getNormalizedRequires(),c),w.attachMod(c,f))},attachMod:function(f,h){var i=h.factory;if("function"===typeof i){var g;h.requires&&h.requires.length&&(g=L.bind(h.require,h));i=i.apply(h,h.cjs?[f,g,h.exports,h]:w.getModules(f,h.getRequiresWithAlias()));void 0!==i&&(h.exports=i)}else{h.exports=i}h.status=z},getModNamesAsArray:function(b){"string"===typeof b&&(b=b.replace(/\s+/g,"").split(","));return b},normalizeModNames:function(e,c,f){return w.unalias(e,w.normalizeModNamesWithAlias(e,c,f))},unalias:function(s,r){for(var o=[].concat(r),q,n,l,k=0,g,i=s.Env.mods;!k;){k=1;for(q=o.length-1;0<=q;q--){if((n=i[o[q]])&&"alias" in n){k=0;l=n.alias;"string"===typeof l&&(l=[l]);for(g=l.length-1;0<=g;g--){l[g]||l.splice(g,1)}o.splice.apply(o,[q,1].concat(F(l)))}}}return o},normalizeModNamesWithAlias:function(h,g,k){var l=[],j,i;if(g){j=0;for(i=g.length;j<i;j++){g[j]&&l.push(D(h,F(g[j])))}}k&&(l=w.normalDepModuleName(k,l));return l},registerModule:function(f,l,m,k){var l=G(l),j=f.Env.mods,i=j[l];i&&void 0!==i.factory?(l+" is defined more than once","warn"):(w.createModuleInfo(f,l),i=j[l],L.mix(i,{name:l,status:u,factory:m}),L.mix(i,k))},getHash:function(e){var c=5381,f;for(f=e.length;-1<--f;){c=(c<<5)+c+e.charCodeAt(f)}return c+""},getRequiresFromFn:function(d){var c=[];d.toString().replace(x,"").replace(p,function(b,e){c.push(B(e))});return c}});var x=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,p=/[^.'"]\s*require\s*\(([^)]+)\)/g})(KISSY);(function(d){function n(c,f){return f in c?c[f]:c.runtime.Config[f]}function o(c){d.mix(this,c)}function j(c){this.exports={};this.status=e.Status.INIT;this.factory=this.name=void 0;this.cjs=1;d.mix(this,c);this.waitedCallbacks=[]}var e=d.Loader,p=d.Path,m=e.Utils;o.prototype={constructor:o,reset:function(c){d.mix(this,c)},getTag:function(){return n(this,"tag")},getName:function(){return this.name},getBase:function(){return n(this,"base")},getPrefixUriForCombo:function(){var c=this.name;return this.getBase()+(c&&!this.isIgnorePackageNameInUri()?c+"/":"")},getPackageUri:function(){this.packageUri||(this.packageUri=new d.Uri(this.getPrefixUriForCombo()));return this.packageUri},getBaseUri:function(){return n(this,"baseUri")},isDebug:function(){return n(this,"debug")},isIgnorePackageNameInUri:function(){return n(this,"ignorePackageNameInUri")},getCharset:function(){return n(this,"charset")},isCombine:function(){return n(this,"combine")},getGroup:function(){return n(this,"group")}};e.Package=o;j.prototype={kissy:1,constructor:j,use:function(c,f){c=m.getModNamesAsArray(c);return KISSY.use(m.normalDepModuleName(this.name,c),f)},resolve:function(c){return this.getFullPathUri().resolve(c)},resolveByName:function(c){return m.normalDepModuleName(this.name,c)},require:function(c){return d.require(c,this.name)},wait:function(c){this.waitedCallbacks.push(c)},notifyAll:function(){for(var f,h=this.waitedCallbacks.length,i=0;i<h;i++){f=this.waitedCallbacks[i];try{f(this)}catch(g){g.stack||g,"error",setTimeout(function(){throw g},0)}}this.waitedCallbacks=[]},getType:function(){var c=this.type;c||(this.type=c=".css"===p.extname(this.name).toLowerCase()?"css":"js");return c},getFullPathUri:function(){var c,i,g,h;if(!this.fullPathUri){if(this.fullpath){i=new d.Uri(this.fullpath)}else{i=this.getPackage();c=i.getBaseUri();h=this.getPath();if(i.isIgnorePackageNameInUri()&&(g=i.name)){h=p.relative(g,h)}i=c.resolve(h);if(c=this.getTag()){c+="."+this.getType(),i.query.set("t",c)}}this.fullPathUri=i}return this.fullPathUri},getFullPath:function(){var c;this.fullpath||(c=this.getFullPathUri(),this.fullpath=c.toString());return this.fullpath},getPath:function(){var c;if(!(c=this.path)){c=this.name;var h="."+this.getType(),g="-min";c=p.join(p.dirname(c),p.basename(c,h));this.getPackage().isDebug()&&(g="");c=this.path=c+g+h}return c},getName:function(){return this.name},getPackage:function(){var f;if(!(f=this.packageInfo)){var h=this.name;f=this.runtime.config("packages");var h=h+"/",i="",g;for(g in f){d.startsWith(h,g+"/")&&g.length>i.length&&(i=g)}f=this.packageInfo=f[i]||b}return f},getTag:function(){return this.tag||this.getPackage().getTag()},getCharset:function(){return this.charset||this.getPackage().getCharset()},getRequiresWithAlias:function(){var c=this.requiresWithAlias,f=this.requires;if(!f||0===f.length){return f||[]}c||(this.requiresWithAlias=c=m.normalizeModNamesWithAlias(this.runtime,f,this.name));return c},getRequiredMods:function(){var c=this.runtime;return d.map(this.getNormalizedRequires(),function(f){return m.createModuleInfo(c,f)})},getNormalizedRequires:function(){var f,h=this.normalizedRequiresStatus,i=this.status,g=this.requires;if(!g||0===g.length){return g||[]}if((f=this.normalizedRequires)&&h===i){return f}this.normalizedRequiresStatus=i;return this.normalizedRequires=m.normalizeModNames(this.runtime,g,this.name)}};e.Module=j;var b=new o({name:"",runtime:d})})(KISSY);(function(d){function n(g,k){var l=0;if(e.webkit){g.sheet&&("webkit css poll loaded: "+k,l=1)}else{if(g.sheet){try{g.sheet.cssRules&&("same domain css poll loaded: "+k,l=1)}catch(i){var h=i.name;"css poll exception: "+h+" "+i.code+" "+k;"NS_ERROR_DOM_SECURITY_ERR"===h&&("css poll exception: "+h+"loaded : "+k,l=1)}}}return l}function o(){for(var f in b){var g=b[f],h=g.node;n(h,f)&&(g.callback&&g.callback.call(h),delete b[f])}d.isEmptyObject(b)?("clear css poll timer",m=0):m=setTimeout(o,j)}var j=30,e=d.UA,p=d.Loader.Utils,m=0,b={};p.pollCss=function(f,g){var h;h=b[f.href]={};h.node=f;h.callback=g;m||("start css poll timer",o())};p.isCssLoaded=n})(KISSY);(function(b){var l=b.Env.host.document,m=b.Loader.Utils,e=b.Path,d={},n,j=b.UA;b.getScript=function(k,w,u){function i(){var o=g.readyState;if(!o||"loaded"===o||"complete"===o){g.onreadystatechange=g.onload=null,x(0)}}var t=w,c=0,p,h,f,y;b.startsWith(e.extname(k).toLowerCase(),".css")&&(c=1);b.isPlainObject(t)&&(w=t.success,p=t.error,h=t.timeout,u=t.charset,f=t.attrs);t=d[k]=d[k]||[];t.push([w,p]);if(1<t.length){return t.node}var g=l.createElement(c?"link":"script");f&&b.each(f,function(q,o){g.setAttribute(o,q)});u&&(g.charset=u);c?(g.href=k,g.rel="stylesheet"):(g.src=k,g.async=!0);t.node=g;var x=function(o){var q;if(y){y.cancel();y=void 0}b.each(d[k],function(r){(q=r[o])&&q.call(g)});delete d[k]},w="onload" in g,u=b.Config.forceCssPoll||j.webkit&&536>j.webkit;c&&u&&w&&(w=!1);w?(g.onload=i,g.onerror=function(){g.onerror=null;x(1)}):c?m.pollCss(g,function(){x(0)}):g.onreadystatechange=i;h&&(y=b.later(function(){x(1)},1000*h));n||(n=m.docHead());c?n.appendChild(g):n.insertBefore(g,n.firstChild);return g}})(KISSY);(function(r,n){function o(c){c=c.replace(/\\/g,"/");"/"!==c.charAt(c.length-1)&&(c+="/");m?c=m.resolve(c):(r.startsWith(c,"file:")||(c="file:"+c),c=new r.Uri(c));return c}var j=r.Loader,e=j.Utils,p=r.Env.host.location,m,d,q=r.Config.fns;if(!r.UA.nodejs&&p&&(d=p.href)){m=new r.Uri(d)}r.Config.loadModsFn=function(f,g){r.getScript(f.fullpath,g)};q.packages=function(f){var k,i=this.Config,g=i.packages=i.packages||{};return f?(r.each(f,function(c,l){k=c.name||l;var h=o(c.base||c.path);c.name=k;c.base=h.toString();c.baseUri=h;c.runtime=r;delete c.path;g[k]?g[k].reset(c):g[k]=new j.Package(c)}),n):!1===f?(i.packages={},n):g};q.modules=function(f){var g=this;f&&r.each(f,function(c,i){var h=e.createModuleInfo(g,i,c);h.status===j.Status.INIT&&r.mix(h,c)})};q.base=function(f){var c=this.Config;if(!f){return c.base}f=o(f);c.base=f.toString();c.baseUri=f;return n}})(KISSY);(function(L,F){function G(g,r,q,o,l){var n=r&&r.length,d=[],h=[];L.each(r,function(f){var b,e={timeout:l,success:function(){h.push(f);b&&t&&("standard browser get mod name after load : "+b.name,I.registerModule(g,b.name,t.factory,t.config),t=F);--n||q(h,d)},error:function(){d.push(f);--n||q(h,d)},charset:o};f.combine||(b=f.mods[0],"css"===b.getType()?b=F:E&&(x=b.name,p=L.now(),e.attrs={"data-mod-name":b.name}));L.Config.loadModsFn(f,e)})}function D(c,e){L.mix(this,{runtime:c,waitingModules:e})}function B(e,d){if(!e&&"function"===typeof d&&1<d.length){var f=I.getRequiresFromFn(d);f.length&&(e=e||{},e.requires=f)}else{e&&e.requires&&!e.cjs&&(e.cjs=0)}return e}function J(f,e){for(var f=f.split(/\//),e=e.split(/\//),g=Math.min(f.length,e.length),h=0;h<g&&f[h]===e[h];h++){}return f.slice(0,h).join("/")+"/"}var E=10>L.UA.ieMode,A=L.Loader,K=A.Status,I=A.Utils,z=I.getHash,H=K.LOADING,u=K.LOADED,C=K.READY_TO_ATTACH,y=K.ERROR,w=L.now();D.groupTag=w;var t,x,p;D.add=function(g,o,n,l,h){if(3===h&&L.isArray(o)){var k=o,o=n,n={requires:k,cjs:1}}if("function"===typeof g||1===h){if(n=o,o=g,n=B(n,o),E){for(var g=L.Env.host.document.getElementsByTagName("script"),d,h=g.length-1;0<=h;h--){if(k=g[h],"interactive"===k.readyState){d=k;break}}d?d=d.getAttribute("data-mod-name"):("can not find interactive script,time diff : "+(L.now()-p),"old_ie get mod name from cache : "+x,d=x);I.registerModule(l,d,o,n);x=null;p=0}else{t={factory:o,config:n}}}else{E?(x=null,p=0):t=F,n=B(n,o),I.registerModule(l,g,o,n)}};L.augment(D,{use:function(d){var g=L.Config.timeout,f=this.runtime,d=L.keys(this.calculate(d));I.createModulesInfo(f,d);d=this.getComboUrls(d);L.each(d.css,function(c){G(f,c,function(e,h){L.each(e,function(i){L.each(i.mods,function(j){I.registerModule(f,j.name,L.noop);j.notifyAll()})});L.each(h,function(i){L.each(i.mods,function(b){b.name+" is not loaded! can not find module in path : "+i.fullpath;"error";b.status=y;b.notifyAll()})})},c.charset,g)});L.each(d.js,function(c){G(f,c,function(){L.each(c,function(e){L.each(e.mods,function(b){b.factory||(b.name+" is not loaded! can not find module in path : "+e.fullpath,"error",b.status=y);b.notifyAll()})})},c.charset,g)})},calculate:function(s,r,q){var o,n,l,d,j=this.waitingModules,e=this.runtime,q=q||{},r=r||{};for(o=0;o<s.length;o++){n=s[o],r[n]||(r[n]=1,l=I.createModuleInfo(e,n),d=l.status,d>=C||(d!==u&&!j.contains(n)&&(d!==H&&(l.status=H,q[n]=1),l.wait(function(b){j.remove(b.name);j.notifyAll()}),j.add(n)),this.calculate(l.getNormalizedRequires(),r,q)))}return q},getComboMods:function(W,U){for(var T={},S,R=this.runtime,M=0,Q=W.length,P,O,N,d,q,X,c,Z,Y;M<Q;++M){P=W[M];P=I.createModuleInfo(R,P);N=P.getType();Y=P.getFullPath();O=P.getPackage();c=O.name;q=O.getCharset();d=O.getTag();Z=O.getGroup();X=O.getPrefixUriForCombo();S=O.getPackageUri();var V=c;(P.canBeCombined=O.isCombine()&&L.startsWith(Y,X))&&Z?(V=Z+"_"+q+"_"+w,(O=U[V])?O.isSameOriginAs(S)?O.setPath(J(O.getPath(),S.getPath())):(V=c,U[c]=S):U[V]=S.clone()):U[c]=S;S=T[N]=T[N]||{};(N=S[V])?1===N.tags.length&&N.tags[0]===d||N.tags.push(d):(N=S[V]=[],N.charset=q,N.tags=[d]);N.push(P)}return T},getComboUrls:function(ag){var af=this.runtime.Config,ae=af.comboPrefix,ad=af.comboSep,ac=af.comboMaxFileNum,af=af.comboMaxUrlLength,ab={},ag=this.getComboMods(ag,ab),aa={},Z;for(Z in ag){aa[Z]={};for(var X in ag[Z]){var Y=[],W=[],V=ag[Z][X],T=V.tags,U=(T=1<T.length?z(T.join("")):T[0])?"?t="+encodeURIComponent(T)+"."+Z:"",T=U.length,M=ab[X].toString(),P=M.length,N=M+ae,R=aa[Z][X]=[],M=N.length;R.charset=V.charset;R.mods=[];for(var m=function(){R.push({combine:1,fullpath:N+Y.join(ad)+U,mods:W})},Q=0;Q<V.length;Q++){var S=V[Q];R.mods.push(S);var O=S.getFullPath();if(S.canBeCombined){if(O=O.slice(P).replace(/\?.*$/,""),Y.push(O),W.push(S),Y.length>ac||M+Y.join(ad).length+T>af){Y.pop(),W.pop(),m(),Y=[],W=[],Q--}}else{R.push({combine:0,fullpath:O,mods:[S]})}}Y.length&&m()}}return aa}});A.ComboLoader=D})(KISSY);(function(d,n){function o(c){d.mix(this,{fn:c,waitMods:{}})}var j=d.Loader,e=d.Env,p=j.Utils,m=d.setImmediate,b=j.ComboLoader;o.prototype={constructor:o,notifyAll:function(){var c=this.fn;c&&d.isEmptyObject(this.waitMods)&&(this.fn=null,c())},add:function(c){this.waitMods[c]=1},remove:function(c){delete this.waitMods[c]},contains:function(c){return this.waitMods[c]}};j.WaitingModules=o;d.mix(d,{add:function(g,i,h){b.add(g,i,h,d,arguments.length)},use:function(v,u){function r(){++c;var q=[],i=d.now(),k;k=p.checkModsLoadRecursively(t,d,n,q);c+" check duration "+(d.now()-i);k?(p.attachModsRecursively(t,d),u&&(g?w():m(w))):q.length?l&&(g?l.apply(d,q):m(function(){l.apply(d,q)})):(c+" reload "+v,f.fn=r,h.use(t))}var t,h,l,g,c=0,w,f=new o(r);d.isPlainObject(u)&&(g=u.sync,l=u.error,u=u.success);w=function(){u.apply(d,p.getModules(d,v))};v=p.getModNamesAsArray(v);v=p.normalizeModNamesWithAlias(d,v);t=p.unalias(d,v);h=new b(d,f);g?f.notifyAll():m(function(){f.notifyAll()});return d},require:function(c,h){if(c){var g=p.unalias(d,p.normalizeModNamesWithAlias(d,[c],h));p.attachModsRecursively(g,d);return p.getModules(d,g)[1]}}});e.mods={}})(KISSY);(function(t){function o(h){var k=h.src||"";if(!k.match(q)){return 0}var h=(h=h.getAttribute("data-config"))?(new Function("return "+h))():{},c=h.comboPrefix||n,b=h.comboSep||e,l,d=k.indexOf(c);-1===d?l=k.replace(s,"$1"):(l=k.substring(0,d),"/"!==l.charAt(l.length-1)&&(l+="/"),c=k.substring(d+c.length).split(b),t.each(c,function(f){if(f.match(q)){return l+=f.replace(s,"$1"),!1}}));"tag" in h||(c=k.lastIndexOf("?"),-1!==c&&(k=k.substring(c+1),h.tag=j.getHash(r+k)));h.base=h.base||l;return h}function p(){var f=m.getElementsByTagName("script"),d,g;for(d=f.length-1;0<=d;d--){if(g=o(f[d])){return g}}"must load kissy by file name in browser environment: seed.js or seed-min.js";"error";return null}var m=t.Env.host&&t.Env.host.document,j=t.Loader.Utils,r="20131209235315",n="??",e=",",s=/^(.*)(seed|kissy)(?:-min)?\.js[^/]*/i,q=/(seed|kissy)(?:-min)?\.js/i;t.config({comboPrefix:n,comboSep:e,charset:"utf-8",lang:"zh-cn",tag:r});t.UA.nodejs?t.config({charset:"utf-8",base:__dirname.replace(/\\/g,"/").replace(/\/$/,"")+"/"}):m&&m.getElementsByTagName&&t.config(t.mix({comboMaxUrlLength:2000,comboMaxFileNum:40},p()))})(KISSY);KISSY.add("i18n",{alias:function(b,c){return c+"/i18n/"+b.Config.lang}});(function(a,g){function f(){if(!b){c&&!k.nodejs&&q(i,j,f);b=1;for(var e=0;e<d.length;e++){try{d[e](a)}catch(g){g.stack||g,"error",setTimeout(function(){throw g},0)}}}}var i=a.Env.host,k=a.UA,c=i.document,h=c&&c.documentElement,l=i.location,b=0,d=[],m=/^#?([\w-]+)$/,e=/\S/,r=!(!c||!c.addEventListener),j="load",n=r?function(a,b,c){a.addEventListener(b,c,!1)}:function(a,b,c){a.attachEvent("on"+b,c)},q=r?function(a,b,c){a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent("on"+b,c)};a.mix(a,{isWindow:function(a){return null!=a&&a==a.window},parseXML:function(a){if(a.documentElement){return a}var b;try{i.DOMParser?b=(new DOMParser).parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a))}catch(c){"parseXML error :",c,b=g}(!b||!b.documentElement||b.getElementsByTagName("parsererror").length)&&"Invalid XML: "+a;return b},globalEval:function(a){a&&e.test(a)&&(i.execScript?i.execScript(a):i.eval.call(i,a))},ready:function(c){if(b){try{c(a)}catch(e){e.stack||e,"error",setTimeout(function(){throw e},0)}}else{d.push(c)}return this},available:function(b,d){var b=(b+"").match(m)[1],e=1,f=a.later(function(){if(500<++e){f.cancel()}else{var a=c.getElementById(b);a&&(d(a),f.cancel())}},40,!0)}});if(l&&-1!==(l.search||"").indexOf("ks-debug")){a.Config.debug=!0}(function(){if(!c||"complete"===c.readyState){f()}else{if(n(i,j,f),r){var a=function(){q(c,"DOMContentLoaded",a);f()};n(c,"DOMContentLoaded",a)}else{var b=function(){"complete"===c.readyState&&(q(c,"readystatechange",b),f())};n(c,"readystatechange",b);var d,e=h&&h.doScroll;try{d=null===i.frameElement}catch(g){d=!1}if(e&&d){var k=function(){try{e("left"),f()}catch(a){setTimeout(k,40)}};k()}}}})();if(k.ie){try{c.execCommand("BackgroundImageCache",!1,!0)}catch(s){}}})(KISSY,void 0);(function(b){b.config({modules:{core:{alias:"dom,event,io,anim,base,node,json,ua,cookie".split(",")},ajax:{alias:"io"},"rich-base":{alias:"base"}}});if("undefined"!==typeof location){var c=b.startsWith(location.href,"https")?"https://s.tbcdn.cn/s/kissy/":"http://a.tbcdn.cn/s/kissy/";b.config({packages:{gallery:{base:c},mobile:{base:c}}})}})(KISSY);(function(b,c,d){b({"anim/transition?":{alias:KISSY.Features.isTransitionSupported()?"anim/transition":""}});b({anim:{requires:["anim/base","anim/timer","anim/transition?"]}});b({"anim/base":{requires:["dom","promise"]}});b({"anim/timer":{requires:["dom","anim/base"]}});b({"anim/transition":{requires:["dom","event/dom","anim/base"]}});b({attribute:{requires:["event/custom"]}});b({base:{requires:["attribute"]}});b({button:{requires:["node","component/control"]}});b({color:{requires:["attribute"]}});b({combobox:{requires:["node","component/control","menu","attribute","io"]}});b({"component/container":{requires:["component/control","component/manager"]}});b({"component/control":{requires:["node","base","promise","component/manager","xtemplate/runtime"]}});b({"component/extension/align":{requires:["node"]}});b({"component/extension/content-render":{requires:["component/extension/content-xtpl"]}});b({"component/extension/delegate-children":{requires:["node","component/manager"]}});b({"component/plugin/drag":{requires:["dd"]}});b({"component/plugin/resize":{requires:["resizable"]}});b({"date/format":{requires:["date/gregorian","i18n!date"]}});b({"date/gregorian":{requires:["i18n!date"]}});b({"date/picker":{requires:["node","date/gregorian","i18n!date/picker","component/control","date/format"]}});b({"date/popup-picker":{requires:["date/picker/picker-xtpl","date/picker","component/extension/shim","component/extension/align"]}});b({dd:{requires:["node","base"]}});b({"dd/plugin/constrain":{requires:["node","base"]}});b({"dd/plugin/proxy":{requires:["node","dd","base"]}});b({"dd/plugin/scroll":{requires:["node","dd","base"]}});b({"dom/basic":{alias:["dom/base",c.isIELessThan(9)?"dom/ie":"",c.isClassListSupported()?"":"dom/class-list"]},dom:{alias:["dom/basic",!c.isQuerySelectorSupported()?"dom/selector":""]}});b({"dom/class-list":{requires:["dom/base"]}});b({"dom/ie":{requires:["dom/base"]}});b({"dom/selector":{requires:["dom/basic"]}});b({editor:{requires:["node","html-parser","component/control"]}});b({event:{requires:["event/dom","event/custom"]}});b({"event/custom":{requires:["event/base"]}});b({"event/dom":{alias:["event/dom/base",c.isTouchGestureSupported()?"event/dom/touch":"",c.isDeviceMotionSupported()?"event/dom/shake":"",c.isHashChangeSupported()?"":"event/dom/hashchange",c.isIELessThan(9)?"event/dom/ie":"",d.ie?"":"event/dom/focusin"]}});b({"event/dom/base":{requires:["event/base","dom"]}});b({"event/dom/focusin":{requires:["event/dom/base"]}});b({"event/dom/hashchange":{requires:["event/dom/base","dom"]}});b({"event/dom/ie":{requires:["event/dom/base","dom"]}});b({"event/dom/shake":{requires:["event/dom/base"]}});b({"event/dom/touch":{requires:["event/dom/base","dom"]}});b({"filter-menu":{requires:["menu","component/extension/content-xtpl","component/extension/content-render"]}});b({io:{requires:["dom","event/custom","promise","event/dom"]}});b({kison:{requires:["base"]}});b({menu:{requires:"node,component/container,component/extension/delegate-children,component/control,component/extension/content-render,component/extension/content-xtpl,component/extension/align,component/extension/shim".split(",")}});b({menubutton:{requires:["node","button","component/extension/content-xtpl","component/extension/content-render","menu"]}});b({mvc:{requires:["io","json","attribute","node"]}});b({node:{requires:["dom","event/dom","anim"]}});b({overlay:{requires:"component/container,component/extension/shim,component/extension/align,node,component/extension/content-xtpl,component/extension/content-render".split(",")}});b({resizable:{requires:["node","base","dd"]}});b({"resizable/plugin/proxy":{requires:["node","base"]}});b({"scroll-view":{alias:c.isTouchGestureSupported()?"scroll-view/drag":"scroll-view/base"}});b({"scroll-view/base":{requires:["node","anim","component/container","component/extension/content-render"]}});b({"scroll-view/drag":{requires:["scroll-view/base","node","anim"]}});b({"scroll-view/plugin/pull-to-refresh":{requires:["base"]}});b({"scroll-view/plugin/scrollbar":{requires:["base","node","component/control"]}});b({separator:{requires:["component/control"]}});b({"split-button":{requires:["component/container","button","menubutton"]}});b({stylesheet:{requires:["dom"]}});b({swf:{requires:["dom","json","attribute"]}});b({tabs:{requires:["component/container","toolbar","button"]}});b({toolbar:{requires:["component/container","component/extension/delegate-children","node"]}});b({tree:{requires:["node","component/container","component/extension/content-xtpl","component/extension/content-render","component/extension/delegate-children"]}});b({xtemplate:{requires:["xtemplate/runtime","xtemplate/compiler"]}});b({"xtemplate/compiler":{requires:["xtemplate/runtime"]}});b({"xtemplate/nodejs":{requires:["xtemplate"]}});b({"xtemplate/runtime":{requires:["path"]}})})(function(b){KISSY.config("modules",b)},KISSY.Features,KISSY.UA);(function(d){d.add("ua",function(){return d.UA});d.add("uri",function(){return d.Uri});d.add("path",function(){return d.Path});var n=d.UA,o=d.Env.host,j=(n.nodejs&&"object"===typeof global?global:o).JSON;9>n.ieMode&&(j=null);if(j){d.add("json",function(){return d.JSON=j}),d.parseJson=function(c){return j.parse(c)}}else{var e=/^[\],:{}\s]*$/,p=/(?:^|:|,)(?:\s*\[)+/g,m=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,b=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;d.parseJson=function(c){return null===c?c:"string"===typeof c&&(c=d.trim(c))&&e.test(c.replace(m,"@").replace(b,"]").replace(p,""))?(new Function("return "+c))():d.error("Invalid Json: "+c)}}d.UA.nodejs&&(d.KISSY=d,module.exports=d)})(KISSY);KISSY.add("io/form-serializer",["dom"],function(o,n){function j(c){return c.replace(l,"\r\n")}var e=n("dom"),m=/^(?:select|textarea)/i,l=/\r?\n/g,b,p=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return b={serialize:function(f,d){return o.param(b.getFormData(f),void 0,void 0,d||!1)},getFormData:function(c){var d=[],f={};o.each(e.query(c),function(g){g=g.elements?o.makeArray(g.elements):[g];d.push.apply(d,g)});d=o.filter(d,function(g){return g.name&&!g.disabled&&(g.checked||m.test(g.nodeName)||p.test(g.type))});o.each(d,function(h){var i=e.val(h),g;null!==i&&(i=o.isArray(i)?o.map(i,j):j(i),(g=f[h.name])?(g&&!o.isArray(g)&&(g=f[h.name]=[g]),g.push.apply(g,o.makeArray(i))):f[h.name]=i)});return f}}});KISSY.add("io/base",["event/custom","promise"],function(x,v){function s(d){var f=d.context;delete d.context;d=x.mix(x.clone(r),d,{deep:!0});d.context=f||d;var c,e=d.type,g=d.dataType,f=d.uri=b.resolve(d.url);d.uri.setQuery("");"crossDomain" in d||(d.crossDomain=!d.uri.isSameOriginAs(b));e=d.type=e.toUpperCase();d.hasContent=!w.test(e);if(d.processData&&(c=d.data)&&"string"!==typeof c){d.data=x.param(c,void 0,void 0,d.serializeArray)}g=d.dataType=x.trim(g||"*").split(y);!("cache" in d)&&x.inArray(g[0],["script","jsonp"])&&(d.cache=!1);d.hasContent||(d.data&&f.query.add(x.unparam(d.data)),!1===d.cache&&f.query.set("_ksTS",x.now()+"_"+x.guid()));return d}function q(D){var E=this;if(!(E instanceof q)){return new q(D)}t.call(E);D=s(D);x.mix(E,{responseData:null,config:D||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});t.Defer(E);var C;q.fire("start",{ajaxConfig:D,io:E});C=new (o[D.dataType[0]]||o["*"])(E);E.transport=C;D.contentType&&E.setRequestHeader("Content-Type",D.contentType);var k=D.dataType[0],B,i=D.timeout,h=D.context,m=D.headers,A=D.accepts;E.setRequestHeader("Accept",k&&A[k]?A[k]+("*"===k?"":", */*; q=0.01"):A["*"]);for(B in m){E.setRequestHeader(B,m[B])}if(D.beforeSend&&!1===D.beforeSend.call(h,E,D)){return E}E.readyState=1;q.fire("send",{ajaxConfig:D,io:E});D.async&&0<i&&(E.timeoutTimer=setTimeout(function(){E.abort("timeout")},1000*i));try{E.state=1,C.send()}catch(d){2>E.state?(d.stack||d,"error",E._ioReady(-1,d.message)):d}return E}var u=v("event/custom"),t=v("promise"),z=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,y=/\s+/,p=function(c){return c},w=/^(?:GET|HEAD)$/,b=new x.Uri((x.Env.host.location||{}).href),z=b&&z.test(b.getScheme()),o={},r={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:x.parseJson,html:p,text:p,xml:x.parseXML}},headers:{},responseType: false,contents:{xml:/xml/,html:/html/,json:/json/,blob:/image/}};r.converters.html=r.converters.text;x.mix(q,u.Target);x.mix(q,{isLocal:z,setupConfig:function(c){x.mix(r,c,{deep:!0})},setupTransport:function(c,d){o[c]=d},getTransport:function(c){return o[c]},getConfig:function(){return r}});return q});KISSY.add("io/xhr-transport-base",["./base"],function(t,r){function o(d,e){try{return new (e||p).XMLHttpRequest}catch(c){}}function m(c){var d;c.ifModified&&(d=c.uri,!1===c.cache&&(d=d.clone(),d.query.remove("_ksTS")),d=d.toString());return d}var q=r("./base"),p=t.Env.host,v=7<t.UA.ieMode&&p.XDomainRequest,u={proto:{}},j={},s={};q.__lastModifiedCached=j;q.__eTagCached=s;u.nativeXhr=p.ActiveXObject?function(e,f){var d;if(!b&&e&&v){d=new v}else{if(!(d=!q.isLocal&&o(e,f))){v:{try{d=new (f||p).ActiveXObject("Microsoft.XMLHTTP");break v}catch(g){}d=void 0}}}return d}:o;u.XDomainRequest_=v;var b=u.supportCORS="withCredentials" in u.nativeXhr();t.mix(u.proto,{sendInternal:function(){var l=this,B=l.io,C=B.config,k=l.nativeXhr,y=C.files,z=y?"post":C.type,A=C.async,n,H=C.mimeType,d=B.requestHeaders||{},B=B._getUrlForSend(),G=m(C),e,F;if(G){if(e=j[G]){d["If-Modified-Since"]=e}if(e=s[G]){d["If-None-Match"]=e}}(n=C.username)?k.open(z,B,A,n,C.password):k.open(z,B,A);z=C.xhrFields||{};if("withCredentials" in z && (!A || !b)) delete z.withCredentials;for(F in z){try{k[F]=z[F]}catch(D){D}}H&&k.overrideMimeType&&k.overrideMimeType(H);!1===d["X-Requested-With"]&&delete d["X-Requested-With"];if("undefined"!==typeof k.setRequestHeader){for(F in d){k.setRequestHeader(F,d[F])}}var E=C.hasContent&&C.data||null;y&&(H=E,d={},H&&(d=t.unparam(H)),d=t.mix(d,y),E=new FormData,t.each(d,function(f,c){t.isArray(f)?t.each(f,function(g){E.append(c+(C.serializeArray?"[]":""),g)}):E.append(c,f)}));if(C.responseType){k.responseType=C.responseType;}if(Dynamsoft&&Dynamsoft.WebTwainEnv&&Dynamsoft.WebTwainEnv.RawHttpSend)k.send=Dynamsoft.WebTwainEnv.RawHttpSend;k.send(E);!A||4===k.readyState?l._callback():v&&k instanceof v?(k.onload=function(){k.readyState=4;k.status=200;l._callback()},k.onerror=function(){k.readyState=4;k.status=500;l._callback()}):k.onreadystatechange=function(){l._callback()}},abort:function(){this._callback(0,1)},_callback:function(l,C){var E=this.nativeXhr,g=this.io,A,k,B,z,J,R,d=g.config;try{if(C||4===E.readyState){if(v&&E instanceof v?(E.onerror=t.noop,E.onload=t.noop):E.onreadystatechange=t.noop,C){4!==E.readyState&&E.abort()}else{A=m(d);var I=E.status;v&&E instanceof v||(g.responseHeadersString=E.getAllResponseHeaders());A&&(k=E.getResponseHeader("Last-Modified"),B=E.getResponseHeader("ETag"),k&&(j[A]=k),B&&(s[B]=B));R=E.response;if(E.responseType&&(E.responseType==='blob'||E.responseType==='arraybuffer')){g.responseData=R}else{if((J=E.responseXML)&&J.documentElement){g.responseXML=J}var e=g.responseText=E.responseText;if(d.files&&e){var H,F;if(-1!==(H=e.indexOf("<body>"))){F=e.lastIndexOf("</body>"),-1===F&&(F=e.length),e=e.slice(H+6,F)}g.responseText=t.unEscapeHtml(e)}}try{z=E.statusText}catch(G){"xhr statusText error: ",G,z=""}!I&&q.isLocal&&!d.crossDomain?I=g.responseText?200:404:1223===I&&(I=204);g._ioReady(I,z)}}}catch(D){D.stack||D,"error",setTimeout(function(){throw D},0),E.onreadystatechange=t.noop,C||g._ioReady(-1,D)}}});return u});KISSY.add("io/xdr-flash-transport",["./base","dom"],function(t,r){function o(e,f,c){b||(b=!0,e='<object id="'+u+'" type="application/x-shockwave-flash" data="'+e+'" width="0" height="0"><param name="movie" value="'+e+'" /><param name="FlashVars" value="yid='+f+"&uid="+c+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',f=s.createElement("div"),p.prepend(f,s.body||s.documentElement),f.innerHTML=e)}function m(c){"use XdrFlashTransport for: "+c.config.url;this.io=c}var q=r("./base"),p=r("dom"),v={},u="io_swf",j,s=t.Env.host.document,b=!1;t.augment(m,{send:function(){var g=this,f=g.io,d=f.config;o((d.xdr||{}).src||t.Config.base+"io/assets/io.swf",1,1);j?(g._uid=t.guid(),v[g._uid]=g,j.send(f._getUrlForSend(),{id:g._uid,uid:g._uid,method:d.type,data:d.hasContent&&d.data||{}})):setTimeout(function(){g.send()},200)},abort:function(){j.abort(this._uid)},_xdrResponse:function(y,x){var f,w=x.id,i,k=x.c,n=this.io;if(k&&(i=k.responseText)){n.responseText=decodeURI(i)}switch(y){case"success":f={status:200,statusText:"success"};delete v[w];break;case"abort":delete v[w];break;case"timeout":case"transport error":case"failure":delete v[w],f={status:"status" in k?k.status:500,statusText:k.statusText||y}}f&&n._ioReady(f.status,f.statusText)}});q.applyTo=function(f,h,d){var f=h.split(".").slice(1),g=q;t.each(f,function(c){g=g[c]});g.apply(null,d)};q.xdrReady=function(){j=s.getElementById(u)};q.xdrResponse=function(g,f){var d=v[f.uid];d&&d._xdrResponse(g,f)};return m});KISSY.add("io/sub-domain-transport",["event/dom","dom","./xhr-transport-base"],function(p,o){function j(d){var f=d.config;this.io=d;f.crossDomain=!1;"use SubDomainTransport for: "+f.url}function e(){var c=this.io.config.uri.getHostname(),c=b[c];c.ready=1;n.detach(c.iframe,"load",e,this);this.send()}var n=o("event/dom"),m=o("dom"),r=o("./xhr-transport-base"),q=p.Env.host.document,b={};p.augment(j,r.proto,{send:function(){var g=this.io.config,h=g.uri,d=h.getHostname(),f;f=b[d];var c="/sub_domain_proxy.html";g.xdr&&g.xdr.subDomain&&g.xdr.subDomain.proxy&&(c=g.xdr.subDomain.proxy);f&&f.ready?(this.nativeXhr=r.nativeXhr(0,f.iframe.contentWindow))?this.sendInternal():"document.domain not set correctly!":(f?g=f.iframe:(f=b[d]={},g=f.iframe=q.createElement("iframe"),m.css(g,{position:"absolute",left:"-9999px",top:"-9999px"}),m.prepend(g,q.body||q.documentElement),f=new p.Uri,f.setScheme(h.getScheme()),f.setPort(h.getPort()),f.setHostname(d),f.setPath(c),g.src=f.toString()),n.on(g,"load",e,this))}});return j});KISSY.add("io/xhr-transport",["./base","./xhr-transport-base","./xdr-flash-transport","./sub-domain-transport"],function(p,o){function j(g){var i=g.config,d=i.crossDomain,f=i.xdr||{},c=f.subDomain=f.subDomain||{};this.io=g;if(d&&!n.supportCORS){var h=i.uri.getHostname();if(q.domain&&p.endsWith(h,q.domain)&&!1!==c.proxy){return new r(g)}if("flash"===""+f.use||!b){return new m(g)}}g=this.nativeXhr=n.nativeXhr(d);"crossDomain: "+d+", use "+(b&&g instanceof b?"XDomainRequest":"XhrTransport")+" for: "+i.url;return this}var e=o("./base"),n=o("./xhr-transport-base"),m=o("./xdr-flash-transport"),r=o("./sub-domain-transport"),q=p.Env.host.document,b=n.XDomainRequest_;p.augment(j,n.proto,{send:function(){this.sendInternal()}});e.setupTransport("*",j);return e});KISSY.add("io/script-transport",["./base"],function(g,e){function c(i){var f=i.config;if(!f.crossDomain){return new (b.getTransport("*"))(i)}this.io=i;"use ScriptTransport for: "+f.url;return this}var b=e("./base");b.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){g.globalEval(d);return d}}}});g.augment(c,{send:function(){var i=this,f=i.io,d=f.config;i.script=g.getScript(f._getUrlForSend(),{charset:d.scriptCharset,success:function(){i._callback("success")},error:function(){i._callback("error")}})},_callback:function(j,i){var f=this.io;this.script&&(this.script=void 0,i||("error"!==j?f._ioReady(200,"success"):"error"===j&&f._ioReady(500,"script error")))},abort:function(){this._callback(0,1)}});b.setupTransport("script",c);return b});KISSY.add("io/jsonp",["./base"],function(g,e){var c=e("./base"),b=g.Env.host;c.setupConfig({jsonp:"callback",jsonpCallback:function(){return g.guid("jsonp")}});c.on("start",function(j){var i=j.io,f=i.config,j=f.dataType;if("jsonp"===j[0]){delete f.contentType;var o,d=f.jsonpCallback,k="function"===typeof d?d():d,m=b[k];f.uri.query.set(f.jsonp,k);b[k]=function(h){1<arguments.length&&(h=g.makeArray(arguments));o=[h]};i.fin(function(){b[k]=m;if(void 0===m){try{delete b[k]}catch(h){}}else{o&&m(o[0])}});i=f.converters;i.script=i.script||{};i.script.json=function(){o||" not call jsonpCallback: "+k;return o[0]};j.length=2;j[0]="script";j[1]="json"}});return c});KISSY.add("io/form",["./base","dom","./form-serializer"],function(n,m){var e=m("./base"),c=m("dom"),l=m("./form-serializer"),j=Array.prototype.slice,b=n.Env.host.FormData;e.on("start",function(t){var k,s,t=t.io.config;if(s=t.form){k=c.get(s);s=t.data;for(var g=!1,h={},p=c.query("input",k),u=0,d=p.length;u<d;u++){var r=p[u];if("file"===r.type.toLowerCase()){g=!0;if(!b){break}var q=j.call(r.files,0);h[c.attr(r,"name")]=1<q.length?q:q[0]||null}}g&&b&&(t.files=t.files||{},n.mix(t.files,h),delete t.contentType);!g||b?(k=l.getFormData(k),t.hasContent?(k=n.param(k,void 0,void 0,t.serializeArray),t.data=s?t.data+("&"+k):k):t.uri.query.add(k)):(s=t.dataType,t=s[0],"*"===t&&(t="text"),s.length=2,s[0]="iframe",s[1]=t)}});return e});KISSY.add("io/iframe-transport",["dom","./base","event/dom"],function(r,p){function m(d){var g=r.guid("io-iframe"),f=n.getEmptyIframeSrc(),d=d.iframe=n.create("<iframe "+(f?' src="'+f+'" ':"")+' id="'+g+'" name="'+g+'" style="position:absolute;left:-9999px;top:-9999px;"/>');n.prepend(d,b.body||b.documentElement);return d}function j(h,y,x){var d=[],v,w,u,l;r.each(h,function(c,e){v=r.isArray(c);w=r.makeArray(c);for(u=0;u<w.length;u++){l=b.createElement("input"),l.type="hidden",l.name=e+(v&&x?"[]":""),l.value=w[u],n.append(l,y),d.push(l)}});return d}function o(c){this.io=c;"use IframeTransport for: "+c.config.url}var n=p("dom"),t=p("./base"),s=p("event/dom"),b=r.Env.host.document,q=r.clone(t.getConfig().converters.text);q.json=function(c){return r.parseJson(r.unEscapeHtml(c))};t.setupConfig({converters:{iframe:q,text:{iframe:function(c){return c}},xml:{iframe:function(c){return c}}}});r.augment(o,{send:function(){function w(){s.on(k,"load error",u._callback,u);x.submit()}var u=this,h=u.io,v=h.config,i,k,c,d=v.data,x=n.get(v.form);u.attrs={target:n.attr(x,"target")||"",action:n.attr(x,"action")||"",encoding:n.attr(x,"encoding"),enctype:n.attr(x,"enctype"),method:n.attr(x,"method")};u.form=x;k=m(h);n.attr(x,{target:k.id,action:h._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});d&&(c=r.unparam(d));c&&(i=j(c,x,v.serializeArray));u.fields=i;6===r.UA.ie?setTimeout(w,0):w()},_callback:function(h){var w=this,d=w.form,c=w.io,h=h.type,u,v=c.iframe;if(v){if("abort"===h&&6===r.UA.ie?setTimeout(function(){n.attr(d,w.attrs)},0):n.attr(d,w.attrs),n.remove(this.fields),s.detach(v),setTimeout(function(){n.remove(v)},30),c.iframe=null,"load"===h){try{if((u=v.contentWindow.document)&&u.body){c.responseText=n.html(u.body),r.startsWith(c.responseText,"<?xml")&&(c.responseText=void 0)}c.responseXML=u&&u.XMLDocument?u.XMLDocument:u;u?c._ioReady(200,"success"):c._ioReady(500,"parser error")}catch(k){c._ioReady(500,"parser error")}}else{"error"===h&&c._ioReady(500,"error")}}},abort:function(){this._callback({type:"abort"})}});t.setupTransport("iframe",o);return t});KISSY.add("io/methods",["promise","./base"],function(m,l){function c(x){var v=x.responseText,s=x.responseXML,u=x.config,q=u.converters,t,o,w=u.contents,p=u.dataType;if((u.responseType==='blob'||u.responseType==='arraybuffer') && x.responseData){return}for(u=x.mimeType||x.getResponseHeader("Content-Type");"*"===p[0];){p.shift()}if(!p.length){for(t in w){if(w[t].test(u)){p[0]!==t&&p.unshift(t);break}}}p[0]=p[0]||"text";if(v||s){for(t=0;t<p.length;t++){if("text"===p[t]&&void 0!==v){o=v;break}else{if("xml"===p[t]&&void 0!==s){o=s;break}}}if(!o){var n={text:v,xml:s};m.each(["text","xml"],function(g){var f=p[0];if(q[g]&&q[g][f]&&n[g]){return p.unshift(g),o="text"===g?v:s,!1}})}}w=p[0];for(u=1;u<p.length;u++){t=p[u];var d=q[w]&&q[w][t];if(!d){throw"no covert for "+w+" => "+t}o=d(o);w=t}x.responseData=o}var b=l("promise"),j=l("./base"),e=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;m.extend(j,b,{setRequestHeader:function(d,f){this.requestHeaders[d]=f;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(f){var h,g,f=f.toLowerCase();if(2===this.state){if(!(g=this.responseHeaders)){for(g=this.responseHeaders={};h=e.exec(this.responseHeadersString);){g[h[1].toLowerCase()]=h[2]}}h=g[f]}return void 0===h?null:h},overrideMimeType:function(d){this.state||(this.mimeType=d);return this},abort:function(d){d=d||"abort";this.transport&&this.transport.abort(d);this._ioReady(0,d);return this},getNativeXhr:function(){var d=this.transport;return d?d.nativeXhr:null},_ioReady:function(w,u){if(2!==this.state){this.state=2;this.readyState=4;var s;if(200<=w&&300>w||304===w){if(304===w){u="not modified",s=!0}else{try{c(this),u="success",s=!0}catch(q){q.stack||q,"error",setTimeout(function(){throw q},0),u="parser error"}}}else{0>w&&(w=0)}this.status=w;this.statusText=u;var p=this.defer,o=this.config,n;if(n=this.timeoutTimer){clearTimeout(n),this.timeoutTimer=0}n=s?"success":"error";var v,i=[this.responseData,u,this],t=o.context,g={ajaxConfig:o,io:this};(v=o[n])&&v.apply(t,i);(v=o.complete)&&v.apply(t,i);j.fire(n,g);j.fire("complete",g);p[s?"resolve":"reject"](i)}},_getUrlForSend:function(){var d=this.config,g=d.uri,f=m.Uri.getComponents(d.url).query||"";return g.toString.call(g,d.serializeArray)+(f?(g.query.has()?"&":"?")+f:f)}})});KISSY.add("io","io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(","),function(j,h){function c(l,g,m,i,k){if(typeof g==="function"){i=m;m=g;g=void 0}return e({type:k||"get",url:l,data:g,success:m,dataType:i})}var b=h("io/form-serializer"),e=h("io/base");h("io/xhr-transport");h("io/script-transport");h("io/jsonp");h("io/form");h("io/iframe-transport");h("io/methods");j.mix(e,{serialize:b.serialize,get:c,post:function(k,g,l,i){if(typeof g==="function"){i=l;l=g;g=void 0}return c(k,g,l,i,"post")},jsonp:function(g,f,i){if(typeof f==="function"){i=f;f=void 0}return c(g,f,i,"jsonp")},getScript:j.getScript,getJSON:function(g,f,i){if(typeof f==="function"){i=f;f=void 0}return c(g,f,i,"json")},upload:function(l,g,m,i,k){if(typeof m==="function"){k=i;i=m;m=void 0}return e({url:l,type:"post",dataType:k,form:g,data:m,success:i})}});j.mix(j,{Ajax:e,IO:e,ajax:e,io:e,jsonp:e.jsonp});return e});KISSY.add("dom/base/api",[],function(f){var d=f.Env.host||{},j=d.document,g=f.UA,c={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},i={isCustomDomain:function(e){var e=e||d,e=i.get(e),h=e.document.domain,e=e.location.hostname;return h!==e&&h!=="["+e+"]"},getEmptyIframeSrc:function(e){e=e||d;e=i.get(e);return g.ie&&i.isCustomDomain(e)?"javascript:void(function(){"+encodeURIComponent('document.open();document.domain="'+e.document.domain+'";document.close();')+"}())":""},NodeType:c,getWindow:function(b){if(!b){return d}b=i.get(b);if(f.isWindow(b)){return b}var e=b;e.nodeType!==c.DOCUMENT_NODE&&(e=b.ownerDocument);return e.defaultView||e.parentWindow},getDocument:function(b){if(!b){return j}b=i.get(b);return f.isWindow(b)?b.document:b.nodeType===c.DOCUMENT_NODE?b:b.ownerDocument},isDomNodeList:function(e){return e&&!e.nodeType&&e.item&&!e.setTimeout},nodeName:function(e){var h=i.get(e),e=h.nodeName.toLowerCase();g.ie&&(h=h.scopeName)&&"HTML"!==h&&(e=h.toLowerCase()+":"+e);return e},_RE_NUM_NO_PX:RegExp("^("+/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source+")(?!px)[a-z%]+$","i")};f.mix(i,c);return i});KISSY.add("dom/base/attr",["./api"],function(I,D){function C(b){return null==b?"":b+""}function A(e,f){var f=H[f]||f,c=x[f];return c&&c.get?c.get(e,f):e[f]}var O=D("./api"),L=I.Env.host.document,E=O.NodeType,L=L&&L.documentElement,J=O.nodeName,P=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,G=/^(?:button|input|object|select|textarea)$/i,F=/^a(?:rea)?$/i,N=/:|^on/,M=/\r/g,K={},y={val:1,css:1,html:1,text:1,data:1,width:1,height:1,offset:1,scrollTop:1,scrollLeft:1},v={tabindex:{get:function(b){var c=b.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):G.test(b.nodeName)||F.test(b.nodeName)&&b.href?0:void 0}}},H={hidefocus:"hideFocus",tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},o={get:function(b,c){return O.prop(b,c)?c.toLowerCase():void 0},set:function(b,e,c){!1===e?O.removeAttr(b,c):(e=H[c]||c,e in b&&(b[e]=!0),b.setAttribute(c,c.toLowerCase()));return c}},x={},B={},u={select:{get:function(b){var g=b.selectedIndex,e=b.options,h;if(0>g){return null}if("select-one"===""+b.type){return O.val(e[g])}b=[];g=0;for(h=e.length;g<h;++g){e[g].selected&&b.push(O.val(e[g]))}return b},set:function(b,e){var c=I.makeArray(e);I.each(b.options,function(d){d.selected=I.inArray(O.val(d),c)});c.length||(b.selectedIndex=-1);return c}}};I.each(["radio","checkbox"],function(b){u[b]={get:function(c){return null===c.getAttribute("value")?"on":c.value},set:function(c,e){if(I.isArray(e)){return c.checked=I.inArray(O.val(c),e),1}}}});v.style={get:function(b){return b.style.cssText}};I.mix(O,{_valHooks:u,_propFix:H,_attrHooks:v,_propHooks:x,_attrNodeHook:B,_attrFix:K,prop:function(b,k,i){var l=O.query(b),h,j;if(I.isPlainObject(k)){I.each(k,function(c,e){O.prop(l,e,c)})}else{if(k=H[k]||k,j=x[k],void 0!==i){for(b=l.length-1;0<=b;b--){h=l[b],j&&j.set?j.set(h,i,k):h[k]=i}}else{if(l.length){return A(l[0],k)}}}},hasProp:function(b,k){var j=O.query(b),l,e=j.length,h;for(l=0;l<e;l++){if(h=j[l],void 0!==A(h,k)){return !0}}return !1},removeProp:function(b,k){var k=H[k]||k,i=O.query(b),l,h;for(l=i.length-1;0<=l;l--){h=i[l];try{h[k]=void 0,delete h[k]}catch(j){}}},attr:function(m,g,l,f){var b=O.query(m),h=b[0];if(I.isPlainObject(g)){var f=l,c;for(c in g){O.attr(b,c,g[c],f)}}else{if(f&&y[g]){return O[g](m,l)}g=g.toLowerCase();if(f&&y[g]){return O[g](m,l)}g=K[g]||g;m=P.test(g)?o:N.test(g)?B:v[g];if(void 0===l){if(h&&h.nodeType===E.ELEMENT_NODE){"form"===J(h)&&(m=B);if(m&&m.get){return m.get(h,g)}l=h.getAttribute(g);return""===l&&(g=h.getAttributeNode(g),!g||!g.specified)?void 0:null===l?void 0:l}}else{for(f=b.length-1;0<=f;f--){if((h=b[f])&&h.nodeType===E.ELEMENT_NODE){"form"===J(h)&&(m=B),m&&m.set?m.set(h,l,g):h.setAttribute(g,""+l)}}}}},removeAttr:function(k,l){var l=l.toLowerCase(),l=K[l]||l,j=O.query(k),i,b,f;for(f=j.length-1;0<=f;f--){if(b=j[f],b.nodeType===E.ELEMENT_NODE&&(b.removeAttribute(l),P.test(l)&&(i=H[l]||l) in b)){b[i]=!1}}},hasAttr:L&&!L.hasAttribute?function(h,b){var b=b.toLowerCase(),g=O.query(h),j,e;for(j=0;j<g.length;j++){if(e=g[j],(e=e.getAttributeNode(b))&&e.specified){return !0}}return !1}:function(h,b){var g=O.query(h),j,e=g.length;for(j=0;j<e;j++){if(g[j].hasAttribute(b)){return !0}}return !1},val:function(b,j){var l,g,k,h,d;if(void 0===j){if(k=O.get(b)){if((l=u[J(k)]||u[k.type])&&"get" in l&&void 0!==(g=l.get(k,"value"))){return g}g=k.value;return"string"===typeof g?g.replace(M,""):null==g?"":g}}else{g=O.query(b);for(h=g.length-1;0<=h;h--){k=g[h];if(1!==k.nodeType){break}d=j;null==d?d="":"number"===typeof d?d+="":I.isArray(d)&&(d=I.map(d,C));l=u[J(k)]||u[k.type];if(!l||!("set" in l)||void 0===l.set(k,d,"value")){k.value=d}}}},text:function(k,b){var l,h,g,j;if(void 0===b){return l=O.get(k),O._getText(l)}h=O.query(k);for(g=h.length-1;0<=g;g--){if(l=h[g],j=l.nodeType,j===E.ELEMENT_NODE){O.cleanData(l.getElementsByTagName("*")),"textContent" in l?l.textContent=b:l.innerText=b}else{if(j===E.TEXT_NODE||j===E.CDATA_SECTION_NODE){l.nodeValue=b}}}},_getText:function(b){return b.textContent}});return O});KISSY.add("dom/base/class",["./api"],function(j,f){function d(g){for(var g=j.trim(g||""),g=g.split(r),l=[],n,m=g.length,h=0;h<m;h++){(n=g[h])&&l.push(n)}return l}function c(b){return function(h,t){var s,n,q,m=h.classList,l=i.call(arguments,2);s=0;for(n=t.length;s<n;s++){(q=t[s])&&m[b].apply(m,[q].concat(l))}}}function p(b){return function(e,l){var h=d(l),g=i.call(arguments,2);o.query(e).each(function(m){m.nodeType===k.ELEMENT_NODE&&o[b].apply(o,[m,h].concat(g))})}}var o=f("./api"),i=[].slice,k=o.NodeType,r=/[\.\s]\s*\.?/;j.mix(o,{_hasClass:function(h,g){var q,n,l,m=h.classList;if(m.length){q=0;for(n=g.length;q<n;q++){if((l=g[q])&&!m.contains(l)){return !1}}return !0}return !1},_addClass:c("add"),_removeClass:c("remove"),_toggleClass:c("toggle"),hasClass:function(g,e){var h=o.get(g);return h&&h.nodeType===k.ELEMENT_NODE&&o._hasClass(h,d(e))},replaceClass:function(g,e,h){o.removeClass(g,e);o.addClass(g,h)},addClass:p("_addClass"),removeClass:p("_removeClass"),toggleClass:p("_toggleClass")});return o});KISSY.add("dom/base/create",["./api"],function(U,P){function O(b){b=b&&b!==S?b.createElement(Y):W;b===W&&(b.innerHTML="");return b}function M(b,e){var f=O(e);f.innerHTML="m<div>"+b+"</div>";return f.lastChild}function aa(b,g){if(g){if(J&&g.canHaveChildren&&"removeNode" in b){if(b.firstChild){b:{try{b.innerHTML="";break b}catch(h){}for(var e;e=b.lastChild;){aa(e,b)}}}b.removeNode(!1)}else{g.removeChild(b)}}}function X(b,g,h){var e=g.nodeType;if(e===R.DOCUMENT_FRAGMENT_NODE){g=g.childNodes;h=h.childNodes;for(e=0;g[e];){h[e]&&X(b,g[e],h[e]),e++}}else{if(e===R.ELEMENT_NODE){g=g.getElementsByTagName("*");h=h.getElementsByTagName("*");for(e=0;g[e];){h[e]&&b(g[e],h[e]),e++}}}}function Q(i,j){var g=U.require("event/dom"),e,h;if(j.nodeType!==R.ELEMENT_NODE||ab.hasData(i)){e=ab.data(i);for(h in e){ab.data(j,h,e[h])}g&&g.clone(i,j)}}function V(b){var g=null,h,e;if(b&&(b.push||b.item)&&b[0]){g=b[0].ownerDocument;g=g.createDocumentFragment();b=U.makeArray(b);h=0;for(e=b.length;h<e;h++){g.appendChild(b[h])}}else{"Unable to convert "+b+" to fragment."}return g}var ab=P("./api"),S=U.Env.host.document,R=ab.NodeType,Z=U.UA.ieMode,Y="div",W=S&&S.createElement(Y),K=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,G=/<([\w:]+)/,T=/^\s+/,o=/\s+$/,J=!!(Z&&9>Z),N=J,C=/<|&#?\w+;/,A=S&&"outerHTML" in S.documentElement,I=/^<(\w+)\s*\/?>(?:<\/\1>)?$/;U.mix(ab,{create:function(k,i,l,j){var h=null;if(!k){return h}if(k.nodeType){return ab.clone(k)}if("string"!==typeof k){return h}void 0===j&&(j=!0);j&&(k=U.trim(k));var j=ab._creators,n,d,l=l||S,m,g=Y;if(C.test(k)){if(m=I.exec(k)){h=l.createElement(m[1])}else{k=k.replace(K,"<$1></$2>");if((m=G.exec(k))&&(n=m[1])){g=n.toLowerCase()}n=(j[g]||M)(k,l);N&&(d=k.match(T))&&n.insertBefore(l.createTextNode(d[0]),n.firstChild);N&&/\S/.test(k)&&(d=k.match(o))&&n.appendChild(l.createTextNode(d[0]));d=n.childNodes;1===d.length?h=d[0].parentNode.removeChild(d[0]):d.length?h=V(d):k+" : create node error"}}else{h=l.createTextNode(k)}k=h;U.isPlainObject(i)&&(k.nodeType===R.ELEMENT_NODE?ab.attr(k,i,!0):k.nodeType===R.DOCUMENT_FRAGMENT_NODE&&ab.attr(k.childNodes,i,!0));return k},_fixCloneAttributes:function(b,e){"textarea"===ab.nodeName(b)&&(e.defaultValue=b.defaultValue,e.value=b.value)},_creators:{div:M},_defaultCreator:M,html:function(p,q,l){var p=ab.query(p),i=p[0],n=!1,m,k;if(!i){return null}if(void 0===q){return i.nodeType===R.ELEMENT_NODE?i.innerHTML:i.nodeType===R.DOCUMENT_FRAGMENT_NODE?(l=O(i.ownerDocument),l.appendChild(i),l.innerHTML):null}q+="";if(!q.match(/<(?:script|style|link)/i)&&(!N||!q.match(T))&&!v[(q.match(G)||["",""])[1].toLowerCase()]){try{for(m=p.length-1;0<=m;m--){k=p[m],k.nodeType===R.ELEMENT_NODE&&(ab.cleanData(k.getElementsByTagName("*")),k.innerHTML=q)}n=!0}catch(j){}}n||(q=ab.create(q,0,i.ownerDocument,0),ab.empty(p),ab.append(q,p,l))},outerHtml:function(i,j,g){var i=ab.query(i),e=i.length,h=i[0];if(!h){return null}if(void 0===j){if(A&&h.nodeType!==ab.DOCUMENT_FRAGMENT_NODE){return h.outerHTML}j=O(h.ownerDocument);j.appendChild(ab.clone(h,!0));return j.innerHTML}j+="";if(!j.match(/<(?:script|style|link)/i)&&A){for(g=e-1;0<=g;g--){h=i[g],h.nodeType===R.ELEMENT_NODE&&(ab.cleanData(h,1),h.outerHTML=j)}}else{j=ab.create(j,0,h.ownerDocument,0),ab.insertBefore(j,i,g),ab.remove(i)}},remove:function(m,n){var j,k=ab.query(m),l,b=U.require("event/dom"),h;for(h=k.length-1;0<=h;h--){j=k[h],!n&&j.nodeType===R.ELEMENT_NODE&&(l=U.makeArray(j.getElementsByTagName("*")),l.push(j),ab.removeData(l),b&&b.detach(l)),aa(j,j.parentNode)}},clone:function(m,n,k,e){"object"===typeof n&&(e=n.deepWithDataAndEvent,k=n.withDataAndEvent,n=n.deep);var m=ab.get(m),l,h=ab._fixCloneAttributes,j;if(!m){return null}j=m.nodeType;l=m.cloneNode(n);if(j===R.ELEMENT_NODE||j===R.DOCUMENT_FRAGMENT_NODE){h&&j===R.ELEMENT_NODE&&h(m,l),n&&h&&X(h,m,l)}k&&(Q(m,l),n&&e&&X(Q,m,l));return l},empty:function(e){var e=ab.query(e),g,b;for(b=e.length-1;0<=b;b--){g=e[b],ab.remove(g.childNodes)}},_nodeListToFragment:V});ab.outerHTML=ab.outerHtml;var L=ab._creators,E=ab.create,v={area:"map",thead:"table",td:"tr",th:"tr",tr:"tbody",tbody:"table",tfoot:"table",caption:"table",colgroup:"table",col:"colgroup",legend:"fieldset"},u;for(u in v){(function(b){L[u]=function(d,e){return E("<"+b+">"+d+"</"+b+">",void 0,e)}})(v[u])}v.option=v.optgroup=function(c,b){return E('<select multiple="multiple">'+c+"</select>",void 0,b)};return ab});KISSY.add("dom/base/data",["./api"],function(r,f){var d=f("./api"),c=r.Env.host,u="_ks_data_"+r.now(),t={},i={},s={applet:1,object:1,embed:1},v={hasData:function(b,e){if(b){if(void 0!==e){if(e in b){return !0}}else{if(!r.isEmptyObject(b)){return !0}}}return !1}},p={hasData:function(e,b){return e==c?p.hasData(i,b):v.hasData(e[u],b)},data:function(b,j,g){if(b==c){return p.data(i,j,g)}var h=b[u];if(void 0!==g){h=b[u]=b[u]||{},h[j]=g}else{return void 0!==j?h&&h[j]:h=b[u]=b[u]||{}}},removeData:function(b,j){if(b==c){return p.removeData(i,j)}var g=b[u];if(void 0!==j){delete g[j],r.isEmptyObject(g)&&p.removeData(b)}else{try{delete b[u]}catch(h){b[u]=void 0}}}},o={hasData:function(g,e){var b=g[u];return !b?!1:v.hasData(t[b],e)},data:function(b,h,g){if(!s[b.nodeName.toLowerCase()]){var e=b[u];if(!e){if(void 0!==h&&void 0===g){return}e=b[u]=r.guid()}b=t[e];if(void 0!==g){b=t[e]=t[e]||{},b[h]=g}else{return void 0!==h?b&&b[h]:b=t[e]=t[e]||{}}}},removeData:function(b,l){var k=b[u],h;if(k){if(h=t[k],void 0!==l){delete h[l],r.isEmptyObject(h)&&o.removeData(b)}else{delete t[k];try{delete b[u]}catch(e){b[u]=void 0}b.removeAttribute&&b.removeAttribute(u)}}}};r.mix(d,{__EXPANDO:u,hasData:function(h,l){for(var j=!1,g=d.query(h),k=0;k<g.length&&!(j=g[k],j=j.nodeType?o.hasData(j,l):p.hasData(j,l));k++){}return j},data:function(h,l,j){var h=d.query(h),g=h[0];if(r.isPlainObject(l)){for(var k in l){d.data(h,k,l[k])}}else{if(void 0===j){if(g){return g.nodeType?o.data(g,l):p.data(g,l)}}else{for(k=h.length-1;0<=k;k--){g=h[k],g.nodeType?o.data(g,l,j):p.data(g,l,j)}}}},removeData:function(h,l){var j=d.query(h),g,k;for(k=j.length-1;0<=k;k--){g=j[k],g.nodeType?o.removeData(g,l):p.removeData(g,l)}},cleanData:function(j,w){var n=d.query(j),h,q,k=r.require("event/dom");for(q=n.length-1;0<=q;q--){if(h=n[q],h.nodeType){var m=w&&r.makeArray(h.getElementsByTagName("*"))||[];m.push(h);h=0;for(var l=m.length;h<l;h++){o.removeData(m[h])}k&&k.detach(m)}else{p.removeData(h)}}}});return d});KISSY.add("dom/base/insertion",["./api"],function(s,i){function f(m,k){var n=[],l,g,j;for(l=0;m[l];l++){if(g=m[l],j=x(g),g.nodeType===o.DOCUMENT_FRAGMENT_NODE){n.push.apply(n,f(r(g.childNodes),k))}else{if("script"===j&&(!g.type||v.test(g.type))){g.parentNode&&g.parentNode.removeChild(g),k&&k.push(g)}else{if(g.nodeType===o.ELEMENT_NODE&&!t.test(j)){j=[];var y,c,q=g.getElementsByTagName("script");for(c=0;c<q.length;c++){y=q[c],(!y.type||v.test(y.type))&&j.push(y)}p.apply(m,[l+1,0].concat(j))}n.push(g)}}}return n}function d(b){b.src?s.getScript(b.src):(b=s.trim(b.text||b.textContent||b.innerHTML||""))&&s.globalEval(b)}function w(B,A,q,n){B=u.query(B);n&&(n=[]);B=f(B,n);u._fixInsertionChecked&&u._fixInsertionChecked(B);var A=u.query(A),m,y,l,e,h=A.length;if((B.length||n&&n.length)&&h){B=u._nodeListToFragment(B);1<h&&(e=u.clone(B,!0),A=s.makeArray(A));for(m=0;m<h;m++){y=A[m],B&&(l=0<m?u.clone(e,!0):B,q(l,y)),n&&n.length&&s.each(n,d)}}}var u=i("./api"),o=u.NodeType,t=/^(?:button|input|object|select|textarea)$/i,x=u.nodeName,r=s.makeArray,p=[].splice,v=/\/(java|ecma)script/i;s.mix(u,{_fixInsertionChecked:null,insertBefore:function(b,h,g){w(b,h,function(c,e){e.parentNode&&e.parentNode.insertBefore(c,e)},g)},insertAfter:function(b,h,g){w(b,h,function(c,e){e.parentNode&&e.parentNode.insertBefore(c,e.nextSibling)},g)},appendTo:function(b,h,g){w(b,h,function(c,e){e.appendChild(c)},g)},prependTo:function(b,h,g){w(b,h,function(c,e){e.insertBefore(c,e.firstChild)},g)},wrapAll:function(g,e){e=u.clone(u.get(e),!0);g=u.query(g);g[0].parentNode&&u.insertBefore(e,g[0]);for(var h;(h=e.firstChild)&&1===h.nodeType;){e=h}u.appendTo(g,e)},wrap:function(e,c){e=u.query(e);c=u.get(c);s.each(e,function(b){u.wrapAll(b,c)})},wrapInner:function(e,c){e=u.query(e);c=u.get(c);s.each(e,function(b){var g=b.childNodes;g.length?u.wrapAll(g,c):b.appendChild(c)})},unwrap:function(b){b=u.query(b);s.each(b,function(c){c=c.parentNode;u.replaceWith(c,c.childNodes)})},replaceWith:function(g,e){var h=u.query(g),e=u.query(e);u.remove(e,!0);u.insertBefore(e,h);u.remove(h)}});s.each({prepend:"prependTo",append:"appendTo",before:"insertBefore",after:"insertAfter"},function(e,c){u[c]=u[e]});return u});KISSY.add("dom/base/offset",["./api"],function(x,s){function p(e){var d,f=e.ownerDocument.body;if(!e.getBoundingClientRect){return{left:0,top:0}}d=e.getBoundingClientRect();e=d[B];d=d[z];e-=w.clientLeft||f.clientLeft||0;d-=w.clientTop||f.clientTop||0;return{left:e,top:d}}function o(b,n){var q={left:0,top:0},m=v(b),l,k=b,n=n||m;do{if(m==n){var j=k;l=p(j);j=v(j);l.left+=D[i](j);l.top+=D[F](j)}else{l=p(k)}q.left+=l.left;q.top+=l.top}while(m&&m!=n&&(k=m.frameElement)&&(m=m.parent));return q}var D=s("./api"),A=x.Env.host,u=x.UA,y=A.document,E=D.NodeType,w=y&&y.documentElement,v=D.getWindow,C=Math.max,B="left",z="top",i="scrollLeft",F="scrollTop";x.mix(D,{offset:function(H,t,G){if(void 0===t){var H=D.get(H),r;H&&(r=o(H,G));return r}G=D.query(H);for(r=G.length-1;0<=r;r--){var H=G[r],q=t;"static"===D.css(H,"position")&&(H.style.position="relative");var n=o(H),m={},l=void 0,b=void 0;for(b in q){l=parseFloat(D.css(H,b))||0,m[b]=l+q[b]-n[b]}D.css(H,m)}},scrollIntoView:function(J,I,H,G){var k,f,h,d;if(h=D.get(J)){I&&(I=D.get(I));I||(I=h.ownerDocument);I.nodeType===E.DOCUMENT_NODE&&(I=v(I));x.isPlainObject(H)&&(G=H.allowHorizontalScroll,d=H.onlyScrollIfNeeded,H=H.alignWithTop);G=void 0===G?!0:G;f=x.isWindow(I);var J=D.offset(h),b=D.outerHeight(h);k=D.outerWidth(h);var N,K,M,L;f?(f=I,N=D.height(f),K=D.width(f),L={left:D.scrollLeft(f),top:D.scrollTop(f)},f=J[B]-L[B],h=J[z]-L[z],k=J[B]+k-(L[B]+K),J=J[z]+b-(L[z]+N)):(N=D.offset(I),K=I.clientHeight,M=I.clientWidth,L={left:D.scrollLeft(I),top:D.scrollTop(I)},f=J[B]-(N[B]+(parseFloat(D.css(I,"borderLeftWidth"))||0)),h=J[z]-(N[z]+(parseFloat(D.css(I,"borderTopWidth"))||0)),k=J[B]+k-(N[B]+M+(parseFloat(D.css(I,"borderRightWidth"))||0)),J=J[z]+b-(N[z]+K+(parseFloat(D.css(I,"borderBottomWidth"))||0)));if(d){if(0>h||0<J){!0===H?D.scrollTop(I,L.top+h):!1===H?D.scrollTop(I,L.top+J):0>h?D.scrollTop(I,L.top+h):D.scrollTop(I,L.top+J)}}else{(H=void 0===H?!0:!!H)?D.scrollTop(I,L.top+h):D.scrollTop(I,L.top+J)}if(G){if(d){if(0>f||0<k){!0===H?D.scrollLeft(I,L.left+f):!1===H?D.scrollLeft(I,L.left+k):0>f?D.scrollLeft(I,L.left+f):D.scrollLeft(I,L.left+k)}}else{void 0===H||H?D.scrollLeft(I,L.left+f):D.scrollLeft(I,L.left+k)}}}},docWidth:0,docHeight:0,viewportHeight:0,viewportWidth:0,scrollTop:0,scrollLeft:0});x.each(["Left","Top"],function(g,e){var b="scroll"+g;D[b]=function(q,k){if("number"===typeof q){return arguments.callee(A,q)}var q=D.get(q),f,d,r,c;q&&q.nodeType===E.ELEMENT_NODE?void 0!==k?q[b]=parseFloat(k):f=q[b]:(c=v(q),void 0!==k?(k=parseFloat(k),d="Left"===g?k:D.scrollLeft(c),r="Top"===g?k:D.scrollTop(c),c.scrollTo(d,r)):(f=c["page"+(e?"Y":"X")+"Offset"],"number"!==typeof f&&(d=c.document,f=d.documentElement[b],"number"!==typeof f&&(f=d.body[b]))));return f}});x.each(["Width","Height"],function(b){D["doc"+b]=function(c){c=D.get(c);c=D.getDocument(c);return C(c.documentElement["scroll"+b],c.body["scroll"+b],D["viewport"+b](c))};D["viewport"+b]=function(j){var j=D.get(j),k=v(j),j=k["inner"+b];if(u.mobile&&j){return j}var j="client"+b,k=k.document,h=k.body,g=k.documentElement[j];return"CSS1Compat"===k.compatMode&&g||h&&h[j]||g}});return D});KISSY.add("dom/base/style",["./api"],function(ac,X){function W(b,c){return c.toUpperCase()}function U(b){return b.replace(R,"ms-").replace(G,W)}function ai(h,k,l){var g={},j=h.style,i;for(i in k){g[i]=j[i],j[i]=k[i]}l.call(h);for(i in k){j[i]=g[i]}}function af(i,m,n){var h,l,k;if(!(3===i.nodeType||8===i.nodeType||!(h=i.style))){if(m=U(m),k=Q[m],m=T[m]||m,void 0!==n){null===n||n===V?n=V:!isNaN(Number(n))&&!C[m]&&(n+=J);k&&k.set&&(n=k.set(i,n));if(void 0!==n){try{h[m]=n}catch(j){"css set error:"+j}n===V&&h.removeAttribute&&h.removeAttribute(m)}h.cssText||i.removeAttribute("style")}else{if(!k||!("get" in k&&void 0!==(l=k.get(i,!1)))){l=h[m]}return void 0===l?"":l}}}function Y(b){var e,f=arguments;0!==b.offsetWidth?e=ad.apply(void 0,f):ai(b,A,function(){e=ad.apply(void 0,f)});return e}function ad(j,k,g){if(ac.isWindow(j)){return k===P?aj.viewportWidth(j):aj.viewportHeight(j)}if(9===j.nodeType){return k===P?aj.docWidth(j):aj.docHeight(j)}var i=k===P?["Left","Right"]:["Top","Bottom"],h=k===P?j.offsetWidth:j.offsetHeight;if(0<h){return"border"!==g&&ac.each(i,function(b){g||(h-=parseFloat(aj.css(j,"padding"+b))||0);h="margin"===g?h+(parseFloat(aj.css(j,g+b))||0):h-(parseFloat(aj.css(j,"border"+b+"Width"))||0)}),h}h=aj._getComputedStyle(j,k);if(null===h||0>Number(h)){h=j.style[k]||0}h=parseFloat(h)||0;g&&ac.each(i,function(b){h+=parseFloat(aj.css(j,"padding"+b))||0;"padding"!==g&&(h+=parseFloat(aj.css(j,"border"+b+"Width"))||0);"margin"===g&&(h+=parseFloat(aj.css(j,g+b))||0)});return h}var aj=X("./api"),aa=ac.Env.host,Z=ac.UA,ah=ac.Features,ag=aj.nodeName,ae=aa.document,S=/^margin/,P="width",ab="display"+ac.now(),C={fillOpacity:1,fontWeight:1,lineHeight:1,opacity:1,orphans:1,widows:1,zIndex:1,zoom:1},R=/^-ms-/,V="",J="px",I=/\d(?!px)[a-z%]+$/i,Q={},T={"float":"cssFloat"},O={},G=/-([a-z])/ig,E=ae&&ae.documentElement.style||{},N;ac.each(["","Webkit","Moz","O","ms"],function(b){b=b?b+"UserSelect":"userSelect";void 0===N&&b in E&&(N=b)});if(ah.isTransformSupported()){var K;K=T.transform=ah.getTransformProperty();T.transformOrigin=K+"Origin"}ah.isTransitionSupported()&&(T.transition=ah.getTransitionProperty());ac.mix(aj,{_camelCase:U,_cssHooks:Q,_cssProps:T,_getComputedStyle:function(q,r){var j="",p,n,m,l,k;n=q.ownerDocument;r=T[r]||r;if(p=n.defaultView.getComputedStyle(q,null)){j=p.getPropertyValue(r)||p[r]}j===""&&!aj.contains(n,q)&&(j=q.style[r]);if(aj._RE_NUM_NO_PX.test(j)&&S.test(r)){k=q.style;n=k.width;m=k.minWidth;l=k.maxWidth;k.minWidth=k.maxWidth=k.width=j;j=p.width;k.width=n;k.minWidth=m;k.maxWidth=l}return j},style:function(j,k,e){var j=aj.query(j),i,h=j[0];if(ac.isPlainObject(k)){for(i in k){for(h=j.length-1;h>=0;h--){af(j[h],i,k[i])}}}else{if(e===void 0){i="";h&&(i=af(h,k,e));return i}for(h=j.length-1;h>=0;h--){af(j[h],k,e)}}},css:function(j,k,e){var j=aj.query(j),i=j[0],h;if(ac.isPlainObject(k)){for(h in k){for(i=j.length-1;i>=0;i--){af(j[i],h,k[h])}}}else{k=U(k);h=Q[k];if(e===void 0){e="";if(i&&(!h||!("get" in h&&(e=h.get(i,true))!==void 0))){e=aj._getComputedStyle(i,k)}return typeof e==="undefined"?"":e}for(i=j.length-1;i>=0;i--){af(j[i],k,e)}}},show:function(n){var n=aj.query(n),p,f,m;for(m=n.length-1;m>=0;m--){f=n[m];f.style.display=aj.data(f,ab)||V;if(aj.css(f,"display")==="none"){p=f.tagName.toLowerCase();var l=void 0,k=O[p],i=void 0;if(!O[p]){l=ae.body||ae.documentElement;i=ae.createElement(p);aj.prepend(i,l);k=aj.css(i,"display");l.removeChild(i);O[p]=k}p=k;aj.data(f,ab,p);f.style.display=p}}},hide:function(j){var j=aj.query(j),k,g;for(g=j.length-1;g>=0;g--){k=j[g];var i=k.style,h=i.display;if(h!=="none"){h&&aj.data(k,ab,h);i.display="none"}}},toggle:function(f){var f=aj.query(f),g,e;for(e=f.length-1;e>=0;e--){g=f[e];aj.css(g,"display")==="none"?aj.show(g):aj.hide(g)}},addStyleSheet:function(h,i,f){if(typeof h==="string"){f=i;i=h;h=aa}var h=aj.getDocument(h),g;if(f&&(f=f.replace("#",V))){g=aj.get("#"+f,h)}if(!g){g=aj.create("<style>",{id:f},h);aj.get("head",h).appendChild(g);g.styleSheet?g.styleSheet.cssText=i:g.appendChild(h.createTextNode(i))}},unselectable:function(m){var m=aj.query(m),d,l,k=0,j,h;for(l=m.length-1;l>=0;l--){d=m[l];h=d.style;if(N!==void 0){h[N]="none"}else{if(Z.ie){h=d.getElementsByTagName("*");d.setAttribute("unselectable","on");for(j=["iframe","textarea","input","select"];d=h[k++];){ac.inArray(ag(d),j)||d.setAttribute("unselectable","on")}}}}},innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0,width:0,height:0});ac.each([P,"height"],function(b){aj["inner"+ac.ucfirst(b)]=function(d){return(d=aj.get(d))&&Y(d,b,"padding")};aj["outer"+ac.ucfirst(b)]=function(g,d){var f=aj.get(g);return f&&Y(f,b,d?"margin":"border")};aj[b]=function(g,d){var f=aj.css(g,b,d);f&&(f=parseFloat(f));return f};Q[b]={get:function(e,f){var d;f&&(d=Y(e,b)+"px");return d}}});var A={position:"absolute",visibility:"hidden",display:"block"};ac.each(["left","top"],function(b){Q[b]={get:function(k,d){var j,i,f;if(d){f=aj.css(k,"position");if(f==="static"){return"auto"}j=aj._getComputedStyle(k,b);if((i=j==="auto")&&f==="relative"){return"0px"}if(i||I.test(j)){f={top:0,left:0};if(aj.css(k,"position")==="fixed"){i=k.getBoundingClientRect()}else{for(j=k.offsetParent||(k.ownerDocument||ae).body;j&&!o.test(j.nodeName)&&aj.css(j,"position")==="static";){j=j.offsetParent}i=aj.offset(k);f=aj.offset(j);f.top=f.top+(parseFloat(aj.css(j,"borderTopWidth"))||0);f.left=f.left+(parseFloat(aj.css(j,"borderLeftWidth"))||0)}i.top=i.top-(parseFloat(aj.css(k,"marginTop"))||0);i.left=i.left-(parseFloat(aj.css(k,"marginLeft"))||0);j={top:i.top-f.top,left:i.left-f.left}[b]+"px"}}return j}}});var o=/^(?:body|html)$/i;return aj});KISSY.add("dom/base/selector",["./api"],function(U,P){function O(b){var e=this.length,f;for(f=0;f<e&&!1!==b(this[f],f);f++){}}function M(b){b=b.substr(1);if(!b){throw Error("An invalid or illegal string was specified for selector.")}return b}function aa(b){return function(c){var d=Z._getElementById(b,Y);return d&&Z._contains(c,d)?[d]:[]}}function X(b){return function(d){return d.getElementsByClassName(b)}}function Q(b){return function(d){return d.getElementsByTagName(b)}}function V(s,l){var i,h,e="string"===typeof s,g=void 0!==l?V(l):(h=1)&&[Y],b=g.length;if(s){if(e){s=u(s);if(h){if("body"===s){i=[Y.body]}else{if(A.test(s)&&G){i=Y.getElementsByClassName(RegExp.$1)}else{if(E.test(s)){i=(h=Z._getElementById(RegExp.$2,Y))&&h.nodeName.toLowerCase()===RegExp.$1?[h]:[]}else{if(I.test(s)){i=(h=Z._getElementById(s.substr(1),Y))?[h]:[]}else{if(L.test(s)){i=Y.getElementsByTagName(s)}else{if(!s.match(/,|\+|=|~|\[|\]|:|>|\||\$|\^|\*|\(|\)|[\w-]+\.[\w-]+|[\w-]+#[\w-]+/)&&G){i=s.split(/\s+/);var c=g,d,q;h=0;for(e=i.length;h<e;h++){d=i;q=h;var w;w=i[h];var t=w.charAt(0);w="#"===t?aa(M(w)):"."===t?X(M(w)):Q(w);d[q]=w}h=0;for(e=i.length;h<e;h++){w=i[h];var t=[],n;d=0;for(q=c.length;d<q;d++){n=w(c[d]),t.push.apply(t,U.makeArray(n))}c=t;if(!c.length){break}}i=c&&1<c.length?Z.unique(c):c}}}}}}}if(!i){i=[];for(h=0;h<b;h++){C.apply(i,Z._selectInternal(s,g[h]))}1<i.length&&1<b&&Z.unique(i)}}else{if(i=s.nodeType||s.setTimeout?[s]:s.getDOMNodes?s.getDOMNodes():T(s)?s:J(s)?o(s):[s],!h){e=i;d=e.length;i=[];for(h=0;h<d;h++){for(c=0;c<b;c++){if(Z._contains(g[c],e[h])){i.push(e[h]);break}}}}}}else{i=[]}i.each=O;return i}function ab(b,f){var e=b&&S(b,"class");return e&&(e=e.replace(/[\r\t\n]/g,N))&&-1<(N+e+N).indexOf(N+f+N)}function S(b,f){var e=b&&b.getAttributeNode(f);if(e&&e.specified){return e.nodeValue}}function R(b,d){return"*"===d||b.nodeName.toLowerCase()===d.toLowerCase()}var Z=P("./api"),Y=U.Env.host.document,W=Y.documentElement,K=W.matches||W.webkitMatchesSelector||W.mozMatchesSelector||W.oMatchesSelector||W.msMatchesSelector,G="getElementsByClassName" in Y,T=U.isArray,o=U.makeArray,J=Z.isDomNodeList,N=" ",C=Array.prototype.push,A=/^\.([\w-]+)$/,I=/^#([\w-]+)$/,L=/^([\w-])+$/,E=/^([\w-]+)#([\w-]+)$/,v=/^(?:#([\w-]+))?\s*([\w-]+|\*)?\.?([\w-]+)?$/,u=U.trim;U.mix(Z,{_compareNodeOrder:function(b,d){return !b.compareDocumentPosition||!d.compareDocumentPosition?b.compareDocumentPosition?-1:1:b.compareDocumentPosition(d)&4?-1:1},_getElementsByTagName:function(b,d){return U.makeArray(d.querySelectorAll(b))},_getElementById:function(b,d){return d.getElementById(b)},_getSimpleAttr:S,_isTag:R,_hasSingleClass:ab,_matchesInternal:function(h,l){for(var k=[],g=0,j,i=l.length;g<i;g++){j=l[g],K.call(j,h)&&k.push(j)}return k},_selectInternal:function(b,d){return o(d.querySelectorAll(b))},query:V,get:function(b,d){return V(b,d)[0]||null},unique:function(){function e(d,g){return d===g?(f=!0,0):Z._compareNodeOrder(d,g)}var f,c=!0;[0,0].sort(function(){c=!1;return 0});return function(g){f=c;g.sort(e);if(f){for(var d=1,b=g.length;d<b;){g[d]===g[d-1]?(g.splice(d,1),--b):d++}}return g}}(),filter:function(p,g,n){var p=V(p,n),k,j,h,c,n=[];if("string"===typeof g&&(g=u(g))&&(h=v.exec(g))){k=h[1],j=h[2],c=h[3],k?k&&!j&&!c&&(g=function(b){return S(b,"id")===k}):g=function(i){var f=!0,e=!0;j&&(f=R(i,j));c&&(e=ab(i,c));return e&&f}}return n="function"===typeof g?U.filter(p,g):Z._matchesInternal(g,p)},test:function(e,f,c){e=V(e,c);return e.length&&Z.filter(e,f,c).length===e.length}});return Z});KISSY.add("dom/base/traversal",["./api"],function(g,d){function k(t,u,o,l,s,r,q){if(!(t=j.get(t))){return null}if(0===u){return t}r||(t=t[o]);if(!t){return null}s=s&&j.get(s)||null;void 0===u&&(u=1);var r=[],h=g.isArray(u),e,p;"number"===typeof u&&(e=0,p=u,u=function(){return ++e===p});for(;t&&t!==s;){if((t.nodeType===f.ELEMENT_NODE||t.nodeType===f.TEXT_NODE&&q)&&i(t,u)&&(!l||l(t))){if(r.push(t),!h){break}}t=t[o]}return h?r:r[0]||null}function i(e,h){if(!h){return !0}if(g.isArray(h)){var m,l=h.length;if(!l){return !0}for(m=0;m<l;m++){if(j.test(e,h[m])){return !0}}}else{if(j.test(e,h)){return !0}}return !1}function c(e,h,m,l){var p=[],o,n;if((o=e=j.get(e))&&m){o=e.parentNode}if(o){m=g.makeArray(o.childNodes);for(o=0;o<m.length;o++){n=m[o],(l||n.nodeType===f.ELEMENT_NODE)&&n!==e&&p.push(n)}h&&(p=j.filter(p,h))}return p}var j=d("./api"),f=j.NodeType;g.mix(j,{_contains:function(e,h){return !!(e.compareDocumentPosition(h)&16)},closest:function(l,m,o,n){return k(l,m,"parentNode",function(b){return b.nodeType!==f.DOCUMENT_FRAGMENT_NODE},o,!0,n)},parent:function(h,l,m){return k(h,l,"parentNode",function(b){return b.nodeType!==f.DOCUMENT_FRAGMENT_NODE},m,void 0)},first:function(e,l,m){e=j.get(e);return k(e&&e.firstChild,l,"nextSibling",void 0,void 0,!0,m)},last:function(e,l,m){e=j.get(e);return k(e&&e.lastChild,l,"previousSibling",void 0,void 0,!0,m)},next:function(h,l,m){return k(h,l,"nextSibling",void 0,void 0,void 0,m)},prev:function(h,l,m){return k(h,l,"previousSibling",void 0,void 0,void 0,m)},siblings:function(m,b,l){return c(m,b,!0,l)},children:function(h,b){return c(h,b,void 0)},contents:function(h,b){return c(h,b,void 0,1)},contains:function(e,h){e=j.get(e);h=j.get(h);return e&&h?j._contains(e,h):!1},index:function(e,h){var m=j.query(e),l,n=0;l=m[0];if(!h){m=l&&l.parentNode;if(!m){return -1}for(;l=l.previousSibling;){l.nodeType===f.ELEMENT_NODE&&n++}return n}n=j.query(h);return"string"===typeof h?g.indexOf(l,n):g.indexOf(n[0],m)},equals:function(e,l){e=j.query(e);l=j.query(l);if(e.length!==l.length){return !1}for(var m=e.length;0<=m;m--){if(e[m]!==l[m]){return !1}}return !0}});return j});KISSY.add("dom/base","./base/api,./base/attr,./base/class,./base/create,./base/data,./base/insertion,./base/offset,./base/style,./base/selector,./base/traversal".split(","),function(c,b){var d=b("./base/api");b("./base/attr");b("./base/class");b("./base/create");b("./base/data");b("./base/insertion");b("./base/offset");b("./base/style");b("./base/selector");b("./base/traversal");c.mix(c,{DOM:d,get:d.get,query:d.query});return d});KISSY.add("event/custom/observer",["event/base"],function(e,f){function b(){b.superclass.constructor.apply(this,arguments)}var d=f("event/base");e.extend(b,d.Observer,{keys:["fn","context","groups"]});return b});KISSY.add("event/custom/object",["event/base"],function(e,f){function b(g){b.superclass.constructor.call(this);e.mix(this,g)}var d=f("event/base");e.extend(b,d.Object);return b});KISSY.add("event/custom/observable",["event/base","./observer","./object"],function(h,m){function b(){b.superclass.constructor.apply(this,arguments);this.defaultFn=null;this.defaultTargetOnly=!1;this.bubbles=!0}var f=m("event/base"),e=m("./observer"),l=m("./object"),d=f.Utils;h.extend(b,f.Observable,{on:function(c){c=new e(c);h.Config.debug&&(c.fn||"lack event handler for "+this.type);-1===this.findObserver(c)&&this.observers.push(c)},fire:function(q){var q=q||{},n=this.bubbles,p=this.currentTarget,o,i=this.type,c=this.defaultFn,g,j=q,r;q.type=i;j instanceof l||(j.target=p,j=new l(j));j.currentTarget=p;q=this.notify(j);!1!==r&&void 0!==q&&(r=q);if(n&&!j.isPropagationStopped()){o=(n=p.getTargets())&&n.length||0;for(g=0;g<o&&!j.isPropagationStopped();g++){q=n[g].fire(i,j),!1!==r&&void 0!==q&&(r=q)}}if(c&&!j.isDefaultPrevented()&&(i=j.target,q=i.getCustomEventObservable(j.type),!this.defaultTargetOnly&&!q.defaultTargetOnly||p===i)){r=c.call(p,j)}return r},notify:function(c){var j=[].concat(this.observers),o,n,i=j.length,g;for(g=0;g<i&&!c.isImmediatePropagationStopped();g++){o=j[g].notify(c,this),!1!==n&&void 0!==o&&(n=o)}return n},detach:function(v){var w,t=v.fn,s=v.context,r=this.currentTarget,k=this.observers,v=v.groups;if(k.length){v&&(w=d.getGroupsRe(v));var n,q,u,p,o=k.length;if(t||w){s=s||r;n=v=0;for(q=[];v<o;++v){if(u=k[v],p=u.context||r,s!==p||t&&t!==u.fn||w&&!u.groups.match(w)){q[n++]=u}}this.observers=q}else{this.reset()}}}});return b});KISSY.add("event/custom/target",["event/base","./observable"],function(f,k){var b=k("event/base"),e=k("./observable"),d=b.Utils,h=d.splitAndRun;return{isTarget:1,getCustomEventObservable:function(g,c){var i,j=this.getCustomEvents();i=j&&j[g];!i&&c&&(i=j[g]=new e({currentTarget:this,type:g}));return i},fire:function(i,g){var j=this,m,l=j.getTargets(),n=l&&l.length,g=g||{};h(i,function(c){var o;d.fillGroupsForEvent(c,g);c=g.type;if((o=j.getCustomEventObservable(c))||n){if(o){if(!o.hasObserver()&&!o.defaultFn&&(o.bubbles&&!n||!o.bubbles)){return}}else{o=new e({currentTarget:j,type:c})}c=o.fire(g);!1!==m&&void 0!==c&&(m=c)}});return m},publish:function(i,g){var l,j=this;h(i,function(c){l=j.getCustomEventObservable(c,!0);f.mix(l,g)});return j},addTarget:function(g){var c=this.getTargets();f.inArray(g,c)||c.push(g);return this},removeTarget:function(g){var c=this.getTargets(),g=f.indexOf(g,c);-1!==g&&c.splice(g,1);return this},getTargets:function(){return this["__~ks_bubble_targets"]||(this["__~ks_bubble_targets"]=[])},getCustomEvents:function(){return this["__~ks_custom_events"]||(this["__~ks_custom_events"]={})},on:function(i,g,l){var j=this;d.batchForType(function(n,m,o){m=d.normalizeParam(n,m,o);n=m.type;if(n=j.getCustomEventObservable(n,!0)){n.on(m)}},0,i,g,l);return j},detach:function(i,g,l){var j=this;d.batchForType(function(n,m,p){var o=d.normalizeParam(n,m,p);(n=o.type)?(n=j.getCustomEventObservable(n,!0))&&n.detach(o):(n=j.getCustomEvents(),f.each(n,function(c){c.detach(o)}))},0,i,g,l);return j}}});KISSY.add("event/custom",["./custom/target"],function(d,e){var b=e("./custom/target");return{Target:b,global:d.mix({},b)}});KISSY.add("event/base/utils",[],function(b){function g(d){if(0>d.indexOf(".")){return[d,""]}var c=d.match(/([^.]+)?(\..+)?$/),d=[c[1]];(c=c[2])?(c=c.split(".").sort(),d.push(c.join("."))):d.push("");return d}var h,i;return{splitAndRun:h=function(d,c){b.isArray(d)?b.each(d,c):(d=b.trim(d),-1===d.indexOf(" ")?c(d):b.each(d.split(/\s+/),c))},normalizeParam:function(f,e,k){var j=e||{},j="function"===typeof e?{fn:e,context:k}:b.merge(j),e=g(f),f=e[0];j.groups=e[1];j.type=f;return j},batchForType:function(f,d){var k=b.makeArray(arguments),j=k[2+d];j&&"object"===typeof j?b.each(j,function(m,l){var c=[].concat(k);c.splice(0,2);c[d]=l;c[d+1]=m;f.apply(null,c)}):h(j,function(l){var c=[].concat(k);c.splice(0,2);c[d]=l;f.apply(null,c)})},fillGroupsForEvent:function(e,c){var k=g(e),j=k[1];j&&(j=i(j),c._ksGroups=j);c.type=k[0]},getGroupsRe:i=function(c){return RegExp(c.split(".").join(".*\\.")+"(?:\\.|$)")}}});KISSY.add("event/base/object",[],function(g,h){function i(){this.timeStamp=g.now();this.currentTarget=this.target=h}var j=function(){return !1},b=function(){return !0};i.prototype={constructor:i,isDefaultPrevented:j,isPropagationStopped:j,isImmediatePropagationStopped:j,preventDefault:function(){this.isDefaultPrevented=b},stopPropagation:function(){this.isPropagationStopped=b},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=b;this.stopPropagation()},halt:function(c){c?this.stopImmediatePropagation():this.stopPropagation();this.preventDefault()}};return i});KISSY.add("event/base/observer",[],function(b,c){function g(d){b.mix(this,d)}g.prototype={constructor:g,equals:function(e){var d=this;return !!b.reduce(d.keys,function(f,h){return f&&d[h]===e[h]},1)},simpleNotify:function(f,e){var d;d=this.fn.call(this.context||e.currentTarget,f,this.data);this.once&&e.removeObserver(this);return d},notifyInternal:function(f,e){var d=this.simpleNotify(f,e);!1===d&&f.halt();return d},notify:function(f,e){var d=f._ksGroups;return d&&(!this.groups||!this.groups.match(d))?c:this.notifyInternal(f,e)}};return g});KISSY.add("event/base/observable",[],function(b){function c(e){this.currentTarget=null;b.mix(this,e);this.reset()}c.prototype={constructor:c,hasObserver:function(){return !!this.observers.length},reset:function(){this.observers=[]},removeObserver:function(g){var h,f=this.observers,e=f.length;for(h=0;h<e;h++){if(f[h]===g){f.splice(h,1);break}}this.checkMemory()},checkMemory:function(){},findObserver:function(f){var g=this.observers,e;for(e=g.length-1;0<=e;--e){if(f.equals(g[e])){return e}}return -1}};return c});KISSY.add("event/base",["./base/utils","./base/object","./base/observer","./base/observable"],function(i,j){var k=j("./base/utils"),l=j("./base/object"),h=j("./base/observer"),g=j("./base/observable");return{Utils:k,Object:l,Observer:h,Observable:g}});KISSY.add("promise",[],function(u){function B(c){"undefined"!==typeof console&&console.error&&console.error(c)}function h(g,e,i){if(g instanceof x){d(function(){i.call(g,g[z])})}else{var f=g[z],j=g[w];j?j.push([e,i]):q(f)?h(f,e,i):e&&d(function(){e.call(g,f)})}}function y(c){if(!(this instanceof y)){return new y(c)}this.promise=c||new A;this.promise.defer=this}function q(c){return c&&c instanceof A}function A(c){this[z]=c;void 0===c&&(this[w]=[],this[l]=[])}function x(c){if(c instanceof x){return c}A.apply(this,arguments);this[z] instanceof A&&"assert.not(this.__promise_value instanceof promise) in Reject constructor";return this}function v(g,c,n){function f(e){try{return c?c.call(this,e):e}catch(o){return B(o.stack||o),new x(o)}}function m(o){try{return n?n.call(this,o):new x(o)}catch(e){return B(e.stack||e),new x(e)}}function i(e){j?"already done at fulfilled":e instanceof A?"assert.not(value instanceof Promise) in when":(j=1,k.resolve(f.call(this,e)))}var k=new y,j=0;g instanceof A?h(g,i,function(e){j?"already done at rejected":(j=1,k.resolve(m.call(this,e)))}):i(g);return k.promise}function b(c){return !C(c)&&q(c)&&void 0===c[w]&&(!q(c[z])||b(c[z]))}function C(c){return q(c)&&void 0===c[w]&&c[z] instanceof x}var z="__promise_value",d=u.setImmediate,l="__promise_progress_listeners",w="__promise_pendings";y.prototype={constructor:y,resolve:function(e){var c=this.promise,f;if(!(f=c[w])){return null}c[z]=e;f=[].concat(f);c[w]=void 0;c[l]=void 0;u.each(f,function(g){h(c,g[0],g[1])});return e},reject:function(c){return this.resolve(new x(c))},notify:function(c){u.each(this.promise[l],function(e){d(function(){e(c)})})}};A.prototype={constructor:A,then:function(e,c,f){f&&this.progress(f);return v(this,e,c)},progress:function(c){this[l]&&this[l].push(c);return this},fail:function(c){return v(this,0,c)},fin:function(c){return v(this,function(e){return c(e,!0)},function(e){return c(e,!1)})},done:function(e,c){(e||c?this.then(e,c):this).fail(function(f){f.stack||f;"error";setTimeout(function(){throw f},0)})},isResolved:function(){return b(this)},isRejected:function(){return C(this)}};u.extend(x,A);KISSY.Defer=y;KISSY.Promise=A;A.Defer=y;u.mix(A,{when:v,isPromise:q,isResolved:b,isRejected:C,all:function(f){var e=f.length;if(!e){return null}for(var g=new y,i=0;i<f.length;i++){(function(k,j){v(k,function(m){f[j]=m;0===--e&&g.resolve(f)},function(c){g.reject(c)})})(f[i],i)}return g.promise},async:function(c){return function(){function g(f,e){var n;try{n=i[f](e)}catch(m){return new x(m)}return n.done?n.value:v(n.value,k,j)}function k(e){return g("next",e)}function j(e){return g("throw",e)}var i=c.apply(this,arguments);return k()}}});return A});KISSY.add("event/dom/base/utils",["dom"],function(g,e){var f=e("dom"),j="ksEventTargetId_"+g.now(),h=g.Env.host.document;return{simpleAdd:h&&h.addEventListener?function(k,i,l,m){k.addEventListener&&k.addEventListener(i,l,!!m)}:function(i,c,k){i.attachEvent&&i.attachEvent("on"+c,k)},simpleRemove:h&&h.removeEventListener?function(k,i,l,m){k.removeEventListener&&k.removeEventListener(i,l,!!m)}:function(i,c,k){i.detachEvent&&i.detachEvent("on"+c,k)},data:function(c,i){return f.data(c,j,i)},removeData:function(c){return f.removeData(c,j)}}});KISSY.add("event/dom/base/special",[],function(){return{}});KISSY.add("event/dom/base/observer",["event/base","./special"],function(g,e){function f(c){f.superclass.constructor.call(this,c)}var j=e("event/base"),h=e("./special");g.extend(f,j.Observer,{keys:"fn,filter,data,context,originalType,groups,last".split(","),notifyInternal:function(l,d){var p,n,m=l.type,o;(o=this.originalType)?l.type=o:o=m;(p=h[o])&&p.handle?(p=p.handle(l,this,d))&&0<p.length&&(n=p[0]):n=this.simpleNotify(l,d);!1===n&&l.halt();l.type=m;return n}});return f});KISSY.add("event/dom/base/object",["event/base"],function(l,t){function u(){return v}function q(){return e}function p(k){var c=k.type;p.superclass.constructor.call(this);this.originalEvent=k;var i=q;"defaultPrevented" in k?i=k.defaultPrevented?u:q:"getPreventDefault" in k?i=k.getPreventDefault()?u:q:"returnValue" in k&&(i=k.returnValue===e?u:q);this.isDefaultPrevented=i;var d=[],h,b=j.concat();l.each(n,function(m){c.match(m.reg)&&(b=b.concat(m.props),m.fix&&d.push(m.fix))});for(i=b.length;i;){h=b[--i],this[h]=k[h]}this.target||(this.target=k.srcElement||g);3===this.target.nodeType&&(this.target=this.target.parentNode);for(i=d.length;i;){h=d[--i],h(this,k)}}var f=t("event/base"),g=l.Env.host.document,v=!0,e=!1,j="altKey,bubbles,cancelable,ctrlKey,currentTarget,eventPhase,metaKey,shiftKey,target,timeStamp,view,type".split(","),n=[{reg:/^key/,props:["char","charCode","key","keyCode","which"],fix:function(b,c){null==b.which&&(b.which=null!=c.charCode?c.charCode:c.keyCode);void 0===b.metaKey&&(b.metaKey=b.ctrlKey)}},{reg:/^touch/,props:["touches","changedTouches","targetTouches"]},{reg:/^gesturechange$/i,props:["rotation","scale"]},{reg:/^(mousewheel|DOMMouseScroll)$/,props:[],fix:function(z,m){var s,o,r,k=m.wheelDelta,i=m.axis,y=m.wheelDeltaY,x=m.wheelDeltaX,w=m.detail;k&&(r=k/120);w&&(r=-(0===w%3?w/3:w));void 0!==i&&(i===z.HORIZONTAL_AXIS?(o=0,s=-1*r):i===z.VERTICAL_AXIS&&(s=0,o=r));void 0!==y&&(o=y/120);void 0!==x&&(s=-1*x/120);!s&&!o&&(o=r);void 0!==s&&(z.deltaX=s);void 0!==o&&(z.deltaY=o);void 0!==r&&(z.delta=r)}},{reg:/^mouse|contextmenu|click|mspointer|(^DOMMouseScroll$)/i,props:"buttons,clientX,clientY,button,offsetX,relatedTarget,which,fromElement,toElement,offsetY,pageX,pageY,screenX,screenY".split(","),fix:function(b,d){var m,i,k=b.target,c=d.button;null==b.pageX&&null!=d.clientX&&(m=k.ownerDocument||g,i=m.documentElement,m=m.body,b.pageX=d.clientX+(i&&i.scrollLeft||m&&m.scrollLeft||0)-(i&&i.clientLeft||m&&m.clientLeft||0),b.pageY=d.clientY+(i&&i.scrollTop||m&&m.scrollTop||0)-(i&&i.clientTop||m&&m.clientTop||0));!b.which&&void 0!==c&&(b.which=c&1?1:c&2?3:c&4?2:0);!b.relatedTarget&&b.fromElement&&(b.relatedTarget=b.fromElement===k?b.toElement:b.fromElement);return b}}];l.extend(p,f.Object,{constructor:p,preventDefault:function(){var b=this.originalEvent;b.preventDefault?b.preventDefault():b.returnValue=e;p.superclass.preventDefault.call(this)},stopPropagation:function(){var b=this.originalEvent;b.stopPropagation?b.stopPropagation():b.cancelBubble=v;p.superclass.stopPropagation.call(this)}});return p});KISSY.add("event/dom/base/observable","event/base,dom,./special,./utils,./observer,./object".split(","),function(j,p){function q(b){j.mix(this,b);this.reset()}var n=p("event/base"),l=p("dom"),f=p("./special"),g=p("./utils"),t=p("./observer"),e=p("./object"),h=n.Utils;j.extend(q,n.Observable,{setup:function(){var i=this.type,c=f[i]||{},m=this.currentTarget,k=g.data(m).handle;(!c.setup||c.setup.call(m,i)===false)&&g.simpleAdd(m,i,k)},constructor:q,reset:function(){q.superclass.reset.call(this);this.lastCount=this.delegateCount=0},notify:function(F){var E=F.target,D=F.type,C=this.currentTarget,A=this.observers,B=[],y,w,G=this.delegateCount||0,r,z;if(G&&E.nodeType){for(;E!==C;){if(E.disabled!==true||D!=="click"){var d={},x,v,s;r=[];for(w=0;w<G;w++){z=A[w];s=z.filter;v=s+"";x=d[v];x===void 0&&(x=d[v]=l.test(E,s));x&&r.push(z)}r.length&&B.push({currentTarget:E,currentTargetObservers:r})}E=E.parentNode||C}}G<A.length&&B.push({currentTarget:C,currentTargetObservers:A.slice(G)});w=0;for(E=B.length;!F.isPropagationStopped()&&w<E;++w){D=B[w];r=D.currentTargetObservers;D=D.currentTarget;F.currentTarget=D;for(D=0;!F.isImmediatePropagationStopped()&&D<r.length;D++){C=r[D];C=C.notify(F,this);y!==false&&C!==void 0&&(y=C)}}return y},fire:function(w,B){var w=w||{},A=""+this.type,z,x,y=f[A]||{};z=y.bubbles!==false;var v=this.currentTarget;if(!(y.fire&&y.fire.call(v,B)===false)){if(!(w instanceof e)){x=w;w=new e({currentTarget:v,type:A,target:v});j.mix(w,x)}if(!(y.preFire&&y.preFire.call(v,w,B)===false)){x=v;var r=l.getWindow(x),C=r.document,y=[],i,s="on"+A,d=0;do{y.push(x);x=x.parentNode||x.ownerDocument||x===C&&r}while(!B&&x&&z);x=y[d];do{w.currentTarget=x;if(z=q.getDomEventObservable(x,A)){z=z.notify(w);z!==void 0&&i!==false&&(i=z)}x[s]&&x[s].call(x)===false&&w.preventDefault();x=y[++d]}while(!B&&x&&!w.isPropagationStopped());if(!B&&!w.isDefaultPrevented()){try{if(v[A]&&!j.isWindow(v)){q.triggeredEvent=A;v[A]()}}catch(o){"trigger action error: "+o}q.triggeredEvent=""}return i}}},on:function(i){var d=this.observers,k=f[this.type]||{},i=i instanceof t?i:new t(i);j.Config.debug&&(i.fn||"lack event handler for "+this.type);if(this.findObserver(i)===-1){if(i.filter){d.splice(this.delegateCount,0,i);this.delegateCount++}else{if(i.last){d.push(i);this.lastCount++}else{d.splice(d.length-this.lastCount,0,i)}}k.add&&k.add.call(this.currentTarget,i)}},detach:function(E){var D,C=f[this.type]||{},A="filter" in E,y=E.filter,z=E.context,w=E.fn,v=this.currentTarget,B=this.observers,E=E.groups;if(B.length){E&&(D=h.getGroupsRe(E));var s,x,o,u,k=B.length;if(w||A||D){z=z||v;s=E=0;for(x=[];E<k;++E){o=B[E];u=o.context||v;if(z!==u||w&&w!==o.fn||A&&(y&&y!==o.filter||!y&&!o.filter)||D&&!o.groups.match(D)){x[s++]=o}else{o.filter&&this.delegateCount&&this.delegateCount--;o.last&&this.lastCount&&this.lastCount--;C.remove&&C.remove.call(v,o)}}this.observers=x}else{this.reset()}this.checkMemory()}},checkMemory:function(){var i=this.type,d,r,o=f[i]||{},k=this.currentTarget,m=g.data(k);if(m){d=m.observables;if(!this.hasObserver()){r=m.handle;(!o.tearDown||o.tearDown.call(k,i)===false)&&g.simpleRemove(k,i,r);delete d[i]}if(j.isEmptyObject(d)){m.handle=null;g.removeData(k)}}}});q.triggeredEvent="";q.getDomEventObservable=function(i,d){var m=g.data(i),k;if(m){k=m.observables}return k?k[d]:null};q.getDomEventObservablesHolder=function(i,d){var k=g.data(i);!k&&d&&g.data(i,k={});return k};return q});KISSY.add("event/dom/base/dom-event","event/base,./utils,dom,./special,./observable,./object".split(","),function(p,w){function x(h,d){var k=e[d]||{},i;if(!h.originalType&&(i=k.typeFix)){h.originalType=d;d=i}return d}function v(h,o,m){var k,i,n,m=p.merge(m),o=x(m,o);k=l.getDomEventObservablesHolder(h,1);if(!(n=k.handle)){n=k.handle=function(r){var d=r.type,s=n.currentTarget;if(!(l.triggeredEvent===d||typeof KISSY==="undefined")){if(d=l.getDomEventObservable(s,d)){r.currentTarget=s;r=new q(r);return d.notify(r)}}};n.currentTarget=h}if(!(i=k.observables)){i=k.observables={}}k=i[o];if(!k){k=i[o]=new l({type:o,currentTarget:h});k.setup()}k.on(m);h=null}function u(h,m,i){var i=p.merge(i),m=x(i,m),h=l.getDomEventObservablesHolder(h),k=(h||{}).observables;if(h&&k){if(m){(m=k[m])&&m.detach(i)}else{for(m in k){k[m].detach(i)}}}}var f=w("event/base"),j=w("./utils"),z=w("dom"),e=w("./special"),l=w("./observable"),q=w("./object"),g=f.Utils,y={on:function(h,c,i,k){h=z.query(h);g.batchForType(function(n,m,r,o){for(var r=g.normalizeParam(m,r,o),s,m=r.type,o=n.length-1;o>=0;o--){s=n[o];v(s,m,r)}},1,h,c,i,k);return h},detach:function(h,d,k,i){h=z.query(h);g.batchForType(function(n,m,t,r){for(var t=g.normalizeParam(m,t,r),s,o,m=t.type,r=n.length-1;r>=0;r--){s=n[r];u(s,m,t);if(t.deep&&s.getElementsByTagName){o=s.getElementsByTagName("*");for(s=o.length-1;s>=0;s--){u(o[s],m,t)}}}},1,h,d,k,i);return h},delegate:function(k,h,n,m,i){return y.on(k,h,{fn:m,context:i,filter:n})},undelegate:function(k,h,n,m,i){return y.detach(k,h,{fn:m,context:i,filter:n})},fire:function(k,h,n,m){var i,n=n||{};n.synthetic=1;g.splitAndRun(h,function(c){var r,o,d;g.fillGroupsForEvent(c,n);c=n.type;if((o=e[c])&&o.typeFix){c=o.typeFix}k=z.query(k);for(o=k.length-1;o>=0;o--){r=k[o];d=l.getDomEventObservable(r,c);!m&&!d&&(d=new l({type:c,currentTarget:r}));if(d){r=d.fire(n,m);i!==false&&r!==void 0&&(i=r)}}});return i},fireHandler:function(h,d,i){return y.fire(h,d,i,1)},clone:function(i,c){var m;if(m=l.getDomEventObservablesHolder(i)){var k=j.data(i);k&&k===j.data(c)&&j.removeData(c);p.each(m.observables,function(b,h){p.each(b.observers,function(d){v(c,h,d)})})}}};return y});KISSY.add("event/dom/base/key-codes",[],function(e){var c=e.UA,d={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(f){var g=f.keyCode;if(f.altKey&&!f.ctrlKey||f.metaKey||g>=d.F1&&g<=d.F12){return !1}switch(g){case d.ALT:case d.CAPS_LOCK:case d.CONTEXT_MENU:case d.CTRL:case d.DOWN:case d.END:case d.ESC:case d.HOME:case d.INSERT:case d.LEFT:case d.MAC_FF_META:case d.META:case d.NUMLOCK:case d.NUM_CENTER:case d.PAGE_DOWN:case d.PAGE_UP:case d.PAUSE:case d.PRINT_SCREEN:case d.RIGHT:case d.SHIFT:case d.UP:case d.WIN_KEY:case d.WIN_KEY_RIGHT:return !1;default:return !0}},isCharacterKey:function(b){if(b>=d.ZERO&&b<=d.NINE||b>=d.NUM_ZERO&&b<=d.NUM_MULTIPLY||b>=d.A&&b<=d.Z||c.webkit&&0===b){return !0}switch(b){case d.SPACE:case d.QUESTION_MARK:case d.NUM_PLUS:case d.NUM_MINUS:case d.NUM_PERIOD:case d.NUM_DIVISION:case d.SEMICOLON:case d.DASH:case d.EQUALS:case d.COMMA:case d.PERIOD:case d.SLASH:case d.APOSTROPHE:case d.SINGLE_QUOTE:case d.OPEN_SQUARE_BRACKET:case d.BACKSLASH:case d.CLOSE_SQUARE_BRACKET:return !0;default:return !1}}};return d});KISSY.add("event/dom/base/gesture",[],function(){return{start:"mousedown",move:"mousemove",end:"mouseup",tap:"click",singleTap:"click",doubleTap:"dblclick"}});KISSY.add("event/dom/base/special-events",["./dom-event","./special"],function(f,d){var e=d("./dom-event"),g=d("./special");return f.mix(g,{mousewheel:{typeFix:f.UA.gecko?"DOMMouseScroll":"mousewheel"},load:{bubbles:!1},click:{fire:function(b){if(!b&&"checkbox"===""+this.type&&this.click&&"input"===this.nodeName.toLowerCase()){return this.click(),!1}}},focus:{bubbles:!1,preFire:function(h,i){if(!i){return e.fire(this,"focusin")}},fire:function(b){if(!b&&this.ownerDocument&&this!==this.ownerDocument.activeElement&&this.focus){return this.focus(),!1}}},blur:{bubbles:!1,preFire:function(h,i){if(!i){return e.fire(this,"focusout")}},fire:function(b){if(!b&&this.ownerDocument&&this===this.ownerDocument.activeElement&&this.blur){return this.blur(),!1}}}})});KISSY.add("event/dom/base/mouseenter",["dom","./special"],function(f,d){var e=d("dom"),g=d("./special");f.each([{name:"mouseenter",fix:"mouseover"},{name:"mouseleave",fix:"mouseout"}],function(c){g[c.name]={typeFix:c.fix,handle:function(h,n,m){var l=h.currentTarget,j=h.relatedTarget;if(!j||j!==l&&!e.contains(l,j)){return[n.simpleNotify(h,m)]}}}})});KISSY.add("event/dom/base/valuechange",["dom","./dom-event","./special"],function(x,E){function F(d){if(v.hasData(d,A)){var c=v.data(d,A);clearTimeout(c);v.removeData(d,A)}}function D(c){F(c.target)}function C(e){var d=e.value,f=v.data(e,z);d!==f&&(y.fireHandler(e,G,{prevVal:f,newVal:d}),v.data(e,z,d))}function p(b){v.hasData(b,A)||v.data(b,A,setTimeout(function c(){C(b);v.data(b,A,setTimeout(c,w))},w))}function u(d){var c=d.target;"focus"===d.type&&v.data(c,z,c.value);p(c)}function H(b){C(b.target)}function l(c){v.removeData(c,z);F(c);y.detach(c,"blur",D);y.detach(c,"webkitspeechchange",H);y.detach(c,"mousedown keyup keydown focus",u)}var v=E("dom"),y=E("./dom-event"),q=E("./special"),G="valuechange",B=v.nodeName,z="event/valuechange/history",A="event/valuechange/poll",w=50;q[G]={setup:function(){var b=B(this);if("input"===b||"textarea"===b){l(this),y.on(this,"blur",D),y.on(this,"webkitspeechchange",H),y.on(this,"mousedown keyup keydown focus",u)}},tearDown:function(){l(this)}};return y});KISSY.add("event/dom/base","./base/dom-event,./base/object,./base/key-codes,./base/gesture,./base/special-events,./base/mouseenter,./base/valuechange".split(","),function(h,f){var g=f("./base/dom-event"),l=f("./base/object"),k=f("./base/key-codes"),j=f("./base/gesture"),e=f("./base/special-events");f("./base/mouseenter");f("./base/valuechange");return h.merge({add:g.on,remove:g.detach,KeyCode:k,Gesture:j,Special:e,Object:l},g)});KISSY.add("event/dom/shake",["event/dom/base"],function(B,t){function w(e){var c=e.accelerationIncludingGravity,e=c.x,h=c.y,c=c.z,g;void 0!==C&&(g=s(z(e-C),z(h-y),z(c-x)),g>r&&v(),g>f&&(A=1));C=e;y=h;x=c}var u=t("event/dom/base"),b=u.Special,r=5,f=20,A=0,C,y,x,s=Math.max,z=Math.abs,D=B.Env.host,v=B.buffer(function(){A&&(u.fireHandler(D,"shake",{accelerationIncludingGravity:{x:C,y:y,z:x}}),C=void 0,A=0)},250);b.shake={setup:function(){this===D&&D.addEventListener("devicemotion",w,!1)},tearDown:function(){this===D&&(v.stop(),C=void 0,A=0,D.removeEventListener("devicemotion",w,!1))}}});KISSY.add("event/dom/focusin",["event/dom/base"],function(i,c){var f=c("event/dom/base"),b=f.Special;i.each([{name:"focusin",fix:"focus"},{name:"focusout",fix:"blur"}],function(g){function e(h){return f.fire(h.target,g.name)}var d=i.guid("attaches_"+i.now()+"_");b[g.name]={setup:function(){var h=this.ownerDocument||this;d in h||(h[d]=0);h[d]+=1;1===h[d]&&h.addEventListener(g.fix,e,!0)},tearDown:function(){var h=this.ownerDocument||this;h[d]-=1;0===h[d]&&h.removeEventListener(g.fix,e,!0)}}});return f});KISSY.add("node/base",["dom","event/dom"],function(u,r){function t(d,b,c){if(!(this instanceof t)){return new t(d,b,c)}if(d){if("string"===typeof d){if(d=p.create(d,b,c),d.nodeType===m.DOCUMENT_FRAGMENT_NODE){return s.apply(this,v(d.childNodes)),this}}else{if(u.isArray(d)||n(d)){return s.apply(this,v(d)),this}}}else{return this}this[0]=d;this.length=1;return this}var p=r("dom"),o=r("event/dom"),q=Array.prototype,f=q.slice,m=p.NodeType,s=q.push,v=u.makeArray,n=p.isDomNodeList;t.prototype={constructor:t,isNodeList:!0,length:0,item:function(b){return"number"===typeof b?b>=this.length?null:new t(this[b]):new t(b)},add:function(e,d,c){"number"===typeof d&&(c=d,d=void 0);e=t.all(e,d).getDOMNodes();d=new t(this);void 0===c?s.apply(d,e):(c=[c,0],c.push.apply(c,e),q.splice.apply(d,c));return d},slice:function(){return new t(f.apply(this,arguments))},getDOMNodes:function(){return f.call(this)},each:function(b,e){var c=this;u.each(c,function(d,g){d=new t(d);return b.call(e||d,d,g,c)});return c},getDOMNode:function(){return this[0]},end:function(){return this.__parent||this},filter:function(b){return new t(p.filter(this,b))},all:function(b){b=0<this.length?t.all(b,this):new t;b.__parent=this;return b},one:function(b){b=this.all(b);if(b=b.length?b.slice(0,1):null){b.__parent=this}return b}};u.mix(t,{all:function(b,c){return"string"===typeof b&&(b=u.trim(b))&&3<=b.length&&u.startsWith(b,"<")&&u.endsWith(b,">")?(c&&(c.getDOMNode&&(c=c[0]),c=c.ownerDocument||c),new t(b,void 0,c)):new t(p.query(b,c))},one:function(e,g){var c=t.all(e,g);return c.length?c.slice(0,1):null}});t.NodeType=m;t.KeyCode=o.KeyCode;t.Gesture=o.Gesture;t.REPLACE_HISTORY=o.REPLACE_HISTORY;return t});KISSY.add("node/attach",["dom","event/dom","./base"],function(d,p){function q(g,e,c){c.unshift(e);g=n[g].apply(n,c);return void 0===g?e:g}var n=p("dom"),m=p("event/dom"),o=p("./base"),f=o.prototype,j=d.makeArray;o.KeyCode=m.KeyCode;d.each("nodeName,isCustomDomain,getEmptyIframeSrc,equals,contains,index,scrollTop,scrollLeft,height,width,innerHeight,innerWidth,outerHeight,outerWidth,addStyleSheet,appendTo,prependTo,insertBefore,before,after,insertAfter,test,hasClass,addClass,removeClass,replaceClass,toggleClass,removeAttr,hasAttr,hasProp,scrollIntoView,remove,empty,removeData,hasData,unselectable,wrap,wrapAll,replaceWith,wrapInner,unwrap".split(","),function(b){f[b]=function(){var c=j(arguments);return q(b,this,c)}});d.each("getWindow,getDocument,filter,first,last,parent,closest,next,prev,clone,siblings,contents,children".split(","),function(b){f[b]=function(){var c=j(arguments);c.unshift(this);c=n[b].apply(n,c);return c===void 0?this:c===null?null:new o(c)}});d.each({attr:1,text:0,css:1,style:1,val:0,prop:1,offset:0,html:0,outerHTML:0,outerHtml:0,data:1},function(c,b){f[b]=function(){var e;e=j(arguments);void 0===e[c]&&!d.isObject(e[0])?(e.unshift(this),e=n[b].apply(n,e)):e=q(b,this,e);return e}});d.each(["on","detach","delegate","undelegate"],function(b){f[b]=function(){var c=j(arguments);c.unshift(this);m[b].apply(m,c);return this}});d.each(["fire","fireHandler"],function(b){f[b]=function(){var c=j(arguments);c.unshift(this);return m[b].apply(m,c)}})});KISSY.add("node/override",["dom","./base","./attach"],function(d,j){var k=j("dom"),g=j("./base");j("./attach");var f=g.prototype;d.each(["append","prepend","before","after"],function(c){f[c]=function(b){"string"===typeof b&&(b=k.create(b));if(b){k[c](b,this)}return this}});d.each(["wrap","wrapAll","replaceWith","wrapInner"],function(e){var h=f[e];f[e]=function(c){"string"===typeof c&&(c=g.all(c,this[0].ownerDocument));return h.call(this,c)}})});KISSY.add("node/anim",["./base","dom","anim"],function(d,n){function o(e,i,g){for(var l=[],h={},g=g||0;g<i;g++){l.push.apply(l,f[g])}for(g=0;g<l.length;g++){h[l[g]]=e}return h}var k=n("./base"),j=n("dom"),m=n("anim"),f=[["height","margin-top","margin-bottom","padding-top","padding-bottom"],["width","margin-left","margin-right","padding-left","padding-right"],["opacity"]];d.augment(k,{animate:function(){var b=d.makeArray(arguments);d.each(this,function(h){var c=d.clone(b),g=c[0];g.to?(g.node=h,(new m(g)).run()):m.apply(void 0,[h].concat(c)).run()});return this},stop:function(g,e,b){d.each(this,function(c){m.stop(c,g,e,b)});return this},pause:function(e,b){d.each(this,function(c){m.pause(c,b)});return this},resume:function(e,b){d.each(this,function(c){m.resume(c,b)});return this},isRunning:function(){for(var c=0;c<this.length;c++){if(m.isRunning(this[c])){return !0}}return !1},isPaused:function(){for(var c=0;c<this.length;c++){if(m.isPaused(this[c])){return !0}}return !1}});d.each({show:o("show",3),hide:o("hide",3),toggle:o("toggle",3),fadeIn:o("show",3,2),fadeOut:o("hide",3,2),fadeToggle:o("toggle",3,2),slideDown:o("show",1),slideUp:o("hide",1),slideToggle:o("toggle",1)},function(e,b){k.prototype[b]=function(c,h,g){if(j[b]&&!c){j[b](this)}else{d.each(this,function(i){(new m(i,e,c,g,h)).run()})}return this}})});KISSY.add("node",["node/base","node/attach","node/override","node/anim"],function(d,f){var g=f("node/base");f("node/attach");f("node/override");f("node/anim");d.mix(d,{Node:g,NodeList:g,one:g.one,all:g.all});return g});KISSY.add("anim",["anim/base","anim/timer","anim/transition?"],function(c,o){function d(b,h,i,g,j){if(b.node){j=b}else{"string"===typeof h?(h=c.unparam(""+h,";",":"),c.each(h,function(q,f){var k=c.trim(f);k&&(h[k]=c.trim(q));(!k||k!==f)&&delete h[f]})):h=c.clone(h);if(c.isPlainObject(i)){j=c.clone(i)}else{if(j={complete:j},i&&(j.duration=i),g){j.easing=g}}j.node=b;j.to=h}j=c.merge(e,j,{useTransition:c.config("anim/useTransition")});if(j.useTransition&&n){return"use transition anim",new n(j)}"use js timer anim";return new m(j)}var l=o("anim/base"),m=o("anim/timer"),n=o("anim/transition?"),p=l.Utils,e={duration:1,easing:"linear"};c.each(["pause","resume"],function(f){d[f]=function(b,g){return null===g||"string"===typeof g||!1===g?p.pauseOrResumeQueue(b,g,f):p.pauseOrResumeQueue(b,void 0,f)}});d.isRunning=p.isElRunning;d.isPaused=p.isElPaused;d.stop=p.stopEl;d.Easing=m.Easing;c.Anim=d;d.Q=l.Q;return d});KISSY.add("anim/base/queue",["dom"],function(n,e){function j(g,f,i){var f=f||l,h,d=m.data(g,k);!d&&!i&&m.data(g,k,d={});d&&(h=d[f],!h&&!i&&(h=d[f]=[]));return h}var m=e("dom"),k=n.guid("ks-queue-"+n.now()+"-"),l=n.guid("ks-queue-"+n.now()+"-"),b;return b={queueCollectionKey:k,queue:function(f,h,g){f=j(f,h);f.push(g);return f},remove:function(g,c,h){var f=j(g,c,1);f&&(h=n.indexOf(h,f),-1<h&&f.splice(h,1));f&&!f.length&&b.clearQueue(g,c);return f},clearQueues:function(c){m.removeData(c,k)},clearQueue:function(f,c){var c=c||l,d=m.data(f,k);d&&delete d[c];n.isEmptyObject(d)&&m.removeData(f,k)},dequeue:function(h,f){var g=j(h,f,1);g&&(g.shift(),g.length||b.clearQueue(h,f));return g}}});KISSY.add("anim/base/utils",["./queue","dom"],function(m,b){var e=b("./queue"),l=b("dom"),j=m.guid("ks-anim-unqueued-"+m.now()+"-"),k=m.guid("ks-anim-paused-"+m.now()+"-");return{saveRunningAnim:function(d){var f=d.node,c=l.data(f,j);c||l.data(f,j,c={});c[m.stamp(d)]=d},removeRunningAnim:function(d){var f=d.node,c=l.data(f,j);c&&(delete c[m.stamp(d)],m.isEmptyObject(c)&&l.removeData(f,j))},isAnimPaused:function(c){var d=l.data(c.node,k);return d?!!d[m.stamp(c)]:0},removePausedAnim:function(d){var f=d.node,c=l.data(f,k);c&&(delete c[m.stamp(d)],m.isEmptyObject(c)&&l.removeData(f,k))},savePausedAnim:function(d){var f=d.node,c=l.data(f,k);c||l.data(f,k,c={});c[m.stamp(d)]=d},isAnimRunning:function(c){var d=l.data(c.node,j);return d?!!d[m.stamp(c)]:0},isElPaused:function(c){return(c=l.data(c,k))&&!m.isEmptyObject(c)},isElRunning:function(c){return(c=l.data(c,j))&&!m.isEmptyObject(c)},pauseOrResumeQueue:function(d,f,c){d=l.data(d,"resume"===c?k:j);d=m.merge(d);m.each(d,function(g){if(void 0===f||g.config.queue===f){g[c]()}})},stopEl:function(d,h,c,g){c&&(void 0===g?e.clearQueues(d):!1!==g&&e.clearQueue(d,g));d=l.data(d,j);d=m.merge(d);m.each(d,function(f){(void 0===g||f.config.queue===g)&&f.stop(h)})}}});KISSY.add("anim/base",["dom","./base/utils","./base/queue","promise"],function(r,k){function m(d){m.superclass.constructor.call(this);t.Defer(this);this.config=d;var c=d.node;r.isPlainObject(c)||(c=q.get(d.node));this.node=this.el=c;this._backupProps={};this._propsData={}}var q=k("dom"),n=k("./base/utils"),o=k("./base/queue"),t=k("promise"),p=q.NodeType,s=r.noop,j={toggle:1,hide:1,show:1};r.extend(m,t,{on:function(b,d){"complete"===b?this.then(d):"end"===b?this.fin(d):"step"===b?this.progress(d):"not supported event for anim: "+b;return this},prepareFx:s,runInternal:function(){var z=this,y=z.config,x=z.node,w,v=z._backupProps,g=z._propsData,u=y.to,c=y.delay||0,e=y.duration;n.saveRunningAnim(z);r.each(u,function(b,f){r.isPlainObject(b)||(b={value:b});g[f]=r.mix({delay:c,easing:y.easing,frame:y.frame,duration:e},b)});if(x.nodeType===p.ELEMENT_NODE){if(u.width||u.height){u=x.style,r.mix(v,{overflow:u.overflow,"overflow-x":u.overflowX,"overflow-y":u.overflowY}),u.overflow="hidden","inline"===q.css(x,"display")&&"none"===q.css(x,"float")&&(10>r.UA.ieMode?u.zoom=1:u.display="inline-block")}var d,l;l="none"===q.css(x,"display");r.each(g,function(h,f){w=h.value;if(j[w]){if("hide"===w&&l||"show"===w&&!l){return z.stop(!0),d=!1}v[f]=q.style(x,f);"toggle"===w?w=l?"show":"hide":"hide"===w?(h.value=0,v.display="none"):(h.value=q.css(x,f),q.css(x,f,0),q.show(x))}});if(!1===d){return}}z.startTime=r.now();r.isEmptyObject(g)?(z.__totalTime=1000*e,z.__waitTimeout=setTimeout(function(){z.stop(!0)},z.__totalTime)):(z.prepareFx(),z.doStart())},isRunning:function(){return n.isAnimRunning(this)},isPaused:function(){return n.isAnimPaused(this)},pause:function(){this.isRunning()&&(this._runTime=r.now()-this.startTime,this.__totalTime-=this._runTime,n.removeRunningAnim(this),n.savePausedAnim(this),this.__waitTimeout?clearTimeout(this.__waitTimeout):this.doStop());return this},doStop:s,doStart:s,resume:function(){var b=this;b.isPaused()&&(b.startTime=r.now()-b._runTime,n.removePausedAnim(b),n.saveRunningAnim(b),b.__waitTimeout?b.__waitTimeout=setTimeout(function(){b.stop(!0)},b.__totalTime):(b.beforeResume(),b.doStart()));return b},beforeResume:s,run:function(){var b;b=this.config.queue;!1===b?this.runInternal():(b=o.queue(this.node,b,this),1===b.length&&this.runInternal());return this},stop:function(d){var c=this.node,l=this.config.queue;if(this.isResolved()||this.isRejected()){return this}this.__waitTimeout&&(clearTimeout(this.__waitTimeout),this.__waitTimeout=0);if(!this.isRunning()&&!this.isPaused()){return !1!==l&&o.remove(c,l,this),this}this.doStop(d);n.removeRunningAnim(this);n.removePausedAnim(this);var g=this.defer;if(d){var f,d=this.config.complete;r.isEmptyObject(f=this._backupProps)||q.css(this.node,f);d&&d.call(this);g.resolve([this])}else{g.reject([this])}!1!==l&&(c=o.dequeue(c,l))&&c[0]&&c[0].runInternal();return this}});m.Utils=n;m.Q=o;return m});KISSY.add("anim/timer/easing",[],function(){function n(b){return b}function r(A,z,g,w){var x=3*A-3*g+1,y=3*g-6*A,o=3*A,h=3*z-3*w+1,v=3*w-6*z,m=3*z;return function(f){f:{for(var c=f,l,j,i=0;8>i;i++){j=((x*c+y)*c+o)*c-f;if(e(j)<d){f=c;break f}l=(3*x*c+2*y)*c+o;if(e(l)<d){break}c-=j/l}l=1;i=0;for(c=f;l>i;){j=((x*c+y)*c+o)*c-f;if(e(j)<d){break}0<j?l=c:i=c;c=(l+i)/2}f=c}return((h*f+v)*f+m)*f}}var q=Math.PI,p=Math.pow,u=Math.sin,t=parseFloat,k=/^cubic-bezier\(([^,]+),([^,]+),([^,]+),([^,]+)\)$/i,s={swing:function(b){return -Math.cos(b*q)/2+0.5},easeNone:n,linear:n,easeIn:function(b){return b*b},ease:r(0.25,0.1,0.25,1),"ease-in":r(0.42,0,1,1),"ease-out":r(0,0,0.58,1),"ease-in-out":r(0.42,0,0.58,1),"ease-out-in":r(0,0.42,1,0.58),toFn:function(f){var c;return(c=f.match(k))?r(t(c[1]),t(c[2]),t(c[3]),t(c[4])):s[f]||n},easeOut:function(b){return(2-b)*b},easeBoth:function(b){return 1>(b*=2)?0.5*b*b:0.5*(1- --b*(b-2))},easeInStrong:function(b){return b*b*b*b},easeOutStrong:function(b){return 1- --b*b*b*b},easeBothStrong:function(b){return 1>(b*=2)?0.5*b*b*b*b:0.5*(2-(b-=2)*b*b*b)},elasticIn:function(b){return 0===b||1===b?b:-(p(2,10*(b-=1))*u(2*(b-0.075)*q/0.3))},elasticOut:function(b){return 0===b||1===b?b:p(2,-10*b)*u(2*(b-0.075)*q/0.3)+1},elasticBoth:function(b){return 0===b||2===(b*=2)?b:1>b?-0.5*p(2,10*(b-=1))*u(2*(b-0.1125)*q/0.45):0.5*p(2,-10*(b-=1))*u(2*(b-0.1125)*q/0.45)+1},backIn:function(b){1===b&&(b-=0.001);return b*b*(2.70158*b-1.70158)},backOut:function(b){return(b-=1)*b*(2.70158*b+1.70158)+1},backBoth:function(f){var c,g=(c=2.5949095)+1;return 1>(f*=2)?0.5*f*f*(g*f-c):0.5*((f-=2)*f*(g*f+c)+2)},bounceIn:function(b){return 1-s.bounceOut(1-b)},bounceOut:function(b){return b<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375},bounceBoth:function(b){return 0.5>b?0.5*s.bounceIn(2*b):0.5*s.bounceOut(2*b-1)+0.5}},d=0.000001,e=Math.abs;return s});KISSY.add("anim/timer/manager",[],function(b){var e=b.stamp,d,c;d=function(f){return setTimeout(f,15)};c=function(f){clearTimeout(f)};return{runnings:{},timer:null,start:function(f){var g=e(f);this.runnings[g]||(this.runnings[g]=f,this.startTimer())},stop:function(f){this.notRun(f)},notRun:function(f){delete this.runnings[e(f)];b.isEmptyObject(this.runnings)&&this.stopTimer()},pause:function(f){this.notRun(f)},resume:function(f){this.start(f)},startTimer:function(){var f=this;f.timer||(f.timer=d(function g(){f.runFrames()?f.stopTimer():f.timer=d(g)}))},stopTimer:function(){var f=this.timer;f&&(c(f),this.timer=0)},runFrames:function(){var f,h,g=this.runnings;for(f in g){g[f].frame()}for(f in g){h=0;break}return void 0===h}}});KISSY.add("anim/timer/fx",["dom"],function(b,e){function d(f){b.mix(this,f);this.pos=0;this.unit=this.unit||""}var c=e("dom");d.prototype={isCustomFx:0,constructor:d,load:function(f){b.mix(this,f);this.pos=0;this.unit=this.unit||""},frame:function(j){if(1!==this.pos){var r=this.anim,o=this.prop,q=r.node,p=this.from,i=this.propData,l=this.to;if(void 0===j){var n=b.now(),j=i.duration,n=n-r.startTime-i.delay,j=0>=n?0:n>=j?1:i.easing(n/j)}this.pos=j;p===l||0===j||(this.val=j=this.interpolate(p,l,this.pos),i.frame?i.frame.call(this,r,this):this.isCustomFx||(void 0===j?(this.pos=1,j=l,o+" update directly ! : "+j+" : "+p+" : "+l):j+=this.unit,this.val=j,"attr"===this.type?c.attr(q,o,j,1):c.css(q,o,j)))}},interpolate:function(f,h,g){if("number"===typeof f&&"number"===typeof h){return Math.round(100000*(f+(h-f)*g))/100000}},cur:function(){var g=this.prop,k,i,j=this.anim.node;if(this.isCustomFx){return j[g]||0}if(!(k=this.type)){k=this.type=(!j.style||null==j.style[g])&&null!=c.attr(j,g,void 0,1)?"attr":"css"}g="attr"===k?c.attr(j,g,void 0,1):c.css(j,g);return isNaN(i=parseFloat(g))?!g||"auto"===g?0:g:i}};d.Factories={};d.FxTypes={};d.getFx=function(g){var k=d,h,j;if(h=g.fxType){k=d.FxTypes[h]}else{if(!g.isCustomFx&&(j=d.Factories[g.prop])){k=j}}return new k(g)};return d});KISSY.add("anim/timer/short-hand",[],function(){return{background:[],border:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],borderBottom:["borderBottomWidth"],borderLeft:["borderLeftWidth"],borderTop:["borderTopWidth"],borderRight:["borderRightWidth"],font:["fontSize","fontWeight"],margin:["marginBottom","marginLeft","marginRight","marginTop"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"]}});KISSY.add("anim/timer/color",["./fx","./short-hand"],function(q,t){function s(c){var c=c+"",f;if(f=c.match(e)){return[parseInt(f[1]),parseInt(f[2]),parseInt(f[3])]}if(f=c.match(x)){return[parseInt(f[1]),parseInt(f[2]),parseInt(f[3]),parseInt(f[4])]}if(f=c.match(p)){for(c=1;c<f.length;c++){2>f[c].length&&(f[c]+=f[c])}return[parseInt(f[1],n),parseInt(f[2],n),parseInt(f[3],n)]}if(d[c=c.toLowerCase()]){return d[c]}"only allow rgb or hex color string : "+c;return[255,255,255]}function r(){r.superclass.constructor.apply(this,arguments)}var w=t("./fx"),v=t("./short-hand"),n=16,u=Math.floor,d={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255]},e=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,x=/^rgba\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+),\s*([0-9]+)\)$/i,p=/^#?([0-9A-F]{1,2})([0-9A-F]{1,2})([0-9A-F]{1,2})$/i;v.background.push("backgroundColor");v.borderColor=["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"];v.border.push("borderBottomColor","borderLeftColor","borderRightColor","borderTopColor");v.borderBottom.push("borderBottomColor");v.borderLeft.push("borderLeftColor");v.borderRight.push("borderRightColor");v.borderTop.push("borderTopColor");q.extend(r,w,{load:function(){r.superclass.load.apply(this,arguments);this.from&&(this.from=s(this.from));this.to&&(this.to=s(this.to))},interpolate:function(f,c,h){var g=r.superclass.interpolate;if(3===f.length&&3===c.length){return"rgb("+[u(g(f[0],c[0],h)),u(g(f[1],c[1],h)),u(g(f[2],c[2],h))].join(", ")+")"}if(4===f.length||4===c.length){return"rgba("+[u(g(f[0],c[0],h)),u(g(f[1],c[1],h)),u(g(f[2],c[2],h)),u(g(f[3]||1,c[3]||1,h))].join(", ")+")"}"unknown value : "+f}});q.each("backgroundColor,borderBottomColor,borderLeftColor,borderRightColor,borderTopColor,color,outlineColor".split(","),function(b){w.Factories[b]=r});return w.FxTypes.color=r});KISSY.add("anim/timer/transform",["dom","./fx"],function(n,r){function q(b){b=b.split(/,/);return b=n.map(b,function(c){return u(c)})}function p(){return{translateX:0,translateY:0,rotate:0,skewX:0,skewY:0,scaleX:1,scaleY:1}}function u(b){return Math.round(100000*parseFloat(b))/100000}function t(b){for(var b=b.split(")"),h=n.trim,v=-1,l=b.length-1,m,o,j=p();++v<l;){switch(m=b[v].split("("),o=h(m[0]),m=m[1],o){case"translateX":case"translateY":case"scaleX":case"scaleY":j[o]=u(m);break;case"rotate":case"skewX":case"skewY":var i=u(m);n.endsWith(m,"deg")||(i=180*i/Math.PI);j[o]=i;break;case"translate":case"translate3d":m=m.split(",");j.translateX=u(m[0]);j.translateY=u(m[1]||0);break;case"scale":m=m.split(",");j.scaleX=u(m[0]);j.scaleY=u(m[1]||m[0]);break;case"matrix":return b=m,b=q(b),l=v=h=void 0,o=b[0],j=b[1],m=b[2],i=b[3],o*i-j*m?(h=Math.sqrt(o*o+j*j),l=(o*m+j*i)/(o*i-m*j),v=(o*i-j*m)/h,o*i<j*m&&(l=-l,h=-h)):h=v=l=0,{translateX:u(b[4]),translateY:u(b[5]),rotate:u(180*Math.atan2(j,o)/Math.PI),skewX:u(180*Math.atan(l)/Math.PI),skewY:0,scaleX:u(h),scaleY:u(v)}}}return j}function k(){k.superclass.constructor.apply(this,arguments)}var s=r("dom"),d=r("./fx"),e=n.Features.isTransform3dSupported()?"translate3d({translateX}px,{translateY}px,0)":"translate({translateX}px,{translateY}px)";n.extend(k,d,{load:function(){k.superclass.load.apply(this,arguments);this.from=(this.from=s.style(this.anim.node,"transform")||this.from)&&"none"!==this.from?t(this.from):p();this.to=this.to?t(this.to):p()},interpolate:function(g,f,j){var h=k.superclass.interpolate,i={};i.translateX=h(g.translateX,f.translateX,j);i.translateY=h(g.translateY,f.translateY,j);i.rotate=h(g.rotate,f.rotate,j);i.skewX=h(g.skewX,f.skewX,j);i.skewY=h(g.skewY,f.skewY,j);i.scaleX=h(g.scaleX,f.scaleX,j);i.scaleY=h(g.scaleY,f.scaleY,j);return n.substitute(e+" rotate({rotate}deg) skewX({skewX}deg) skewY({skewY}deg) scale({scaleX},{scaleY})",i)}});return d.Factories.transform=k});KISSY.add("anim/timer","dom,./base,./timer/easing,./timer/manager,./timer/fx,./timer/short-hand,./timer/color,./timer/transform".split(","),function(n,r){function q(){var b;q.superclass.constructor.apply(this,arguments);n.each(b=this.to,function(f,h){var g=e(h);if(h!==g){b[g]=b[h];delete b[h]}})}var p=r("dom"),u=r("./base"),t=r("./timer/easing"),k=r("./timer/manager"),s=r("./timer/fx"),d=r("./timer/short-hand");r("./timer/color");r("./timer/transform");var e=p._camelCase,v=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i;n.extend(q,u,{prepareFx:function(){var A=this.node,x=this._propsData;n.each(x,function(b){b.duration=b.duration*1000;b.delay=b.delay*1000;if(typeof b.easing==="string"){b.easing=t.toFn(b.easing)}});n.each(d,function(b,m){var l,h=x[m],g;if(h){g=h.value;l={};n.each(b,function(E){l[E]=p.css(A,E)});p.css(A,m,g);n.each(l,function(E,F){F in x||(x[F]=n.merge(h,{value:p.css(A,F)}));p.css(A,F,E)});delete x[m]}});var y,z,w,o,j,i,c,B=0,f;n.isPlainObject(A)&&(B=1);for(y in x){z=x[y];w=z.value;i={isCustomFx:B,prop:y,anim:this,fxType:z.fxType,type:z.type,propData:z};c=s.getFx(i);o=w;j=c.cur();w=w+"";f="";if(w=w.match(v)){o=parseFloat(w[2]);if((f=w[3])&&f!=="px"&&j){var D=0,C=o;do{++C;p.css(A,y,C+f);D=c.cur()}while(D===0);j=C/D*j;p.css(A,y,j+f)}w[1]&&(o=(w[1]==="-="?-1:1)*o+j)}i.from=j;i.to=o;i.unit=f;c.load(i);z.fx=c}},frame:function(){var g,f=1,i,h=this._propsData;for(g in h){i=h[g];i=i.fx;i.frame();if(this.isRejected()||this.isResolved()){return}f=f&i.pos===1}h=n.now();g=this.config.duration*1000;h=Math.max(0,this.startTime+g-h);this.defer.notify([this,1-(h/g||0),h]);f&&this.stop(f)},doStop:function(g){var f,h=this._propsData;k.stop(this);if(g){for(f in h){g=h[f];(g=g.fx)&&g.frame(1)}}},doStart:function(){k.start(this)}});q.Easing=t;q.Fx=s;return q});KISSY.add("anim/transition",["dom","event/dom","./base"],function(y,x){function d(h){var g="";y.each(h,function(j,i){g&&(g+=",");g+=i+" "+j.duration+"s "+j.easing+" "+j.delay+"s"});return g}function u(){u.superclass.constructor.apply(this,arguments)}var w=x("dom"),s=x("event/dom"),c=x("./base"),t=y.Features,f=t.getTransitionPrefix(),b=/([A-Z]|^ms)/g,e=f?f.toLowerCase()+"TransitionEnd":"transitionend",v=t.getTransitionProperty();y.extend(u,c,{doStart:function(){var n=this,g=n.node,m=g.style,i=n._propsData,k=m[v],l,j={};if(l=i.transform){delete i.transform,i[t.getTransformProperty().replace(b,"-$1").toLowerCase()]=l}y.each(i,function(h,p){var q=h.value,o=w.css(g,p);"number"===typeof q&&(o=parseFloat(o));o===q&&setTimeout(function(){n._onTransitionEnd({originalEvent:{propertyName:p}})},0);j[p]=q});-1!==k.indexOf("none")?k="":k&&(k+=",");m[v]=k+d(i);s.on(g,e,n._onTransitionEnd,n);w.css(g,j)},beforeResume:function(){var i=this._propsData,g=y.merge(i),h=this._runTime/1000;y.each(g,function(k,j){var l=h;k.delay>=l?k.delay-=l:(l-=k.delay,k.delay=0,k.duration>=l?k.duration-=l:delete i[j])})},_onTransitionEnd:function(i){var i=i.originalEvent,g=1,h=this._propsData;h[i.propertyName]&&(h[i.propertyName].pos=1,y.each(h,function(j){if(1!==j.pos){return g=0,!1}}),g&&this.stop(!0))},doStop:function(l){var g=this.node,k=g.style,h=this._propsData,i=[],j={};s.detach(g,e,this._onTransitionEnd,this);y.each(h,function(m,n){l||(j[n]=w.css(g,n));i.push(n)});h=y.trim(k[v].replace(RegExp("(^|,)\\s*(?:"+i.join("|")+")\\s+[^,]+","gi"),"$1")).replace(/^,|,,|,$/g,"")||"none";k[v]=h;w.css(g,j)}});return u});KISSY.add("base",["attribute"],function(y,c){function x(e,h){return function(i){return function(){h?i.apply(this,arguments):this.callSuper.apply(this,arguments);var o=arguments.callee.__owner__.__extensions__||[];h&&o.reverse();var l=arguments,n;if(n=o&&o.length){for(var k=0;k<n;k++){var j=o[k]&&(!e?o[k]:o[k].prototype[e]);j&&j.apply(this,l||[])}}h?this.callSuper.apply(this,arguments):i.apply(this,arguments)}}}function g(e){var h=this.__hooks__,i=this.prototype;if(this.__extensions__.length&&h){for(var j in h){if(!i.hasOwnProperty(j)||e.hasOwnProperty(j)){e[j]=e[j]||f}}}return b.call(this,e)}function B(e){var h;e.target===this&&(h=this[w+e.type.slice(5).slice(0,-6)],h.call(this,e.newVal,e))}function A(e){var h=e.get("plugins"),i;y.each(h,function(j,k){"function"===typeof j&&(i=j,h[k]=new i)})}function v(e){var h,i=this.get("plugins");if(h=i.length){for(var j=0;j<h;j++){if(i[j][e]){i[j][e](this)}}}}var d=c("attribute"),u=y.ucfirst,w="_onSet",f=y.noop,m=d.extend({constructor:function(){this.callSuper.apply(this,arguments);var e=this.get("listeners"),h;for(h in e){this.on(h,e[h])}this.initializer();A(this);v.call(this,"pluginInitializer");this.bindInternal();this.syncInternal()},initializer:f,__getHook:x,__callPluginsMethod:v,bindInternal:function(){var e=this.getAttrs(),h,i;for(h in e){if(i=w+u(h),this[i]){this.on("after"+u(h)+"Change",B)}}},syncInternal:function(){var h=[],i;i=this.constructor;for(var n=this.getAttrs();i;){h.push(i),i=i.superclass&&i.superclass.constructor}h.reverse();for(i=0;i<h.length;i++){var o=h[i].ATTRS||{},k;for(k in o){if(k in n){var l,j;(j=this[w+u(k)])&&0!==n[k].sync&&void 0!==(l=this.get(k))&&j.call(this,l)}}}},plug:function(e){"function"===typeof e&&(e=new e);e.pluginInitializer&&e.pluginInitializer(this);this.get("plugins").push(e);return this},unplug:function(e){var h=[],i=this,j="string"===typeof e;y.each(i.get("plugins"),function(l){var n=0,k;e&&(j?(k=l.get&&l.get("pluginId")||l.pluginId,k!==e&&(h.push(l),n=1)):l!==e&&(h.push(l),n=1));n||l.pluginDestructor(i)});i.setInternal("plugins",h);return i},getPlugin:function(e){var h=null;y.each(this.get("plugins"),function(i){if((i.get&&i.get("pluginId")||i.pluginId)===e){return h=i,!1}});return h},destructor:y.noop,destroy:function(){this.get("destroyed")||(v.call(this,"pluginDestructor"),this.destructor(),this.set("destroyed",!0),this.fire("destroy"),this.detach())}});y.mix(m,{__hooks__:{initializer:x(),destructor:x("__destructor",!0)},ATTRS:{plugins:{value:[]},destroyed:{value:!1},listeners:{value:[]}},extend:function z(k,l,j){y.isArray(k)||(j=l,l=k,k=[]);j=j||{};l=l||{};l=d.extend.call(this,l,j);l.__extensions__=k;g.call(l,{});if(k.length){var e={},i={};y.each(k.concat(l),function(h){if(h){y.each(h.ATTRS,function(o,q){var p=e[q]=e[q]||{};y.mix(p,o)});var h=h.prototype,n;for(n in h){h.hasOwnProperty(n)&&(i[n]=h[n])}}});l.ATTRS=e;i.constructor=l;y.augment(l,i)}l.extend=j.extend||z;l.addMembers=g;return l}});var b=m.addMembers;return y.Base=m});KISSY.add("attribute",["event/custom"],function(Q,L,h,G){function N(j,g){return"string"===typeof g?j[g]:g}function M(g){return g.__attrVals||(g.__attrVals={})}function J(q,j,r,g,p,o,n,k){n=n||r;return q.fire(j+Q.ucfirst(r)+"Change",Q.mix({attrName:n,subAttrName:o,prevVal:g,newVal:p},k))}function O(k,j,n){var g=k[j];!n&&!g&&(k[j]=g={});return g||{}}function m(k,j){for(var n=0,g=j.length;void 0!==k&&n<g;n++){k=k[j[n]]}return k}function i(j){var g;-1!==j.indexOf(".")&&(g=j.split("."),j=g.shift());return{path:g,name:j}}function f(o,j,p){var g=p;if(j){var o=g=void 0===o?{}:Q.clone(o),n=j.length-1;if(0<=n){for(var k=0;k<n;k++){o=o[j[k]]}void 0!==o&&(o[j[k]]=p)}}return g}function e(r,u,s,t,q){var p,o,n;p=i(u);var g=u,u=p.name;p=p.path;n=r.get(u);var k=u,j=O(r,"__defaultBeforeFns");j[k]||(j[k]=1,k="before"+Q.ucfirst(k)+"Change",r.publish(k,{defaultFn:d}));p&&(o=m(n,p));if(t.force||!(!p&&n===s||p&&o===s)){s=f(n,p,s);s=Q.mix({attrName:u,subAttrName:g,prevVal:n,newVal:s,_opts:t,_attrs:q,target:r},t.data);if(t.silent){if(P===d.call(r,s)){return P}}else{if(P===r.fire("before"+Q.ucfirst(u)+"Change",s)){return P}}return r}}function d(o){if(o.target===this){var j=o.newVal,p=o.prevVal,g=o.attrName,n=o.subAttrName,k=o._attrs,o=o._opts,j=this.setInternal(g,j);if(j===P){return j}o.silent||(j=M(this)[g],J(this,"after",g,p,j,n,null,o.data),k?k.push({prevVal:p,newVal:j,attrName:g,subAttrName:n}):J(this,"","*",[p],[j],[n],[g],o.data))}}function H(n){var j=this.constructor;for(this.userConfig=n;j;){var o=j.ATTRS;if(o){var g=void 0;for(g in o){this.addAttr(g,o[g],!1)}}j=j.superclass?j.superclass.constructor:null}if(n){for(var k in n){this.setInternal(k,n[k])}}}function c(k,j){var n=j.__hooks__||{},g;for(g in n){g in k&&(k[g]=n[g](k[g]))}Q.each(k,function(o,s){if("function"===typeof o){var r=0;if(o.__owner__){var q=o.__owner__;delete o.__owner__;delete o.__name__;var r=o.__wrapped__=1,p=b(o);p.__owner__=q;p.__name__=s;q.prototype[s]=p}else{o.__wrapped__&&(r=1)}r&&(k[s]=o=b(o));o.__owner__=j;o.__name__=s}})}function l(g){c(g,this);Q.mix(this.prototype,g)}function D(n,j){var o=n.getAttrs(),g=O(o,j,1),k=g.valueFn;if(k&&(k=N(n,k))){k=k.call(n),void 0!==k&&(g.value=k),delete g.valueFn,o[j]=g}return g.value}function K(o,j,p,g){var n,k;n=i(j);j=n.name;if(n=n.path){k=o.get(j),p=f(k,n,p)}if((n=O(o.getAttrs(),j).validator)&&(n=N(o,n))){if(o=n.call(o,p,j,g),void 0!==o&&!0!==o){return o}}}L=L("event/custom");G.exports=H;var b=Q.bind,I={},P=!1;H.extend=function R(o,g){var n,g=g||{},o=o||{},k=g.__hooks__;if(n=this.__hooks__){k=g.__hooks__=g.__hooks__||{},Q.mix(k,n,!1)}n=o.hasOwnProperty("constructor")?o.constructor:function(){this.callSuper.apply(this,arguments)};o.constructor=n;n.__hooks__=k;c(o,n);var j=g.inheritedStatics;if(k=this.inheritedStatics){j=g.inheritedStatics=g.inheritedStatics||{},Q.mix(j,k,!1)}Q.extend(n,this,o,g);j&&Q.mix(n,j);n.extend=g.extend||R;n.addMembers=l;return n};Q.augment(H,L.Target,{INVALID:I,callSuper:function(){var j,n,g=arguments;"function"===typeof this&&this.__name__?(j=this,n=g[0],g=Array.prototype.slice.call(g,1)):(j=arguments.callee.caller,j.__wrapped__&&(j=j.caller),n=this);var k=j.__name__;if(k){return j=j.__owner__.superclass[k],!j?void 0:j.apply(n,g||[])}},getAttrs:function(){return this.__attrs||(this.__attrs={})},getAttrVals:function(){var j={},k,g=this.getAttrs();for(k in g){j[k]=this.get(k)}return j},addAttr:function(j,o,g){var n=this.getAttrs(),k,o=Q.clone(o);(k=n[j])?Q.mix(k,o,g):n[j]=o;return this},addAttrs:function(j,k){var g=this;Q.each(j,function(n,o){g.addAttr(o,n)});k&&g.set(k);return g},hasAttr:function(g){return this.getAttrs().hasOwnProperty(g)},removeAttr:function(j){var k=M(this),g=this.getAttrs();this.hasAttr(j)&&(delete g[j],delete k[j]);return this},set:function(u,s,t){var r;if(Q.isPlainObject(u)){var t=s||{},s=Object(u),q=[],p=[];for(u in s){void 0!==(r=K(this,u,s[u],s))&&p.push(r)}if(p.length){return t.error&&t.error(p),P}for(u in s){e(this,u,s[u],t,q)}var o=[],n=[],j=[],g=[];Q.each(q,function(k){n.push(k.prevVal);j.push(k.newVal);o.push(k.attrName);g.push(k.subAttrName)});o.length&&J(this,"","*",n,j,g,o,t.data);return this}t=t||{};r=K(this,u,s);return void 0!==r?(t.error&&t.error(r),P):e(this,u,s,t)},setInternal:function(j,n){var g,k=O(this.getAttrs(),j).setter;if(k&&(k=N(this,k))){g=k.call(this,n,j)}if(g===I){return P}void 0!==g&&(n=g);M(this)[j]=n},get:function(j){var o,g=M(this),n,k;-1!==j.indexOf(".")&&(o=j.split("."),j=o.shift());n=O(this.getAttrs(),j,1).getter;k=j in g?g[j]:D(this,j);if(n&&(n=N(this,n))){k=n.call(this,k,j)}!(j in g)&&void 0!==k&&(g[j]=k);o&&(k=m(k,o));return k},reset:function(j,n){if("string"===typeof j){return this.hasAttr(j)?this.set(j,D(this,j),n):this}var n=j,g=this.getAttrs(),k={};for(j in g){k[j]=D(this,j)}this.set(k,n);return this}})});KISSY.add("overlay/extension/loading",["node"],function(b,f){function i(){}var d=f("node");i.prototype={loading:function(){this._loadingExtEl||(this._loadingExtEl=(new d('<div class="'+this.get("prefixCls")+'ext-loading" style="position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);"/>')).appendTo(this.$el));this._loadingExtEl.show()},unloading:function(){var c=this._loadingExtEl;c&&c.hide()}};return i});KISSY.add("overlay/extension/mask",["node"],function(s,v){function x(d,c){var e=d.view.getBaseCssClasses("mask"),e=n('<div  style="width:'+(u?"expression(KISSY.DOM.docWidth())":"100%")+";left:0;top:0;height:"+(u?"expression(KISSY.DOM.docHeight())":"100%")+";position:"+(u?"absolute":"fixed")+';" class="'+e+" "+c+'">'+(u?'<iframe style="position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;"></iframe>':"")+"</div>").prependTo("body");e.unselectable();e.on("mousedown",function(b){b.preventDefault()});return e}function t(){}function y(e,f){var c=e.get("maskNode"),g=e.view.getBaseCssClasses("mask-hidden");f?c.removeClass(g):c.addClass(g)}function z(b,g,l,m){var h=b.effect||p;y(m,l);if(h!==p){var m=b.duration,b=b.easing,j=l?1:0;g.stop(1,1);g.css("display",l?p:"block");g[h+q[h][j]](m,function(){g.css("display","")},b)}}function r(e){var f=this.get("maskNode");if(e=e.newVal){var c=Number(this.$el.css("z-index"));isNaN(c)||f.css("z-index",c)}z(this.get("mask"),f,e,this)}var w=s.UA,k=v("node"),u=6===w.ie,n=k.all;t.ATTRS={mask:{value:!1},maskNode:{}};var p="none",q={fade:["Out","In"],slide:["Up","Down"]};t.prototype={__renderUI:function(){this.get("mask")&&this.set("maskNode",x(this,this.get("visible")?"":this.view.getBaseCssClasses("mask-hidden")))},__bindUI:function(){var b,c;if(c=this.get("mask")){b=this.get("maskNode");if(c.closeOnClick){b.on(k.Gesture.tap,this.close,this)}this.on("afterVisibleChange",r)}},__destructor:function(){var b;(b=this.get("maskNode"))&&b.remove()}};return t});KISSY.add("overlay/close-xtpl",[],function(){return function(l){var p,r=this;p=this.config.utils;var m=p.runBlockCommand,s=p.renderOutput,t=p.getProperty,k=p.runInlineCommand,q=p.getPropertyOrRunCommand;p="";var j={},n=[],t=t(r,l,"closable",0,1);n.push(t);j.params=n;j.fn=function(b){var d;d='\n<a href="javascript:void(\'close\')"\n   id="ks-overlay-close-';var h=q(r,b,{},"id",0,3);d+=s(h,!0);d+='"\n   class="';var h={},c=[];c.push("close");h.params=c;h=k(r,b,h,"getBaseCssClasses",4);d+=s(h,!0);d+="\"\n   role='button'>\n    <span class=\"";h={};c=[];c.push("close-x");h.params=c;b=k(r,b,h,"getBaseCssClasses",6);d+=s(b,!0);return d+'">close</span>\n</a>\n'};p+=m(r,l,j,"if",1);return p+"\n"}});KISSY.add("overlay/overlay-xtpl",["overlay/close-xtpl","component/extension/content-xtpl"],function(b,f,i,d){return function(g){var h,j;h=this.config.utils;"undefined"!==typeof d&&d.kissy&&(j=d);var l=h.renderOutput,n=h.runInlineCommand;h="";var k={},e=[];e.push("overlay/close-xtpl");k.params=e;j&&(f("overlay/close-xtpl"),k.params[0]=j.resolveByName(k.params[0]));k=n(this,g,k,"include",1);h+=l(k,!1);h+="\n";k={};e=[];e.push("component/extension/content-xtpl");k.params=e;j&&(f("component/extension/content-xtpl"),k.params[0]=j.resolveByName(k.params[0]));g=n(this,g,k,"include",2);return h+=l(g,!1)}});KISSY.add("overlay/overlay-render",["component/container","./overlay-xtpl","component/extension/content-render"],function(f,j){var k=j("component/container"),i=j("./overlay-xtpl"),d=j("component/extension/content-render");return k.getDefaultRender().extend([d],{createDom:function(){this.fillChildrenElsBySelectors({closeBtn:"#ks-overlay-close-{id}"})}},{ATTRS:{contentTpl:{value:i}},HTML_PARSER:{closeBtn:function(b){return b.one("."+this.getBaseCssClass("close"))}}})});KISSY.add("overlay/extension/overlay-effect",[],function(i){function k(b){var c=b.$el.clone(!0);c.css({visibility:"visible",overflow:"hidden"}).addClass(b.get("prefixCls")+"overlay-ghost");return b.__afterCreateEffectGhost(c)}function l(t,q,s){t.__effectGhost&&t.__effectGhost.stop(1,1);var p=t.$el,r=i.all,o=t.get("effect"),m=r(o.target),r=o.duration,m=i.mix(m.offset(),{width:m.width(),height:m.height()}),h=i.mix(p.offset(),{width:p.width(),height:p.height()}),e=k(t),o=o.easing;e.insertAfter(p);q?(q=m,m=h):q=h;p.css("visibility","hidden");e.css(q);t.__effectGhost=e;e.animate(m,{duration:r,easing:o,complete:function(){t.__effectGhost=null;e.remove();p.css("visibility","");s()}})}function j(c,r,q){var p=c.$el,o=c.get("effect"),n=o.effect||"none",m=o.target;"none"===n&&!m?q():m?l(c,r,q):(c=o.duration,o=o.easing,m=r?1:0,p.stop(1,1),p.css({visibility:"visible",display:r?"none":"block"}),p[n+f[n][m]](c,function(){p.css({display:"block",visibility:""});q()},o))}function d(){}var f={fade:["Out","In"],slide:["Up","Down"]};d.ATTRS={effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(c){var e=c.effect;"string"===typeof e&&!f[e]&&(c.effect="")}}};d.prototype={__afterCreateEffectGhost:function(b){return b},_onSetVisible:function(e){var c=this;j(c,e,function(){c.fire(e?"show":"hide")})}};return d});KISSY.add("overlay/control","component/container,component/extension/shim,component/extension/align,./extension/loading,./extension/mask,./overlay-render,./extension/overlay-effect".split(","),function(l,p){var r=p("component/container"),m=p("component/extension/shim"),s=p("component/extension/align"),t=p("./extension/loading"),k=p("./extension/mask"),q=p("./overlay-render"),j=p("./extension/overlay-effect"),n={hide:"hide",destroy:"destroy"};return r.extend([m,t,s,k,j],{bindUI:function(){var d=this,c=d.get("closeBtn");if(c){c.on("click",function(e){d.close();e.preventDefault()})}},close:function(){this[n[this.get("closeAction")]||"hide"]();return this}},{ATTRS:{contentEl:{},closable:{value:false,view:1},closeBtn:{view:1},closeAction:{value:"hide"},focusable:{value:false},allowTextSelection:{value:true},handleMouseEvents:{value:false},visible:{value:false},xrender:{value:q}},xclass:"overlay"})});KISSY.add("overlay/dialog-xtpl",["overlay/close-xtpl"],function(b,f,i,d){return function(v){var w,u=this,t;w=this.config.utils;"undefined"!==typeof d&&d.kissy&&(t=d);var r=w.runBlockCommand,s=w.renderOutput,g=w.getProperty,o=w.runInlineCommand,q=w.getPropertyOrRunCommand;w="";var p={},e=[];e.push("overlay/close-xtpl");p.params=e;t&&(f("overlay/close-xtpl"),p.params[0]=t.resolveByName(p.params[0]));t=o(u,v,p,"include",1);w+=s(t,!1);w+='\n<div id="ks-content-';t=q(u,v,{},"id",0,2);w+=s(t,!0);w+='"\n     class="';t={};p=[];p.push("content");t.params=p;t=o(u,v,t,"getBaseCssClasses",3);w+=s(t,!0);w+='">\n    <div class="';t={};p=[];p.push("header");t.params=p;t=o(u,v,t,"getBaseCssClasses",4);w+=s(t,!0);w+='"\n         style="\n';t={};p=[];e=g(u,v,"headerStyle",0,6);p.push(e);t.params=p;t.fn=function(h){var c;c=" \n ";var j=q(u,h,{},"xindex",0,7);c=c+s(j,true);c=c+":";h=q(u,h,{},".",0,7);c=c+s(h,true);return c+";\n"};w+=r(u,v,t,"each",6);w+='\n"\n         id="ks-stdmod-header-';t=q(u,v,{},"id",0,10);w+=s(t,!0);w+='">';t=q(u,v,{},"headerContent",0,10);w+=s(t,!1);w+='</div>\n\n    <div class="';t={};p=[];p.push("body");t.params=p;t=o(u,v,t,"getBaseCssClasses",12);w+=s(t,!0);w+='"\n         style="\n';t={};p=[];e=g(u,v,"bodyStyle",0,14);p.push(e);t.params=p;t.fn=function(h){var c;c=" \n ";var j=q(u,h,{},"xindex",0,15);c=c+s(j,true);c=c+":";h=q(u,h,{},".",0,15);c=c+s(h,true);return c+";\n"};w+=r(u,v,t,"each",14);w+='\n"\n         id="ks-stdmod-body-';t=q(u,v,{},"id",0,18);w+=s(t,!0);w+='">';t=q(u,v,{},"bodyContent",0,18);w+=s(t,!1);w+='</div>\n\n    <div class="';t={};p=[];p.push("footer");t.params=p;o=o(u,v,t,"getBaseCssClasses",20);w+=s(o,!0);w+='"\n         style="\n';o={};t=[];g=g(u,v,"footerStyle",0,22);t.push(g);o.params=t;o.fn=function(h){var c;c=" \n ";var j=q(u,h,{},"xindex",0,23);c=c+s(j,true);c=c+":";h=q(u,h,{},".",0,23);c=c+s(h,true);return c+";\n"};w+=r(u,v,o,"each",22);w+='\n"\n         id="ks-stdmod-footer-';r=q(u,v,{},"id",0,26);w+=s(r,!0);w+='">';v=q(u,v,{},"footerContent",0,26);w+=s(v,!1);return w+'</div>\n</div>\n<div tabindex="0"></div>'}});KISSY.add("overlay/dialog-render",["./overlay-render","./dialog-xtpl"],function(b,f){var i=f("./overlay-render"),d=f("./dialog-xtpl");return i.extend({beforeCreateDom:function(c){b.mix(c.elAttrs,{role:"dialog","aria-labelledby":"ks-stdmod-header-"+this.control.get("id")})},createDom:function(){this.fillChildrenElsBySelectors({header:"#ks-stdmod-header-{id}",body:"#ks-stdmod-body-{id}",footer:"#ks-stdmod-footer-{id}"})},getChildrenContainerEl:function(){return this.control.get("body")},_onSetBodyStyle:function(c){this.control.get("body").css(c)},_onSetHeaderStyle:function(c){this.control.get("header").css(c)},_onSetFooterStyle:function(c){this.control.get("footer").css(c)},_onSetBodyContent:function(c){var e;e=this.control.get("body");e.html(c)},_onSetHeaderContent:function(c){var e;e=this.control.get("header");e.html(c)},_onSetFooterContent:function(c){var e;e=this.control.get("footer");e.html(c)}},{ATTRS:{contentTpl:{value:d}},HTML_PARSER:{header:function(c){return c.one("."+this.getBaseCssClass("header"))},body:function(c){return c.one("."+this.getBaseCssClass("body"))},footer:function(c){return c.one("."+this.getBaseCssClass("footer"))},headerContent:function(c){return c.one("."+this.getBaseCssClass("header")).html()},bodyContent:function(c){return c.one("."+this.getBaseCssClass("body")).html()},footerContent:function(c){return(c=c.one("."+this.getBaseCssClass("footer")))&&c.html()}}})});KISSY.add("overlay/dialog",["./control","./dialog-render","node"],function(i,k){var l=k("./control"),j=k("./dialog-render"),d=k("node"),l=l.extend({__afterCreateEffectGhost:function(e){var c=this.get("body");e.all("."+this.get("prefixCls")+"stdmod-body").css({height:c.height(),width:c.width()}).html("");return e},handleKeyDownInternal:function(m){if(this.get("escapeToClose")&&m.keyCode===d.KeyCode.ESC){if("select"!==m.target.nodeName.toLowerCase()||m.target.disabled){this.close(),m.halt()}}else{f:if(m.keyCode===f){var h=this.$el,g=d.all(m.target),b=h.last();if(g.equals(h)&&m.shiftKey){b[0].focus(),m.halt()}else{if(g.equals(b)&&!m.shiftKey){this.focus(),m.halt()}else{if(g.equals(h)||h.contains(g)){break f}}}m.halt()}}},_onSetVisible:function(g,e){var m=this.el;if(g){this.__lastActive=m.ownerDocument.activeElement,this.focus(),m.setAttribute("aria-hidden","false")}else{m.setAttribute("aria-hidden","true");try{this.__lastActive&&this.__lastActive.focus()}catch(h){}}this.callSuper(g,e)}},{ATTRS:{header:{view:1},body:{view:1},footer:{view:1},bodyStyle:{value:{},view:1},footerStyle:{value:{},view:1},headerStyle:{value:{},view:1},headerContent:{value:"",view:1},bodyContent:{value:"",view:1},footerContent:{value:"",view:1},closable:{value:!0},xrender:{value:j},focusable:{value:!0},escapeToClose:{value:!0}},xclass:"dialog"}),f=d.KeyCode.TAB;return l});KISSY.add("overlay/popup",["./control"],function(b,c){return c("./control").extend({initializer:function(){var d=this;d.get("trigger")&&("mouse"===d.get("triggerType")?(d._bindTriggerMouse(),d.on("afterRenderUI",function(){d._bindContainerMouse()})):d._bindTriggerClick())},_bindTriggerMouse:function(){var g=this,f=g.get("trigger"),d;g.__mouseEnterPopup=function(e){g._clearHiddenTimer();d=b.later(function(){g._showing(e);d=void 0},1000*g.get("mouseDelay"))};f.on("mouseenter",g.__mouseEnterPopup);g._mouseLeavePopup=function(){d&&(d.cancel(),d=void 0);g._setHiddenTimer()};f.on("mouseleave",g._mouseLeavePopup)},_bindContainerMouse:function(){this.$el.on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var d=this;d._hiddenTimer=b.later(function(){d._hiding()},1000*d.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=void 0)},_bindTriggerClick:function(){var d=this;d.__clickPopup=function(f){f.preventDefault();if(d.get("toggle")){d[d.get("visible")?"_hiding":"_showing"](f)}else{d._showing(f)}};d.get("trigger").on("click",d.__clickPopup)},_showing:function(d){this.set("currentTrigger",b.one(d.target));this.show()},_hiding:function(){this.set("currentTrigger",void 0);this.hide()},destructor:function(){var f=this.$el,d=this.get("trigger");d&&(this.__clickPopup&&d.detach("click",this.__clickPopup),this.__mouseEnterPopup&&d.detach("mouseenter",this.__mouseEnterPopup),this._mouseLeavePopup&&d.detach("mouseleave",this._mouseLeavePopup));f.detach("mouseleave",this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,this)}},{ATTRS:{trigger:{setter:function(d){return b.all(d)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}},xclass:"popup"})});KISSY.add("overlay",["overlay/control","overlay/dialog","overlay/popup"],function(f,j){var k=j("overlay/control"),i=j("overlay/dialog"),d=j("overlay/popup");k.Dialog=i;f.Dialog=i;k.Popup=d;return f.Overlay=k});KISSY.add("component/container/render",["component/control","component/manager"],function(c,h){var e=h("component/control"),b=h("component/manager");return e.getDefaultRender().extend([],{decorateDom:function(){var m=this,k=m.getChildrenContainerEl(),i=m.control,g=i.get("defaultChildCfg"),n=g.prefixCls,l=g.xclass,j=[];k.children().each(function(d){var o=m.getComponentConstructorByNode(n,d)||l&&b.getConstructorByXClass(l);o&&j.push(new o(c.merge(g,{srcNode:d})))});i.set("children",j)},getChildrenContainerEl:function(){return this.$el}},{name:"ContainerRender"})});KISSY.add("component/container",["component/control","./container/render"],function(h,m){function l(f){if(f.target===this){var d=f.component,g=this.get("children"),f=f.index;g.splice(f,0,d);g=this.get("children");d=g[f];d.setInternal("parent",this);this.get("rendered")&&this.renderChild(f);this.fire("afterAddChild",{component:d,index:f})}}function e(g){if(g.target===this){var f=g.component,n,j,i=g.destroy,k=this.get("children"),g=g.index;-1!==g&&k.splice(g,1);f.setInternal("parent",null);if(i){f.destroy&&f.destroy()}else{if(f.get&&(j=f.el)){(n=j.parentNode)&&n.removeChild(j)}}this.fire("afterRemoveChild",{component:f,index:g})}}var c=m("component/control"),b=m("./container/render");return c.extend({isContainer:!0,initializer:function(){var f=this.get("prefixCls"),d=this.get("defaultChildCfg");this.publish("beforeAddChild",{defaultFn:l});this.publish("beforeRemoveChild",{defaultFn:e});d.prefixCls=d.prefixCls||f},createDom:function(){this.createChildren()},renderUI:function(){this.renderChildren()},renderChildren:function(){var f,d=this.get("children");for(f=0;f<d.length;f++){this.renderChild(f)}},createChildren:function(){var f,d=this.get("children");for(f=0;f<d.length;f++){this.createChild(f)}},addChild:function(f,d){var g=this.get("children");void 0===d&&(d=g.length);this.fire("beforeAddChild",{component:f,index:d})},renderChild:function(f){var d=this.get("children");this.createChild(f).render();this.fire("afterRenderChild",{component:d[f],index:f})},createChild:function(g){var f,k,i,j;f=this.get("children")[g];j=this.view.getChildrenContainerEl();i=j[0];k=i.children[g]||null;f.get("rendered")?(j=f.el,j.parentNode!==i&&i.insertBefore(j,k)):(k?f.set("elBefore",k):f.set("render",j),f.create());this.fire("afterCreateChild",{component:f,index:g});return f},removeChild:function(f,d){void 0===d&&(d=!0);this.fire("beforeRemoveChild",{component:f,index:h.indexOf(f,this.get("children")),destroy:d})},removeChildren:function(f){var d,g=[].concat(this.get("children"));for(d=0;d<g.length;d++){this.removeChild(g[d],f)}return this},getChildAt:function(d){return this.get("children")[d]||null},destructor:function(){var f,d=this.get("children");for(f=0;f<d.length;f++){d[f].destroy&&d[f].destroy()}}},{ATTRS:{children:{value:[],getter:function(g){var f=null,j,i;for(j=0;j<g.length;j++){i=g[j],i.isControl||(f=f||this.get("defaultChildCfg"),h.mix(i,f,!1),g[j]=this.createComponent(i))}return g},setter:function(f){var d,g;for(d=0;d<f.length;d++){g=f[d],g.isControl&&g.setInternal("parent",this)}}},defaultChildCfg:{value:{}},xrender:{value:b}},name:"container"})});KISSY.add("component/control/process",["base","promise"],function(o,f){function n(c){c.fire("beforeSyncUI");c.syncUI();c.__callPluginsMethod("pluginSyncUI");c.fire("afterSyncUI")}var e=f("base"),i=f("promise").Defer,p=e.prototype.__getHook,q=o.noop,l=e.extend({bindInternal:q,syncInternal:q,initializer:function(){this._renderedDefer=new i},renderUI:q,syncUI:q,bindUI:q,onRendered:function(c){return this._renderedDefer.promise.then(c)},create:function(){this.get("created")||(this.fire("beforeCreateDom"),this.createInternal(),this.__callPluginsMethod("pluginCreateDom"),this.fire("afterCreateDom"),this.setInternal("created",!0));return this},createInternal:function(){this.createDom()},render:function(){this.get("rendered")||(this.create(),this.fire("beforeRenderUI"),this.renderUI(),this.__callPluginsMethod("pluginRenderUI"),this.fire("afterRenderUI"),this.fire("beforeBindUI"),l.superclass.bindInternal.call(this),this.bindUI(),this.__callPluginsMethod("pluginBindUI"),this.fire("afterBindUI"),l.superclass.syncInternal.call(this),n(this),this.setInternal("rendered",!0));return this},sync:function(){n(this)},plug:function(d){var g=this.get("plugins");this.callSuper(d);d=g[g.length-1];this.get("rendered")?(d.pluginCreateDom&&d.pluginCreateDom(this),d.pluginRenderUI&&d.pluginCreateDom(this),d.pluginBindUI&&d.pluginBindUI(this),d.pluginSyncUI&&d.pluginSyncUI(this)):this.get("created")&&d.pluginCreateDom&&d.pluginCreateDom(this);return this}},{__hooks__:{createDom:p("__createDom"),renderUI:p("__renderUI"),bindUI:p("__bindUI"),syncUI:p("__syncUI")},name:"ComponentProcess",ATTRS:{rendered:{value:!1,setter:function(c){c&&this._renderedDefer.resolve(this)}},created:{value:!1}}});return l});KISSY.add("component/control/render-xtpl",[],function(){return function(r){var u,q=this;u=this.config.utils;var e=u.runBlockCommand,n=u.renderOutput,s=u.getProperty,t=u.runInlineCommand,o=u.getPropertyOrRunCommand;u='<div id="';var p=o(q,r,{},"id",0,1);u+=n(p,!0);u+='"\n class="';var p={},f=[];f.push("");p.params=f;t=t(q,r,p,"getBaseCssClasses",2);u+=n(t,!0);u+="\n";t={};p=[];f=s(q,r,"elCls",0,3);p.push(f);t.params=p;t.fn=function(d){var g;g="\n ";d=o(q,d,{},".",0,4);g+=n(d,!0);return g+"  \n"};u+=e(q,r,t,"each",3);u+='\n"\n\n';t={};p=[];f=s(q,r,"elAttrs",0,8);p.push(f);t.params=p;t.fn=function(d){var h;h=" \n ";var g=o(q,d,{},"xindex",0,9);h+=n(g,!0);h+='="';d=o(q,d,{},".",0,9);h+=n(d,!0);return h+'"\n'};u+=e(q,r,t,"each",8);u+='\n\nstyle="\n';t={};p=[];s=s(q,r,"elStyle",0,13);p.push(s);t.params=p;t.fn=function(d){var h;h=" \n ";var g=o(q,d,{},"xindex",0,14);h+=n(g,!0);h+=":";d=o(q,d,{},".",0,14);h+=n(d,!0);return h+";\n"};u+=e(q,r,t,"each",13);return u+'\n">'}});KISSY.add("component/control/render",["node","xtemplate/runtime","./process","./render-xtpl","component/manager"],function(G,K){function F(b){"number"===typeof b&&(b+="px");return b}function A(b){b||(b=[""]);"string"===typeof b&&(b=b.split(/\s+/));return b}function C(k,h,d){for(var l="",j=0,i=d.length,h=k+h;j<i;j++){k=(k=d[j])?"-"+k:k,l+=" "+h+k}return l}function I(c){var b;c.target===this.control&&(b=this[H+c.type.slice(5).slice(0,-6)],b.call(this,c.newVal,c))}function J(c,b){return this.config.view.getBaseCssClasses(b.params[0])}function D(c,b){return this.config.view.getBaseCssClass(b.params[0])}var E=K("node"),B=K("xtemplate/runtime"),z=K("./process"),y=K("./render-xtpl"),L=K("component/manager"),H="_onSet",x=G.trim,v=E.all,u=G.UA,e=G.Env.host.document;return z.extend({isRender:!0,createInternal:function(){var b=this.control.get("srcNode");b?this.decorateDom(b):this.callSuper()},beforeCreateDom:function(n){var r=this.control,q,p,m,l=r.get("elAttrs"),j=r.get("elCls"),o;q=r.getAttrs();o=r.get("elStyle");var h=r.get("elCls");for(p in q){m=q[p],m.view&&(n[p]=r.get(p))}q=n.width;p=n.height;m=n.visible;n=n.zIndex;q&&(o.width=F(q));p&&(o.height=F(p));n&&(o["z-index"]=n);m||h.push(this.getBaseCssClasses("hidden"));if(o=r.get("disabled")){j.push(this.getBaseCssClasses("disabled")),l["aria-disabled"]="true"}r.get("highlighted")&&j.push(this.getBaseCssClasses("hover"));r.get("focusable")&&(9>u.ieMode&&(l.hideFocus="true"),l.tabindex=o?"-1":"0")},createDom:function(){this.beforeCreateDom(this.renderData={},this.childrenElSelectors={},this.renderCommands={getBaseCssClasses:J,getBaseCssClass:D});var c=this.control,b;b=this.renderTpl(y)+this.renderTpl(this.get("contentTpl"))+"</div>";c.setInternal("el",this.$el=v(b));this.el=this.$el[0];this.fillChildrenElsBySelectors()},decorateDom:function(h){var g=this.control;h.attr("id")||h.attr("id",g.get("id"));var k=this.constructor.HTML_PARSER,i,j;for(i in k){j=k[i],"function"===typeof j?(j=j.call(this,h),void 0!==j&&g.setInternal(i,j)):"string"===typeof j?g.setInternal(i,h.one(j)):G.isArray(j)&&j[0]&&g.setInternal(i,h.all(j[0]))}g.setInternal("el",this.$el=h);this.el=h[0]},renderUI:function(){var f=this.control,d=this.$el;if(!f.get("srcNode")){var g=f.get("render");(f=f.get("elBefore"))?d.insertBefore(f,void 0):g?d.appendTo(g,void 0):d.appendTo(e.body,void 0)}},bindUI:function(){var f=this.control,d=f.getAttrs(),m,l;for(m in d){l=d[m];var j=G.ucfirst(m),g=this[H+j];if(l.view&&g){f.on("after"+j+"Change",I,this)}}},destructor:function(){this.$el&&this.$el.remove()},$:function(b){return this.$el.all(b)},fillChildrenElsBySelectors:function(h){var g=this.$el,k=this.control,i,j,h=h||this.childrenElSelectors;for(i in h){j=h[i],"function"===typeof j?k.setInternal(i,j(g)):k.setInternal(i,this.$(G.substitute(j,this.renderData))),delete h[i]}},renderTpl:function(f,d,g){d=d||this.renderData;g=g||this.renderCommands;return(new (this.get("xtemplate"))(f,{control:this.control,view:this,commands:g})).render(d)},getComponentConstructorByNode:function(d,h){var g=h[0].className;return g?(g=g.replace(RegExp("\\b"+d,"ig"),""),L.getConstructorByXClass(g)):null},getComponentCssClasses:function(){if(this.componentCssClasses){return this.componentCssClasses}for(var f=this.control.constructor,d,g=[];f&&!f.prototype.hasOwnProperty("isControl");){(d=f.xclass)&&g.push(d),f=f.superclass&&f.superclass.constructor}return this.componentCssClasses=g},getBaseCssClasses:function(i){for(var i=A(i),h=this.getComponentCssClasses(),m=0,k=this.get("control"),l="",j=h.length,k=k.get("prefixCls");m<j;m++){l+=C(k,h[m],i)}return x(l)},getBaseCssClass:function(b){return x(C(this.control.get("prefixCls"),this.getComponentCssClasses()[0],A(b)))},getKeyEventTarget:function(){return this.$el},_onSetWidth:function(b){this.$el.width(b)},_onSetHeight:function(b){this.$el.height(b)},_onSetContent:function(d){var c=this.$el;c.html(d);this.get("allowTextSelection")||c.unselectable()},_onSetVisible:function(f){var d=this.$el,g=this.getBaseCssClasses("hidden");f?d.removeClass(g):d.addClass(g)},_onSetHighlighted:function(d){var c=this.getBaseCssClasses("hover");this.$el[d?"addClass":"removeClass"](c)},_onSetDisabled:function(f){var d=this.control,g=this.getBaseCssClasses("disabled");this.$el[f?"addClass":"removeClass"](g).attr("aria-disabled",f);d.get("focusable")&&this.getKeyEventTarget().attr("tabindex",f?-1:0)},_onSetActive:function(d){var c=this.getBaseCssClasses("active");this.$el[d?"addClass":"removeClass"](c).attr("aria-pressed",!!d)},_onSetFocused:function(f){var d=this.$el,g=this.getBaseCssClasses("focused");d[f?"addClass":"removeClass"](g)},_onSetZIndex:function(b){this.$el.css("z-index",b)}},{__hooks__:{decorateDom:z.prototype.__getHook("__decorateDom"),beforeCreateDom:z.prototype.__getHook("__beforeCreateDom")},extend:function w(h,g,k){var i,j={};i=z.extend.apply(this,arguments);i.HTML_PARSER=i.HTML_PARSER||{};G.isArray(h)&&(G.each(h.concat(i),function(b){b&&G.each(b.HTML_PARSER,function(d,c){j[c]=d})}),i.HTML_PARSER=j);G.mix(i.HTML_PARSER,this.HTML_PARSER,!1);i.extend=w;return i},ATTRS:{control:{setter:function(b){this.control=b}},xtemplate:{value:B},contentTpl:{value:function(b){return b.get("content")||""}}},HTML_PARSER:{id:function(b){return(b=b[0].id)?b:void 0},content:function(b){return b.html()},disabled:function(b){return b.hasClass(this.getBaseCssClass("disabled"))}},name:"render"})});KISSY.add("component/control",["node","./control/process","component/manager","./control/render"],function(w,A){function v(){var d,c=this;do{d=c.ATTRS,c=c.superclass}while(!d||!d.xrender);return d.xrender.value}var q=A("node"),s=A("./control/process"),y=A("component/manager"),z=A("./control/render"),t=w.UA.ieMode,u=w.Features,r=q.Gesture,p=u.isTouchGestureSupported(),e=u.isTouchEventSupported(),z=s.extend({isControl:!0,createDom:function(){var f=this.get("xrender"),d=this.get("view"),g=this.get("id");d?d.set("control",this):this.set("view",this.view=d=new f({control:this}));d.create();f=d.getKeyEventTarget();this.get("allowTextSelection")||f.unselectable();y.addComponent(g,this)},renderUI:function(){this.view.render()},bindUI:function(){var b=this.view.getKeyEventTarget();if(this.get("focusable")){b.on("focus",this.handleFocus,this).on("blur",this.handleBlur,this).on("keydown",this.handleKeydown,this)}if(this.get("handleMouseEvents")){b=this.$el;if(!e){b.on("mouseenter",this.handleMouseEnter,this).on("mouseleave",this.handleMouseLeave,this).on("contextmenu",this.handleContextMenu,this)}b.on(r.start,this.handleMouseDown,this).on(r.end,this.handleMouseUp,this).on(r.tap,this.handleClick,this);if(r.cancel){b.on(r.cancel,this.handleMouseUp,this)}if(9>t){b.on("dblclick",this.handleDblClick,this)}}},sync:function(){this.fire("beforeSyncUI");this.syncUI();this.view.sync();this.__callPluginsMethod("pluginSyncUI");this.fire("afterSyncUI")},createComponent:function(d,c){return y.createComponent(d,c||this)},_onSetFocused:function(d){var c=this.view.getKeyEventTarget()[0];d?c.focus():c.ownerDocument.activeElement===c&&c.ownerDocument.body.focus()},_onSetX:function(b){this.$el.offset({left:b})},_onSetY:function(b){this.$el.offset({top:b})},_onSetVisible:function(b){this.fire(b?"show":"hide")},show:function(){this.render();this.set("visible",!0);return this},hide:function(){this.set("visible",!1);return this},focus:function(){this.get("focusable")&&this.set("focused",!0)},blur:function(){this.get("focusable")&&this.set("focused",!1)},move:function(d,c){this.set({x:d,y:c})},handleDblClick:function(b){this.get("disabled")||this.handleDblClickInternal(b)},handleDblClickInternal:function(b){this.handleClickInternal(b)},handleMouseEnter:function(b){this.get("disabled")||this.handleMouseEnterInternal(b)},handleMouseEnterInternal:function(b){this.set("highlighted",!!b)},handleMouseLeave:function(b){this.get("disabled")||this.handleMouseLeaveInternal(b)},handleMouseLeaveInternal:function(b){this.set("active",!1);this.set("highlighted",!b)},handleMouseDown:function(b){this.get("disabled")||this.handleMouseDownInternal(b)},handleMouseDownInternal:function(d){var c;if(1===d.which||p){this.get("activeable")&&this.set("active",!0),this.get("focusable")&&this.focus(),this.get("allowTextSelection")||(c=(c=d.target.nodeName)&&c.toLowerCase(),"input"!==c&&"textarea"!==c&&d.preventDefault())}},handleMouseUp:function(b){this.get("disabled")||this.handleMouseUpInternal(b)},handleMouseUpInternal:function(b){this.get("active")&&(1===b.which||p)&&this.set("active",!1)},handleContextMenu:function(b){this.get("disabled")||this.handleContextMenuInternal(b)},handleContextMenuInternal:function(){},handleFocus:function(){this.get("disabled")||this.handleFocusInternal()},handleFocusInternal:function(){this.focus();this.fire("focus")},handleBlur:function(){this.get("disabled")||this.handleBlurInternal()},handleBlurInternal:function(){this.blur();this.fire("blur")},handleKeydown:function(b){if(!this.get("disabled")&&this.handleKeyDownInternal(b)){return b.halt(),!0}},handleKeyDownInternal:function(b){if(b.keyCode===q.KeyCode.ENTER){return this.handleClickInternal(b)}},handleClick:function(b){this.get("disabled")||this.handleClickInternal(b)},handleClickInternal:function(){this.get("focusable")&&this.focus()},destructor:function(){y.removeComponent(this.get("id"));this.view?this.view.destroy():this.get("srcNode")&&this.get("srcNode").remove()}},{name:"control",ATTRS:{id:{view:1,valueFn:function(){return w.guid("ks-component")}},content:{view:1,value:""},width:{view:1},height:{view:1},elCls:{view:1,value:[],setter:function(b){"string"===typeof b&&(b=b.split(/\s+/));return b||[]}},elStyle:{view:1,value:{}},elAttrs:{view:1,value:{}},elBefore:{},el:{setter:function(b){this.$el=b;this.el=b[0]}},x:{},y:{},xy:{setter:function(d){var c=w.makeArray(d);c.length&&(void 0!==c[0]&&this.set("x",c[0]),void 0!==c[1]&&this.set("y",c[1]));return d},getter:function(){return[this.get("x"),this.get("y")]}},zIndex:{view:1},render:{},visible:{sync:0,value:!0,view:1},srcNode:{setter:function(b){return q.all(b)}},handleMouseEvents:{value:!0},focusable:{value:!0,view:1},allowTextSelection:{value:!1},activeable:{value:!0},focused:{view:1},active:{view:1,value:!1},highlighted:{view:1,value:!1},prefixCls:{view:1,value:w.config("component/prefixCls")||"ks-"},prefixXClass:{},parent:{setter:function(d,c){(c=this.get("parent"))&&this.removeTarget(c);d&&this.addTarget(d)}},disabled:{view:1,value:!1},xrender:{value:z},view:{setter:function(b){this.view=b}}}});z.getDefaultRender=v;z.extend=function x(d,m,h){var g=w.makeArray(arguments),k,f=g[g.length-1];if(k=f.xclass){f.name=k}g=s.extend.apply(this,g);k&&y.setConstructorByXClass(k,g);g.extend=x;g.getDefaultRender=v;return g};return z});KISSY.add("component/manager",[],function(){var b=0,f,d={},i={};return f={__instances:i,addComponent:function(e,c){i[e]=c},removeComponent:function(c){delete i[c]},getComponent:function(c){return i[c]},createComponent:function(e,c){var g,h;if(e){if(!e.isControl&&c&&(e.prefixCls||(e.prefixCls=c.get("prefixCls")),!e.xclass&&e.prefixXClass)){e.xclass=e.prefixXClass,e.xtype&&(e.xclass+="-"+e.xtype)}if(!e.isControl&&(h=e.xclass)){(g=f.getConstructorByXClass(h))||"can not find class by xclass desc : "+h,e=new g(e)}e.isControl&&c&&e.setInternal("parent",c)}return e},getConstructorByXClass:function(h){var h=h.split(/\s+/),g=-1,j,l,m,k=null;for(l=0;l<h.length;l++){if((m=d[h[l]])&&(j=m.priority)>g){g=j,k=m.constructor}}return k},setConstructorByXClass:function(e,c){d[e]={constructor:c,priority:b++}}}});KISSY.add("xtemplate/runtime/scope",[],function(c){function b(g,d){this.data=g||{};this.affix=d;this.root=this}b.prototype={isScope:1,setParent:function(d){this.parent=d;this.root=d.root},getParent:function(){return this.parent},getRoot:function(){return this.root},set:function(g,d){this.affix||(this.affix={});this.affix[g]=d},setData:function(d){this.data=d},getData:function(){return this.data},mix:function(d){this.affix||(this.affix={});c.mix(this.affix,d)},has:function(i){var g=this.data,d=this.affix;return d&&i in d?!0:"object"===typeof g&&i in g},get:function(i){var g=this.data,d=this.affix;if(d&&i in d){return d[i]}if("object"===typeof g&&i in g){return g[i]}},resolve:function(p,o){"."===p&&(p="this");var m=p.split("."),q=this,t,s,r,n,j;if("root"===m[0]){m.shift(),q=q.root}else{if(o){for(;q&&o--;){q=q.parent}}}var l=0;for(t=m.length;q;){j=1;r=q;for(s=0;s<t;s++){if(n=m[s],"this"===n){l=1}else{if(r===q){if(!q.has(n)){j=0;break}r=q.get(n)}else{if("object"!==typeof r||!(n in r)){j=0;break}r=r[n]}}}if(j){return r&&r.isScope&&(r=r.data),"function"===typeof r&&(r=r.call(this.data)),[r]}if(l){break}q=q.parent}return !1}};return b});KISSY.add("xtemplate/runtime/commands",["path","./scope"],function(d,b){var j,i=b("path"),c=b("./scope");return j={each:function(q,t){var s=t.params,r=s[0],p=s[2]||"xindex",s=s[1],o="",l,k,h;if(r){if(k=new c,d.isArray(r)){l=r.length;for(var g=0;g<l;g++){k.data=r[g],h=k.affix={xcount:l},h[p]=g,s&&(h[s]=r[g]),k.setParent(q),o+=t.fn(k)}}else{for(l in r){k.data=r[l],h=k.affix={},h[p]=l,s&&(h[s]=r[l]),k.setParent(q),o+=t.fn(k)}}}else{t.inverse&&(o=t.inverse(q))}return o},"with":function(g,f){var e=f.params[0],h="";e?(e=new c(e),e.setParent(g),h=f.fn(e)):f.inverse&&(h=f.inverse(g));return h},"if":function(g,f){var e="";f.params[0]?f.fn&&(e=f.fn(g)):f.inverse&&(e=f.inverse(g));return e},set:function(f,e){f.mix(e.hash);return""},include:function(g,f){var e=f.params;if(!e||1!==e.length){return"include must has one param",""}if(f.hash){var h=new c(f.hash);h.setParent(g);g=h}h=this.config.name;e=e[0];if("."===e.charAt(0)){if("unspecified"===h){return"parent template does not have name for relative sub tpl name: "+e,""}e=i.resolve(h,"../",e)}h=this.config.loader.call(this,e);f=d.merge(this.config);f.name=e;f.commands=this.config.commands;f.macros=this.config.macros;return this.invokeEngine(h,g,f)},macro:function(m,h){var g=h.params,n=g[0],l=g.slice(1),g=this.config.macros;if(h.fn){g[n]||(g[n]={paramNames:l,fn:h.fn})}else{var k={};(n=g[n])||"can not find macro:"+name;d.each(n.paramNames,function(e,f){k[e]=l[f]});g=new c(k);return n.fn.call(this,g)}return""},parse:function(f,e){return j.include.call(this,new c,e)}}});KISSY.add("xtemplate/runtime",["./runtime/commands","./runtime/scope"],function(r,m){function t(b){b}function s(h,f){for(var l=f.split("."),g=h,i=l.length,k=0;k<i&&!(g=g[l[k]],!g);k++){}return g}function q(f,B,A,C,z,y){var p,l=s(f.config.commands,C);if(l){try{p=l.call(f,B,A)}catch(k){k.message+': "'+C+'" at line '+z}return{find:!0,value:p}}y&&"can not find command: "+C+'" at line '+z;return{find:!1}}function u(h,e,g,l,k){var i,h=h.config.silent?t:r.error,e=e.resolve(g,l);!1===e?h('can not find property: "'+g+'" at line '+k,"warn"):i=e[0];return i}function x(c,b){this.tpl=c;b=r.merge(o,b);b.commands=r.merge(b.commands,w);b.utils=n;b.macros=b.macros||{};this.config=b}var w=m("./runtime/commands"),v=m("./runtime/scope"),j=r.escapeHtml,n={runBlockCommand:function(F,E,D,C,B){var A=F.config,y=A.silent?t:r.error,A=A.commands,g=s(A,C);if(!g){if(!D.params&&!D.hash){var z=E.resolve(C);!1===z?(y('can not find property: "'+C+'" at line '+B),z=""):z=z[0];g=A["if"];r.isArray(z)?g=A.each:"object"===typeof z&&(g=A["with"]);D.params=[z]}else{return"can not find command: "+C+'" at line '+B,""}}var e;try{e=g.call(F,E,D)}catch(f){f.message+': "'+C+'" at line '+B}return e},renderOutput:function(d,c){void 0===d&&(d="");return c&&d?j(d):d},getProperty:function(g,d,k,i,h){return u(g,d,k,i,h)},runInlineCommand:function(h,g,p,l,k){var i="",h=q(h,g,p,l,k);h.find&&(i=h.value);return i},getPropertyOrRunCommand:function(h,d,B,A,z,y){var p,l=B.hash||B.params,B=q(h,d,B,A,y,l);B.find?p=B.value:l||(p=u(h,d,A,z,y));return p}},o={silent:!0,name:"unspecified",loader:function(d){var c=r.require(d);c||'template "'+d+'" does not exist, need to be required or used first!';return c}};r.mix(x,{commands:w,utils:n,addCommand:function(b,d){w[b]=d},removeCommand:function(b){delete w[b]}});x.prototype={constructor:x,invokeEngine:function(e,d,f){return(new this.constructor(e,f)).render(d,!0)},removeCommand:function(b){delete this.config.commands[b]},addCommand:function(d,c){this.config.commands[d]=c},render:function(d){var c=d;if(!c||!c.isScope){c=new v(d)}return this.tpl(c,r)}};x.Scope=v;return x});KISSY.add("component/extension/shim",[],function(e){function d(){}var e=6===e.UA.ie,f='<iframe style="position: absolute;border: none;width: '+(e?"expression(this.parentNode.clientWidth)":"100%")+";top: 0;opacity: 0;filter: alpha(opacity=0);left: 0;z-index: -1;height: "+(e?"expression(this.parentNode.clientHeight)":"100%")+';"/>';d.ATTRS={shim:{value:e}};d.prototype.__createDom=function(){this.get("shim")&&this.get("el").prepend(f)};return d});KISSY.add("component/extension/align",["node"],function(i,C){function g(j){var l=j.ownerDocument.body,k=y(j).css("position");if(!("fixed"===k||"absolute"===k)){return"html"===j.nodeName.toLowerCase()?null:j.parentNode}for(j=j.parentNode;j&&j!==l;j=j.parentNode){if(k=y(j).css("position"),"static"!==k){return j}}return null}function f(k){var o,n,j={left:0,right:Infinity,top:0,bottom:Infinity},m;m=k.ownerDocument;n=y(m).getWindow();o=m.body;for(m=m.documentElement;k=g(k);){if((!B.ie||0!==k.clientWidth)&&k!==o&&k!==m&&"visible"!==y(k).css("overflow")){var l=y(k).offset();l.left+=k.clientLeft;l.top+=k.clientTop;j.top=Math.max(j.top,l.top);j.right=Math.min(j.right,l.left+k.clientWidth);j.bottom=Math.min(j.bottom,l.top+k.clientHeight);j.left=Math.max(j.left,l.left)}}m=n.scrollLeft();k=n.scrollTop();j.left=Math.max(j.left,m);j.top=Math.max(j.top,k);o=n.width();n=n.height();j.right=Math.min(j.right,m+o);j.bottom=Math.min(j.bottom,k+n);return 0<=j.top&&0<=j.left&&j.bottom>j.top&&j.right>j.left?j:null}function e(k,o,n,j){var m,l;m=k.left;l=k.top;o=d(o,n[0]);k=d(k,n[1]);k=[k.left-o.left,k.top-o.top];return{left:m-k[0]+ +j[0],top:l-k[1]+ +j[1]}}function c(k,m,l){var j=[];i.each(k,function(n){j.push(n.replace(m,function(o){return l[o]}))});return j}function h(){}function b(j){var l,k;l=j[0];i.isWindow(l)?(j=y(l).getWindow(),l={left:j.scrollLeft(),top:j.scrollTop()},k=j.width(),j=j.height()):(l=j.offset(),k=j.outerWidth(),j=j.outerHeight());l.width=k;l.height=j;return l}function d(k,q){var p=q.charAt(0),j=q.charAt(1),n=k.width,l=k.height,o,m;o=k.left;m=k.top;"c"===p?m+=l/2:"b"===p&&(m+=l);"c"===j?o+=n/2:"r"===j&&(o+=n);return{left:o,top:m}}function A(j){j.target===this&&j.newVal&&this._onSetAlign(this.get("align"))}function E(){this.get("visible")&&this._onSetAlign(this.get("align"))}var D=C("node"),z=i.Env.host,y=D.all,B=i.UA;h.__getOffsetParent=g;h.__getVisibleRectForElement=f;h.ATTRS={align:{value:{}}};h.prototype={__bindUI:function(){this.on("beforeVisibleChange",A,this);this.$el.getWindow().on("resize",E,this)},_onSetAlign:function(j){j&&j.points&&this.align(j.node,j.points,j.offset,j.overflow)},align:function(t,r,q,s){var t=D.one(t||z),q=q&&[].concat(q)||[0,0],s=s||{},o=this.$el,m=0,p=f(o[0]),n=b(o),k=b(t),t=e(n,k,r,q),l=i.merge(n,t);if(p&&(s.adjustX||s.adjustY)){if(t.left<p.left||t.left+n.width>p.right){m=1,r=c(r,/[lr]/ig,{l:"r",r:"l"}),q[0]=-q[0]}if(t.top<p.top||t.top+n.height>p.bottom){m=1,r=c(r,/[tb]/ig,{t:"b",b:"t"}),q[1]=-q[1]}m&&(t=e(n,k,r,q),i.mix(l,t));r=s.adjustX&&(t.left<p.left||t.left+n.width>p.right);s=s.adjustY&&(t.top<p.top||t.top+n.height>p.bottom);if(r||s){t=i.clone(t),l={width:n.width,height:n.height},r&&t.left<p.left&&(t.left=p.left),r&&t.left+l.width>p.right&&(t.left=Math.max(p.right-l.width,p.left)),s&&t.top<p.top&&(t.top=p.top),s&&t.top+l.height>p.bottom&&(t.top=Math.max(p.bottom-l.height,p.top)),l=i.mix(t,l)}}this.set({x:l.left,y:l.top},{force:1});l.width!==n.width&&this.set("width",o.width()+l.width-n.width);l.height!==n.height&&this.set("height",o.height()+l.height-n.height);return this},center:function(j){this.set("align",{node:j,points:["cc","cc"],offset:[0,0]});return this},__destructor:function(){this.$el&&this.$el.getWindow().detach("resize",E,this)}};return h});KISSY.add("component/extension/content-xtpl",[],function(){return function(h){var i;i=this.config.utils;var m=i.renderOutput,l=i.runInlineCommand,k=i.getPropertyOrRunCommand;i='<div id="ks-content-';var n=k(this,h,{},"id",0,1);i+=m(n,!0);i+='"\n           class="';var n={},j=[];j.push("content");n.params=j;l=l(this,h,n,"getBaseCssClasses",2);i+=m(l,!0);i+='">';h=k(this,h,{},"content",0,2);i+=m(h,!1);return i+"</div>"}});KISSY.add("component/extension/content-render",["component/extension/content-xtpl"],function(j,c){function i(e){var d=e.control,f=d.get("contentEl");e.$contentEl=d.$contentEl=f;e.contentEl=d.contentEl=f[0]}function k(){}var b=c("component/extension/content-xtpl");k.prototype={__beforeCreateDom:function(e,d){j.mix(d,{contentEl:"#ks-content-{id}"})},__createDom:function(){i(this)},__decorateDom:function(){i(this)},getChildrenContainerEl:function(){return this.control.get("contentEl")},_onSetContent:function(e){var d=this.control,f=d.$contentEl;f.html(e);d.get("allowTextSelection")||f.unselectable()}};j.mix(k,{ATTRS:{contentTpl:{value:b}},HTML_PARSER:{content:function(d){return d.one("."+this.getBaseCssClass("content")).html()},contentEl:function(d){return d.one("."+this.getBaseCssClass("content"))}}});return k});KISSY.add("dd/ddm",["node","base"],function(W,Z){function T(f){var d,c;if(f.touches&&1<f.touches.length){M._end()}else{if(d=this.__activeToDrag){d._move(f)}else{if(c=this.get("activeDrag")){c._move(f),this.__needDropCheck&&X(this,f,c)}}(d=d||c)&&d.get("preventDefaultOnMove")&&f.preventDefault()}}function X(l,r,q){var j=l.get("validDrops"),h=q.get("mode"),p=0,n=0,k=V(q.get("node")),g=L(k);W.each(j,function(c){if(!c.get("disabled")){var b;if(b=c.getNodeFromTarget(r,q.get("dragNode")[0],q.get("node")[0])){if("point"===h){S(V(b),q.mousePos)&&(b=L(V(b)),p?b<n&&(p=c,n=b):(p=c,n=b))}else{if("intersect"===h){b=L(J(k,V(b))),b>n&&(n=b,p=c)}else{if("strict"===h&&(b=L(J(k,V(b))),b===g)){return p=c,!1}}}}}});if((j=l.get("activeDrop"))&&j!==p){j._handleOut(r),q._handleOut(r)}l.setInternal("activeDrop",p);p&&(j!==p?p._handleEnter(r):p._handleOver(r))}function Y(f){var d=f.get("activeDrag").get("activeHandler"),c="auto";d&&(c=d.css("cursor"));"auto"===c&&(c=f.get("dragCursor"));f._shim.css({cursor:c,display:"block"});F&&E.call(f)}function R(c){var b=c.get("drops");c.setInternal("validDrops",[]);b.length&&W.each(b,function(d){d._active()})}function aa(c){var b=c.get("drops");c.setInternal("validDrops",[]);b.length&&W.each(b,function(d){d._deActive()})}function V(c){var b=c.offset();c.__ddCachedWidth||("no cache in dd!",c[0]);return{left:b.left,right:b.left+(c.__ddCachedWidth||c.outerWidth()),top:b.top,bottom:b.top+(c.__ddCachedHeight||c.outerHeight())}}function S(c,b){return c.left<=b.left&&c.right>=b.left&&c.top<=b.top&&c.bottom>=b.top}function L(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function J(g,f){var h=Math.max(g.top,f.top),j=Math.min(g.right,f.right),d=Math.min(g.bottom,f.bottom);return{left:Math.max(g.left,f.left),right:j,top:h,bottom:d}}function P(b){b&&(b.__ddCachedWidth=b.outerWidth(),b.__ddCachedHeight=b.outerHeight())}var I=Z("node"),H=Z("base"),ab=W.UA,U=I.all,Q=W.Env.host,O=Q.document,G=U(O),K=U(Q),F=6===ab.ie,I=I.Gesture,D=I.move,C=I.end,H=H.extend({__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(d){var c=this.get("drops"),d=W.indexOf(d,c);-1!==d&&c.splice(d,1)},_regToDrag:function(b){this.__activeToDrag=b;G.on(C,this._end,this);G.on(D,e,this);O.body.setCapture&&O.body.setCapture()},_start:function(){var b=this.__activeToDrag;b&&(this.setInternal("activeDrag",b),this.__activeToDrag=0,b.get("shim")&&N(this),this.__needDropCheck=0,b.get("groups")&&(R(this),this.get("validDrops").length&&(P(b.get("node")),this.__needDropCheck=1)))},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(d){var f=this.__activeToDrag,g=this.get("activeDrag"),b=this.get("activeDrop");d&&(f&&f._move(d),g&&g._move(d));G.detach(D,e,this);G.detach(C,this._end,this);O.body.releaseCapture&&O.body.releaseCapture();f&&(f._end(d),this.__activeToDrag=0);this._shim&&this._shim.hide();g&&(g._end(d),aa(this),b&&b._end(d),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}},{ATTRS:{dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}}}),e=ab.ie?W.throttle(T,30):T,N=function(b){b._shim=U('<div style="background-color:red;position:'+(F?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+M.get("dragCursor")+';z-index:999999;"></div>').prependTo(O.body||O.documentElement).css("opacity",0);N=Y;if(F){K.on("resize scroll",E,b)}Y(b)},E=W.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:G.width(),height:G.height()})},30),M=new H;M.inRegion=S;M.region=V;M.area=L;M.cacheWH=P;M.PREFIX_CLS="ks-dd-";return M});KISSY.add("dd/draggable",["node","./ddm","base"],function(w,z){function u(){return !1}var x=z("node"),y=z("./ddm"),o=z("base"),A=x.all,v=w.each,p=w.Features,i=w.UA.ie,e=y.PREFIX_CLS,m=w.Env.host.document,C,B=function(d){var c=d.target;this._checkDragStartValid(d)&&this._checkHandler(c)&&this._prepare(d)};return o.extend({initializer:function(){this.addTarget(y);this._allowMove=this.get("move")},_onSetNode:function(b){this.setInternal("dragNode",b);this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(x.Gesture.start,B,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(b){b=this;b.get("node").detach(x.Gesture.start,B,b).detach("dragstart",b._fixDragStart)},_bufferTimer:null,_onSetDisabledChange:function(b){this.get("dragNode")[b?"addClass":"removeClass"](e+"-disabled")},_fixDragStart:function(b){b.preventDefault()},_checkHandler:function(f){var d=this,h=d.get("handlers"),g=0;v(h,function(b){if(b[0]===f||b.contains(f)){return g=1,d.setInternal("activeHandler",b),!1}});return g},_checkDragStartValid:function(b){return this.get("primaryButtonOnly")&&1!==b.which||this.get("disabled")?0:1},_prepare:function(g){if(g){var d=this;i&&(C=m.body.onselectstart,m.body.onselectstart=u);d.get("halt")&&g.stopPropagation();p.isTouchEventSupported()||g.preventDefault();var l=g.pageX,j=g.pageY;d.setInternal("startMousePos",d.mousePos={left:l,top:j});if(d._allowMove){var k=d.get("node").offset();d.setInternal("startNodePos",k);d.setInternal("deltaPos",{left:l-k.left,top:j-k.top})}y._regToDrag(d);if(l=d.get("bufferTime")){d._bufferTimer=setTimeout(function(){d._start(g)},1000*l)}}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(g){var f=g.pageX,q=g.pageY;if(!this.get("dragging")){var j=this.get("startMousePos"),l=0,n=this.get("clickPixelThresh");if(Math.abs(f-j.left)>=n||Math.abs(q-j.top)>=n){this._start(g),l=1}if(!l){return}}this.mousePos={left:f,top:q};g={drag:this,left:f,top:q,pageX:f,pageY:q,domEvent:g};if(j=this._allowMove){l=this.get("deltaPos"),f-=l.left,q-=l.top,g.left=f,g.top=q,this.setInternal("actualPos",{left:f,top:q}),this.fire("dragalign",g)}q=1;!1===this.fire("drag",g)&&(q=0);q&&j&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){y._end()},_end:function(d){var d=d||{},c;this._clearBufferTimer();i&&(m.body.onselectstart=C);this.get("dragging")&&(this.get("node").removeClass(e+"drag-over"),(c=y.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:c}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this,pageX:d.pageX,pageY:d.pageY}))},_handleOut:function(){this.get("node").removeClass(e+"drag-over");this.fire("dragexit",{drag:this,drop:y.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(e+"drag-over");this.fire("dragenter",b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(b){this._clearBufferTimer();this.setInternal("dragging",1);this.setInternal("dragStartMousePos",{left:b.pageX,top:b.pageY});y._start();this.fire("dragstart",{drag:this,pageX:b.pageX,pageY:b.pageY})},destructor:function(){this.detachDragEvent();this.detach()}},{name:"Draggable",ATTRS:{node:{setter:function(b){if(!(b instanceof x)){return A(b)}}},clickPixelThresh:{valueFn:function(){return y.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return y.get("bufferTime")}},dragNode:{},shim:{value:!1},handlers:{value:[],getter:function(b){var d=this;b.length||(b[0]=d.get("node"));v(b,function(c,f){"function"===typeof c&&(c=c.call(d));"string"===typeof c&&(c=d.get("node").one(c));c.nodeType&&(c=A(c));b[f]=c});d.setInternal("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](e+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startMousePos:{},dragStartMousePos:{},startNodePos:{},deltaPos:{},actualPos:{},preventDefaultOnMove:{value:!0}},inheritedStatics:{DropMode:{POINT:"point",INTERSECT:"intersect",STRICT:"strict"}}})});KISSY.add("dd/draggable-delegate",["node","./ddm","./draggable"],function(n,q){var k=q("node"),o=q("./ddm"),p=q("./draggable"),i=o.PREFIX_CLS,e=k.all,m=function(l){var b,j;if(this._checkDragStartValid(l)){b=this.get("handlers");var g=e(l.target);(b=b.length?this._getHandler(g):g)&&(j=this._getNode(b));j&&(this.setInternal("activeHandler",b),this.setInternal("node",j),this.setInternal("dragNode",j),this._prepare(l))}};return p.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},_onSetDisabledChange:function(c){this.get("container")[c?"addClass":"removeClass"](i+"-disabled")},bindDragEvent:function(){this.get("container").on(k.Gesture.start,m,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(k.Gesture.start,m,this).detach("dragstart",this._fixDragStart)},_getHandler:function(f){for(var l=this.get("container"),g=this.get("handlers");f&&f[0]!==l[0];){for(var j=0;j<g.length;j++){if(f.test(g[j])){return f}}f=f.parent()}return null},_getNode:function(c){return c.closest(this.get("selector"),this.get("container"))}},{ATTRS:{container:{setter:function(b){return e(b)}},selector:{},handlers:{value:[],getter:0}}})});KISSY.add("dd/droppable",["node","./ddm","base"],function(h,m){var e=m("node"),i=m("./ddm"),k=m("base"),b=i.PREFIX_CLS;return k.extend({initializer:function(){this.addTarget(i);i._regDrop(this)},getNodeFromTarget:function(g,n,l){var g=this.get("node"),j=g[0];return j===n||j===l?null:g},_active:function(){var f=i.get("activeDrag"),n=this.get("node"),l=this.get("groups"),f=f.get("groups");a:if(!0===f){l=1}else{for(var j in l){if(f[j]){l=1;break a}}l=0}l?(i._addValidDrop(this),n&&(n.addClass(b+"drop-active-valid"),i.cacheWH(n))):n&&n.addClass(b+"drop-active-invalid")},_deActive:function(){var c=this.get("node");c&&c.removeClass(b+"drop-active-valid").removeClass(b+"drop-active-invalid")},__getCustomEvt:function(c){return h.mix({drag:i.get("activeDrag"),drop:this},c)},_handleOut:function(){var c=this.__getCustomEvt();this.get("node").removeClass(b+"drop-over");this.fire("dropexit",c)},_handleEnter:function(c){c=this.__getCustomEvt(c);c.drag._handleEnter(c);this.get("node").addClass(b+"drop-over");this.fire("dropenter",c)},_handleOver:function(c){c=this.__getCustomEvt(c);c.drag._handleOver(c);this.fire("dropover",c)},_end:function(){var c=this.__getCustomEvt();this.get("node").removeClass(b+"drop-over");this.fire("drophit",c)},destructor:function(){i._unRegDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(c){if(c){return e.one(c)}}},groups:{value:{}},disabled:{}}})});KISSY.add("dd/droppable-delegate",["node","./ddm","./droppable"],function(h,m){function e(){var d=this.get("container"),j=[],g=this.get("selector");d.all(g).each(function(c){k.cacheWH(c);j.push(c)});this.__allNodes=j}var i=m("node"),k=m("./ddm"),b=m("./droppable").extend({initializer:function(){k.on("dragstart",e,this)},getNodeFromTarget:function(d,r,p){var g={left:d.pageX,top:d.pageY},d=this.__allNodes,o=0,q=Number.MAX_VALUE;d&&h.each(d,function(c){var f=c[0];f===p||f===r||(f=k.region(c),k.inRegion(f,g)&&(f=k.area(f),f<q&&(q=f,o=c)))});o&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",o));return o},_handleOut:function(){this.callSuper();this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(l){var r=this.get("node"),q=b.superclass._handleOut,p=this.callSuper,o=b.superclass._handleEnter,n=this.get("lastNode");n[0]!==r[0]?(this.setInternal("node",n),q.apply(this,arguments),this.setInternal("node",r),o.call(this,l)):p.call(this,l)},_end:function(c){this.callSuper(c);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(c){return i.one(c)}}}});return b});KISSY.add("dd",["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable-delegate","dd/droppable"],function(k,o){var i=o("dd/ddm"),m=o("dd/draggable"),n=o("dd/draggable-delegate"),h=o("dd/droppable-delegate"),e=o("dd/droppable"),i={Draggable:m,DDM:i,Droppable:e,DroppableDelegate:h,DraggableDelegate:n};return KISSY.DD=i});KISSY.add("event",["event/dom","event/custom"],function(e,g){var f=g("event/dom"),h=g("event/custom"),f=e.Event=e.merge(f,{DomEvent:f,CustomEvent:h});f.global=h.global;e.EventTarget=f.Target=h.Target;return f});KISSY.add("xtemplate",["xtemplate/runtime","xtemplate/compiler"],function(n,m){function c(b,j){j=n.merge(e,j);if("string"===typeof b){var h=b,g=j,i;if(!g.cache||!(i=l[h])){i=f.compileToFn(h,g),g.cache&&(l[h]=i)}b=i}c.superclass.constructor.call(this,b,j)}var d=m("xtemplate/runtime"),f=m("xtemplate/compiler"),l=c.cache={},e={cache:!0};n.extend(c,d,{},{compiler:f,Scope:d.Scope,RunTime:d,addCommand:d.addCommand,removeCommand:d.removeCommand});return c});KISSY.add("xtemplate/compiler/parser",[],function(j,f){var k={},d=KISSY,i=function(b){this.rules=[];d.mix(this,b);this.resetInput(this.input)};i.prototype={constructor:function(b){this.rules=[];d.mix(this,b);this.resetInput(this.input)},resetInput:function(b){d.mix(this,{input:b,matched:"",stateStack:[i.STATIC.INITIAL],match:"",text:"",firstLine:1,lineNumber:1,lastLine:1,firstColumn:1,lastColumn:1})},genShortId:function(b){b+="__gen";b in this||(this[b]=-1);var b=this[b]+=1,c="";do{c=String.fromCharCode(97+b%26)+c,b=Math.floor(b/26)-1}while(0<=b);return c},getCurrentRules:function(){var b=this.stateStack[this.stateStack.length-1],c=[],b=this.mapState(b);d.each(this.rules,function(g){var e=g.state||g[3];e?d.inArray(b,e)&&c.push(g):b===i.STATIC.INITIAL&&c.push(g)});return c},pushState:function(b){this.stateStack.push(b)},popState:function(){return this.stateStack.pop()},getStateStack:function(){return this.stateStack},showDebugInfo:function(){var g=i.STATIC.DEBUG_CONTEXT_LIMIT,l=this.matched,m=this.match,e=this.input,l=l.slice(0,l.length-m.length),l=(l.length>g?"...":"")+l.slice(-g).replace(/\n/," "),m=m+e,m=m.slice(0,g)+(m.length>g?"...":"");return l+m+"\n"+Array(l.length+1).join("-")+"^"},mapSymbol:function(b){var e=this.symbolMap;return !e?b:e[b]||(e[b]=this.genShortId("symbol"))},mapReverseSymbol:function(l){var n=this.symbolMap,m,g=this.reverseSymbolMap;if(!g&&n){for(m in g=this.reverseSymbolMap={},n){g[n[m]]=m}}return g?g[l]:l},mapState:function(b){var e=this.stateMap;return !e?b:e[b]||(e[b]=this.genShortId("state"))},lex:function(){var q=this.input,o,l,b,p=this.getCurrentRules();this.match=this.text="";if(!q){return this.mapSymbol(i.STATIC.END_TAG)}for(o=0;o<p.length;o++){l=p[o];var e=l.token||l[0];b=l.action||l[2]||f;if(l=q.match(l.regexp||l[1])){if(o=l[0].match(/\n.*/g)){this.lineNumber+=o.length}d.mix(this,{firstLine:this.lastLine,lastLine:this.lineNumber+1,firstColumn:this.lastColumn,lastColumn:o?o[o.length-1].length-1:this.lastColumn+l[0].length});o=this.match=l[0];this.matches=l;this.text=o;this.matched+=o;b=b&&b.call(this);b=b===f?e:this.mapSymbol(b);this.input=q=q.slice(o.length);return b?b:this.lex()}}"lex error at line "+this.lineNumber+":\n"+this.showDebugInfo();return f}};i.STATIC={INITIAL:"I",DEBUG_CONTEXT_LIMIT:20,END_TAG:"$EOF"};var h=new i({rules:[[0,/^[\s\S]*?(?={{)/,function(){var g=this.text,l,e=0;if(l=g.match(/\\+$/)){e=l[0].length}e%2?(this.pushState("et"),g=g.slice(0,-1)):this.pushState("t");this.text=g=g.replace(/\\+$/g,function(b){return Array(b.length/2+1).join("\\")});return"CONTENT"}],["b",/^[\s\S]+/,0],["b",/^[\s\S]{2,}?(?:(?={{)|$)/,function(){this.popState()},["et"]],["c",/^{{(?:#|@|\^)/,0,["t"]],["d",/^{{\//,0,["t"]],["e",/^{{\s*else\s*}}/,function(){this.popState()},["t"]],[0,/^{{![\s\S]*?}}/,function(){this.popState()},["t"]],["b",/^{{%([\s\S]*?)%}}/,function(){this.text=this.matches[1]||"";this.popState()},["t"]],["f",/^{{{?/,0,["t"]],["g",/^\s+/,0,["t"]],["h",/^}}}?/,function(){this.popState()},["t"]],["i",/^\(/,0,["t"]],["j",/^\)/,0,["t"]],["k",/^\|\|/,0,["t"]],["l",/^&&/,0,["t"]],["m",/^===/,0,["t"]],["n",/^!==/,0,["t"]],["o",/^>=/,0,["t"]],["p",/^<=/,0,["t"]],["q",/^>/,0,["t"]],["r",/^</,0,["t"]],["s",/^\+/,0,["t"]],["t",/^-/,0,["t"]],["u",/^\*/,0,["t"]],["v",/^\//,0,["t"]],["w",/^%/,0,["t"]],["x",/^!/,0,["t"]],["y",/^"(\\[\s\S]|[^\\"])*"/,function(){this.text=this.text.slice(1,-1).replace(/\\"/g,'"')},["t"]],["y",/^'(\\[\s\S]|[^\\'])*'/,function(){this.text=this.text.slice(1,-1).replace(/\\'/g,"'")},["t"]],["z",/^true/,0,["t"]],["z",/^false/,0,["t"]],["aa",/^\d+(?:\.\d+)?(?:e-?\d+)?/i,0,["t"]],["ab",/^=/,0,["t"]],["ac",/^\.(?=})/,0,["t"]],["ac",/^\.\./,function(){this.pushState("ws")},["t"]],["ad",/^\//,function(){this.popState()},["ws"]],["ad",/^\./,0,["t"]],["ae",/^\[/,0,["t"]],["af",/^\]/,0,["t"]],["ac",/^[a-zA-Z0-9_$]+/,0,["t"]],["ag",/^./,0,["t"]]]});k.lexer=h;h.symbolMap={$EOF:"a",CONTENT:"b",OPEN_BLOCK:"c",OPEN_CLOSE_BLOCK:"d",INVERSE:"e",OPEN_TPL:"f",SPACE:"g",CLOSE:"h",LPAREN:"i",RPAREN:"j",OR:"k",AND:"l",LOGIC_EQUALS:"m",LOGIC_NOT_EQUALS:"n",GE:"o",LE:"p",GT:"q",LT:"r",PLUS:"s",MINUS:"t",MULTIPLY:"u",DIVIDE:"v",MODULUS:"w",NOT:"x",STRING:"y",BOOLEAN:"z",NUMBER:"aa",EQUALS:"ab",ID:"ac",SEP:"ad",REF_START:"ae",REF_END:"af",INVALID:"ag",$START:"ah",program:"ai",statements:"aj",statement:"ak",openBlock:"al",closeBlock:"am",tpl:"an",inBlockTpl:"ao",path:"ap",inTpl:"aq",Expression:"ar",params:"as",hash:"at",param:"au",ConditionalOrExpression:"av",ConditionalAndExpression:"aw",EqualityExpression:"ax",RelationalExpression:"ay",AdditiveExpression:"az",MultiplicativeExpression:"ba",UnaryExpression:"bb",PrimaryExpression:"bc",hashSegments:"bd",hashSegment:"be",pathSegments:"bf"};k.productions=[["ah",["ai"]],["ai",["aj","e","aj"],function(){return new this.yy.ProgramNode(this.lexer.lineNumber,this.$1,this.$3)}],["ai",["aj"],function(){return new this.yy.ProgramNode(this.lexer.lineNumber,this.$1)}],["aj",["ak"],function(){return[this.$1]}],["aj",["aj","ak"],function(){this.$1.push(this.$2)}],["ak",["al","ai","am"],function(){return new this.yy.BlockNode(this.lexer.lineNumber,this.$1,this.$2,this.$3)}],["ak",["an"]],["ak",["b"],function(){return new this.yy.ContentNode(this.lexer.lineNumber,this.$1)}],["ao",["ap"],function(){return new this.yy.TplNode(this.lexer.lineNumber,this.$1)}],["ao",["aq"]],["al",["c","ao","h"],function(){"^"===this.$1.charAt(this.$1.length-1)&&(this.$2.isInverted=1);return this.$2}],["am",["d","ap","h"],function(){return this.$2}],["an",["f","aq","h"],function(){3===this.$1.length&&(this.$2.escaped=!1);return this.$2}],["an",["f","ar","h"],function(){var b=new this.yy.TplExpressionNode(this.lexer.lineNumber,this.$2);3===this.$1.length&&(b.escaped=!1);return b}],["aq",["ap","g","as","g","at"],function(){return new this.yy.TplNode(this.lexer.lineNumber,this.$1,this.$3,this.$5)}],["aq",["ap","g","as"],function(){return new this.yy.TplNode(this.lexer.lineNumber,this.$1,this.$3)}],["aq",["ap","g","at"],function(){return new this.yy.TplNode(this.lexer.lineNumber,this.$1,null,this.$3)}],["as",["as","g","au"],function(){this.$1.push(this.$3)}],["as",["au"],function(){return[this.$1]}],["au",["ar"]],["ar",["av"]],["av",["aw"]],["av",["av","k","aw"],function(){return new this.yy.ConditionalOrExpression(this.$1,this.$3)}],["aw",["ax"]],["aw",["aw","l","ax"],function(){return new this.yy.ConditionalAndExpression(this.$1,this.$3)}],["ax",["ay"]],["ax",["ax","m","ay"],function(){return new this.yy.EqualityExpression(this.$1,"===",this.$3)}],["ax",["ax","n","ay"],function(){return new this.yy.EqualityExpression(this.$1,"!==",this.$3)}],["ay",["az"]],["ay",["ay","r","az"],function(){return new this.yy.RelationalExpression(this.$1,"<",this.$3)}],["ay",["ay","q","az"],function(){return new this.yy.RelationalExpression(this.$1,">",this.$3)}],["ay",["ay","p","az"],function(){return new this.yy.RelationalExpression(this.$1,"<=",this.$3)}],["ay",["ay","o","az"],function(){return new this.yy.RelationalExpression(this.$1,">=",this.$3)}],["az",["ba"]],["az",["az","s","ba"],function(){return new this.yy.AdditiveExpression(this.$1,"+",this.$3)}],["az",["az","t","ba"],function(){return new this.yy.AdditiveExpression(this.$1,"-",this.$3)}],["ba",["bb"]],["ba",["ba","u","bb"],function(){return new this.yy.MultiplicativeExpression(this.$1,"*",this.$3)}],["ba",["ba","v","bb"],function(){return new this.yy.MultiplicativeExpression(this.$1,"/",this.$3)}],["ba",["ba","w","bb"],function(){return new this.yy.MultiplicativeExpression(this.$1,"%",this.$3)}],["bb",["x","bb"],function(){return new this.yy.UnaryExpression(this.$1,this.$2)}],["bb",["t","bb"],function(){return new this.yy.UnaryExpression(this.$1,this.$2)}],["bb",["bc"]],["bc",["y"],function(){return new this.yy.StringNode(this.lexer.lineNumber,this.$1)}],["bc",["aa"],function(){return new this.yy.NumberNode(this.lexer.lineNumber,this.$1)}],["bc",["z"],function(){return new this.yy.BooleanNode(this.lexer.lineNumber,this.$1)}],["bc",["ap"]],["bc",["i","ar","j"],function(){return this.$2}],["at",["bd"],function(){return new this.yy.HashNode(this.lexer.lineNumber,this.$1)}],["bd",["bd","g","be"],function(){this.$1.push(this.$3)}],["bd",["be"],function(){return[this.$1]}],["be",["ac","ab","ar"],function(){return[this.$1,this.$3]}],["ap",["bf"],function(){return new this.yy.IdNode(this.lexer.lineNumber,this.$1)}],["bf",["bf","ad","ac"],function(){this.$1.push(this.$3)}],["bf",["bf","ae","ar","af"],function(){this.$1.push(this.$3)}],["bf",["bf","ad","aa"],function(){this.$1.push(this.$3)}],["bf",["ac"],function(){return[this.$1]}]];k.table={gotos:{"0":{ai:4,aj:5,ak:6,al:7,an:8},2:{ao:10,aq:11,ap:12,bf:13},3:{aq:20,ar:21,av:22,aw:23,ax:24,ay:25,az:26,ba:27,bb:28,bc:29,ap:30,bf:13},5:{ak:32,al:7,an:8},7:{ai:33,aj:5,ak:6,al:7,an:8},14:{ar:38,av:22,aw:23,ax:24,ay:25,az:26,ba:27,bb:28,bc:29,ap:39,bf:13},15:{bb:40,bc:29,ap:39,bf:13},16:{bb:41,bc:29,ap:39,bf:13},31:{aj:57,ak:6,al:7,an:8},33:{am:59},35:{as:61,au:62,ar:63,av:22,aw:23,ax:24,ay:25,az:26,ba:27,bb:28,bc:29,at:64,bd:65,be:66,ap:39,bf:13},37:{ar:69,av:22,aw:23,ax:24,ay:25,az:26,ba:27,bb:28,bc:29,ap:39,bf:13},44:{aw:71,ax:24,ay:25,az:26,ba:27,bb:28,bc:29,ap:39,bf:13},45:{ax:72,ay:25,az:26,ba:27,bb:28,bc:29,ap:39,bf:13},46:{ay:73,az:26,ba:27,bb:28,bc:29,ap:39,bf:13},47:{ay:74,az:26,ba:27,bb:28,bc:29,ap:39,bf:13},48:{az:75,ba:27,bb:28,bc:29,ap:39,bf:13},49:{az:76,ba:27,bb:28,bc:29,ap:39,bf:13},50:{az:77,ba:27,bb:28,bc:29,ap:39,bf:13},51:{az:78,ba:27,bb:28,bc:29,ap:39,bf:13},52:{ba:79,bb:28,bc:29,ap:39,bf:13},53:{ba:80,bb:28,bc:29,ap:39,bf:13},54:{bb:81,bc:29,ap:39,bf:13},55:{bb:82,bc:29,ap:39,bf:13},56:{bb:83,bc:29,ap:39,bf:13},57:{ak:32,al:7,an:8},58:{ap:84,bf:13},85:{ar:90,av:22,aw:23,ax:24,ay:25,az:26,ba:27,bb:28,bc:29,ap:39,bf:13},86:{au:91,ar:63,av:22,aw:23,ax:24,ay:25,az:26,ba:27,bb:28,bc:29,at:92,bd:65,be:66,ap:39,bf:13},87:{be:94}},action:{"0":{b:[1,f,1],c:[1,f,2],f:[1,f,3]},1:{a:[2,7],e:[2,7],c:[2,7],f:[2,7],b:[2,7],d:[2,7]},2:{ac:[1,f,9]},3:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},4:{a:[0]},5:{a:[2,2],d:[2,2],b:[1,f,1],c:[1,f,2],e:[1,f,31],f:[1,f,3]},6:{a:[2,3],e:[2,3],c:[2,3],f:[2,3],b:[2,3],d:[2,3]},7:{b:[1,f,1],c:[1,f,2],f:[1,f,3]},8:{a:[2,6],e:[2,6],c:[2,6],f:[2,6],b:[2,6],d:[2,6]},9:{h:[2,56],g:[2,56],ad:[2,56],ae:[2,56],k:[2,56],l:[2,56],m:[2,56],n:[2,56],o:[2,56],p:[2,56],q:[2,56],r:[2,56],s:[2,56],t:[2,56],u:[2,56],v:[2,56],w:[2,56],j:[2,56],af:[2,56]},10:{h:[1,f,34]},11:{h:[2,9]},12:{h:[2,8],g:[1,f,35]},13:{h:[2,52],g:[2,52],k:[2,52],l:[2,52],m:[2,52],n:[2,52],o:[2,52],p:[2,52],q:[2,52],r:[2,52],s:[2,52],t:[2,52],u:[2,52],v:[2,52],w:[2,52],j:[2,52],af:[2,52],ad:[1,f,36],ae:[1,f,37]},14:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},15:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},16:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},17:{h:[2,43],k:[2,43],l:[2,43],m:[2,43],n:[2,43],o:[2,43],p:[2,43],q:[2,43],r:[2,43],s:[2,43],t:[2,43],u:[2,43],v:[2,43],w:[2,43],j:[2,43],g:[2,43],af:[2,43]},18:{h:[2,45],k:[2,45],l:[2,45],m:[2,45],n:[2,45],o:[2,45],p:[2,45],q:[2,45],r:[2,45],s:[2,45],t:[2,45],u:[2,45],v:[2,45],w:[2,45],j:[2,45],g:[2,45],af:[2,45]},19:{h:[2,44],k:[2,44],l:[2,44],m:[2,44],n:[2,44],o:[2,44],p:[2,44],q:[2,44],r:[2,44],s:[2,44],t:[2,44],u:[2,44],v:[2,44],w:[2,44],j:[2,44],g:[2,44],af:[2,44]},20:{h:[1,f,42]},21:{h:[1,f,43]},22:{h:[2,20],j:[2,20],g:[2,20],af:[2,20],k:[1,f,44]},23:{h:[2,21],k:[2,21],j:[2,21],g:[2,21],af:[2,21],l:[1,f,45]},24:{h:[2,23],k:[2,23],l:[2,23],j:[2,23],g:[2,23],af:[2,23],m:[1,f,46],n:[1,f,47]},25:{h:[2,25],k:[2,25],l:[2,25],m:[2,25],n:[2,25],j:[2,25],g:[2,25],af:[2,25],o:[1,f,48],p:[1,f,49],q:[1,f,50],r:[1,f,51]},26:{h:[2,28],k:[2,28],l:[2,28],m:[2,28],n:[2,28],o:[2,28],p:[2,28],q:[2,28],r:[2,28],j:[2,28],g:[2,28],af:[2,28],s:[1,f,52],t:[1,f,53]},27:{h:[2,33],k:[2,33],l:[2,33],m:[2,33],n:[2,33],o:[2,33],p:[2,33],q:[2,33],r:[2,33],s:[2,33],t:[2,33],j:[2,33],g:[2,33],af:[2,33],u:[1,f,54],v:[1,f,55],w:[1,f,56]},28:{h:[2,36],k:[2,36],l:[2,36],m:[2,36],n:[2,36],o:[2,36],p:[2,36],q:[2,36],r:[2,36],s:[2,36],t:[2,36],u:[2,36],v:[2,36],w:[2,36],j:[2,36],g:[2,36],af:[2,36]},29:{h:[2,42],k:[2,42],l:[2,42],m:[2,42],n:[2,42],o:[2,42],p:[2,42],q:[2,42],r:[2,42],s:[2,42],t:[2,42],u:[2,42],v:[2,42],w:[2,42],j:[2,42],g:[2,42],af:[2,42]},30:{h:[2,46],k:[2,46],l:[2,46],m:[2,46],n:[2,46],o:[2,46],p:[2,46],q:[2,46],r:[2,46],s:[2,46],t:[2,46],u:[2,46],v:[2,46],w:[2,46],g:[1,f,35]},31:{b:[1,f,1],c:[1,f,2],f:[1,f,3]},32:{a:[2,4],e:[2,4],c:[2,4],f:[2,4],b:[2,4],d:[2,4]},33:{d:[1,f,58]},34:{c:[2,10],f:[2,10],b:[2,10]},35:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,60]},36:{aa:[1,f,67],ac:[1,f,68]},37:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},38:{j:[1,f,70]},39:{j:[2,46],k:[2,46],l:[2,46],m:[2,46],n:[2,46],o:[2,46],p:[2,46],q:[2,46],r:[2,46],s:[2,46],t:[2,46],u:[2,46],v:[2,46],w:[2,46],h:[2,46],g:[2,46],af:[2,46]},40:{h:[2,41],k:[2,41],l:[2,41],m:[2,41],n:[2,41],o:[2,41],p:[2,41],q:[2,41],r:[2,41],s:[2,41],t:[2,41],u:[2,41],v:[2,41],w:[2,41],j:[2,41],g:[2,41],af:[2,41]},41:{h:[2,40],k:[2,40],l:[2,40],m:[2,40],n:[2,40],o:[2,40],p:[2,40],q:[2,40],r:[2,40],s:[2,40],t:[2,40],u:[2,40],v:[2,40],w:[2,40],j:[2,40],g:[2,40],af:[2,40]},42:{a:[2,12],e:[2,12],c:[2,12],f:[2,12],b:[2,12],d:[2,12]},43:{a:[2,13],e:[2,13],c:[2,13],f:[2,13],b:[2,13],d:[2,13]},44:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},45:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},46:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},47:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},48:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},49:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},50:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},51:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},52:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},53:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},54:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},55:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},56:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},57:{a:[2,1],d:[2,1],b:[1,f,1],c:[1,f,2],f:[1,f,3]},58:{ac:[1,f,9]},59:{a:[2,5],e:[2,5],c:[2,5],f:[2,5],b:[2,5],d:[2,5]},60:{h:[2,56],g:[2,56],k:[2,56],l:[2,56],m:[2,56],n:[2,56],o:[2,56],p:[2,56],q:[2,56],r:[2,56],s:[2,56],t:[2,56],u:[2,56],v:[2,56],w:[2,56],ad:[2,56],ae:[2,56],ab:[1,f,85]},61:{h:[2,15],g:[1,f,86]},62:{h:[2,18],g:[2,18]},63:{h:[2,19],g:[2,19]},64:{h:[2,16]},65:{h:[2,48],g:[1,f,87]},66:{h:[2,50],g:[2,50]},67:{h:[2,55],g:[2,55],ad:[2,55],ae:[2,55],k:[2,55],l:[2,55],m:[2,55],n:[2,55],o:[2,55],p:[2,55],q:[2,55],r:[2,55],s:[2,55],t:[2,55],u:[2,55],v:[2,55],w:[2,55],j:[2,55],af:[2,55]},68:{h:[2,53],g:[2,53],ad:[2,53],ae:[2,53],k:[2,53],l:[2,53],m:[2,53],n:[2,53],o:[2,53],p:[2,53],q:[2,53],r:[2,53],s:[2,53],t:[2,53],u:[2,53],v:[2,53],w:[2,53],j:[2,53],af:[2,53]},69:{af:[1,f,88]},70:{h:[2,47],k:[2,47],l:[2,47],m:[2,47],n:[2,47],o:[2,47],p:[2,47],q:[2,47],r:[2,47],s:[2,47],t:[2,47],u:[2,47],v:[2,47],w:[2,47],j:[2,47],g:[2,47],af:[2,47]},71:{h:[2,22],k:[2,22],j:[2,22],g:[2,22],af:[2,22],l:[1,f,45]},72:{h:[2,24],k:[2,24],l:[2,24],j:[2,24],g:[2,24],af:[2,24],m:[1,f,46],n:[1,f,47]},73:{h:[2,26],k:[2,26],l:[2,26],m:[2,26],n:[2,26],j:[2,26],g:[2,26],af:[2,26],o:[1,f,48],p:[1,f,49],q:[1,f,50],r:[1,f,51]},74:{h:[2,27],k:[2,27],l:[2,27],m:[2,27],n:[2,27],j:[2,27],g:[2,27],af:[2,27],o:[1,f,48],p:[1,f,49],q:[1,f,50],r:[1,f,51]},75:{h:[2,32],k:[2,32],l:[2,32],m:[2,32],n:[2,32],o:[2,32],p:[2,32],q:[2,32],r:[2,32],j:[2,32],g:[2,32],af:[2,32],s:[1,f,52],t:[1,f,53]},76:{h:[2,31],k:[2,31],l:[2,31],m:[2,31],n:[2,31],o:[2,31],p:[2,31],q:[2,31],r:[2,31],j:[2,31],g:[2,31],af:[2,31],s:[1,f,52],t:[1,f,53]},77:{h:[2,30],k:[2,30],l:[2,30],m:[2,30],n:[2,30],o:[2,30],p:[2,30],q:[2,30],r:[2,30],j:[2,30],g:[2,30],af:[2,30],s:[1,f,52],t:[1,f,53]},78:{h:[2,29],k:[2,29],l:[2,29],m:[2,29],n:[2,29],o:[2,29],p:[2,29],q:[2,29],r:[2,29],j:[2,29],g:[2,29],af:[2,29],s:[1,f,52],t:[1,f,53]},79:{h:[2,34],k:[2,34],l:[2,34],m:[2,34],n:[2,34],o:[2,34],p:[2,34],q:[2,34],r:[2,34],s:[2,34],t:[2,34],j:[2,34],g:[2,34],af:[2,34],u:[1,f,54],v:[1,f,55],w:[1,f,56]},80:{h:[2,35],k:[2,35],l:[2,35],m:[2,35],n:[2,35],o:[2,35],p:[2,35],q:[2,35],r:[2,35],s:[2,35],t:[2,35],j:[2,35],g:[2,35],af:[2,35],u:[1,f,54],v:[1,f,55],w:[1,f,56]},81:{h:[2,37],k:[2,37],l:[2,37],m:[2,37],n:[2,37],o:[2,37],p:[2,37],q:[2,37],r:[2,37],s:[2,37],t:[2,37],u:[2,37],v:[2,37],w:[2,37],j:[2,37],g:[2,37],af:[2,37]},82:{h:[2,38],k:[2,38],l:[2,38],m:[2,38],n:[2,38],o:[2,38],p:[2,38],q:[2,38],r:[2,38],s:[2,38],t:[2,38],u:[2,38],v:[2,38],w:[2,38],j:[2,38],g:[2,38],af:[2,38]},83:{h:[2,39],k:[2,39],l:[2,39],m:[2,39],n:[2,39],o:[2,39],p:[2,39],q:[2,39],r:[2,39],s:[2,39],t:[2,39],u:[2,39],v:[2,39],w:[2,39],j:[2,39],g:[2,39],af:[2,39]},84:{h:[1,f,89]},85:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,9]},86:{i:[1,f,14],t:[1,f,15],x:[1,f,16],y:[1,f,17],z:[1,f,18],aa:[1,f,19],ac:[1,f,60]},87:{ac:[1,f,93]},88:{h:[2,54],g:[2,54],ad:[2,54],ae:[2,54],k:[2,54],l:[2,54],m:[2,54],n:[2,54],o:[2,54],p:[2,54],q:[2,54],r:[2,54],s:[2,54],t:[2,54],u:[2,54],v:[2,54],w:[2,54],j:[2,54],af:[2,54]},89:{a:[2,11],e:[2,11],c:[2,11],f:[2,11],b:[2,11],d:[2,11]},90:{h:[2,51],g:[2,51]},91:{h:[2,17],g:[2,17]},92:{h:[2,14]},93:{ab:[1,f,85]},94:{h:[2,49],g:[2,49]}}};k.parse=function(E){var F=this.lexer,C,B,w,z=this.table,v=z.gotos,z=z.action,G=this.productions,u=[null],x=[0];for(F.resetInput(E);;){C=x[x.length-1];B||(B=F.lex());if(!B){return"it is not a valid input: "+E,"error",!1}w=z[C]&&z[C][B];if(!w){E=[];if(z[C]){for(var y in z[C]){E.push(this.lexer.mapReverseSymbol(y))}}F="Syntax error at line "+F.lineNumber+":\n"+F.showDebugInfo()+"\nexpect "+E.join(", ");F;return !1}switch(w[0]){case 1:x.push(B);u.push(F.text);x.push(w[2]);B=null;break;case 2:var D=G[w[1]];C=D.symbol||D[0];w=D.action||D[2];var A=(D.rhs||D[1]).length,m=0,t,D=u[u.length-A];t=f;for(this.$$=D;m<A;m++){this["$"+(A-m)]=u[u.length-1-m]}w&&(t=w.call(this));D=t!==f?t:this.$$;A&&(x=x.slice(0,-2*A),u=u.slice(0,-1*A));x.push(C);u.push(D);x.push(v[x[x.length-2]][x[x.length-1]]);break;case 0:return D}}return f};return k});KISSY.add("xtemplate/compiler/ast",[],function(c){var b={ProgramNode:function(f,d,g){this.lineNumber=f;this.statements=d;this.inverse=g}};b.ProgramNode.prototype.type="program";b.BlockNode=function(f,d,i,h){h=h.parts;c.equals(d.path.parts,h)||(h="Syntax error at line "+f+":\nexpect {{/"+d.path.parts+"}} not {{/"+h+"}}",h);this.lineNumber=f;this.tpl=d;this.program=i};b.BlockNode.prototype.type="block";b.TplNode=function(f,d,i,h){this.lineNumber=f;this.path=d;this.params=i;this.hash=h;this.escaped=!0;this.isInverted=!1};b.TplNode.prototype.type="tpl";b.TplExpressionNode=function(e,d){this.lineNumber=e;this.expression=d;this.escaped=!0};b.TplExpressionNode.prototype.type="tplExpression";b.ContentNode=function(e,d){this.lineNumber=e;this.value=d};b.ContentNode.prototype.type="content";b.UnaryExpression=function(e,d){this.value=d;this.unaryType=e};b.UnaryExpression.prototype.type="unaryExpression";b.MultiplicativeExpression=function(f,d,g){this.op1=f;this.opType=d;this.op2=g};b.MultiplicativeExpression.prototype.type="multiplicativeExpression";b.AdditiveExpression=function(f,d,g){this.op1=f;this.opType=d;this.op2=g};b.AdditiveExpression.prototype.type="additiveExpression";b.RelationalExpression=function(f,d,g){this.op1=f;this.opType=d;this.op2=g};b.RelationalExpression.prototype.type="relationalExpression";b.EqualityExpression=function(f,d,g){this.op1=f;this.opType=d;this.op2=g};b.EqualityExpression.prototype.type="equalityExpression";b.ConditionalAndExpression=function(e,d){this.op1=e;this.op2=d};b.ConditionalAndExpression.prototype.type="conditionalAndExpression";b.ConditionalOrExpression=function(e,d){this.op1=e;this.op2=d};b.ConditionalOrExpression.prototype.type="conditionalOrExpression";b.StringNode=function(e,d){this.lineNumber=e;this.value=d};b.StringNode.prototype.type="string";b.NumberNode=function(e,d){this.lineNumber=e;this.value=d};b.NumberNode.prototype.type="number";b.BooleanNode=function(e,d){this.lineNumber=e;this.value=d};b.BooleanNode.prototype.type="boolean";b.HashNode=function(f,d){var g={};this.lineNumber=f;c.each(d,function(e){g[e[0]]=e[1]});this.value=g};b.HashNode.prototype.type="hash";b.IdNode=function(f,d){var i=[],h=0;this.lineNumber=f;c.each(d,function(e){".."===e?h++:i.push(e)});this.parts=i;this.string=i.join(".");this.depth=h};b.IdNode.prototype.type="id";return b});KISSY.add("xtemplate/compiler",["xtemplate/runtime","./compiler/parser","./compiler/ast"],function(h,z){function x(b,c){b=c?y(b,!1):b.replace(/\\/g,"\\\\").replace(/'/g,"\\'");return b=b.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")}function y(b,c){return b.replace(c?B:k,function(e){e.length%2&&(e="\\"+e);return e})}function w(b,c){j.apply(b,c)}function q(b){return b[b.length-1]}var C=z("xtemplate/runtime"),r=z("./compiler/parser");r.yy=z("./compiler/ast");var B=/\\*"/g,k=/\\*'/g,j=[].push,l=0,A=0,D={genFunction:function(f,g){var m=[];g||m.push("function(scope) {");m.push('var buffer = ""'+(g?",":";"));if(g){m.push("config = this.config,engine = this,moduleWrap, utils = config.utils;");m.push('if (typeof module !== "undefined" && module.kissy) {moduleWrap = module;}');var i="",e,n=C.utils;for(e in n){i+=e+"Util = utils."+e+","}i&&m.push("var "+i.slice(0,i.length-1)+";")}if(f){i=0;for(e=f.length;i<e;i++){w(m,this[f[i].type](f[i]))}}m.push("return buffer;");return !g?(m.push("}"),m):{params:["scope","S","undefined"],source:m}},genIdOrInlineCommand:function(i,m){var s=[],n=i.depth,e,t=i.parts,o="id"+l++;if(0===n){var p=m&&this.genConfig(m);p&&(e=p[0],w(s,p[1]))}t=this.getIdStringFromIdParts(s,t);n||h.startsWith(t,"this.")?s.push("var "+o+' = getPropertyUtil(engine,scope,"'+t+'",'+n+","+i.lineNumber+");"):e?("include"===t&&s.push('if(moduleWrap) {require("'+m.params[0].value+'");'+e+".params[0] = moduleWrap.resolveByName("+e+".params[0]);}"),s.push("var "+o+" = runInlineCommandUtil(engine,scope,"+e+',"'+t+'",'+i.lineNumber+");")):s.push("var "+o+" = getPropertyOrRunCommandUtil(engine,scope,"+(e||"{}")+',"'+t+'",'+n+","+i.lineNumber+");");return[o,s]},genOpExpression:function(g,m){var o=[],e,p,n=this[g.op1.type](g.op1),i=this[g.op2.type](g.op2);e=n[0];p=i[0];if(e&&p){return w(o,n[1]),w(o,i[1]),o.push(e+m+p),["",o]}if(!e&&!p){return w(o,n[1].slice(0,-1)),w(o,i[1].slice(0,-1)),o.push("("+q(n[1])+")"+m+"("+q(i[1])+")"),["",o]}if(e&&!p){return w(o,n[1]),w(o,i[1].slice(0,-1)),o.push(e+m+"("+q(i[1])+")"),["",o]}if(!e&&p){return w(o,n[1].slice(0,-1)),w(o,i[1]),o.push("("+q(n[1])+")"+m+p),["",o]}},genConfig:function(g){var e=[],o,p,n=this;if(g){p=g.params;g=g.hash;if(p||g){o="config"+l++,e.push("var "+o+" = {};")}if(p){var m="params"+l++;e.push("var "+m+" = [];");h.each(p,function(b){b=n[b.type](b);b[0]?(w(e,b[1]),e.push(m+".push("+b[0]+");")):(w(e,b[1].slice(0,-1)),e.push(m+".push("+q(b[1])+");"))});e.push(o+".params="+m+";")}if(g){var i="hash"+l++;e.push("var "+i+" = {};");h.each(g.value,function(c,b){var f=n[c.type](c);f[0]?(w(e,f[1]),e.push(i+'["'+b+'"] = '+f[0]+";")):(w(e,f[1].slice(0,-1)),e.push(i+'["'+b+'"] = '+q(f[1])+";"))});e.push(o+".hash="+i+";")}}return[o,e]},conditionalOrExpression:function(b){return this.genOpExpression(b,"||")},conditionalAndExpression:function(b){return this.genOpExpression(b,"&&")},relationalExpression:function(b){return this.genOpExpression(b,b.opType)},equalityExpression:function(b){return this.genOpExpression(b,b.opType)},additiveExpression:function(b){return this.genOpExpression(b,b.opType)},multiplicativeExpression:function(b){return this.genOpExpression(b,b.opType)},unaryExpression:function(f){var e=[],g,i=f.unaryType,f=this[f.value.type](f.value);j.apply(e,f[1]);(g=f[0])?e.push(g+"="+i+g+";"):e[e.length-1]=""+i+q(e);return[g,e]},string:function(b){return["",["'"+x(b.value,!0)+"'"]]},number:function(b){return["",[b.value]]},"boolean":function(b){return["",[b.value]]},id:function(g){var f=[],m=g.depth,n=g.parts,i="id"+l++,n=this.getIdStringFromIdParts(f,n);f.push("var "+i+' = getPropertyUtil(engine,scope,"'+n+'",'+m+","+g.lineNumber+");");return[i,f]},block:function(i){var e=i.program,p=[],s=i.tpl,o=this.genConfig(s),i=o[0],n=s.path,m=n.string;w(p,o[1]);i||(i=h.guid("config"),p.push("var "+i+" = {};"));p.push(i+".fn="+this.genFunction(e.statements).join("\n")+";");e.inverse&&(e=this.genFunction(e.inverse).join("\n"),p.push(i+".inverse="+e+";"));s.isInverted&&(e="inverse"+l++,p.push("var "+e+"="+i+".fn;"),p.push(i+".fn = "+i+".inverse;"),p.push(i+".inverse = "+e+";"));if(!s.hash&&!s.params){s=n.parts;for(e=0;e<s.length;e++){if("string"!==typeof s[e]){m=this.getIdStringFromIdParts(p,s);break}}}p.push("buffer += runBlockCommandUtil(engine, scope, "+i+', "'+m+'", '+n.lineNumber+");");return p},content:function(b){return["buffer += '"+x(b.value,!1)+"';"]},tpl:function(e){var c=[],f=this.genIdOrInlineCommand(e.path,e);w(c,f[1]);c.push("buffer += renderOutputUtil("+f[0]+","+e.escaped+");");return c},tplExpression:function(f){var e=[],g=f.escaped,i;i=f.expression;f=f.expression.type;i="id"===f?this.genIdOrInlineCommand(i):this[f](i);i[0]?(w(e,i[1]),i=i[0]):(w(e,i[1].slice(0,-1)),i=q(i[1]));e.push("buffer += renderOutputUtil("+i+","+g+");");return e},getIdStringFromIdParts:function(m,e){var t="",p,s,o,n=!0;for(p=0;p<e.length;p++){s=e[p],o=s.type,n||(t+="."),o?(s=this[o](s),s[0]&&(w(m,s[1]),t+='"+'+s[0]+'+"',n=!0)):(t+=s,n=!1)}return t}},d;return d={parse:function(b){return r.parse(b)},compileToStr:function(b){b=this.compile(b);return"function("+b.params.join(",")+"){\n"+b.source.join("\n")+"}"},compile:function(b){b=this.parse(b);l=0;return D.genFunction(b.statements,!0)},compileToFn:function(g,f){var m=d.compile(g),f=f||{},i="sourceURL="+(f.name?f.name:"xtemplate"+A++)+".js";return Function.apply(null,[].concat(m.params).concat(m.source.join("\n")+"\n//@ "+i+"\n//# "+i))}}});
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});KISSY.add("event/dom/touch/single-touch",[],function(e){function a(){}a.prototype={constructor:a,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!==this.requiredTouchCount)return!1;a=this.lastTouches=a.touches;this.lastXY={pageX:a[0].pageX,pageY:a[0].pageY}},onTouchMove:e.noop,onTouchEnd:e.noop};return a});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(d){d.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./single-touch"),k=i.Object;e.extend(h,f,{onTouchMove:function(d){var a=this.lastXY,d=d.changedTouches[0];if(!d||5<Math.abs(d.pageX-a.pageX)||5<Math.abs(d.pageY-a.pageY))return!1},onTouchEnd:function(d){var a=d.changedTouches[0],b=d.target,n=new k({type:"tap",
target:b,currentTarget:b});e.mix(n,{pageX:a.pageX,pageY:a.pageY,originalEvent:d.originalEvent,which:1,touch:a});i.fire(b,"tap",n);if(n.isDefaultPrevented())i.on(b,"click",{fn:c,once:1})}});g.tap={handle:new h};return h});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(b,a,f){var g=a.changedTouches[0],q=g.pageX-b.startX,m=g.pageY-b.startY,j=Math.abs(q),r=Math.abs(m);if(f){if(b.isVertical&&b.isHorizontal){if(5>Math.max(j,r))return;r>j?b.isHorizontal=0:b.isVertical=0}}else if(b.isVertical&&r<l&&(b.isVertical=0),b.isHorizontal&&j<l)b.isHorizontal=0;if(b.isHorizontal)q=0>q?"left":"right";else if(b.isVertical)q=0>m?"up":"down",j=r;else return!1;i.fire(a.target,
f?d:k,{originalEvent:a.originalEvent,pageX:g.pageX,pageY:g.pageY,which:1,touch:g,direction:q,distance:j,duration:(a.timeStamp-b.startTime)/1E3})}function h(){}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./single-touch"),k="swipe",d="swiping",l=50;e.extend(h,f,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var a=b.touches[0];this.startTime=b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=a.pageX;this.startY=a.pageY;-1!==b.type.indexOf("mouse")&&
b.preventDefault()},onTouchMove:function(b){var a=b.changedTouches[0],d=a.pageY-this.startY,a=Math.abs(a.pageX-this.startX),d=Math.abs(d);if(1E3<b.timeStamp-this.startTime)return!1;this.isVertical&&35<a&&(this.isVertical=0);this.isHorizontal&&35<d&&(this.isHorizontal=0);return c(this,b,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:c(this,a,0)}});g[k]=g[d]={handle:new h};return h});
KISSY.add("event/dom/touch/double-tap",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(){}var h=a("./handle-map"),g=a("event/dom/base"),i=a("./single-touch");e.extend(c,i,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var i=this.lastEndTime,d=a.timeStamp,e=a.target,
b=a.changedTouches[0],c=d-this.startTime;this.lastEndTime=d;if(i&&(c=d-i,300>c)){this.lastEndTime=0;g.fire(e,"doubleTap",{touch:b,duration:c/1E3});return}c=d-this.startTime;300<c?g.fire(e,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3}):this.singleTapTimer=setTimeout(function(){g.fire(e,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3})},300)}});h.singleTap=h.doubleTap={handle:new c};return c});
KISSY.add("event/dom/touch/multi-touch",["dom"],function(e,a){function c(){}var h=a("dom");c.prototype={constructor:c,requiredTouchCount:2,onTouchStart:function(a){var i=this.requiredTouchCount,c=a.touches.length;c===i?this.start():c>i&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:e.noop,getCommonTarget:function(a){var c=a.touches,a=c[0].target,c=c[1].target;if(a===c||h.contains(a,c))return a;for(;;){if(h.contains(c,
a))return c;c=c.parentNode}"getCommonTarget error!"},end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return c});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./multi-touch"],function(e,a){function c(){}function h(a){2===a.touches.length&&a.preventDefault()}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./multi-touch");e.extend(c,f,{onTouchMove:function(a){if(this.isTracking){var d=a.touches;if(0<d[0].pageX&&0<d[0].pageY&&0<d[1].pageX&&0<d[1].pageY){var c,b=d[0],f=d[1];c=b.pageX-f.pageX;b=b.pageY-f.pageY;c=Math.sqrt(c*c+b*b);this.lastTouches=d;this.isStarted?i.fire(this.target,"pinch",
e.mix(a,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,d=this.target=this.getCommonTarget(a),i.fire(d,"pinchStart",e.mix(a,{distance:c,scale:1})))}}},fireEnd:function(a){i.fire(this.target,"pinchEnd",e.mix(a,{touches:this.lastTouches}))}});f=new c;g.pinchStart=g.pinchEnd={handle:f};g.pinch={handle:f,setup:function(){i.on(this,"touchmove",h)},tearDown:function(){i.detach(this,"touchmove",h)}};return c});
KISSY.add("event/dom/touch/tap-hold",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(){}var h=a("./handle-map"),g=a("event/dom/base"),i=a("./single-touch");e.extend(c,i,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){var c=a.touches[0];g.fire(a.target,"tapHold",{touch:c,pageX:c.pageX,pageY:c.pageY,which:1,duration:(e.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},
onTouchEnd:function(){clearTimeout(this.timer)}});h.tapHold={handle:new c};return c});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./multi-touch"],function(e,a){function c(){}function h(a){2===a.touches.length&&a.preventDefault()}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./multi-touch"),k=180/Math.PI;e.extend(c,f,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,b=c[0],f=c[1],g=this.lastAngle,b=Math.atan2(f.pageY-b.pageY,f.pageX-b.pageX)*k;if(void 0!==g){var f=Math.abs(b-g),h=(b+360)%360,q=(b-360)%360;Math.abs(h-g)<f?b=h:Math.abs(q-g)<f&&
(b=q)}this.lastTouches=c;this.lastAngle=b;this.isStarted?i.fire(this.target,"rotate",e.mix(a,{angle:b,rotation:b-this.startAngle})):(this.isStarted=!0,this.startAngle=b,this.target=this.getCommonTarget(a),i.fire(this.target,"rotateStart",e.mix(a,{angle:b,rotation:0})))}},end:function(){this.lastAngle=void 0;c.superclass.end.apply(this,arguments)},fireEnd:function(a){i.fire(this.target,"rotateEnd",e.mix(a,{touches:this.lastTouches}))}});f=new c;g.rotateEnd=g.rotateStart={handle:f};g.rotate={handle:f,
setup:function(){i.on(this,"touchmove",h)},tearDown:function(){i.detach(this,"touchmove",h)}};return c});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(","),function(e,a){function c(a){return e.startsWith(a,"touch")}function h(a){return e.startsWith(a,"mouse")}function g(a){return e.startsWith(a,"MSPointer")||e.startsWith(a,"pointer")}function i(a){this.doc=a;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var f=a("dom"),k=a("./handle-map"),d=a("event/dom/base");a("./tap");a("./swipe");a("./double-tap");
a("./pinch");a("./tap-hold");a("./rotate");var l=e.guid("touch-handle"),b=e.Features,n,p,o;if(b.isTouchEventSupported())if(e.UA.ios){o="touchend touchcancel";n="touchstart";p="touchmove"}else{o="touchend touchcancel mouseup";n="touchstart mousedown";p="touchmove mousemove"}else if(b.isPointerSupported()){n="pointerdown";p="pointermove";o="pointerup pointercancel"}else if(b.isMsPointerSupported()){n="MSPointerDown";p="MSPointerMove";o="MSPointerUp MSPointerCancel"}else{n="mousedown";p="mousemove";
o="mouseup"}i.prototype={constructor:i,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;d.on(a,n,this.onTouchStart,this);if(!g(p))d.on(a,p,this.onTouchMove,this);d.on(a,o,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var m=0,c=a.pointerId,b=this.touches,d=b.length;m<d;m++){a=b[m];if(a.pointerId===c){b.splice(m,1);break}}},updateTouch:function(a){for(var c=0,j,b=a.pointerId,d=this.touches,e=d.length;c<e;c++){j=d[c];
j.pointerId===b&&(d[c]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var c=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var b={x:a.clientX,y:a.clientY};c.push(b);setTimeout(function(){var a=c.indexOf(b);a>-1&&c.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var c=
this.lastTouches,b=a.clientX,a=a.clientY,d=0,e=c.length,f;d<e&&(f=c[d]);d++){var g=Math.abs(b-f.x),h=Math.abs(a-f.y);if(g<=25&&h<=25)return true}return 0},normalize:function(a){var b=a.type,j;if(c(b)){j=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;if(j.length===1){a.which=1;a.pageX=j[0].pageX;a.pageY=j[0].pageY}return a}j=this.touches;b=!b.match(/(up|cancel)$/i);a.touches=b?j:[];a.targetTouches=b?j:[];a.changedTouches=j;return a},onTouchStart:function(a){var b,j;j=a.type;var e=this.eventHandle;
if(c(j)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(h(j)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(g(j)){this.addTouch(a.originalEvent);if(this.touches.length===1)d.on(this.doc,p,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(b in e){j=e[b].handle;j.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(h(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=
[a.originalEvent]}else if(g(b))this.updateTouch(a.originalEvent);else if(!c(b))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=this,j=a.type;if(!h(j)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(c(j)){b.dupMouse(a);e.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(h(j))b.touches=[];else if(g(j)){b.removeTouch(a.originalEvent);b.touches.length||d.detach(b.doc,p,b.onTouchMove,
b)}}},callEventHandle:function(a,b){var c=this.eventHandle,d,e,b=this.normalize(b);if(b.changedTouches.length){for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=k[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;
d.detach(a,n,this.onTouchStart,this);d.detach(a,p,this.onTouchMove,this);d.detach(a,o,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,b){var c=f.getDocument(a),d=f.data(c,l);d||f.data(c,l,d=new i(c));b&&d.addEventHandle(b)},removeDocumentHandle:function(a,b){var c=f.getDocument(a),d=f.data(c,l);if(d){b&&d.removeEventHandle(b);if(e.isEmptyObject(d.eventHandle)){d.destroy();f.removeData(c,l)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(e,a){function c(a){d.addDocumentHandle(this,a);k[a].setup.apply(this,arguments)}function h(a){d.removeDocumentHandle(this,a);k[a].tearDown.apply(this,arguments)}function g(a){d.addDocumentHandle(this,a)}function i(a){d.removeDocumentHandle(this,a)}var f=a("event/dom/base"),k=a("./touch/handle-map"),d=a("./touch/handle"),l=f.Gesture,b=l.start="KSPointerDown",n=l.move="KSPointerMove",p=l.end="KSPointerUp";
l.tap="tap";l.doubleTap="doubleTap";k[b]={handle:{isActive:1,onTouchStart:function(a){f.fire(a.target,b,a)}}};k[n]={handle:{isActive:1,onTouchMove:function(a){f.fire(a.target,n,a)}}};k[p]={handle:{isActive:1,onTouchEnd:function(a){f.fire(a.target,p,a)}}};var l=f.Special,o,q,m;for(q in k)o={},m=k[q],o.setup=m.setup?c:g,o.tearDown=m.tearDown?h:i,m.add&&(o.add=m.add),m.remove&&(o.remove=m.remove),l[q]=o});
KISSY.add("cookie",[],function(b){function f(c){return"string"===typeof c&&""!==c}var h=b.Env.host.document,j=encodeURIComponent,g=b.urlDecode;b.Cookie={get:function(c){var a,d;if(f(c)&&(d=(""+h.cookie).match(RegExp("(?:^| )"+c+"(?:(?:=([^;]*))|;|$)"))))a=d[1]?g(d[1]):"";return a},set:function(c,a,d,b,i,g){var a=""+j(a),e=d;"number"===typeof e&&(e=new Date,e.setTime(e.getTime()+864E5*d));e instanceof Date&&(a+="; expires="+e.toUTCString());f(b)&&(a+="; domain="+b);f(i)&&(a+="; path="+i);g&&(a+="; secure");
h.cookie=c+"="+a},remove:function(c,a,d,b){this.set(c,"",-1,a,d,b)}};return b.Cookie});
KISSY.add("json/quote",[],function(o){var h={"":"\\b","":"\\f","\n":"\\n","\r":"\\r","\t":"\\t",'"':'\\"'},j={},k=/["\b\f\n\r\t\x00-\x1f]/g,m=/\\b|\\f|\\n|\\r|\\t|\\"|\\u[0-9a-zA-Z]{4}/g;o.each(h,function(f,b){j[b]=f});j["\\/"]="/";return{quote:function(f){return'"'+f.replace(k,function(b){var a;if(!(a=h[b]))a="\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4);return a})+'"'},unQuote:function(f){return f.slice(1,f.length-1).replace(m,function(b){var a;if(!(a=j[b]))a=String.fromCharCode(parseInt(b.slice(2),
16));return a})}}});
KISSY.add("json/stringify",["./quote"],function(o,h){function j(f){return 10>f?"0"+f:f}function k(f,b,a,c,e,s,g){var d=b[f];if(d&&"object"===typeof d)if("function"===typeof d.toJSON)d=d.toJSON(f);else if(d instanceof Date)d=isFinite(d.valueOf())?d.getUTCFullYear()+"-"+j(d.getUTCMonth()+1)+"-"+j(d.getUTCDate())+"T"+j(d.getUTCHours())+":"+j(d.getUTCMinutes())+":"+j(d.getUTCSeconds())+"Z":null;else if(d instanceof String||d instanceof Number||d instanceof Boolean)d=d.valueOf();void 0!==a&&(d=a.call(b,
f,d));switch(typeof d){case "number":return isFinite(d)?""+d:"null";case "string":return m.quote(d);case "boolean":return""+d;case "object":if(d)if(o.isArray(d)){for(var f=d,b=g,g=g+e,d=[],h=f.length,p=0;p<h;){var l=k(""+p,f,a,c,e,s,g);d[d.length]=void 0===l?"null":l;++p}d.length?e?(a=d.join("\n,"+g),a="[\n"+g+a+"\n"+b+"]"):a="["+d.join(",")+"]":a="[]"}else{for(var f=d,b=g,g=g+e,i,d=void 0!==c?c:o.keys(f),l=[],p=0,h=d.length;p<h;p++){i=d[p];var t=k(i,f,a,c,e,s,g);void 0!==t&&(i=m.quote(i),i+=":",
e&&(i+=" "),i+=t,l[l.length]=i)}l.length?e?(a=l.join(",\n"+g),a="{\n"+g+a+"\n"+b+"}"):a="{"+l.join(",")+"}":a="{}"}else a="null";return a}}var m=h("./quote");return function(f,b,a){var c="",e,h;b&&("function"===typeof b?h=b:o.isArray(b)&&(e=b));"number"===typeof a?(a=Math.min(10,a),c=Array(a+1).join(" ")):"string"===typeof a&&(c=a.slice(0,10));return k("",{"":f},h,e,c,[],"")}});
KISSY.add("json/parser",[],function(o,h){var j={},k=KISSY,m=function(b){this.rules=[];k.mix(this,b);this.resetInput(this.input)};m.prototype={constructor:function(b){this.rules=[];k.mix(this,b);this.resetInput(this.input)},resetInput:function(b){k.mix(this,{input:b,matched:"",stateStack:[m.STATIC.INITIAL],match:"",text:"",firstLine:1,lineNumber:1,lastLine:1,firstColumn:1,lastColumn:1})},getCurrentRules:function(){var b=this.stateStack[this.stateStack.length-1],a=[],b=this.mapState(b);k.each(this.rules,
function(c){var e=c.state||c[3];e?k.inArray(b,e)&&a.push(c):b==m.STATIC.INITIAL&&a.push(c)});return a},pushState:function(b){this.stateStack.push(b)},popState:function(){return this.stateStack.pop()},getStateStack:function(){return this.stateStack},showDebugInfo:function(){var b=m.STATIC.DEBUG_CONTEXT_LIMIT,a=this.matched,c=this.match,e=this.input,a=a.slice(0,a.length-c.length),a=(a.length>b?"...":"")+a.slice(-b).replace(/\n/," "),c=c+e,c=c.slice(0,b)+(c.length>b?"...":"");return a+c+"\n"+Array(a.length+
1).join("-")+"^"},mapSymbol:function(b){var a=this.symbolMap;return!a?b:a[b]||(a[b]=++this.symbolId)},mapReverseSymbol:function(b){var a=this.symbolMap,c,e=this.reverseSymbolMap;if(!e&&a)for(c in e=this.reverseSymbolMap={},a)e[a[c]]=c;return e?e[b]:b},mapState:function(b){var a=this.stateMap;return!a?b:a[b]||(a[b]=++this.stateId)},lex:function(){var b=this.input,a,c,e,f=this.getCurrentRules();this.match=this.text="";if(!b)return this.mapSymbol(m.STATIC.END_TAG);for(a=0;a<f.length;a++){c=f[a];var g=
c.token||c[0];e=c.action||c[2]||h;if(c=b.match(c.regexp||c[1])){if(a=c[0].match(/\n.*/g))this.lineNumber+=a.length;k.mix(this,{firstLine:this.lastLine,lastLine:this.lineNumber+1,firstColumn:this.lastColumn,lastColumn:a?a[a.length-1].length-1:this.lastColumn+c[0].length});a=this.match=c[0];this.matches=c;this.text=a;this.matched+=a;e=e&&e.call(this);e=e===h?g:this.mapSymbol(e);this.input=b=b.slice(a.length);return e?e:this.lex()}}"lex error at line "+this.lineNumber+":\n"+this.showDebugInfo();return h}};
m.STATIC={INITIAL:"I",DEBUG_CONTEXT_LIMIT:20,END_TAG:"$EOF"};var f=new m({rules:[[2,/^"(\\"|\\\\|\\\/|\\b|\\f|\\n|\\r|\\t|\\u[0-9a-zA-Z]{4}|[^\\"\x00-\x1f])*"/,0],[0,/^[\t\r\n\x20]/,0],[3,/^,/,0],[4,/^:/,0],[5,/^\[/,0],[6,/^\]/,0],[7,/^\{/,0],[8,/^\}/,0],[9,/^-?\d+(?:\.\d+)?(?:e-?\d+)?/i,0],[10,/^true|false/,0],[11,/^null/,0],[12,/^./,0]]});j.lexer=f;f.symbolMap={$EOF:1,STRING:2,COMMA:3,COLON:4,LEFT_BRACKET:5,RIGHT_BRACKET:6,LEFT_BRACE:7,RIGHT_BRACE:8,NUMBER:9,BOOLEAN:10,NULL:11,INVALID:12,$START:13,
json:14,value:15,object:16,array:17,elementList:18,member:19,memberList:20};j.productions=[[13,[14]],[14,[15],function(){return this.$1}],[15,[2],function(){return this.yy.unQuote(this.$1)}],[15,[9],function(){return parseFloat(this.$1)}],[15,[16],function(){return this.$1}],[15,[17],function(){return this.$1}],[15,[10],function(){return"true"===this.$1}],[15,[11],function(){return null}],[18,[15],function(){return[this.$1]}],[18,[18,3,15],function(){this.$1[this.$1.length]=this.$3;return this.$1}],
[17,[5,6],function(){return[]}],[17,[5,18,6],function(){return this.$2}],[19,[2,4,15],function(){return{key:this.yy.unQuote(this.$1),value:this.$3}}],[20,[19],function(){var b={};b[this.$1.key]=this.$1.value;return b}],[20,[20,3,19],function(){this.$1[this.$3.key]=this.$3.value;return this.$1}],[16,[7,8],function(){return{}}],[16,[7,20,8],function(){return this.$2}]];j.table={gotos:{"0":{14:7,15:8,16:9,17:10},2:{15:12,16:9,17:10,18:13},3:{19:16,20:17},18:{15:23,16:9,17:10},20:{15:24,16:9,17:10},21:{19:25}},
action:{"0":{2:[1,0,1],5:[1,0,2],7:[1,0,3],9:[1,0,4],10:[1,0,5],11:[1,0,6]},1:{1:[2,2,0],3:[2,2,0],6:[2,2,0],8:[2,2,0]},2:{2:[1,0,1],5:[1,0,2],6:[1,0,11],7:[1,0,3],9:[1,0,4],10:[1,0,5],11:[1,0,6]},3:{2:[1,0,14],8:[1,0,15]},4:{1:[2,3,0],3:[2,3,0],6:[2,3,0],8:[2,3,0]},5:{1:[2,6,0],3:[2,6,0],6:[2,6,0],8:[2,6,0]},6:{1:[2,7,0],3:[2,7,0],6:[2,7,0],8:[2,7,0]},7:{1:[0,0,0]},8:{1:[2,1,0]},9:{1:[2,4,0],3:[2,4,0],6:[2,4,0],8:[2,4,0]},10:{1:[2,5,0],3:[2,5,0],6:[2,5,0],8:[2,5,0]},11:{1:[2,10,0],3:[2,10,0],6:[2,
10,0],8:[2,10,0]},12:{3:[2,8,0],6:[2,8,0]},13:{3:[1,0,18],6:[1,0,19]},14:{4:[1,0,20]},15:{1:[2,15,0],3:[2,15,0],6:[2,15,0],8:[2,15,0]},16:{3:[2,13,0],8:[2,13,0]},17:{3:[1,0,21],8:[1,0,22]},18:{2:[1,0,1],5:[1,0,2],7:[1,0,3],9:[1,0,4],10:[1,0,5],11:[1,0,6]},19:{1:[2,11,0],3:[2,11,0],6:[2,11,0],8:[2,11,0]},20:{2:[1,0,1],5:[1,0,2],7:[1,0,3],9:[1,0,4],10:[1,0,5],11:[1,0,6]},21:{2:[1,0,14]},22:{1:[2,16,0],3:[2,16,0],6:[2,16,0],8:[2,16,0]},23:{3:[2,9,0],6:[2,9,0]},24:{3:[2,12,0],8:[2,12,0]},25:{3:[2,14,
0],8:[2,14,0]}}};j.parse=function(b){var a=this,c=a.lexer,e,f,g,d=a.table,j=d.gotos,d=d.action,m=a.productions,l=[null],i=[0];for(c.resetInput(b);;){e=i[i.length-1];f||(f=c.lex());if(!f)return"it is not a valid input: "+b,"error",!1;g=d[e]&&d[e][f];if(!g){var o=[];d[e]&&k.each(d[e],function(b,c){o.push(a.lexer.mapReverseSymbol(c))});b="Syntax error at line "+c.lineNumber+":\n"+c.showDebugInfo()+"\nexpect "+o.join(", ");b;return!1}switch(g[0]){case 1:i.push(f);l.push(c.text);i.push(g[2]);f=null;break;
case 2:var n=m[g[1]];e=n.symbol||n[0];g=n.action||n[2];var q=(n.rhs||n[1]).length,r=0,n=l[l.length-q];a.$$=n;for(n=h;r<q;r++)a["$"+(q-r)]=l[l.length-1-r];g&&(n=g.call(a));n=n!==h?n:a.$$;q&&(i=i.slice(0,-2*q),l=l.slice(0,-1*q));i.push(e);l.push(n);i.push(j[i[i.length-2]][i[i.length-1]]);break;case 0:return n}}return h};return j});
KISSY.add("json/parse",["./parser","./quote"],function(o,h){function j(f,b,a){var c=f[b],e,h,g;if("object"===typeof c)if(o.isArray(c)){e=0;h=c.length;for(var d=[];e<h;)g=j(c,""+e,a),void 0!==g&&(d[d.length]=g);c=d}else{d=o.keys(c);e=0;for(h=d.length;e<h;e++){var k=d[e];g=j(c,k,a);void 0===g?delete c[k]:c[k]=g}}return a.call(f,b,c)}var k=h("./parser"),m=h("./quote");k.yy={unQuote:m.unQuote};return function(f,b){var a=k.parse(""+f);return b?j({"":a},"",b):a}});
KISSY.add("json",["./json/stringify","./json/parse"],function(o,h){var j=h("./json/stringify"),k=h("./json/parse");return o.JSON={stringify:j,parse:k}});
KISSY.add("dom/class-list",["dom/base"],function(g,i){var j=i("dom/base"),h=/[\n\t\r]/g;return g.mix(j,{_hasClass:function(f,d){var a=f.className,e,b;if(a){a=(" "+a+" ").replace(h," ");b=0;for(e=d.length;b<e;b++)if(0>a.indexOf(" "+d[b]+" "))return!1;return!0}return!1},_addClass:function(f,d){var a=f.className,e,b=d.length,c;if(a){e=(" "+a+" ").replace(h," ");for(c=0;c<b;c++)0>e.indexOf(" "+d[c]+" ")&&(a+=" "+d[c]);a=g.trim(a)}else a=d.join(" ");f.className=a},_removeClass:function(f,d){var a=f.className,
e=d.length,b,c;if(a&&e){a=(" "+a+" ").replace(h," ");for(b=0;b<e;b++)for(c=" "+d[b]+" ";0<=a.indexOf(c);)a=a.replace(c," ");f.className=g.trim(a)}},_toggleClass:function(f,d,a){var e,b,c,g=[],h=[],i=d.length;for(e=0;e<i;e++)b=d[e],c=(c=this._hasClass(f,[b]))?!0!==a&&"remove":!1!==a&&"add","remove"===c?g.push(b):"add"===c&&h.push(b);h.length&&this._addClass(f,h);g.length&&this._removeClass(f,g)}})});
KISSY.add("dom/selector/parser",[],function(D,x){var v={},s=KISSY,k=function(d){this.rules=[];s.mix(this,d);this.resetInput(this.input)};k.prototype={constructor:function(d){this.rules=[];s.mix(this,d);this.resetInput(this.input)},resetInput:function(d){s.mix(this,{input:d,matched:"",stateStack:[k.STATIC.INITIAL],match:"",text:"",firstLine:1,lineNumber:1,lastLine:1,firstColumn:1,lastColumn:1})},getCurrentRules:function(){var d=this.stateStack[this.stateStack.length-1],f=[],d=this.mapState(d);s.each(this.rules,
function(e){var g=e.state||e[3];g?s.inArray(d,g)&&f.push(e):d===k.STATIC.INITIAL&&f.push(e)});return f},pushState:function(d){this.stateStack.push(d)},popState:function(){return this.stateStack.pop()},getStateStack:function(){return this.stateStack},showDebugInfo:function(){var d=k.STATIC.DEBUG_CONTEXT_LIMIT,f=this.matched,e=this.match,g=this.input,f=f.slice(0,f.length-e.length),f=(f.length>d?"...":"")+f.slice(-d).replace(/\n/," "),e=e+g,e=e.slice(0,d)+(e.length>d?"...":"");return f+e+"\n"+Array(f.length+
1).join("-")+"^"},mapSymbol:function(d){var f=this.symbolMap;return!f?d:f[d]||(f[d]=++this.symbolId)},mapReverseSymbol:function(d){var f=this.symbolMap,e,g=this.reverseSymbolMap;if(!g&&f)for(e in g=this.reverseSymbolMap={},f)g[f[e]]=e;return g?g[d]:d},mapState:function(d){var f=this.stateMap;return!f?d:f[d]||(f[d]=++this.stateId)},lex:function(){var d=this.input,f,e,g,E=this.getCurrentRules();this.match=this.text="";if(!d)return this.mapSymbol(k.STATIC.END_TAG);for(f=0;f<E.length;f++){e=E[f];var n=
e.token||e[0];g=e.action||e[2]||x;if(e=d.match(e.regexp||e[1])){if(f=e[0].match(/\n.*/g))this.lineNumber+=f.length;s.mix(this,{firstLine:this.lastLine,lastLine:this.lineNumber+1,firstColumn:this.lastColumn,lastColumn:f?f[f.length-1].length-1:this.lastColumn+e[0].length});f=this.match=e[0];this.matches=e;this.text=f;this.matched+=f;g=g&&g.call(this);g=g===x?n:this.mapSymbol(g);this.input=d=d.slice(f.length);return g?g:this.lex()}}"lex error at line "+this.lineNumber+":\n"+this.showDebugInfo();return x}};
k.STATIC={INITIAL:"I",DEBUG_CONTEXT_LIMIT:20,END_TAG:"$EOF"};var o=new k({rules:[[2,/^\[(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[3,/^(?:[\t\r\n\f\x20]*)\]/,function(){this.text=KISSY.trim(this.text)}],[4,/^(?:[\t\r\n\f\x20]*)~=(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[5,/^(?:[\t\r\n\f\x20]*)\|=(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[6,/^(?:[\t\r\n\f\x20]*)\^=(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],
[7,/^(?:[\t\r\n\f\x20]*)\$=(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[8,/^(?:[\t\r\n\f\x20]*)\*=(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[9,/^(?:[\t\r\n\f\x20]*)\=(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[10,/^(?:(?:[\w]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))(?:[\w\d-]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))*)\(/,function(){this.text=KISSY.trim(this.text).slice(0,-1);this.pushState("fn")}],[11,/^[^\)]*/,function(){this.popState()},
["fn"]],[12,/^(?:[\t\r\n\f\x20]*)\)/,function(){this.text=KISSY.trim(this.text)}],[13,/^:not\((?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[14,/^(?:(?:[\w]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))(?:[\w\d-]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))*)/,function(){this.text=this.yy.unEscape(this.text)}],[15,/^"(\\"|[^"])*"/,function(){this.text=this.yy.unEscapeStr(this.text)}],[15,/^'(\\'|[^'])*'/,function(){this.text=this.yy.unEscapeStr(this.text)}],[16,/^#(?:(?:[\w\d-]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))+)/,
function(){this.text=this.yy.unEscape(this.text.slice(1))}],[17,/^\.(?:(?:[\w]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))(?:[\w\d-]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))*)/,function(){this.text=this.yy.unEscape(this.text.slice(1))}],[18,/^(?:[\t\r\n\f\x20]*),(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[19,/^::?/,0],[20,/^(?:[\t\r\n\f\x20]*)\+(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[21,/^(?:[\t\r\n\f\x20]*)>(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],
[22,/^(?:[\t\r\n\f\x20]*)~(?:[\t\r\n\f\x20]*)/,function(){this.text=KISSY.trim(this.text)}],[23,/^\*/,0],[24,/^(?:[\t\r\n\f\x20]+)/,0],[25,/^./,0]]});v.lexer=o;o.symbolMap={$EOF:1,LEFT_BRACKET:2,RIGHT_BRACKET:3,INCLUDES:4,DASH_MATCH:5,PREFIX_MATCH:6,SUFFIX_MATCH:7,SUBSTRING_MATCH:8,ALL_MATCH:9,FUNCTION:10,PARAMETER:11,RIGHT_PARENTHESES:12,NOT:13,IDENT:14,STRING:15,HASH:16,CLASS:17,COMMA:18,COLON:19,PLUS:20,GREATER:21,TILDE:22,UNIVERSAL:23,S:24,INVALID:25,$START:26,selectors_group:27,selector:28,simple_selector_sequence:29,
combinator:30,type_selector:31,id_selector:32,class_selector:33,attrib_match:34,attrib:35,attrib_val:36,pseudo:37,negation:38,negation_arg:39,suffix_selector:40,suffix_selectors:41};v.productions=[[26,[27]],[27,[28],function(){return[this.$1]}],[27,[27,18,28],function(){this.$1.push(this.$3)}],[28,[29]],[28,[28,30,29],function(){this.$1.nextCombinator=this.$3.prevCombinator=this.$2;this.$3.order=(this.$1.order=this.$1.order||0)+1;this.$3.prev=this.$1;return this.$1.next=this.$3}],[30,[20]],[30,[21]],
[30,[22]],[30,[24],function(){return" "}],[31,[14],function(){return{t:"tag",value:this.$1}}],[31,[23],function(){return{t:"tag",value:this.$1}}],[32,[16],function(){return{t:"id",value:this.$1}}],[33,[17],function(){return{t:"cls",value:this.$1}}],[34,[6]],[34,[7]],[34,[8]],[34,[9]],[34,[4]],[34,[5]],[35,[2,14,3],function(){return{t:"attrib",value:{ident:this.$2}}}],[36,[14]],[36,[15]],[35,[2,14,34,36,3],function(){return{t:"attrib",value:{ident:this.$2,match:this.$3,value:this.$4}}}],[37,[19,10,
11,12],function(){return{t:"pseudo",value:{fn:this.$2.toLowerCase(),param:this.$3}}}],[37,[19,14],function(){return{t:"pseudo",value:{ident:this.$2.toLowerCase()}}}],[38,[13,39,12],function(){return{t:"pseudo",value:{fn:"not",param:this.$2}}}],[39,[31]],[39,[32]],[39,[33]],[39,[35]],[39,[37]],[40,[32]],[40,[33]],[40,[35]],[40,[37]],[40,[38]],[41,[40],function(){return[this.$1]}],[41,[41,40],function(){this.$1.push(this.$2)}],[29,[31]],[29,[41],function(){return{suffix:this.$1}}],[29,[31,41],function(){return{t:"tag",
value:this.$1.value,suffix:this.$2}}]];v.table={gotos:{"0":{27:8,28:9,29:10,31:11,32:12,33:13,35:14,37:15,38:16,40:17,41:18},2:{31:20,32:21,33:22,35:23,37:24,39:25},9:{30:33},11:{32:12,33:13,35:14,37:15,38:16,40:17,41:34},18:{32:12,33:13,35:14,37:15,38:16,40:35},19:{34:43},28:{28:46,29:10,31:11,32:12,33:13,35:14,37:15,38:16,40:17,41:18},33:{29:47,31:11,32:12,33:13,35:14,37:15,38:16,40:17,41:18},34:{32:12,33:13,35:14,37:15,38:16,40:35},43:{36:50},46:{30:33}},action:{"0":{2:[1,0,1],13:[1,0,2],14:[1,
0,3],16:[1,0,4],17:[1,0,5],19:[1,0,6],23:[1,0,7]},1:{14:[1,0,19]},2:{2:[1,0,1],14:[1,0,3],16:[1,0,4],17:[1,0,5],19:[1,0,6],23:[1,0,7]},3:{1:[2,9,0],2:[2,9,0],12:[2,9,0],13:[2,9,0],16:[2,9,0],17:[2,9,0],18:[2,9,0],19:[2,9,0],20:[2,9,0],21:[2,9,0],22:[2,9,0],24:[2,9,0]},4:{1:[2,11,0],2:[2,11,0],12:[2,11,0],13:[2,11,0],16:[2,11,0],17:[2,11,0],18:[2,11,0],19:[2,11,0],20:[2,11,0],21:[2,11,0],22:[2,11,0],24:[2,11,0]},5:{1:[2,12,0],2:[2,12,0],12:[2,12,0],13:[2,12,0],16:[2,12,0],17:[2,12,0],18:[2,12,0],19:[2,
12,0],20:[2,12,0],21:[2,12,0],22:[2,12,0],24:[2,12,0]},6:{10:[1,0,26],14:[1,0,27]},7:{1:[2,10,0],2:[2,10,0],12:[2,10,0],13:[2,10,0],16:[2,10,0],17:[2,10,0],18:[2,10,0],19:[2,10,0],20:[2,10,0],21:[2,10,0],22:[2,10,0],24:[2,10,0]},8:{1:[0,0,0],18:[1,0,28]},9:{1:[2,1,0],18:[2,1,0],20:[1,0,29],21:[1,0,30],22:[1,0,31],24:[1,0,32]},10:{1:[2,3,0],18:[2,3,0],20:[2,3,0],21:[2,3,0],22:[2,3,0],24:[2,3,0]},11:{1:[2,38,0],2:[1,0,1],13:[1,0,2],16:[1,0,4],17:[1,0,5],18:[2,38,0],19:[1,0,6],20:[2,38,0],21:[2,38,0],
22:[2,38,0],24:[2,38,0]},12:{1:[2,31,0],2:[2,31,0],13:[2,31,0],16:[2,31,0],17:[2,31,0],18:[2,31,0],19:[2,31,0],20:[2,31,0],21:[2,31,0],22:[2,31,0],24:[2,31,0]},13:{1:[2,32,0],2:[2,32,0],13:[2,32,0],16:[2,32,0],17:[2,32,0],18:[2,32,0],19:[2,32,0],20:[2,32,0],21:[2,32,0],22:[2,32,0],24:[2,32,0]},14:{1:[2,33,0],2:[2,33,0],13:[2,33,0],16:[2,33,0],17:[2,33,0],18:[2,33,0],19:[2,33,0],20:[2,33,0],21:[2,33,0],22:[2,33,0],24:[2,33,0]},15:{1:[2,34,0],2:[2,34,0],13:[2,34,0],16:[2,34,0],17:[2,34,0],18:[2,34,
0],19:[2,34,0],20:[2,34,0],21:[2,34,0],22:[2,34,0],24:[2,34,0]},16:{1:[2,35,0],2:[2,35,0],13:[2,35,0],16:[2,35,0],17:[2,35,0],18:[2,35,0],19:[2,35,0],20:[2,35,0],21:[2,35,0],22:[2,35,0],24:[2,35,0]},17:{1:[2,36,0],2:[2,36,0],13:[2,36,0],16:[2,36,0],17:[2,36,0],18:[2,36,0],19:[2,36,0],20:[2,36,0],21:[2,36,0],22:[2,36,0],24:[2,36,0]},18:{1:[2,39,0],2:[1,0,1],13:[1,0,2],16:[1,0,4],17:[1,0,5],18:[2,39,0],19:[1,0,6],20:[2,39,0],21:[2,39,0],22:[2,39,0],24:[2,39,0]},19:{3:[1,0,36],4:[1,0,37],5:[1,0,38],
6:[1,0,39],7:[1,0,40],8:[1,0,41],9:[1,0,42]},20:{12:[2,26,0]},21:{12:[2,27,0]},22:{12:[2,28,0]},23:{12:[2,29,0]},24:{12:[2,30,0]},25:{12:[1,0,44]},26:{11:[1,0,45]},27:{1:[2,24,0],2:[2,24,0],12:[2,24,0],13:[2,24,0],16:[2,24,0],17:[2,24,0],18:[2,24,0],19:[2,24,0],20:[2,24,0],21:[2,24,0],22:[2,24,0],24:[2,24,0]},28:{2:[1,0,1],13:[1,0,2],14:[1,0,3],16:[1,0,4],17:[1,0,5],19:[1,0,6],23:[1,0,7]},29:{2:[2,5,0],13:[2,5,0],14:[2,5,0],16:[2,5,0],17:[2,5,0],19:[2,5,0],23:[2,5,0]},30:{2:[2,6,0],13:[2,6,0],14:[2,
6,0],16:[2,6,0],17:[2,6,0],19:[2,6,0],23:[2,6,0]},31:{2:[2,7,0],13:[2,7,0],14:[2,7,0],16:[2,7,0],17:[2,7,0],19:[2,7,0],23:[2,7,0]},32:{2:[2,8,0],13:[2,8,0],14:[2,8,0],16:[2,8,0],17:[2,8,0],19:[2,8,0],23:[2,8,0]},33:{2:[1,0,1],13:[1,0,2],14:[1,0,3],16:[1,0,4],17:[1,0,5],19:[1,0,6],23:[1,0,7]},34:{1:[2,40,0],2:[1,0,1],13:[1,0,2],16:[1,0,4],17:[1,0,5],18:[2,40,0],19:[1,0,6],20:[2,40,0],21:[2,40,0],22:[2,40,0],24:[2,40,0]},35:{1:[2,37,0],2:[2,37,0],13:[2,37,0],16:[2,37,0],17:[2,37,0],18:[2,37,0],19:[2,
37,0],20:[2,37,0],21:[2,37,0],22:[2,37,0],24:[2,37,0]},36:{1:[2,19,0],2:[2,19,0],12:[2,19,0],13:[2,19,0],16:[2,19,0],17:[2,19,0],18:[2,19,0],19:[2,19,0],20:[2,19,0],21:[2,19,0],22:[2,19,0],24:[2,19,0]},37:{14:[2,17,0],15:[2,17,0]},38:{14:[2,18,0],15:[2,18,0]},39:{14:[2,13,0],15:[2,13,0]},40:{14:[2,14,0],15:[2,14,0]},41:{14:[2,15,0],15:[2,15,0]},42:{14:[2,16,0],15:[2,16,0]},43:{14:[1,0,48],15:[1,0,49]},44:{1:[2,25,0],2:[2,25,0],13:[2,25,0],16:[2,25,0],17:[2,25,0],18:[2,25,0],19:[2,25,0],20:[2,25,0],
21:[2,25,0],22:[2,25,0],24:[2,25,0]},45:{12:[1,0,51]},46:{1:[2,2,0],18:[2,2,0],20:[1,0,29],21:[1,0,30],22:[1,0,31],24:[1,0,32]},47:{1:[2,4,0],18:[2,4,0],20:[2,4,0],21:[2,4,0],22:[2,4,0],24:[2,4,0]},48:{3:[2,20,0]},49:{3:[2,21,0]},50:{3:[1,0,52]},51:{1:[2,23,0],2:[2,23,0],12:[2,23,0],13:[2,23,0],16:[2,23,0],17:[2,23,0],18:[2,23,0],19:[2,23,0],20:[2,23,0],21:[2,23,0],22:[2,23,0],24:[2,23,0]},52:{1:[2,22,0],2:[2,22,0],12:[2,22,0],13:[2,22,0],16:[2,22,0],17:[2,22,0],18:[2,22,0],19:[2,22,0],20:[2,22,0],
21:[2,22,0],22:[2,22,0],24:[2,22,0]}}};v.parse=function(d){var f=this,e=f.lexer,g,k,n,u=f.table,q=u.gotos,u=u.action,v=f.productions,l=[null],p=[0];for(e.resetInput(d);;){g=p[p.length-1];k||(k=e.lex());if(!k)return"it is not a valid input: "+d,"error",!1;n=u[g]&&u[g][k];if(!n){var y=[];u[g]&&s.each(u[g],function(d,e){y.push(f.lexer.mapReverseSymbol(e))});d="Syntax error at line "+e.lineNumber+":\n"+e.showDebugInfo()+"\nexpect "+y.join(", ");d;return!1}switch(n[0]){case 1:p.push(k);l.push(e.text);
p.push(n[2]);k=null;break;case 2:var j=v[n[1]];g=j.symbol||j[0];n=j.action||j[2];var t=(j.rhs||j[1]).length,w=0,o,j=l[l.length-t];o=x;for(f.$$=j;w<t;w++)f["$"+(t-w)]=l[l.length-1-w];n&&(o=n.call(f));j=o!==x?o:f.$$;t&&(p=p.slice(0,-2*t),l=l.slice(0,-1*t));p.push(g);l.push(j);p.push(q[p[p.length-2]][p[p.length-1]]);break;case 0:return j}}return x};return v});
KISSY.add("dom/selector",["./selector/parser","dom/basic"],function(D,x){function v(a){return a.replace(K,L)}function s(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function k(a){var b=0,c=0;if("number"===typeof a)c=a;else if("odd"===a)b=2,c=1;else if("even"===a)b=2,c=0;else if(a=a.replace(/\s/g,"").match(I))a[1]?(b=parseInt(a[2]),isNaN(b)&&(b="-"===a[2]?-1:1)):b=0,c=parseInt(a[3])||0;return{a:b,b:c}}function o(a,b,c,f){if(0===b){if(a===c)return f}else if(0<=(a-c)/b&&0===(a-c)%b&&f)return 1}function d(a,
b){return q._selectInternal(a,null,b)}function f(a,b){if(!b)return!0;if(!a||9===a.nodeType)return!1;var c=1,f=b.suffix,d,e;"tag"===b.t&&(c&=F.tag(a,b.value));if(c&&f){d=f.length;for(e=0;c&&e<d;e++){var g=f[e],i=g.t;F[i]&&(c&=F[i](a,g.value))}}return c}function e(a,b){var c=1,d=a,e,g=b;do if(c&=f(a,b)){b=b&&b.prev;if(!b)return!0;e=B[b.nextCombinator];a=s(a,e.dir);if(!e.immediate)return{el:a,match:b}}else if(e=B[b.nextCombinator],e.immediate)break;else return{el:a&&s(a,e.dir),match:b};while(a);return{el:s(d,
B[g.nextCombinator].dir),match:g}}function g(a,b){var c;if(y){if(!(c=a.getAttribute(l)))a.setAttribute(l,c=+new Date+"_"+ ++j)}else if(!(c=a[l]))c=a[l]=+new Date+"_"+ ++j;c=c+"_"+(b.order||0);if(c in t)return t[c];t[c]=E(a,b);return t[c]}function E(a,b){var c=e(a,b);if(!0===c)return!0;a=c.el;for(b=c.match;a;){if(g(a,b))return!0;a=s(a,B[b.nextCombinator].dir)}return!1}function n(a,b,c){p[a]||(p[a]=u.parse(a));var a=p[a],e=0,d=a.length,A,k,i=[];c&&(b=b||c[0].ownerDocument);A=b&&b.ownerDocument||G;for(y=
(k=(b=b||A)&&(b.ownerDocument||b).documentElement)?"html"!==k.nodeName.toLowerCase():!1;e<d;e++){t={};k=a[e];var h=k.suffix,r,m,j,n=c;j=null;if(!n){if(h&&!y){r=0;for(m=h.length;r<m;r++){var l=h[r];if("id"===l.t){j=l.value;break}}}if(j)if(r=!b.getElementById,m=q._contains(A,b),h=r?m?A.getElementById(j):null:b.getElementById(j),!h&&r||h&&w(h,"id")!==j){r=q._getElementsByTagName("*",b);m=r.length;for(l=0;l<m;l++)if(h=r[l],w(h,"id")===j){n=[h];break}l===m&&(n=[])}else m&&h&&b!==A&&(h=q._contains(b,h)?
h:null),n=h?[h]:[];else n=q._getElementsByTagName(k.value||"*",b)}j=0;if(h=n.length)for(;j<h;j++){r=n[j];a:{m=r;var l=void 0,o=k;do{if(!f(m,o)){m=null;break a}o=o.prev;if(!o){m=!0;break a}l=B[o.nextCombinator];m=s(m,l.dir)}while(m&&l.immediate);m=!m?null:{el:m,match:o}}!0===m?i.push(r):m&&g(m.el,m.match)&&i.push(r)}}1<d&&(i=q.unique(i));return i}var u=x("./selector/parser"),q=x("dom/basic");"use KISSY css3 selector";var G=D.Env.host.document,l="_ks_data_selector_id_",p={},y,j=0,t={},w=function(a,
b){return y?q._getSimpleAttr(a,b):q.attr(a,b)},J=q._hasSingleClass,H=q._isTag,I=/^(([+-]?(?:\d+)?)?n)?([+-]?\d+)?$/,K=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,L=function(a,b){var c="0x"+b-65536;return isNaN(c)?b:0>c?String.fromCharCode(c+65536):String.fromCharCode(c>>10|55296,c&1023|56320)};u.lexer.yy={unEscape:v,unEscapeStr:function(a){return this.unEscape(a.slice(1,-1))}};var C={"nth-child":function(a,b){var c=k(b),f=c.a,c=c.b;if(0===f&&0===c)return 0;var e=0,d=a.parentNode;if(d)for(var d=d.childNodes,
g=0,i,h=d.length;g<h;g++)if(i=d[g],1===i.nodeType&&(e++,i=o(e,f,c,i===a),void 0!==i))return i;return 0},"nth-last-child":function(a,b){var c=k(b),f=c.a,c=c.b;if(0===f&&0===c)return 0;var e=0,d=a.parentNode;if(d)for(var d=d.childNodes,g=d.length-1,i;0<=g;g--)if(i=d[g],1===i.nodeType&&(e++,i=o(e,f,c,i===a),void 0!==i))return i;return 0},"nth-of-type":function(a,b){var c=k(b),f=c.a,c=c.b;if(0===f&&0===c)return 0;var d=0,e=a.parentNode;if(e)for(var e=e.childNodes,g=a.tagName,i=0,h,j=e.length;i<j;i++)if(h=
e[i],h.tagName===g&&(d++,h=o(d,f,c,h===a),void 0!==h))return h;return 0},"nth-last-of-type":function(a,b){var c=k(b),e=c.a,c=c.b;if(0===e&&0===c)return 0;var f=0,d=a.parentNode;if(d)for(var d=d.childNodes,g=a.tagName,i=d.length-1,h;0<=i;i--)if(h=d[i],h.tagName===g&&(f++,h=o(f,e,c,h===a),void 0!==h))return h;return 0},lang:function(a,b){var c,b=v(b.toLowerCase());do if(c=y?a.getAttribute("xml:lang")||a.getAttribute("lang"):a.lang)return c=c.toLowerCase(),c===b||0===c.indexOf(b+"-");while((a=a.parentNode)&&
1===a.nodeType);return!1},not:function(a,b){return!F[b.t](a,b.value)}},z={empty:function(a){for(var a=a.childNodes,b=0,c=a.length-1,d;b<c;b++)if(d=a[b],d=d.nodeType,1===d||3===d||4===d||5===d)return 0;return 1},root:function(a){return a.ownerDocument&&a===a.ownerDocument.documentElement},"first-child":function(a){return C["nth-child"](a,1)},"last-child":function(a){return C["nth-last-child"](a,1)},"first-of-type":function(a){return C["nth-of-type"](a,1)},"last-of-type":function(a){return C["nth-last-of-type"](a,
1)},"only-child":function(a){return z["first-child"](a)&&z["last-child"](a)},"only-of-type":function(a){return z["first-of-type"](a)&&z["last-of-type"](a)},focus:function(a){var b=a.ownerDocument;return b&&a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&!(!a.type&&!(a.href||0<=a.tabIndex))},target:function(a){var b=location.hash;return b&&b.slice(1)===w(a,"id")},enabled:function(a){return!a.disabled},disabled:function(a){return a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===
b&&a.checked||"option"===b&&a.selected}},M={"~=":function(a,b){return!b||-1<b.indexOf(" ")?0:-1!==(" "+a+" ").indexOf(" "+b+" ")},"|=":function(a,b){return-1!==(" "+a).indexOf(" "+b+"-")},"^=":function(a,b){return b&&D.startsWith(a,b)},"$=":function(a,b){return b&&D.endsWith(a,b)},"*=":function(a,b){return b&&-1!==a.indexOf(b)},"=":function(a,b){return a===b}},F={tag:H,cls:J,id:function(a,b){return w(a,"id")===b},attrib:function(a,b){var c=b.ident;y||(c=c.toLowerCase());var c=w(a,c),d=b.match;if(!d&&
void 0!==c)return 1;if(d){if(void 0===c)return 0;if(d=M[d])return d(c+"",b.value+"")}return 0},pseudo:function(a,b){var c,d;if(d=b.fn){if(!(c=C[d]))throw new SyntaxError("Syntax error: not support pseudo: "+d);return c(a,b.param)}if(c=b.ident){if(!z[c])throw new SyntaxError("Syntax error: not support pseudo: "+c);return z[c](a)}return 0}},B={">":{dir:"parentNode",immediate:1}," ":{dir:"parentNode"},"+":{dir:"previousSibling",immediate:1},"~":{dir:"previousSibling"}};"sourceIndex"in G.documentElement&&
(q._compareNodeOrder=function(a,b){return a.sourceIndex-b.sourceIndex});q._matchesInternal=d;q._selectInternal=n;return{parse:function(a){return u.parse(a)},select:n,matches:d}});
KISSY.add("dom/ie/create",["dom/base"],function(l,k){var e=k("dom/base");e._fixCloneAttributes=function(c,a){a.clearAttributes&&a.clearAttributes();a.mergeAttributes&&a.mergeAttributes(c);var b=a.nodeName.toLowerCase(),d=c.childNodes;if("object"===b&&!a.childNodes.length)for(b=0;b<d.length;b++)a.appendChild(d[b].cloneNode(!0));else if("input"===b&&("checkbox"===c.type||"radio"===c.type)){if(c.checked&&(a.defaultChecked=a.checked=c.checked),a.value!==c.value)a.value=c.value}else if("option"===b)a.selected=
c.defaultSelected;else if("input"===b||"textarea"===b)a.defaultValue=c.defaultValue,a.value=c.value;a.removeAttribute(e.__EXPANDO)};var m=e._creators,g=e._defaultCreator,i=/<tbody/i;8>l.UA.ieMode&&(m.table=function(c,a){var b=g(c,a);if(i.test(c))return b;var d=b.firstChild,h=l.makeArray(d.childNodes);l.each(h,function(a){"tbody"===e.nodeName(a)&&!a.childNodes.length&&d.removeChild(a)});return b})});
KISSY.add("dom/ie/insertion",["dom/base"],function(l,k){var e=k("dom/base");8>l.UA.ieMode&&(e._fixInsertionChecked=function g(i){for(var c=0;c<i.length;c++){var a=i[c];if(a.nodeType===e.NodeType.DOCUMENT_FRAGMENT_NODE)g(a.childNodes);else if("input"===e.nodeName(a)){if("checkbox"===a.type||"radio"===a.type)a.defaultChecked=a.checked}else if(a.nodeType===e.NodeType.ELEMENT_NODE)for(var a=a.getElementsByTagName("input"),b=0;b<a.length;b++)g(a[b])}})});
KISSY.add("dom/ie/style",["dom/base"],function(l,k){var e=k("dom/base"),m=e._cssProps,g=l.UA,i=l.Env.host.document,i=i&&i.documentElement,c=/^(top|right|bottom|left)$/,a=e._cssHooks,b=/opacity\s*=\s*([^)]*)/,d=/alpha\([^)]*\)/i;m["float"]="styleFloat";a.backgroundPosition={get:function(a,d){return d?a.currentStyle.backgroundPositionX+" "+a.currentStyle.backgroundPositionY:a.style.backgroundPosition}};try{null==i.style.opacity&&(a.opacity={get:function(a,d){return b.test((d&&a.currentStyle?a.currentStyle.filter:
a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":d?"1":""},set:function(a,b){var b=parseFloat(b),c=a.style,h=a.currentStyle,j=isNaN(b)?"":"alpha(opacity="+100*b+")",f=l.trim(h&&h.filter||c.filter||"");c.zoom=1;if((1<=b||!j)&&!l.trim(f.replace(d,"")))if(c.removeAttribute("filter"),!j||h&&!h.filter)return;c.filter=d.test(f)?f.replace(d,j):f+(f?", ":"")+j}})}catch(h){"IE filters ActiveX is disabled. ex = "+h}var g=8===g.ie,j={};j.thin=g?"1px":"2px";j.medium=g?"3px":"4px";j.thick=g?"5px":"6px";l.each(["",
"Top","Left","Right","Bottom"],function(d){var b="border"+d+"Width",c="border"+d+"Style";a[b]={get:function(a,d){var h=d?a.currentStyle:0,o=h&&""+h[b]||void 0;o&&0>o.indexOf("px")&&(o=j[o]&&"none"!==h[c]?j[o]:0);return o}}});e._getComputedStyle=function(a,d){var d=m[d]||d,b=a.currentStyle&&a.currentStyle[d];if(e._RE_NUM_NO_PX.test(b)&&!c.test(d)){var h=a.style,j=h.left,f=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;h.left="fontSize"===d?"1em":b||0;b=h.pixelLeft+"px";h.left=j;a.runtimeStyle.left=
f}return""===b?"auto":b}});
KISSY.add("dom/ie/traversal",["dom/base"],function(l,k){var e=k("dom/base");e._contains=function(c,a){c.nodeType===e.NodeType.DOCUMENT_NODE&&(c=c.documentElement);a=a.parentNode;return c===a?!0:a&&a.nodeType===e.NodeType.ELEMENT_NODE?c.contains&&c.contains(a):!1};var m=document.createElement("div");m.appendChild(document.createComment(""));var g;g=m.getElementsByTagName("*").length?function(c,a){var b=a.getElementsByTagName(c),d="*"===c;if(d||"number"!==typeof b.length){for(var h=[],j=0,o;o=b[j++];)(!d||
1===o.nodeType)&&h.push(o);return h}return b}:function(c,a){return a.getElementsByTagName(c)};e._getElementsByTagName=g;var i=e._getSimpleAttr;e._getElementById=function(c,a){var b=a.getElementById(c);if(b&&i(b,"id")!==c)for(var d=g("*",a),h=0,j=d.length;h<j;h++)if(i(d[h],"id")===c)return d[h];return b}});
KISSY.add("dom/ie/transform",["dom/base"],function(l,k){function e(c){return[[c[0],c[2],c[4]],[c[1],c[3],c[5]],[0,0,1]]}function m(c,a){var b;if(2<arguments.length){var d=c;for(b=1;b<arguments.length;b++)d=m(d,arguments[b]);return d}var d=[],h=c.length,j=a.length,o=a[0].length;for(b=0;b<h;b++)for(var e=0;e<o;e++){for(var g=0,i=0;i<j;i++)g+=c[b][i]*a[i][e];var i=d,l=b,f=e;i[l]||(i[l]=[]);i[l][f]=g}return d}function g(c){return-1<c.indexOf("deg")?parseInt(c,10)*(2*Math.PI/360):parseFloat(c)}var i=/progid:DXImageTransform.Microsoft.Matrix\(([^)]*)\)/;
k("dom/base")._cssHooks.transform={get:function(c,a){var b=c[a?"currentStyle":"style"];if(b&&i.test(b.filter)){var b=RegExp.$1.split(","),d=0,h=0,j=b[4]&&b[4].split("="),e=b[5]&&b[5].split("=");j&&"dx"===j[0].toLowerCase()&&(d=parseFloat(j[1]));e&&"dy"===e[0].toLowerCase()&&(h=parseFloat(e[1]));b=[b[0].split("=")[1],b[2].split("=")[1],b[1].split("=")[1],b[3].split("=")[1],d,h]}else return a?"none":"";return"matrix("+b.join(",")+")"},set:function(c,a){var b=c.style,d,h=c.currentStyle,j,o={width:c.clientWidth,
height:c.clientHeight};j=o.width/2;var k=o.height/2,p=c.style.transformOrigin,p=(p||"50% 50%").split(/\s+/);1===p.length&&(p[1]=p[0]);for(var q=0;q<p.length;q++){var r=parseFloat(p[q]);p[q]=l.endsWith(p[q],"%")?r*o[q?"height":"width"]/100:r}o=p;b.zoom=1;if(a){d=a.split(")");for(var p=l.trim,q=-1,r=d.length-1,f,t,s=e([1,0,0,1,0,0]),n;++q<r;){f=d[q].split("(");t=p(f[0]);f=f[1];n=[1,0,0,1,0,0];switch(t){case "translateX":n[4]=parseInt(f,10);break;case "translateY":n[5]=parseInt(f,10);break;case "translate":f=
f.split(",");n[4]=parseInt(f[0],10);n[5]=parseInt(f[1]||0,10);break;case "rotate":f=g(f);n[0]=Math.cos(f);n[1]=Math.sin(f);n[2]=-Math.sin(f);n[3]=Math.cos(f);break;case "scaleX":n[0]=+f;break;case "scaleY":n[3]=+f;break;case "scale":f=f.split(",");n[0]=+f[0];n[3]=1<f.length?+f[1]:+f[0];break;case "skewX":n[2]=Math.tan(g(f));break;case "skewY":n[1]=Math.tan(g(f));break;case "skew":f=f.split(",");n[2]=Math.tan(g(f[0]));1<f.length&&(n[1]=Math.tan(g(f[1])));break;case "matrix":f=f.split(","),n[0]=+f[0],
n[1]=+f[1],n[2]=+f[2],n[3]=+f[3],n[4]=parseInt(f[4],10),n[5]=parseInt(f[5],10)}s=m(s,e(n))}a=s;d=o[0];o=o[1];d=m([[1,0,d],[0,1,o],[0,0,1]],a,[[1,0,-d],[0,1,-o],[0,0,1]],[[j],[k],[1]]);d.x=d[0][0];d.y=d[1][0];j=["progid:DXImageTransform.Microsoft.Matrix(M11="+a[0][0],"M12="+a[0][1],"M21="+a[1][0],"M22="+a[1][1],"Dx="+a[0][2],"Dy="+a[1][2],'SizingMethod="auto expand"'].join()+")"}else j="";k=h&&h.filter||b.filter||"";if(!j&&!l.trim(k.replace(i,""))&&(b.removeAttribute("filter"),!j||h&&!h.filter))return;
b.filter=i.test(k)?k.replace(i,j):k+(k?", ":"")+j;j?(h=c.offsetHeight/2,b.marginLeft=d.x-c.offsetWidth/2+"px",b.marginTop=d.y-h+"px"):b.marginLeft=b.marginTop=0}}});
KISSY.add("dom/ie/input-selection",["dom/base"],function(l,k){function e(a,b){var d=0,h=0,c=a.ownerDocument.selection.createRange(),e=m(a);e.inRange(c)&&(e.setEndPoint("EndToStart",c),d=i(a,e).length,b&&(h=d+i(a,c).length));return[d,h]}function m(a){if("textarea"===a.type){var b=a.document.body.createTextRange();b.moveToElementText(a);return b}return a.createTextRange()}function g(a,b,d){var h=Math.min(b,d),c=Math.max(b,d);return h===c?0:"textarea"===a.type?(a=a.value.substring(h,c).replace(/\r\n/g,
"\n").length,b>d&&(a=-a),a):d-b}function i(a,b){if("textarea"===a.type){var d=b.text,c=b.duplicate();if(0===c.compareEndPoints("StartToEnd",c))return d;c.moveEnd("character",-1);c.text===d&&(d+="\r\n");return d}return b.text}var c=k("dom/base")._propHooks;c.selectionStart={set:function(a,b){var d=a.ownerDocument.selection.createRange();if(m(a).inRange(d)){var c=e(a,1)[1],j=g(a,b,c);d.collapse(!1);d.moveStart("character",-j);b>c&&d.collapse(!0);d.select()}},get:function(a){return e(a)[0]}};c.selectionEnd=
{set:function(a,b){var d=a.ownerDocument.selection.createRange();if(m(a).inRange(d)){var c=e(a)[0],j=g(a,c,b);d.collapse(!0);d.moveEnd("character",j);c>b&&d.collapse(!1);d.select()}},get:function(a){return e(a,1)[1]}}});
KISSY.add("dom/ie/attr",["dom/base"],function(l,k){function e(a){var b="",j=a.nodeType;if(j===m.NodeType.ELEMENT_NODE)for(a=a.firstChild;a;a=a.nextSibling)b+=e(a);else if(j===c.TEXT_NODE||j===c.CDATA_SECTION_NODE)b+=a.nodeValue;return b}var m=k("dom/base"),g=m._attrHooks,i=m._attrNodeHook,c=m.NodeType,a=m._valHooks,b=m._propFix;8>l.UA.ieMode&&(g.style.set=function(a,b){a.style.cssText=b},l.mix(i,{get:function(a,b){var c=a.getAttributeNode(b);return c&&(c.specified||c.nodeValue)?c.nodeValue:void 0},
set:function(a,b,c){var e=a.getAttributeNode(c),g;if(e)e.nodeValue=b;else try{g=a.ownerDocument.createAttribute(c),g.value=b,a.setAttributeNode(g)}catch(i){return a.setAttribute(c,b,0)}}}),l.mix(m._attrFix,b),g.tabIndex=g.tabindex,l.each("href,src,width,height,colSpan,rowSpan".split(","),function(a){g[a]={get:function(b){b=b.getAttribute(a,2);return b===null?void 0:b}}}),a.button=g.value=i,g.placeholder={get:function(a,b){return a[b]||i.get(a,b)}},a.option={get:function(a){var b=a.attributes.value;
return!b||b.specified?a.value:a.text}});(g.href=g.href||{}).set=function(a,b,e){for(var g=a.childNodes,i,k=g.length,l=k>0,k=k-1;k>=0;k--)g[k].nodeType!==c.TEXT_NODE&&(l=0);if(l){i=a.ownerDocument.createElement("b");i.style.display="none";a.appendChild(i)}a.setAttribute(e,""+b);i&&a.removeChild(i)};m._getText=e;return m});
KISSY.add("dom/ie","./ie/create,./ie/insertion,./ie/style,./ie/traversal,./ie/transform,./ie/input-selection,./ie/attr".split(","),function(l,k){k("./ie/create");k("./ie/insertion");k("./ie/style");k("./ie/traversal");k("./ie/transform");k("./ie/input-selection");return k("./ie/attr")});
KISSY.add("event/dom/shake",["event/dom/base"],function(d,m){function j(a){var b=a.accelerationIncludingGravity,a=b.x,d=b.y,b=b.z,f;void 0!==c&&(f=n(g(a-c),g(d-h),g(b-i)),f>o&&k(),f>p&&(e=1));c=a;h=d;i=b}var l=m("event/dom/base"),q=l.Special,o=5,p=20,e=0,c,h,i,n=Math.max,g=Math.abs,a=d.Env.host,k=d.buffer(function(){e&&(l.fireHandler(a,"shake",{accelerationIncludingGravity:{x:c,y:h,z:i}}),c=void 0,e=0)},250);q.shake={setup:function(){this===a&&a.addEventListener("devicemotion",j,!1)},tearDown:function(){this===
a&&(k.stop(),c=void 0,e=0,a.removeEventListener("devicemotion",j,!1))}}});
KISSY.add("event/dom/ie/change",["event/dom/base","dom"],function(i,d){function e(a){a=a.type;return"checkbox"===a||"radio"===a}function g(a){"checked"===a.originalEvent.propertyName&&(this.__changed=1)}function c(b){this.__changed&&(this.__changed=0,a.fire(this,"change",b))}function h(b){b=b.target;j.test(b.nodeName)&&!b.__changeHandler&&(b.__changeHandler=1,a.on(b,"change",{fn:f,last:1}))}function f(b){if(!b.isPropagationStopped()&&!e(this)){var c;(c=this.parentNode)&&a.fire(c,"change",b)}}var a=
d("event/dom/base"),k=d("dom"),j=/^(?:textarea|input|select)$/i;a.Special.change={setup:function(){if(j.test(this.nodeName))if(e(this))a.on(this,"propertychange",g),a.on(this,"click",c);else return!1;else a.on(this,"beforeactivate",h)},tearDown:function(){if(j.test(this.nodeName))if(e(this))a.remove(this,"propertychange",g),a.remove(this,"click",c);else return!1;else a.remove(this,"beforeactivate",h),i.each(k.query("textarea,input,select",this),function(b){b.__changeHandler&&(b.__changeHandler=0,
a.remove(b,"change",{fn:f,last:1}))})}}});
KISSY.add("event/dom/ie/submit",["event/dom/base","dom"],function(i,d){function e(a){var a=a.target,d=f(a);if((a="input"===d||"button"===d?a.form:null)&&!a.__submitFix)a.__submitFix=1,c.on(a,"submit",{fn:g,last:1})}function g(a){this.parentNode&&!a.isPropagationStopped()&&!a.synthetic&&c.fire(this.parentNode,"submit",a)}var c=d("event/dom/base"),h=d("dom"),f=h.nodeName;c.Special.submit={setup:function(){if("form"===f(this))return!1;c.on(this,"click keypress",e)},tearDown:function(){if("form"===f(this))return!1;
c.remove(this,"click keypress",e);i.each(h.query("form",this),function(a){a.__submitFix&&(a.__submitFix=0,c.remove(a,"submit",{fn:g,last:1}))})}}});KISSY.add("event/dom/ie",["./ie/change","./ie/submit"],function(i,d){d("./ie/change");d("./ie/submit")});
KISSY.add("event/dom/hashchange",["event/dom/base","dom"],function(e,n){var c=n("event/dom/base"),h=n("dom"),d=e.UA,r=c.Special,f=e.Env.host,g=f.document,s=d.ieMode,l="__replace_history_"+e.now(),d=s||d.ie;c.REPLACE_HISTORY=l;var t="<html><head><title>"+(g&&g.title||"")+" - {hash}</title>{head}</head><body>{hash}</body></html>",i=function(){return"#"+(new e.Uri(location.href)).getFragment()},b,j,m=function(){var a=i(),c;if(c=e.endsWith(a,l))a=a.slice(0,-l.length),location.hash=a;a!==j&&(j=a,o(a,c));
b=setTimeout(m,50)},o=d&&8>d?function(c,b){var d=e.substitute(t,{hash:e.escapeHtml(c),head:h.isCustomDomain()?'<script>document.domain = "'+g.domain+'";<\/script>':""}),k=a.contentWindow.document;try{b?k.open("text/html","replace"):k.open(),k.write(d),k.close()}catch(f){}}:function(){c.fireHandler(f,"hashchange")},p=function(){b||m()},q=function(){b&&clearTimeout(b);b=0},a;d&&8>d&&(p=function(){if(!a){var b=h.getEmptyIframeSrc();a=h.create("<iframe "+(b?'src="'+b+'"':"")+' style="display: none" height="0" width="0" tabindex="-1" title="empty"/>');
h.prepend(a,g.documentElement);c.add(a,"load",function(){c.remove(a,"load");o(i());c.add(a,"load",d);m()});g.onpropertychange=function(){try{"title"===event.propertyName&&(a.contentWindow.document.title=g.title+" - "+i())}catch(c){}};var d=function(){var b=e.trim(a.contentWindow.document.body.innerText),d=i();b!==d&&(j=location.hash=b);c.fireHandler(f,"hashchange")}}},q=function(){b&&clearTimeout(b);b=0;c.detach(a);h.remove(a);a=0});r.hashchange={setup:function(){if(this===f){j=i();p()}},tearDown:function(){this===
f&&q()}}});
KISSY.add("event/dom/focusin",["event/dom/base"],function(d,g){var e=g("event/dom/base"),h=e.Special;d.each([{name:"focusin",fix:"focus"},{name:"focusout",fix:"blur"}],function(c){function f(a){return e.fire(a.target,c.name)}var b=d.guid("attaches_"+d.now()+"_");h[c.name]={setup:function(){var a=this.ownerDocument||this;b in a||(a[b]=0);a[b]+=1;1===a[b]&&a.addEventListener(c.fix,f,!0)},tearDown:function(){var a=this.ownerDocument||this;a[b]-=1;0===a[b]&&a.removeEventListener(c.fix,f,!0)}}});return e});
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});KISSY.add("event/dom/touch/single-touch",[],function(e){function a(){}a.prototype={constructor:a,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!==this.requiredTouchCount)return!1;a=this.lastTouches=a.touches;this.lastXY={pageX:a[0].pageX,pageY:a[0].pageY}},onTouchMove:e.noop,onTouchEnd:e.noop};return a});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(d){d.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./single-touch"),k=i.Object;e.extend(h,f,{onTouchMove:function(d){var a=this.lastXY,d=d.changedTouches[0];if(!d||5<Math.abs(d.pageX-a.pageX)||5<Math.abs(d.pageY-a.pageY))return!1},onTouchEnd:function(d){var a=d.changedTouches[0],b=d.target,n=new k({type:"tap",
target:b,currentTarget:b});e.mix(n,{pageX:a.pageX,pageY:a.pageY,originalEvent:d.originalEvent,which:1,touch:a});i.fire(b,"tap",n);if(n.isDefaultPrevented())i.on(b,"click",{fn:c,once:1})}});g.tap={handle:new h};return h});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(b,a,f){var g=a.changedTouches[0],q=g.pageX-b.startX,m=g.pageY-b.startY,j=Math.abs(q),r=Math.abs(m);if(f){if(b.isVertical&&b.isHorizontal){if(5>Math.max(j,r))return;r>j?b.isHorizontal=0:b.isVertical=0}}else if(b.isVertical&&r<l&&(b.isVertical=0),b.isHorizontal&&j<l)b.isHorizontal=0;if(b.isHorizontal)q=0>q?"left":"right";else if(b.isVertical)q=0>m?"up":"down",j=r;else return!1;i.fire(a.target,
f?d:k,{originalEvent:a.originalEvent,pageX:g.pageX,pageY:g.pageY,which:1,touch:g,direction:q,distance:j,duration:(a.timeStamp-b.startTime)/1E3})}function h(){}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./single-touch"),k="swipe",d="swiping",l=50;e.extend(h,f,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var a=b.touches[0];this.startTime=b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=a.pageX;this.startY=a.pageY;-1!==b.type.indexOf("mouse")&&
b.preventDefault()},onTouchMove:function(b){var a=b.changedTouches[0],d=a.pageY-this.startY,a=Math.abs(a.pageX-this.startX),d=Math.abs(d);if(1E3<b.timeStamp-this.startTime)return!1;this.isVertical&&35<a&&(this.isVertical=0);this.isHorizontal&&35<d&&(this.isHorizontal=0);return c(this,b,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:c(this,a,0)}});g[k]=g[d]={handle:new h};return h});
KISSY.add("event/dom/touch/double-tap",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(){}var h=a("./handle-map"),g=a("event/dom/base"),i=a("./single-touch");e.extend(c,i,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var i=this.lastEndTime,d=a.timeStamp,e=a.target,
b=a.changedTouches[0],c=d-this.startTime;this.lastEndTime=d;if(i&&(c=d-i,300>c)){this.lastEndTime=0;g.fire(e,"doubleTap",{touch:b,duration:c/1E3});return}c=d-this.startTime;300<c?g.fire(e,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3}):this.singleTapTimer=setTimeout(function(){g.fire(e,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3})},300)}});h.singleTap=h.doubleTap={handle:new c};return c});
KISSY.add("event/dom/touch/multi-touch",["dom"],function(e,a){function c(){}var h=a("dom");c.prototype={constructor:c,requiredTouchCount:2,onTouchStart:function(a){var i=this.requiredTouchCount,c=a.touches.length;c===i?this.start():c>i&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:e.noop,getCommonTarget:function(a){var c=a.touches,a=c[0].target,c=c[1].target;if(a===c||h.contains(a,c))return a;for(;;){if(h.contains(c,
a))return c;c=c.parentNode}"getCommonTarget error!"},end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return c});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./multi-touch"],function(e,a){function c(){}function h(a){2===a.touches.length&&a.preventDefault()}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./multi-touch");e.extend(c,f,{onTouchMove:function(a){if(this.isTracking){var d=a.touches;if(0<d[0].pageX&&0<d[0].pageY&&0<d[1].pageX&&0<d[1].pageY){var c,b=d[0],f=d[1];c=b.pageX-f.pageX;b=b.pageY-f.pageY;c=Math.sqrt(c*c+b*b);this.lastTouches=d;this.isStarted?i.fire(this.target,"pinch",
e.mix(a,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,d=this.target=this.getCommonTarget(a),i.fire(d,"pinchStart",e.mix(a,{distance:c,scale:1})))}}},fireEnd:function(a){i.fire(this.target,"pinchEnd",e.mix(a,{touches:this.lastTouches}))}});f=new c;g.pinchStart=g.pinchEnd={handle:f};g.pinch={handle:f,setup:function(){i.on(this,"touchmove",h)},tearDown:function(){i.detach(this,"touchmove",h)}};return c});
KISSY.add("event/dom/touch/tap-hold",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(){}var h=a("./handle-map"),g=a("event/dom/base"),i=a("./single-touch");e.extend(c,i,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){var c=a.touches[0];g.fire(a.target,"tapHold",{touch:c,pageX:c.pageX,pageY:c.pageY,which:1,duration:(e.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},
onTouchEnd:function(){clearTimeout(this.timer)}});h.tapHold={handle:new c};return c});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./multi-touch"],function(e,a){function c(){}function h(a){2===a.touches.length&&a.preventDefault()}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./multi-touch"),k=180/Math.PI;e.extend(c,f,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,b=c[0],f=c[1],g=this.lastAngle,b=Math.atan2(f.pageY-b.pageY,f.pageX-b.pageX)*k;if(void 0!==g){var f=Math.abs(b-g),h=(b+360)%360,q=(b-360)%360;Math.abs(h-g)<f?b=h:Math.abs(q-g)<f&&
(b=q)}this.lastTouches=c;this.lastAngle=b;this.isStarted?i.fire(this.target,"rotate",e.mix(a,{angle:b,rotation:b-this.startAngle})):(this.isStarted=!0,this.startAngle=b,this.target=this.getCommonTarget(a),i.fire(this.target,"rotateStart",e.mix(a,{angle:b,rotation:0})))}},end:function(){this.lastAngle=void 0;c.superclass.end.apply(this,arguments)},fireEnd:function(a){i.fire(this.target,"rotateEnd",e.mix(a,{touches:this.lastTouches}))}});f=new c;g.rotateEnd=g.rotateStart={handle:f};g.rotate={handle:f,
setup:function(){i.on(this,"touchmove",h)},tearDown:function(){i.detach(this,"touchmove",h)}};return c});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(","),function(e,a){function c(a){return e.startsWith(a,"touch")}function h(a){return e.startsWith(a,"mouse")}function g(a){return e.startsWith(a,"MSPointer")||e.startsWith(a,"pointer")}function i(a){this.doc=a;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var f=a("dom"),k=a("./handle-map"),d=a("event/dom/base");a("./tap");a("./swipe");a("./double-tap");
a("./pinch");a("./tap-hold");a("./rotate");var l=e.guid("touch-handle"),b=e.Features,n,p,o;if(b.isTouchEventSupported())if(e.UA.ios){o="touchend touchcancel";n="touchstart";p="touchmove"}else{o="touchend touchcancel mouseup";n="touchstart mousedown";p="touchmove mousemove"}else if(b.isPointerSupported()){n="pointerdown";p="pointermove";o="pointerup pointercancel"}else if(b.isMsPointerSupported()){n="MSPointerDown";p="MSPointerMove";o="MSPointerUp MSPointerCancel"}else{n="mousedown";p="mousemove";
o="mouseup"}i.prototype={constructor:i,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;d.on(a,n,this.onTouchStart,this);if(!g(p))d.on(a,p,this.onTouchMove,this);d.on(a,o,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var m=0,c=a.pointerId,b=this.touches,d=b.length;m<d;m++){a=b[m];if(a.pointerId===c){b.splice(m,1);break}}},updateTouch:function(a){for(var c=0,j,b=a.pointerId,d=this.touches,e=d.length;c<e;c++){j=d[c];
j.pointerId===b&&(d[c]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var c=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var b={x:a.clientX,y:a.clientY};c.push(b);setTimeout(function(){var a=c.indexOf(b);a>-1&&c.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var c=
this.lastTouches,b=a.clientX,a=a.clientY,d=0,e=c.length,f;d<e&&(f=c[d]);d++){var g=Math.abs(b-f.x),h=Math.abs(a-f.y);if(g<=25&&h<=25)return true}return 0},normalize:function(a){var b=a.type,j;if(c(b)){j=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;if(j.length===1){a.which=1;a.pageX=j[0].pageX;a.pageY=j[0].pageY}return a}j=this.touches;b=!b.match(/(up|cancel)$/i);a.touches=b?j:[];a.targetTouches=b?j:[];a.changedTouches=j;return a},onTouchStart:function(a){var b,j;j=a.type;var e=this.eventHandle;
if(c(j)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(h(j)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(g(j)){this.addTouch(a.originalEvent);if(this.touches.length===1)d.on(this.doc,p,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(b in e){j=e[b].handle;j.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(h(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=
[a.originalEvent]}else if(g(b))this.updateTouch(a.originalEvent);else if(!c(b))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=this,j=a.type;if(!h(j)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(c(j)){b.dupMouse(a);e.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(h(j))b.touches=[];else if(g(j)){b.removeTouch(a.originalEvent);b.touches.length||d.detach(b.doc,p,b.onTouchMove,
b)}}},callEventHandle:function(a,b){var c=this.eventHandle,d,e,b=this.normalize(b);if(b.changedTouches.length){for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=k[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;
d.detach(a,n,this.onTouchStart,this);d.detach(a,p,this.onTouchMove,this);d.detach(a,o,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,b){var c=f.getDocument(a),d=f.data(c,l);d||f.data(c,l,d=new i(c));b&&d.addEventHandle(b)},removeDocumentHandle:function(a,b){var c=f.getDocument(a),d=f.data(c,l);if(d){b&&d.removeEventHandle(b);if(e.isEmptyObject(d.eventHandle)){d.destroy();f.removeData(c,l)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(e,a){function c(a){d.addDocumentHandle(this,a);k[a].setup.apply(this,arguments)}function h(a){d.removeDocumentHandle(this,a);k[a].tearDown.apply(this,arguments)}function g(a){d.addDocumentHandle(this,a)}function i(a){d.removeDocumentHandle(this,a)}var f=a("event/dom/base"),k=a("./touch/handle-map"),d=a("./touch/handle"),l=f.Gesture,b=l.start="KSPointerDown",n=l.move="KSPointerMove",p=l.end="KSPointerUp";
l.tap="tap";l.doubleTap="doubleTap";k[b]={handle:{isActive:1,onTouchStart:function(a){f.fire(a.target,b,a)}}};k[n]={handle:{isActive:1,onTouchMove:function(a){f.fire(a.target,n,a)}}};k[p]={handle:{isActive:1,onTouchEnd:function(a){f.fire(a.target,p,a)}}};var l=f.Special,o,q,m;for(q in k)o={},m=k[q],o.setup=m.setup?c:g,o.tearDown=m.tearDown?h:i,m.add&&(o.add=m.add),m.remove&&(o.remove=m.remove),l[q]=o});
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 


// ----------------------------- KISSY BIO 1.2 -----------------------------------
/*
kg/bio/1.2/type/ajax
kg/bio/1.2/index
*/

KISSY.add('kg/bio/1.2/type/ajax', ['base', 'json', 'io'], function(S, require) {
    var EMPTY = '', LOG_PREFIX = '[bio-ajax]: ';
	
	var base=require('base'),
		JSON=require('json'), IO=require('io');

    /**
     * @name AjaxType
     * @class ajax uploader
     * @constructor
     * @requires UploadType
     */
	var AjaxType = base.extend(/** @lends bio.prototype*/{
		constructor:function (config) {
            var self = this;
            AjaxType.superclass.constructor.call(self, config);
            self._setWithCredentials();
        },
		
		uploadToServer : function(file){

			var self = this, blobSize = self.get('blobSize');
            if(blobSize > 0){
                //chunked
                self._chunkedUpload(file);
            }else{
                self._fullUpload(file);
            }
            return self;
		},
		
        /**
         * upload
         * @param {File} fileData :
         * @return {AjaxType}
         */
        _fullUpload : function(file) {

			var self = this,
				ajaxConfig = self.get('ajaxConfig'),
				sFun = function(_datas){
					//upload success
					var result='';
					if(_datas){
						if(_datas && KISSY.isArray(_datas) && _datas.length>1){
							result = _datas[0];
						} else if(KISSY.isString(_datas)){
							result = _datas;
						}
					}

					result = self._processResponse(result);
					// done, fire success event
					self.fire(AjaxType.event.SUCCESS, result);
				},
				fFun = function(_datas, _pReason, _pIo){
					var _reason, _io;
					if(_datas && KISSY.isArray(_datas) && _datas.length>2){
						_reason = _datas[1];
						_io = _datas[2];
					} else {
						_reason = _pReason;
						_io = _pIo;
					}
					
					self._errorHandler(_io, _reason, file);
				};
			
            self._setFormData();
            
            self._addFileData(file);
            S.mix(ajaxConfig,{
                data:self.get('formData'),
                url:self.get('action'),
				beforeSend: function(_context, _io, _c){
					var nativeXhr = _context.getNativeXhr();
					nativeXhr.upload.addEventListener('progress', function(evt){
						self.fire(AjaxType.event.PROGRESS,  { 'loaded': evt['loaded'], 'total': evt['total'] });
					}, false);
				}
            });
			
			if(!ajaxConfig.async){
				S.mix(ajaxConfig,{
					success: sFun,
					error: fFun
				});
			}
			
            var ajax = new IO(ajaxConfig);
			if(ajaxConfig.async){
				ajax.then(sFun, fFun);
				self.set('ajax',ajax);
				return ajax;
			}else{
				self.set('ajax',false);
				return false;
			}
        },
		
		/**
         * chunked upload
         * @param file
         * @return {boolean}
         * @private
         */
        _chunkedUpload:function(file){
			
            var self = this;
            var ajaxConfig = self.get('ajaxConfig'),
				sFun = function(_datas){
					//upload success
					var result='';
					if(_datas){
						if(_datas && KISSY.isArray(_datas) && _datas.length>1){
							result = _datas[0];
						} else if(KISSY.isString(_datas)){
							result = _datas;
						}
					}

					result = self._processResponse(result);
					// done, fire success event
					self.fire(AjaxType.event.SUCCESS, result);
				},
				fFun = function(_datas, _pReason, _pIo){
					var _reason, _io;
					if(_datas && KISSY.isArray(_datas) && _datas.length>2){
						_reason = _datas[1];
						_io = _datas[2];
					} else {
						_reason = _pReason;
						_io = _pIo;
					}
					
					self._errorHandler(_io, _reason, file);
				};
				
            S.mix(ajaxConfig,{
                url:self.get('action')
            });

            var size = file.size;
            //
            var uploadedBytes = 0;
            var maxChunkSize = self.get('blobSize') || size;
            //data slice, (browser difference)
            var slice = file.slice || file.webkitSlice || file.mozSlice;
            function funUpload(bFirst){
                //make chunk, set maxChunkSize-uploadedBytes
                var blob = slice.call(
                    file,
                    uploadedBytes,
                    uploadedBytes + maxChunkSize,
                    file.type
                );
                //
                var chunkSize = blob.size;

                //set header
                //self._setContentDisposition(file.name);
                self._setContentRange(uploadedBytes, chunkSize, size);

                //
				self._setFormData();
				
				if(bFirst){
					self.set('data', []);
				}
				
				blob.name = file.name;
				self._addFileData(blob);
				
				S.mix(ajaxConfig,{
					data:self.get('formData')
				});
				
				var ajax = new IO(ajaxConfig);
				ajax.then(function(data){
					//upload success
					//
					uploadedBytes = self._getUploadedBytes(ajax) || uploadedBytes + chunkSize;
					//fire processing event
					self.fire(AjaxType.event.PROGRESS, { 'loaded': uploadedBytes, 'total': size });
					
					//go on
					if(uploadedBytes< size){
						funUpload(false);
					}else{
						//done, fire success event
						sFun(data);
					}
				}, fFun);
				
            }

            funUpload(true);
        },
        /**
         * abort
         * @return {AjaxType}
         */
        abort : function() {
            var self = this,ajax = self.get('ajax');
            if (!S.isObject(ajax)) {
                S.log(LOG_PREFIX + 'abort(), the value of io invalid!');
                return self;
            }
            ajax.abort();
			self.set('ajax',false);
            return self;
        },
		
		
        /**
         * cross domain, set cookies
         * @private
         */
        _setWithCredentials:function(){
            var self = this;
            var CORS = self.get('CORS');
            var ajaxConfig = self.get('ajaxConfig');
            S.mix(ajaxConfig,{xhrFields: {
                withCredentials: false
            }});
            return ajaxConfig;
        },
		
        /**
         * set FormData
         */
        _setFormData:function(){

			var self = this,data = self.get('data'),
				formData = new FormData();
            try{
				S.each(data, function(v, k) {
					formData.append(k, v);
				});
				self.set('formData', formData);
            }catch(e){
                S.log(LOG_PREFIX + 'something error when reset FormData.');
            }
        },
		
		/**
         * set header
         * @param name : header name
         * @param value : header value
         * @private
         */
        setRequestHeader:function(name,value){
            var self = this;
            var ajaxConfig = self.get('ajaxConfig');
            ajaxConfig.headers[name] = value;
            self.set('ajaxConfig',ajaxConfig);
            return value;
        },
		
        /**
         * 
         * @param {Object} file :
         */
        _addFileData : function(file) {
            if (!S.isObject(file)) {
                S.log(LOG_PREFIX + '_addFileData(), file parameter invalid!');
                return false;
            }
            var self = this;
            var formData = self.get('formData');
            var fileName = file.name, remoteFilename = file.remoteFilename;
			if(!remoteFilename)
				remoteFilename = 'RemoteFile';
            formData.append(remoteFilename, file, fileName);
            self.set('formData', formData);
            return formData;
        },

        /**
		 * dataArray: [unused, statusText, _io]
         * ajax error {'status':'','result':''}
         * @private
         */
        _errorHandler:function(_io, failedReason, srcFile){
            var self = this,
				status = AjaxType.status.ERROR,
				result = {'status':status, 'msg':failedReason, 'response':false};
			
			if(_io){
				result['httpStatus'] = _io.status;
				result.response = _io.responseText;
			}
			
            self.fire(status, result);
        },
		
		/**
         * get sent bytes from 'range header' which server returned
         * @param ajax
         * @return {String}
         * @private
         */
        _getUploadedBytes:function(ajax){
            //get Range
            var range = ajax.getResponseHeader('Range');
            var parts = range && range.split('-');
            var upperBytesPos = parts && parts.length > 1 && parseInt(parts[1], 10);
            return upperBytesPos && upperBytesPos + 1;
        },
		/**
         * set Content-Range
         * @param uploadedBytes :
         * @param chunkSize :
         * @param size :
         * @return {string}
         * @private
         */
        _setContentRange:function(uploadedBytes,chunkSize,size){
            //format:  Content-Range: bytes (unitSPfirst byte pos) - [last byte pos]/[entity legth]
            //e.g.:    Content-Range: bytes 123-456/801 //file start from 0, the bytes value is (size-1) here
            var contentRange = 'bytes ' + uploadedBytes + '-' + (uploadedBytes + chunkSize - 1) + '/' + size;
            var self = this;
            var ajaxConfig = self.get('ajaxConfig');
            var headers= ajaxConfig.headers;
            headers['Content-Range'] = contentRange;
            return contentRange;
        },
	
		/**
         * Response
         * @param responseText : the text string from server
         * @private
		 * fire event: {'status':'','msg':false,'json':false,'response':''}
         */
        _processResponse:function(responseText){
            var self = this, result, i, ch, bFound = false, message = responseText,
				SUC = AjaxType.status.SUCCESS, ERR = AjaxType.event.ERROR;
			
            S.log('Response from server: ' + responseText);
			
			if(S.isUndefined(responseText) || responseText === ''){
				result = {'status':SUC,'msg':false,'json':false,'response':''};
			} else if(S.isString(responseText)){
                try{
					
					for(i=0; i<responseText.length; i++){
						if(i>10){
							break;
						}
						
						ch = responseText[i];
						if(ch == '{'){
							bFound = true;
							break;
						} else if(ch == ' ' || ch == '\r' || ch == '\n' || ch == '\t'){
							// continue
						} else {
							break;
						}
					}
					if(bFound){
						var responseJson = JSON.parse(responseText);
						if(responseJson.status == 1){
							// OK
							result = {'status':SUC,'msg':false,'json':responseJson,'response':responseText};
						} else {
							result = {'status':ERR,'msg':false,'json':responseJson,'response':responseText};
						}
					}
                }catch(e){
					bFound = false;
                    S.log(e);
                }
				
				if(!bFound){
					var _r = new String(responseText);
					_r = _r.replace(/( |\t|\r|\n)/g,'');
					if(_r == '')
						result = {'status':SUC,'msg':false,'json':false,'response':responseText};
					else
						result = {'status':ERR,'msg':false,'json':false,'response':responseText};
				}
				
            } else {
				result = {'status':SUC,'msg':false,'json':false,'response':''};
			}
            return result;
        }
    }, {ATTRS : /** @lends AjaxType*/{
        action : {value : EMPTY},
		/**
		 * the data for upload
		 */
        data : {value : {}},
		/**
		 * send the data for chunked upload always
		 * true: always, false : only first time
		 */
        bChunkedSendData : {value : true},
				
		/**
		 * make the data chunked for upload
		 */
		blobSize:{value:0},
		
		/**
		 * ajax config
		 */
		ajaxConfig : {'value' : {
				'type': 'post',
				'processData': false,
				'cache': false,
				'dataType': 'text',
				'async': true,
				'contentType': false,
				'headers': {
					'X-Requested-With': false
				}
			}
		},
        /**
         * IO instance
         */
        ajax : {value : EMPTY},
        /**
         * formData instance
         */		
		formData : {value : EMPTY},
        /**
         * CROSS domain
         */
        CORS:{value : false}
    }
    });
	
	S.mix(AjaxType, /** @lends AjaxType*/{

		event:{
            SUCCESS:'success',
            ERROR:'error',
            PROGRESS:'progress'
        },
		status : {
            SUCCESS : 'success',
            ERROR : 'error'
		}
	
	});
	
	return AjaxType;
});

KISSY.add('kg/bio/1.2/base', ['base', './type/ajax'], function (S, require) {
	var EMPTY='', LOG_PREFIX = '[bio]: ';

	//AjaxType
	var base=require('base'),
		AjaxType=require('./type/ajax');

    var win = S.Env.host,
        FormData = win.FormData;

	// isSupportAjax
	var ret = false;
	try {
		if (FormData) ret = true;
	} catch (e) {
	}
	
	if(!FormData){
		S.log(LOG_PREFIX + 'the browser does not support ajax.');
		return {};
	}

    /**
     * @name AjaxType
     * @class ajax uploader
     * @constructor
     * @requires UploadType
     */
	var BIO = base.extend(/** @lends bio.prototype*/{
		constructor:function (config) {
            var self = this;
            BIO.superclass.constructor.call(self, config);
            self._init();
        },
		
		upload:function (file) {

			if (!S.isObject(file)) {
                S.log(LOG_PREFIX + 'upload() the parameter "file" invalid!');
                return false;
            }
			
            var self = this, uploadType = self.get('uploadType');

			if (!file.size) file.size = 0;
			
			//chrome is fileName, firefox is name
			if (!file.name) file.name = file.fileName || EMPTY;
            if (!file.id) file.id = S.guid('file-');
            if (file.size) file.textSize = self._convertByteSize(file.size);

            uploadType.uploadToServer(file);

        },
		
		abort: function(){
            var self = this, uploadType = self.get('uploadType');
			uploadType.abort();
			return true;
		},

		setRequestHeader: function(name,value){
            var self = this, uploadType = self.get('uploadType');
			uploadType.setRequestHeader(name,value);
		},
		
		/**
		 * 
		 * @param {Number} bytes : input file sizes
		 * @return {String} filesize
		 */
		_convertByteSize: function (bytes) {
			var i = -1;
			do {
				bytes = bytes / 1024;
				i++;
			} while (bytes > 99 && i<4);
			return Math.max(bytes, 0.1).toFixed(1) + ['KB', 'MB', 'GB', 'TB'][i];
		},
		
        /**
         * @return {base}
         */
        _init:function(){
		
			var self = this;
            
            var serverConfig = {
					action:self.get('action'),
					data:self.get('data'),
					CORS: self.get('CORS')
				},
				uploadType = new AjaxType(serverConfig);

			var ajaxConfig = uploadType.get('ajaxConfig');
			if(ajaxConfig){
				ajaxConfig.dataType = self.get('dataType');
				ajaxConfig.async = self.get('async');
			}
            
			// event after upload
            uploadType.on(AjaxType.event.SUCCESS, self._uploadCompleteHandler, self);
            uploadType.on(AjaxType.event.ERROR, self._uploadCompleteHandler, self);
            
			// event uploading
            uploadType.on(AjaxType.event.PROGRESS, self._uploadProgressHandler, self);
            
            self.set('uploadType', uploadType);
            return uploadType;
        },
        /**
         * 
         */
        _uploadProgressHandler:function (ev) {
            var self = this;
            self.fire(BIO.event.PROGRESS, ev);
        },

		/**
         * upload complete
		 * @param {Object} param : {'status':'','msg':false,'json':false,'response':''}
         */
        _uploadCompleteHandler:function (param) {
            var self = this, 
				status = param.status, 
				msg = param.msg,
                curFile = self.get('file');
			
			S.mix(param, {
				'file':curFile
			});
			
            if (status === 'success') {
				// {'status':'','msg':false,'json':false,'response':'','file':''}
                self.fire(BIO.event.SUCCESS, param);
            } else {
				
				if(msg === false){
					// upload success but response something from server
					
				} else if(msg === 'abort'){
					
					S.mix(param, {
						'canceled':true
					});
					
				} else if(msg === 'timeout'){
					
					S.mix(param, {
						'timeout':true
					});
					
				}
				
				// {'status':'','msg':false,'json':false,'response':'','file':'', 'canceled': false, 'timeout': false}
                self.fire(BIO.event.ERROR, param);
            }
        }

	},{
		ATTRS:{
			action:{value:EMPTY},
			
			timeout:{value:0},	// seconds
			CORS:{value:false},
			async:{value:true},
			dataType:{value:'text'},
			fileStatus:{value:EMPTY},
			
			uploadType:{value:{}},
			data:{value:{}}
		}
	}, 'bio');
	
	
	S.mix(BIO, /** @lends BIO*/{

		event:{
            SUCCESS:'success',
            ERROR:'error',
            PROGRESS:'progress'
        }
	
	});
	
	return BIO;
});



KISSY.add('kg/bio/1.2/index',function(S,BIO){

	return BIO;

},{
	requires:['./base']	
});


// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 

/// ICAP_PIXELTYPE values (PT_ means Pixel Type)
var EnumDWT_PixelType = {
    TWPT_BW: 0,
    TWPT_GRAY: 1,
    TWPT_RGB: 2,
    TWPT_PALLETE: 3,
    TWPT_CMY: 4,
    TWPT_CMYK: 5,
    TWPT_YUV: 6,
    TWPT_YUVK: 7,
    TWPT_CIEXYZ: 8,
    TWPT_LAB: 9,
    TWPT_SRGB: 10,
    TWPT_SCRGB: 11,
    TWPT_INFRARED: 16
};

var EnumDWT_BorderStyle = {
  /// No border.
  TWBS_NONE: 0,
  /// Flat border.
  TWBS_SINGLEFLAT: 1,
  /// 3D border.  
  TWBS_SINGLE3D: 2
};

/// For query the operation that are supported by the data source on a capability .
/// Application gets these through DG_CONTROL/DAT_CAPABILITY/MSG_QUERYSUPPORT
var EnumDWT_MessageType = {
    TWQC_GET: 1,
    TWQC_SET: 2,
    TWQC_GETDEFAULT: 4,
    TWQC_GETCURRENT: 8,
    TWQC_RESET: 16
};

/// Capabilities
var EnumDWT_Cap = {
    /// Nothing.
    CAP_NONE: 0,
    /// The application is willing to accept this number of images.
    CAP_XFERCOUNT: 1,
    /// Allows the application and Source to identify which compression schemes they have in
    /// common for Buffered Memory and File transfers.
    /// Note for File transfers:
    /// Since only certain file formats support compression, this capability must be negotiated after
    /// setting the desired file format with ICAP_IMAGEFILEFORMAT.
    ICAP_COMPRESSION: 256,
    /// The type of pixel data that a Source is capable of acquiring (for example, black and white, gray, RGB, etc.).
    ICAP_PIXELTYPE: 257,
    /// Unless a quantity is dimensionless or uses a specified unit of measure, ICAP_UNITS determines
    /// the unit of measure for all quantities.
    ICAP_UNITS: 258,
    /// Allows the application and Source to identify which transfer mechanisms the source supports.
    ICAP_XFERMECH: 259,
    /// The name or other identifying information about the Author of the image. It may include a copyright string.
    CAP_AUTHOR: 4096,
    /// A general note about the acquired image.
    CAP_CAPTION: 4097,
    /// If TRUE, Source must acquire data from the document feeder acquire area and other feeder 
    /// capabilities can be used. If FALSE, Source must acquire data from the non-feeder acquire area 
    /// and no other feeder capabilities can be used.
    CAP_FEEDERENABLED: 4098,
    /// Reflect whether there are documents loaded in the Source's feeder.
    CAP_FEEDERLOADED: 4099,
    /// The date and time the image was acquired.
    /// Stored in the form "YYYY/MM/DD HH:mm:SS.sss" where YYYY is the year, MM is the 
    /// numerical month, DD is the numerical day, HH is the hour, mm is the minute, SS is the second, 
    /// and sss is the millisecond.
    CAP_TIMEDATE: 4100,
    /// Returns a list of all the capabilities for which the Source will answer inquiries. Does not indicate
    /// which capabilities the Source will allow to be set by the application. Some capabilities can only
    /// be set if certain setup work has been done so the Source cannot globally answer which
    /// capabilities are "set-able."
    CAP_SUPPORTEDCAPS: 4101,
    /// Allows the application and Source to negotiate capabilities to be used in States 5 and 6.
    CAP_EXTENDEDCAPS: 4102,
    /// If TRUE, the Source will automatically feed the next page from the document feeder after the
    /// number of frames negotiated for capture from each page are acquired. CAP_FEEDERENABLED
    /// must be TRUE to use this capability.
    CAP_AUTOFEED: 4103,
    /// If TRUE, the Source will eject the current page being acquired from and will leave the feeder
    /// acquire area empty.
    /// If CAP_AUTOFEED is TRUE, a fresh page will be advanced.
    /// CAP_FEEDERENABLED must equal TRUE to use this capability.
    /// This capability must have been negotiated as an extended capability to be used in States 5 and 6.
    CAP_CLEARPAGE: 4104,
    /// If TRUE, the Source will eject the current page and advance the next page in the document feeder
    /// into the feeder acquire area.
    /// If CAP_AUTOFEED is TRUE, the same action just described will occur and CAP_AUTOFEED will
    /// remain active.
    /// CAP_FEEDERENABLED must equal TRUE to use this capability.
    /// This capability must have been negotiated as an extended capability to be used in States 5 and 6.
    CAP_FEEDPAGE: 4105,
    /// If TRUE, the Source will return the current page to the input side of the document feeder and
    /// feed the last page from the output side of the feeder back into the acquisition area.
    /// If CAP_AUTOFEED is TRUE, automatic feeding will continue after all negotiated frames from this
    /// page are acquired.
    /// CAP_FEEDERENABLED must equal TRUE to use this capability.
    /// This capability must have been negotiated as an extended capability to be used in States 5 and 6.
    CAP_REWINDPAGE: 4106,
    /// If TRUE, the Source will display a progress indicator during acquisition and transfer, regardless
    /// of whether the Source's user interface is active. If FALSE, the progress indicator will be
    /// suppressed if the Source's user interface is inactive.
    /// The Source will continue to display device-specific instructions and error messages even with
    /// the Source user interface and progress indicators turned off.
    CAP_INDICATORS: 4107,
    /// Returns a list of all the capabilities for which the Source will answer inquiries. Does not indicate
    /// which capabilities the Source will allow to be set by the application. Some capabilities can only
    /// be set if certain setup work has been done so the Source cannot globally answer which
    /// capabilities are "set-able."
    CAP_SUPPORTEDCAPSEXT: 4108,
    /// This capability determines whether the device has a paper sensor that can detect documents on the ADF or Flatbed.
    CAP_PAPERDETECTABLE: 4109,
    /// If TRUE, indicates that this Source supports acquisition with the UI disabled; i.e.,
    /// TW_USERINTERFACE's ShowUI field can be set to FALSE. If FALSE, indicates that this Source
    /// can only support acquisition with the UI enabled.
    CAP_UICONTROLLABLE: 4110,
    /// If TRUE, the physical hardware (e.g., scanner, digital camera, image database, etc.) that
    /// represents the image source is attached, powered on, and communicating.
    CAP_DEVICEONLINE: 4111,
    /// This capability is intended to boost the performance of a Source. The fundamental assumption
    /// behind AutoScan is that the device is able to capture the number of images indicated by the
    /// value of CAP_XFERCOUNT without waiting for the Application to request the image transfers.
    /// This is only possible if the device has internal buffers capable of caching the images it captures.
    /// The default behavior is undefined, because some high volume devices are incapable of anything
    /// but CAP_AUTOSCAN being equal to TRUE. However, if a Source supports FALSE, it should use it
    /// as the mandatory default, since this best describes the behavior of pre-1.8 TWAIN Applications.
    CAP_AUTOSCAN: 4112,
    /// Allows an application to request the delivery of thumbnail representations for the set of images
    /// that are to be delivered.
    /// Setting CAP_THUMBNAILSENABLED to TRUE turns on thumbnail mode. Images transferred
    /// thereafter will be sent at thumbnail size (exact thumbnail size is determined by the Data Source).
    /// Setting this capability to FALSE turns thumbnail mode off and returns full size images.
    CAP_THUMBNAILSENABLED: 4113,
    /// This indicates whether the scanner supports duplex. If so, it further indicates whether one-path
    /// or two-path duplex is supported.
    CAP_DUPLEX: 4114,
    /// The user can set the duplex option to be TRUE or FALSE. If TRUE, the scanner scans both sides
    /// of a paper; otherwise, the scanner will scan only one side of the image.
    CAP_DUPLEXENABLED: 4115,
    /// Allows an application to query a source to see if it implements the new user interface settings dialog. 
    CAP_ENABLEDSUIONLY: 4116,
    CAP_CUSTOMDSDATA: 4117,
    /// Allows the application to specify the starting endorser / imprinter number. All other endorser/
    /// imprinter properties should be handled through the data source's user interface.
    /// The user can set the starting number for the endorser.
    CAP_ENDORSER: 4118,
    /// Turns specific audible alarms on and off.
    CAP_ALARMS: 4120,
    /// The volume of a device's audible alarm. Note that this control affects the volume of all alarms;
    /// no specific volume control for individual types of alarms is provided.
    CAP_ALARMVOLUME: 4121,
    /// The number of images to automatically capture. This does not refer to the number of images to
    /// be sent to the Application, use CAP_XFERCOUNT for that.
    CAP_AUTOMATICCAPTURE: 4122,
    /// For automatic capture, this value selects the number of milliseconds before the first picture is to
    /// be taken, or the first image is to be scanned.
    CAP_TIMEBEFOREFIRSTCAPTURE: 4123,
    /// For automatic capture, this value selects the milliseconds to wait between pictures taken, or images scanned.
    CAP_TIMEBETWEENCAPTURES: 4124,
    /// CapGet() reports the presence of data in the scanner's buffers. CapSet() with a value of TWCB_CLEAR immediately clears the buffers.
    CAP_CLEARBUFFERS: 4125,
    /// Describes the number of pages that the scanner can buffer when CAP_AUTOSCAN is enabled.
    CAP_MAXBATCHBUFFERS: 4126,
    /// The date and time of the device's clock.
    /// Managed in the form "YYYY/MM/DD HH:mm:SS:sss" where YYYY is the year, MM is the
    /// numerical month, DD is the numerical day, HH is the hour, mm is the minute, SS is the second,
    /// and sss is the millisecond.
    CAP_DEVICETIMEDATE: 4127,
    /// CapGet() reports the kinds of power available to the device. CapGetCurrent() reports the current power supply in use.
    CAP_POWERSUPPLY: 4128,
    /// This capability queries the Source for UI support for preview mode. If TRUE, the Source supports preview UI.
    CAP_CAMERAPREVIEWUI: 4129,
    /// A string containing the serial number of the currently selected device in the Source. Multiple
    /// devices may all report the same serial number.
    CAP_SERIALNUMBER: 4132,
    /// CapGet() returns the current list of available printer devices, along with the one currently being used for negotiation. 
    /// CapSet() selects the current device for negotiation, and optionally constrains the list.
    /// Top/Bottom refers to duplex devices, and indicates if the printer is writing on the top or the bottom of the sheet of paper. 
    /// Simplex devices use the top settings. Before/After indicates whether printing occurs before or after the sheet of paper has been scanned.
    CAP_PRINTER: 4134,
    /// Turns the current CAP_PRINTER device on or off.
    CAP_PRINTERENABLED: 4135,
    /// The User can set the starting number for the current CAP_PRINTER device.
    CAP_PRINTERINDEX: 4136,
    /// Specifies the appropriate current CAP_PRINTER device mode.
    /// Note:
    ///  TWPM_SINGLESTRING specifies that the printed text will consist of a single string.
    ///  TWPM _MULTISTRING specifies that the printed text will consist of an enumerated list of
    /// strings to be printed in order.
    ///  TWPM _COMPOUNDSTRING specifies that the printed string will consist of a compound of a
    /// String followed by a value followed by a suffix string.
    CAP_PRINTERMODE: 4137,
    /// Specifies the string(s) that are to be used in the string component when the current
    /// CAP_PRINTER device is enabled.
    CAP_PRINTERSTRING: 4138,
    /// Specifies the string that shall be used as the current CAP_PRINTER device's suffix.
    CAP_PRINTERSUFFIX: 4139,
    /// Allows Application and Source to identify which languages they have in common for the exchange of string data, 
    /// and to select the language of the internal UI. Since the TWLG_xxxx codes include language and country data, there is no separate 
    /// capability for selecting the country.
    CAP_LANGUAGE: 4140,
    /// Helps the Application determine any special actions it may need to take when negotiating
    /// frames with the Source. Allowed values are listed in <see cref="TWCapFeederAlignment"/>.
    /// TWFA_NONE: The alignment is free-floating. Applications should assume
    /// that the origin for frames is on the left.
    /// TWFA_LEFT: The alignment is to the left.
    /// TWFA_CENTER: The alignment is centered. This means that the paper will
    /// be fed in the middle of the ICAP_PHYSICALWIDTH of the
    /// device. If this is set, then the Application should calculate
    /// any frames with a left offset of zero.
    /// TWFA_RIGHT: The alignment is to the right.
    CAP_FEEDERALIGNMENT: 4141,
    /// TWFO_FIRSTPAGEFIRST if the feeder starts with the top of the first page.
    /// TWFO_LASTPAGEFIRST is the feeder starts with the top of the last page.
    CAP_FEEDERORDER: 4142,
    /// Indicates whether the physical hardware (e.g. scanner, digital camera) is capable of acquiring
    /// multiple images of the same page without changes to the physical registration of that page.
    CAP_REACQUIREALLOWED: 4144,
    /// The minutes of battery power remaining to the device.
    CAP_BATTERYMINUTES: 4146,
    /// When used with CapGet(), return the percentage of battery power level on camera. If -1 is returned, it indicates that the battery is not present. 
    CAP_BATTERYPERCENTAGE: 4147,
    /// Added 1.91 
    CAP_CAMERASIDE: 4148,
    /// Added 1.91  
    CAP_SEGMENTED: 4149,  
    /// Added 2.0 
    CAP_CAMERAENABLED: 4150,
    /// Added 2.0   
    CAP_CAMERAORDER: 4151, 
    /// Added 2.0 
    CAP_MICRENABLED: 4152, 
    /// Added 2.0  
    CAP_FEEDERPREP: 4153,  
    /// Added 2.0 
    CAP_FEEDERPOCKET: 4154,  
    /// Added 2.1 
    CAP_AUTOMATICSENSEMEDIUM: 4155,
    /// Added 2.1 
    CAP_CUSTOMINTERFACEGUID: 4156, 
    /// TRUE enables and FALSE disables the Source's Auto-brightness function (if any).
    ICAP_AUTOBRIGHT: 4352,
    /// The brightness values available within the Source.
    ICAP_BRIGHTNESS: 4353,
    /// The contrast values available within the Source.
    ICAP_CONTRAST: 4355,
    /// Specifies the square-cell halftone (dithering) matrix the Source should use to halftone the image.
    ICAP_CUSTHALFTONE: 4356,
    /// Specifies the exposure time used to capture the image, in seconds.
    ICAP_EXPOSURETIME: 4357,
    /// Describes the color characteristic of the subtractive filter applied to the image data. Multiple
    /// filters may be applied to a single acquisition.
    ICAP_FILTER: 4358,
    /// Specifies whether or not the image was acquired using a flash.
    ICAP_FLASHUSED: 4359,
    /// Gamma correction value for the image data.
    ICAP_GAMMA: 4360,
    /// A list of names of the halftone patterns available within the Source.
    ICAP_HALFTONES: 4361,
    /// Specifies which value in an image should be interpreted as the lightest "highlight." All values
    /// "lighter" than this value will be clipped to this value. Whether lighter values are smaller or
    /// larger can be determined by examining the Current value of ICAP_PIXELFLAVOR.
    ICAP_HIGHLIGHT: 4362,
    /// Informs the application which file formats the Source can generate (CapGet()). Tells the Source which file formats the application can handle (CapSet()).
    /// TWFF_TIFF Used for document 
    /// TWFF_PICT Native Macintosh 
    /// TWFF_BMP Native Microsoft 
    /// TWFF_XBM Used for document 
    /// TWFF_JFIF Wrapper for JPEG 
    /// TWFF_FPX FlashPix, used with digital 
    /// TWFF_TIFFMULTI Multi-page TIFF files
    /// TWFF_PNG An image format standard intended for use on the web, replaces GIF
    /// TWFF_SPIFF A standard from JPEG, intended to replace JFIF, also supports JBIG
    /// TWFF_EXIF File format for use with digital cameras. 
    ICAP_IMAGEFILEFORMAT: 4364,
    /// TRUE means the lamp is currently, or should be set to ON. Sources may not support CapSet() operations. 
    ICAP_LAMPSTATE: 4365,
    /// Describes the general color characteristic of the light source used to acquire the image.
    ICAP_LIGHTSOURCE: 4366,
    /// Defines which edge of the "paper" the image's "top" is aligned with. This information is used to adjust the frames to match the 
    /// scanning orientation of the paper. For instance, if an ICAP_SUPPORTEDSIZE of TWSS_ISOA4 has been negotiated, 
    /// and ICAP_ORIENTATION is set to TWOR_LANDSCAPE, then the Source must rotate the frame it downloads to the scanner to reflect the 
    /// orientation of the paper. Please note that setting ICAP_ORIENTATION does not affect the values reported by ICAP_FRAMES; 
    /// it just causes the Source to use them in a different way. The upper-left of the image is defined as the location where both the primary and 
    /// secondary scans originate. (The X axis is the primary scan direction and the Y axis is the secondary scan direction.)
    /// For a flatbed scanner, the light bar moves in the secondary scan direction. For a handheld scanner, the scanner is drug in the 
    /// secondary scan direction. For a digital camera, the secondary direction is the vertical axis when the viewed image is considered upright. 
    ICAP_ORIENTATION: 4368,
    /// The maximum physical width (X-axis) the Source can acquire (measured in units of ICAP_UNITS).
    ICAP_PHYSICALWIDTH: 4369,
    /// The maximum physical height (Y-axis) the Source can acquire (measured in units of ICAP_UNITS).
    ICAP_PHYSICALHEIGHT: 4370,
    /// Specifies which value in an image should be interpreted as the darkest "shadow." All values 
    /// "darker" than this value will be clipped to this value.
    ICAP_SHADOW: 4371,
    /// The list of frames the Source will acquire on each page.
    ICAP_FRAMES: 4372,
    /// The native optical resolution along the X-axis of the device being controlled by the Source. Most
    /// devices will respond with a single value (TW_ONEVALUE).
    /// This is NOT a list of all resolutions that can be generated by the device. Rather, this is the
    /// resolution of the device's optics. Measured in units of pixels per unit as defined by
    /// ICAP_UNITS (pixels per TWUN_PIXELS yields dimensionless data).
    ICAP_XNATIVERESOLUTION: 4374,
    /// The native optical resolution along the Y-axis of the device being controlled by the Source.
    /// Measured in units of pixels per unit as defined by ICAP_UNITS (pixels per TWUN_PIXELS
    /// yields dimensionless data).
    ICAP_YNATIVERESOLUTION: 4375,
    /// All the X-axis resolutions the Source can provide.
    /// Measured in units of pixels per unit as defined by ICAP_UNITS (pixels per TWUN_PIXELS
    /// yields dimensionless data). That is, when the units are TWUN_PIXELS, both
    /// ICAP_XRESOLUTION and ICAP_YRESOLUTION shall report 1 pixel/pixel. Some data sources
    /// like to report the actual number of pixels that the device reports, but that response is more
    /// appropriate in ICAP_PHYSICALHEIGHT and ICAP_PHYSICALWIDTH.
    ICAP_XRESOLUTION: 4376,
    /// All the Y-axis resolutions the Source can provide.
    /// Measured in units of pixels per unit as defined by ICAP_UNITS (pixels per TWUN_PIXELS
    /// yields dimensionless data). That is, when the units are TWUN_PIXELS, both
    /// ICAP_XRESOLUTION and ICAP_YRESOLUTION shall report 1 pixel/pixel. Some data sources
    /// like to report the actual number of pixels that the device reports, but that response is more
    /// appropriate in ICAP_PHYSICALHEIGHT and ICAP_PHYSICALWIDTH.
    ICAP_YRESOLUTION: 4377,
    /// The maximum number of frames the Source can provide or the application can accept per page. 
    /// This is a bounding capability only. It does not establish current or future behavior.
    ICAP_MAXFRAMES: 4378,
    /// This is used with buffered memory transfers. If TRUE, Source can provide application with tiled image data.
    ICAP_TILES: 4379,
    /// Specifies how the bytes in an image are filled by the Source. TWBO_MSBFIRST indicates that the leftmost bit in the byte (usually bit 7) is 
    /// the byte's Most Significant Bit.
    ICAP_BITORDER: 4380,
    /// Used for CCITT Group 3 2-dimensional compression. The 'K' factor indicates how often the
    /// new compression baseline should be re-established. A value of 2 or 4 is common in facsimile
    /// communication. A value of zero in this field will indicate an infinite K factorthe baseline is
    /// only calculated at the beginning of the transfer.
    ICAP_CCITTKFACTOR: 4381,
    /// Describes whether the image was captured transmissively or reflectively.
    ICAP_LIGHTPATH: 4382,
    /// Sense of the pixel whose numeric value is zero (minimum data value). 
    ICAP_PIXELFLAVOR: 4383,
    /// Allows the application and Source to identify which color data formats are available. There are
    /// two options, "planar" and "chunky."
    ICAP_PLANARCHUNKY: 4384,
    /// How the Source can/should rotate the scanned image data prior to transfer. This doesn't use
    /// ICAP_UNITS. It is always measured in degrees. Any applied value is additive with any
    /// rotation specified in ICAP_ORIENTATION.
    ICAP_ROTATION: 4385,
    /// For devices that support fixed frame sizes. 
    /// Defined sizes match typical page sizes. This specifies the size(s) the Source can/should use to acquire image data. 
    ICAP_SUPPORTEDSIZES: 4386,
    /// Specifies the dividing line between black and white. This is the value the Source will use to
    /// threshold, if needed, when ICAP_PIXELTYPE:TWPT_BW.
    /// The value is normalized so there are no units of measure associated with this ICAP.
    ICAP_THRESHOLD: 4387,
    /// All the X-axis scaling values available. A value of '1.0' is equivalent to 100% scaling. Do not use values less than or equal to zero.
    ICAP_XSCALING: 4388,
    /// All the Y-axis scaling values available. A value of '1.0' is equivalent to 100% scaling. Do not use values less than or equal to zero. 
    /// There are no units inherent with this data as it is normalized to 1.0 being "unscaled."
    ICAP_YSCALING: 4389,
    /// Used for CCITT data compression only. Indicates the bit order representation of the stored compressed codes.
    ICAP_BITORDERCODES: 4390,
    /// Used only for CCITT data compression. Specifies whether the compressed codes' pixel "sense" 
    /// will be inverted from the Current value of ICAP_PIXELFLAVOR prior to transfer.
    ICAP_PIXELFLAVORCODES: 4391,
    /// Allows the application and Source to agree upon a common set of color descriptors that are 
    /// made available by the Source. This ICAP is only useful for JPEG-compressed buffered memory image transfers.
    ICAP_JPEGPIXELTYPE: 4392,
    /// Used only with CCITT data compression. Specifies the minimum number of words of compressed codes (compressed data) to be transmitted per line.
    ICAP_TIMEFILL: 4394,
    /// Specifies the pixel bit depths for the Current value of ICAP_PIXELTYPE. For example, when
    /// using ICAP_PIXELTYPE:TWPT_GRAY, this capability specifies whether this is 8-bit gray or 4-bit gray.
    /// This depth applies to all the data channels (for instance, the R, G, and B channels will all have
    /// this same bit depth for RGB data).
    ICAP_BITDEPTH: 4395,
    /// Specifies the Reduction Method the Source should use to reduce the bit depth of the data. Most
    /// commonly used with ICAP_PIXELTYPE:TWPT_BW to reduce gray data to black and white.
    ICAP_BITDEPTHREDUCTION: 4396,
    /// If TRUE the Source will issue a MSG_XFERREADY before starting the scan.
    /// Note: The Source may need to scan the image before initiating the transfer. This is the case if
    /// the scanned image is rotated or merged with another scanned image.
    ICAP_UNDEFINEDIMAGESIZE: 4397,
    /// Allows the application to query the data source to see if it supports extended image attribute capabilities, 
    /// such as Barcode Recognition, Shaded Area Detection and Removal, Skew detection and Removal, and so on.
    ICAP_EXTIMAGEINFO: 4399,
    /// Allows the source to define the minimum height (Y-axis) that the source can acquire.
    ICAP_MINIMUMHEIGHT: 4400,
    /// Allows the source to define theminimum width (X-axis) that the source can acquire.
    ICAP_MINIMUMWIDTH: 4401,
    /// Use this capability to have the Source discard blank images. The Application never sees these
    /// images during the scanning session.
    /// TWBP_DISABLE  this must be the default state for the Source. It indicates that all images will
    /// be delivered to the Application, none of them will be discarded.
    /// TWBP_AUTO  if this is used, then the Source will decide if an image is blank or not and discard
    /// as appropriate.
    /// If the specified value is a positive number in the range 0 to 2311, then this capability will use it
    /// as the byte size cutoff point to identify which images are to be discarded. If the size of the image
    /// is less than or equal to this value, then it will be discarded. If the size of the image is greater
    /// than this value, then it will be kept so that it can be transferred to the Application.
    ICAP_AUTODISCARDBLANKPAGES: 4404,
    /// Flip rotation is used to properly orient images that flip orientation every other image.
    /// TWFR_BOOK The images to be scanned are viewed in book form, flipping each page from left to right or right to left.
    /// TWFR_FANFOLD The images to be scanned are viewed in fanfold paper style, flipping each page up or down. 
    ICAP_FLIPROTATION: 4406,
    /// Turns bar code detection on and off.
    ICAP_BARCODEDETECTIONENABLED: 4407,
    /// Provides a list of bar code types that can be detected by the current Data Source.
    ICAP_SUPPORTEDBARCODETYPES: 4408,
    /// The maximum number of supported search priorities.
    ICAP_BARCODEMAXSEARCHPRIORITIES: 4409,
    /// A prioritized list of bar code types dictating the order in which bar codes will be sought.
    ICAP_BARCODESEARCHPRIORITIES: 4410,
    /// Restricts bar code searching to certain orientations, or prioritizes one orientation over the other.
    ICAP_BARCODESEARCHMODE: 4411,
    /// Restricts the number of times a search will be retried if none are found on each page.
    ICAP_BARCODEMAXRETRIES: 4412,
    /// Restricts the total time spent on searching for a bar code on each page.
    ICAP_BARCODETIMEOUT: 4413,
    /// When used with CapGet(), returns all camera supported lens zooming range. 
    ICAP_ZOOMFACTOR: 4414,
    /// Turns patch code detection on and off.
    ICAP_PATCHCODEDETECTIONENABLED: 4415,
    /// A list of patch code types that may be detected by the current Data Source.
    ICAP_SUPPORTEDPATCHCODETYPES: 4416,
    /// The maximum number of supported search priorities.
    ICAP_PATCHCODEMAXSEARCHPRIORITIES: 4417,
    /// A prioritized list of patch code types dictating the order in which patch codes will be sought.
    ICAP_PATCHCODESEARCHPRIORITIES: 4418,
    /// Restricts patch code searching to certain orientations, or prioritizes one orientation over the other.
    ICAP_PATCHCODESEARCHMODE: 4419,
    /// Restricts the number of times a search will be retried if none are found on each page.
    ICAP_PATCHCODEMAXRETRIES: 4420,
    /// Restricts the total time spent on searching for a patch code on each page.
    ICAP_PATCHCODETIMEOUT: 4421,
    /// For devices that support flash. CapSet() selects the flash to be used (if any). CapGet() reports the current setting.
    /// This capability replaces ICAP_FLASHUSED, which is only able to negotiate the flash being on or off. 
    ICAP_FLASHUSED2: 4422,
    /// For devices that support image enhancement filtering. This capability selects the algorithm used to improve the quality of the image.
    ICAP_IMAGEFILTER: 4423,
    /// For devices that support noise filtering. This capability selects the algorithm used to remove noise.
    ICAP_NOISEFILTER: 4424,
    /// Overscan is used to scan outside of the boundaries described by ICAP_FRAMES, and is used to help acquire image data that 
    /// may be lost because of skewing.
    /// This is primarily of use for transport scanners which rely on edge detection to begin scanning. 
    /// If overscan is supported, then the device is capable of scanning in the inter-document gap to get the skewed image information. 
    ICAP_OVERSCAN: 4425,
    /// Turns automatic border detection on and off.
    ICAP_AUTOMATICBORDERDETECTION: 4432,
    /// Turns automatic deskew correction on and off.
    ICAP_AUTOMATICDESKEW: 4433,
    /// When TRUE this capability depends on intelligent features within the Source to automatically 
    /// rotate the image to the correct position.
    ICAP_AUTOMATICROTATE: 4434,
    /// Added 1.9 
    ICAP_JPEGQUALITY: 4435,
    /// Added 1.91  
    ICAP_FEEDERTYPE: 4436, 
    /// Added 1.91 
    ICAP_ICCPROFILE: 4437,
    /// Added 2.0  
    ICAP_AUTOSIZE: 4438,  
    /// Added 2.1 
    ICAP_AUTOMATICCROPUSESFRAME: 4439, 
    /// Added 2.1 
    ICAP_AUTOMATICLENGTHDETECTION: 4440,
    /// Added 2.1 
    ICAP_AUTOMATICCOLORENABLED: 4441, 
    /// Added 2.1 
    ICAP_AUTOMATICCOLORNONCOLORPIXELTYPE: 4442, 
    /// Added 2.1 
    ICAP_COLORMANAGEMENTENABLED: 4443,
    /// Added 2.1 
    ICAP_IMAGEMERGE: 4444,  
    /// Added 2.1 
    ICAP_IMAGEMERGEHEIGHTTHRESHOLD: 4445,
    /// Added 2.1  
    ICAP_SUPPORTEDEXTIMAGEINFO: 4446   
};

/// Capabilities exist in many varieties but all have a Default Value, Current Value, and may have other values available that can be supported if selected. 
/// To help categorize the supported values into clear structures, TWAIN defines four types of containers for capabilities: 
/// TW_ONEVALUE, TW_ARRAY, TW_RANGE and TW_ENUMERATION.
var EnumDWT_CapType = {
    /// Nothing.
    TWON_NONE: 0,
    /// A rectangular array of values that describe a logical item. It is similar to the TW_ONEVALUE because the current and default values are the same and 
    /// there are no other values to select from. For example, a list of the names, such as the supported capabilities list returned by the CAP_SUPPORTEDCAPS 
    /// capability, would use this type of container. 
    TWON_ARRAY: 3,
    /// This is the most general type because it defines a list of values from which the Current Value can be chosen. 
    /// The values do not progress uniformly through a range and there is not a consistent step size between the values. 
    /// For example, if a Source's resolution options do not occur in even step sizes then an enumeration would be used (for example, 150, 400, and 600). 
    TWON_ENUMERATION: 4,
    /// A single value whose current and default values are coincident. The range of available values for this type of capability is simply this single value.
    /// For example, a capability that indicates the presence of a document feeder could be of this type.
    TWON_ONEVALUE: 5,
    /// Many capabilities allow users to select their current value from a range of regularly spaced values. 
    /// The capability can specify the minimum and maximum acceptable values and the incremental step size between the values.
    /// For example, resolution might be supported from 100 to 600 in steps of 50 (100, 150, 200, ..., 550, 600). 
    TWON_RANGE: 6
};

/// ICAP_XFERMECH values.
var EnumDWT_TransferMode = {
    /// Native transfers require the data to be transferred to a single large block of RAM. Therefore,
    /// they always face the risk of having an inadequate amount of RAM available to perform the transfer successfully.
    TWSX_NATIVE: 0,
    /// Disk File Mode Transfers.
    TWSX_FILE: 1,
    /// Buffered Memory Mode Transfers.
    TWSX_MEMORY: 2
    /// added 1.91
    //TWSX_MEMFILE  = 4    
};

/// ICAP_IMAGEFILEFORMAT values.
var EnumDWT_FileFormat = {
    /// Used for document imaging. Tagged Image File Format
    TWFF_TIFF: 0, 
    /// Native Macintosh format. Macintosh PICT   
    TWFF_PICT: 1, 
    /// Native Microsoft format. Windows Bitmap
    TWFF_BMP: 2,  
    /// Used for document imaging. X-Windows Bitmap
    TWFF_XBM: 3,  
    /// Wrapper for JPEG images. JPEG File Interchange Format
    TWFF_JFIF: 4, 
    /// FlashPix, used with digital cameras. Flash Pix
    TWFF_FPX: 5,  
    /// Multi-page TIFF files. Multi-page tiff file
    TWFF_TIFFMULTI: 6,
    /// An image format standard intended for use on the web, replaces GIF.
    TWFF_PNG: 7,
    /// A standard from JPEG, intended to replace JFIF, also supports JBIG.
    TWFF_SPIFF: 8,
    /// File format for use with digital cameras.
    TWFF_EXIF: 9,
    /// A file format from Adobe. 1.91 NB: this is not PDF/A 
    TWFF_PDF: 10,   
    /// A file format from the Joint Photographic Experts Group. 1.91
    TWFF_JP2: 11,    
    /// 1.91
    TWFF_JPN: 12,    
    /// 1.91
    TWFF_JPX: 13,    
    /// A file format from LizardTech. 1.91
    TWFF_DEJAVU: 14,    
    /// A file format from Adobe. 2.0
    TWFF_PDFA: 15,   
    /// 2.1 Adobe PDF/A, Version 2
    TWFF_PDFA2: 16  
};


/// TIFF file compression type.
var EnumDWT_TIFFCompressionType = {
    /// Auto mode.
    TIFF_AUTO: 0,
    /// Dump mode.
    TIFF_NONE: 1,
    /// CCITT modified Huffman RLE.
    TIFF_RLE: 2,
    /// CCITT Group 3 fax encoding.
    TIFF_FAX3: 3,
    /// CCITT T.4 (TIFF 6 name).
    TIFF_T4: 3,
    /// CCITT Group 4 fax encoding
    TIFF_FAX4: 4,
    /// CCITT T.6 (TIFF 6 name).
    TIFF_T6: 4,
    /// Lempel Ziv and Welch
    TIFF_LZW: 5,
    TIFF_JPEG: 7,
    TIFF_PACKBITS: 32773
};

/// The method to do interpolation.
var EnumDWT_InterpolationMethod = {
    IM_NEARESTNEIGHBOUR: 1,
    IM_BILINEAR: 2,
    IM_BICUBIC: 3
};

/// Image type
var EnumDWT_ImageType = {
    /// Native Microsoft format.
    IT_BMP: 0,
    /// JPEG format.
    IT_JPG: 1,
    /// Tagged Image File Format.
    IT_TIF: 2,
    /// An image format standard intended for use on the web, replaces GIF.
    IT_PNG: 3,
    /// A file format from Adobe.
    IT_PDF: 4,
  IT_ALL: 5
};

/// PDF file compression type.
var EnumDWT_PDFCompressionType = {
    /// Auto mode.
    PDF_AUTO: 0,
    /// CCITT Group 3 fax encoding.
    PDF_FAX3: 1,
    /// CCITT Group 4 fax encoding
    PDF_FAX4: 2,
    /// Lempel Ziv and Welch
    PDF_LZW: 3,
    /// CCITT modified Huffman RLE.
    PDF_RLE: 4,
    PDF_JPEG: 5
};

var EnumDWT_ShowMode = {
    /// Activates the window and displays it in its current size and position.
    SW_ACTIVE: 0,
    /// Maximizes the window
    SW_MAX: 1,
    /// Minimize the window
    SW_MIN: 2,
    /// Close the latest opened editor window
    SW_CLOSE: 3,
    /// Check whether a window exists
    SW_IFLIVE: 4
};

/// The kind of data stored in the container.
var EnumDWT_CapValueType = {
    TWTY_INT8: 0,
    /// Means Item is a TW_INT16  
    TWTY_INT16: 1,    
    /// Means Item is a TW_INT32  
    TWTY_INT32: 2,    
    /// Means Item is a TW_UINT8  
    TWTY_UINT8: 3,    
    /// Means Item is a TW_UINT16 
    TWTY_UINT16: 4,    
    /// Means Item is a TW_int 
    TWTY_int: 5,    
    /// Means Item is a TW_BOOL   
    TWTY_BOOL: 6,    
    /// Means Item is a TW_FIX32  
    TWTY_FIX32: 7,    
    /// Means Item is a TW_FRAME  
    TWTY_FRAME: 8,    
    /// Means Item is a TW_STR32  
    TWTY_STR32: 9,    
    /// Means Item is a TW_STR64  
    TWTY_STR64: 10,    
    /// Means Item is a TW_STR128 
    TWTY_STR128: 11,    
    /// Means Item is a TW_STR255 
    TWTY_STR255: 12        
};

/// ICAP_UNITS values.
var EnumDWT_UnitType = {
    TWUN_INCHES: 0,
    TWUN_CENTIMETERS: 1,
    TWUN_PICAS: 2,
    TWUN_POINTS: 3,
    TWUN_TWIPS: 4,
    TWUN_PIXELS: 5,
    TWUN_MILLIMETERS: 6
};

/// ICAP_DUPLEX values.
var EnumDWT_DUPLEX = {
    TWDX_NONE: 0,
    TWDX_1PASSDUPLEX: 1,
    TWDX_2PASSDUPLEX: 2
};

/// CAP_LANGUAGE values.
var EnumDWT_CapLanguage = {
    /// Danish     
    TWLG_DAN: 0, 
    /// Dutch      
    TWLG_DUT: 1, 
    /// International English  
    TWLG_ENG: 2, 
    /// French Canadian        
    TWLG_FCF: 3, 
    /// Finnish    
    TWLG_FIN: 4, 
    /// French     
    TWLG_FRN: 5, 
    /// German     
    TWLG_GER: 6, 
    /// Icelandic  
    TWLG_ICE: 7, 
    /// Italian     
    TWLG_ITN: 8, 
    /// Norwegian  
    TWLG_NOR: 9, 
    /// Portuguese 
    TWLG_POR: 10, 
    /// Spanish    
    TWLG_SPA: 11, 
    /// Swedish    
    TWLG_SWE: 12, 
    /// U.S. English           
    TWLG_USA: 13, 
    /// Added for 1.8 
    TWLG_USERLOCALE: -1,
    TWLG_AFRIKAANS: 14,
    TWLG_ALBANIA: 15,
    TWLG_ARABIC: 16,
    TWLG_ARABIC_ALGERIA: 17,
    TWLG_ARABIC_BAHRAIN: 18,
    TWLG_ARABIC_EGYPT: 19,
    TWLG_ARABIC_IRAQ: 20,
    TWLG_ARABIC_JORDAN: 21,
    TWLG_ARABIC_KUWAIT: 22,
    TWLG_ARABIC_LEBANON: 23,
    TWLG_ARABIC_LIBYA: 24,
    TWLG_ARABIC_MOROCCO: 25,
    TWLG_ARABIC_OMAN: 26,
    TWLG_ARABIC_QATAR: 27,
    TWLG_ARABIC_SAUDIARABIA: 28,
    TWLG_ARABIC_SYRIA: 29,
    TWLG_ARABIC_TUNISIA: 30,
    /// United Arabic Emirates 
    TWLG_ARABIC_UAE: 31, 
    TWLG_ARABIC_YEMEN: 32,
    TWLG_BASQUE: 33,
    TWLG_BYELORUSSIAN: 34,
    TWLG_BULGARIAN: 35,
    TWLG_CATALAN: 36,
    TWLG_CHINESE: 37,
    TWLG_CHINESE_HONGKONG: 38,
    /// People's Republic of China 
    TWLG_CHINESE_PRC: 39, 
    TWLG_CHINESE_SINGAPORE: 40,
    TWLG_CHINESE_SIMPLIFIED: 41,
    TWLG_CHINESE_TAIWAN: 42,
    TWLG_CHINESE_TRADITIONAL: 43,
    TWLG_CROATIA: 44,
    TWLG_CZECH: 45,
    TWLG_DANISH: 0,
    TWLG_DUTCH: 1,
    TWLG_DUTCH_BELGIAN: 46,
    TWLG_ENGLISH: 2,
    TWLG_ENGLISH_AUSTRALIAN: 47,
    TWLG_ENGLISH_CANADIAN: 48,
    TWLG_ENGLISH_IRELAND: 49,
    TWLG_ENGLISH_NEWZEALAND: 50,
    TWLG_ENGLISH_SOUTHAFRICA: 51,
    TWLG_ENGLISH_UK: 52,
    TWLG_ENGLISH_USA: 13,
    TWLG_ESTONIAN: 53,
    TWLG_FAEROESE: 54,
    TWLG_FARSI: 55,
    TWLG_FINNISH: 4,
    TWLG_FRENCH: 5,
    TWLG_FRENCH_BELGIAN: 56,
    TWLG_FRENCH_CANADIAN: 3,
    TWLG_FRENCH_LUXEMBOURG: 57,
    TWLG_FRENCH_SWISS: 58,
    TWLG_GERMAN: 6,
    TWLG_GERMAN_AUSTRIAN: 59,
    TWLG_GERMAN_LUXEMBOURG: 60,
    TWLG_GERMAN_LIECHTENSTEIN: 61,
    TWLG_GERMAN_SWISS: 62,
    TWLG_GREEK: 63,
    TWLG_HEBREW: 64,
    TWLG_HUNGARIAN: 65,
    TWLG_ICELANDIC: 7,
    TWLG_INDONESIAN: 66,
    TWLG_ITALIAN: 8,
    TWLG_ITALIAN_SWISS: 67,
    TWLG_JAPANESE: 68,
    TWLG_KOREAN: 69,
    TWLG_KOREAN_JOHAB: 70,
    TWLG_LATVIAN: 71,
    TWLG_LITHUANIAN: 72,
    TWLG_NORWEGIAN: 9,
    TWLG_NORWEGIAN_BOKMAL: 73,
    TWLG_NORWEGIAN_NYNORSK: 74,
    TWLG_POLISH: 75,
    TWLG_PORTUGUESE: 10,
    TWLG_PORTUGUESE_BRAZIL: 76,
    TWLG_ROMANIAN: 77,
    TWLG_RUSSIAN: 78,
    TWLG_SERBIAN_LATIN: 79,
    TWLG_SLOVAK: 80,
    TWLG_SLOVENIAN: 81,
    TWLG_SPANISH: 11,
    TWLG_SPANISH_MEXICAN: 82,
    TWLG_SPANISH_MODERN: 83,
    TWLG_SWEDISH: 12,
    TWLG_THAI: 84,
    TWLG_TURKISH: 85,
    TWLG_UKRANIAN: 86,
    /// More stuff added for 1.8 
    TWLG_ASSAMESE: 87,
    TWLG_BENGALI: 88,
    TWLG_BIHARI: 89,
    TWLG_BODO: 90,
    TWLG_DOGRI: 91,
    TWLG_GUJARATI: 92,
    TWLG_HARYANVI: 93,
    TWLG_HINDI: 94,
    TWLG_KANNADA: 95,
    TWLG_KASHMIRI: 96,
    TWLG_MALAYALAM: 97,
    TWLG_MARATHI: 98,
    TWLG_MARWARI: 99,
    TWLG_MEGHALAYAN: 100,
    TWLG_MIZO: 101,
    TWLG_NAGA: 102,
    TWLG_ORISSI: 103,
    TWLG_PUNJABI: 104,
    TWLG_PUSHTU: 105,
    TWLG_SERBIAN_CYRILLIC: 106,
    TWLG_SIKKIMI: 107,
    TWLG_SWEDISH_FINLAND: 108,
    TWLG_TAMIL: 109,
    TWLG_TELUGU: 110,
    TWLG_TRIPURI: 111,
    TWLG_URDU: 112,
    TWLG_VIETNAMESE: 113
};

/// TWAIN Supported sizes.
var EnumDWT_CapSupportedSizes = {
    /// 0
    TWSS_NONE: 0,
    /// 1
    TWSS_A4LETTER: 1,
    /// 2
    TWSS_B5LETTER: 2,
    /// 3
    TWSS_USLETTER: 3,
    /// 4
    TWSS_USLEGAL: 4,
    /// Added 1.5 
    /// 5
    TWSS_A5: 5,
    /// 6
    TWSS_B4: 6,
    /// 7
    TWSS_B6: 7,
    /// Added 1.7 
    /// 9
    TWSS_USLEDGER: 9,
    /// 10
    TWSS_USEXECUTIVE: 10,
    /// 11
    TWSS_A3: 11,
    /// 12
    TWSS_B3: 12,
    /// 13
    TWSS_A6: 13,
    /// 14
    TWSS_C4: 14,
    /// 15
    TWSS_C5: 15,
    /// 16
    TWSS_C6: 16,
    /// Added 1.8 
    /// 17
    TWSS_4A0: 17,
    /// 18
    TWSS_2A0: 18,
    /// 19
    TWSS_A0: 19,
    /// 20
    TWSS_A1: 20,
    /// 21
    TWSS_A2: 21,
    /// 1
    TWSS_A4: 1,
    /// 22
    TWSS_A7: 22,
    /// 23
    TWSS_A8: 23,
    /// 24
    TWSS_A9: 24,
    /// 25
    TWSS_A10: 25,
    /// 26
    TWSS_ISOB0: 26,
    /// 27
    TWSS_ISOB1: 27,
    /// 28
    TWSS_ISOB2: 28,
    /// 12
    TWSS_ISOB3: 12,
    /// 6
    TWSS_ISOB4: 6,
    /// 29
    TWSS_ISOB5: 29,
    /// 7
    TWSS_ISOB6: 7,
    /// 30
    TWSS_ISOB7: 30,
    /// 31
    TWSS_ISOB8: 31,
    /// 32
    TWSS_ISOB9: 32,
    /// 33
    TWSS_ISOB10: 33,
    /// 34
    TWSS_JISB0: 34,
    /// 35
    TWSS_JISB1: 35,
    /// 36
    TWSS_JISB2: 36,
    /// 37
    TWSS_JISB3: 37,
    /// 38
    TWSS_JISB4: 38,
    /// 2
    TWSS_JISB5: 2,
    /// 39
    TWSS_JISB6: 39,
    /// 40
    TWSS_JISB7: 40,
    /// 41
    TWSS_JISB8: 41,
    /// 41
    TWSS_JISB9: 42,
    /// 43
    TWSS_JISB10: 43,
    /// 44
    TWSS_C0: 44,
    /// 45
    TWSS_C1: 45,
    /// 46
    TWSS_C2: 46,
    /// 47
    TWSS_C3: 47,
    /// 48
    TWSS_C7: 48,
    /// 49
    TWSS_C8: 49,
    /// 50
    TWSS_C9: 50,
    /// 51
    TWSS_C10: 51,
    /// 52
    TWSS_USSTATEMENT: 52,
    /// 53
    TWSS_BUSINESSCARD: 53,
    /// 54. Added 2.1
    TWSS_MAXSIZE: 54  
};


/// CAP_FEEDERALIGNMENT values.
var EnumDWT_CapFeederAlignment = {
    /// The alignment is free-floating. Applications should assume that the origin for frames is on the left.
    TWFA_NONE: 0,
    /// The alignment is to the left.
    TWFA_LEFT: 1,
    /// The alignment is centered. This means that the paper will be fed in the middle of the ICAP_PHYSICALWIDTH of the 
    /// device. If this is set, then the Application should calculate any frames with a left offset of zero.
    TWFA_CENTER: 2,
    /// The alignment is to the right.
    TWFA_RIGHT: 3
};
/// CAP_FEEDERORDER values.
var EnumDWT_CapFeederOrder = {
    /// The feeder starts with the top of the first page.
    TWFO_FIRSTPAGEFIRST: 0,
    /// The feeder starts with the top of the last page.
    TWFO_LASTPAGEFIRST: 1
};

/// CAP_PRINTER values.
var EnumDWT_CapPrinter = {
    TWPR_IMPRINTERTOPBEFORE: 0,
    TWPR_IMPRINTERTOPAFTER: 1,
    TWPR_IMPRINTERBOTTOMBEFORE: 2,
    TWPR_IMPRINTERBOTTOMAFTER: 3,
    TWPR_ENDORSERTOPBEFORE: 4,
    TWPR_ENDORSERTOPAFTER: 5,
    TWPR_ENDORSERBOTTOMBEFORE: 6,
    TWPR_ENDORSERBOTTOMAFTER: 7
};
/// CAP_PRINTERMODE values.
var EnumDWT_CapPrinterMode = {
    /// Specifies that the printed text will consist of a single string.
    TWPM_SINGLESTRING: 0,
    /// Specifies that the printed text will consist of an enumerated list of strings to be printed in order.
    TWPM_MULTISTRING: 1,
    /// Specifies that the printed string will consist of a compound of a String followed by a value followed by a suffix string.
    TWPM_COMPOUNDSTRING: 2
};
/// ICAP_BITDEPTHREDUCTION values.
var EnumDWT_CapBitdepthReduction = {
    TWBR_THRESHOLD: 0,
    TWBR_HALFTONE: 1,
    TWBR_CUSTHALFTONE: 2,
    TWBR_DIFFUSION: 3
};
/// ICAP_BITORDER values.
var EnumDWT_CapBitOrder = {
    TWBO_LSBFIRST: 0,
    /// Indicates that the leftmost bit in the byte (usually bit 7) is the byte's Most Significant Bit.
    TWBO_MSBFIRST: 1
};
/// ICAP_FILTER values.
var EnumDWT_CapFilterType = {
    TWFT_RED: 0,
    TWFT_GREEN: 1,
    TWFT_BLUE: 2,
    TWFT_NONE: 3,
    TWFT_WHITE: 4,
    TWFT_CYAN: 5,
    TWFT_MAGENTA: 6,
    TWFT_YELLOW: 7,
    TWFT_BLACK: 8
};
/// ICAP_FLASHUSED2 values.
var EnumDWT_CapFlash = {
    TWFL_NONE: 0,
    TWFL_OFF: 1,
    TWFL_ON: 2,
    TWFL_AUTO: 3,
    TWFL_REDEYE: 4
};
/// ICAP_FLIPROTATION values.
var EnumDWT_CapFlipRotation = {
    /// The images to be scanned are viewed in book form, flipping each page from left to right or right to left.
    TWFR_BOOK: 0,
    /// The images to be scanned are viewed in fanfold paper style, flipping each page up or down.
    TWFR_FANFOLD: 1
};
/// ICAP_IMAGEFILTER values.
var EnumDWT_CapImageFilter = {
    TWIF_NONE: 0,
    TWIF_AUTO: 1,
    /// Good for halftone images.
    TWIF_LOWPASS: 2,
    /// Good for improving text.
    TWIF_BANDPASS: 3,
    /// Good for improving fine lines.
    TWIF_HIGHPASS: 4,
    TWIF_TEXT: 3,
    TWIF_FINELINE: 4
};
/// ICAP_LIGHTPATH values.
var EnumDWT_CapLightPath = {
    TWLP_REFLECTIVE: 0,
    TWLP_TRANSMISSIVE: 1
};
/// ICAP_LIGHTSOURCE values.
var EnumDWT_CapLightSource = {
    TWLS_RED: 0,
    TWLS_GREEN: 1,
    TWLS_BLUE: 2,
    TWLS_NONE: 3,
    TWLS_WHITE: 4,
    TWLS_UV: 5,
    TWLS_IR: 6
};
/// TWEI_MAGTYPE values. (MD_ means Mag Type) Added 2.0 
var EnumDWT_MagType = {
    /// Added 2.0 
    TWMD_MICR: 0, 
    /// added 2.1  
    TWMD_RAW: 1,  
    /// added 2.1 
    TWMD_INVALID: 2  
};
/// ICAP_NOISEFILTER values.
var EnumDWT_CapNoiseFilter = {
    TWNF_NONE: 0,
    TWNF_AUTO: 1,
    TWNF_LONEPIXEL: 2,
    TWNF_MAJORITYRULE: 3
};

/// ICAP_ORIENTATION values.
var EnumDWT_CapORientation = {
    TWOR_ROT0: 0,
    TWOR_ROT90: 1,
    TWOR_ROT180: 2,
    TWOR_ROT270: 3,
    TWOR_PORTRAIT: 0,
    TWOR_LANDSCAPE: 3,
    /// 2.0 
    TWOR_AUTO: 4,          
    /// 2.0 
    TWOR_AUTOTEXT: 5,           
    /// 2.0 
    TWOR_AUTOPICTURE: 6           
};
/// ICAP_OVERSCAN values.
var EnumDWT_CapOverscan = {
    TWOV_NONE: 0,
    TWOV_AUTO: 1,
    TWOV_TOPBOTTOM: 2,
    TWOV_LEFTRIGHT: 3,
    TWOV_ALL: 4
};
/// ICAP_PIXELFLAVOR values.
var EnumDWT_CapPixelFlavor = {
    /// Zero pixel represents darkest shade. zero pixel represents darkest shade  
    TWPF_CHOCOLATE: 0, 
    /// Zero pixel represents lightest shade. zero pixel represents lightest shade 
    TWPF_VANILLA: 1  
};

/// ICAP_PLANARCHUNKY values.
var EnumDWT_CapPlanarChunky = {
    TWPC_CHUNKY: 0,
    TWPC_PLANAR: 1
};

/// Data source status.
var EnumDWT_DataSourceStatus = {
    /// Indicate the data source is closed. 
    TWDSS_CLOSED: 0,
    /// Indicate the data source is opened.
    TWDSS_OPENED: 1,
    /// Indicate the data source is enabled. 
    TWDSS_ENABLED: 2,
    /// Indicate the data source is acquiring image.
    TWDSS_ACQUIRING: 3
};

/// Fit window type
var EnumDWT_FitWindowType = {
    /// Fit the image to the width and height of the window
    enumFitWindow: 0,
    /// Fit the image to the height of the window
    enumFitWindowHeight: 1,
    /// Fit the image to the width of the window
    enumFitWindowWidth: 2
};

/// Platform type
var EnumDWT_PlatformType = {
    /// Fit the image to the width and height of the window
    enumWindow: 0,
    /// Fit the image to the height of the window
    enumMac: 1,
    /// Fit the image to the width of the window
    enumLinux: 2
};
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 


var DynamLib = DynamLib || {},
	
	OnWebTwainNotFoundOnWindowsCallback = OnWebTwainNotFoundOnWindowsCallback || false,
	OnWebTwainNotFoundOnMacCallback = OnWebTwainNotFoundOnMacCallback || false,
	OnWebTwainNotFoundOnLinuxCallback = OnWebTwainNotFoundOnLinuxCallback || false,
	OnWebTwainOldPluginNotAllowedCallback = OnWebTwainOldPluginNotAllowedCallback || false,
	OnWebTwainNeedUpgradeCallback = OnWebTwainNeedUpgradeCallback || false,
	OnWebTwainPreExecuteCallback = OnWebTwainPreExecuteCallback || false,
	OnWebTwainPostExecuteCallback = OnWebTwainPostExecuteCallback || false,
	
	// compatible for 10.0
	Dynamsoft_ChangeConfig = Dynamsoft_ChangeConfig || false,
	Dynamsoft_OnLoad = Dynamsoft_OnLoad || false,
	Dynamsoft_OnNotReady = Dynamsoft_OnNotReady || false,
	Dynamsoft_OnReady = Dynamsoft_OnReady || false;

if(!Dynamsoft.Lib)
	Dynamsoft.Lib = {};

// add mix function
(function (DL) {
	DL.mix = function (dest, source) {
		for (var i in source) {
			dest[i] = source[i];
		}
	}
})(Dynamsoft.Lib);

// add type judgement: 
//     isString / isFunction / isObject / isArray / isBoolean / isNumber / isUndefined
(function (DL) {
    // [[Class]] -> type pairs
    var win = window, 
		class2type = {},
        FALSE = !1,
        OP = Object.prototype,
        toString = OP.toString;

    DL.mix(DL, {
		isUndefined : function (o){
			return (typeof(o) === 'undefined');
		},
		isNull : function (o){
			return (o === null);
		},
		isNaN : function (o){
			return isNaN(o);
		},
		type : function (o) {
			if(o === null || o === undefined)
				return String(o);
			return class2type[toString.call(o)] || 'object';
		},
		each: function(arr, fn, context) {
            var l = (arr && arr.length) || 0, i = 0;
            for (; i < l; ++i) {
                fn.call(context || win, arr[i], i, arr);
            }
        }
	});

    DL.each(['String', 'Function', 'Object', 'Array', 'Boolean', 'Number'], function (name, lc) {
        // populate the class2type map
        class2type['[object ' + name + ']'] = (lc = name.toLowerCase());

        // add isBoolean/isNumber/...
        DL['is' + name] = function (o) {
            return DL.type(o) === lc;
        };
    });
    DL.isArray = Array.isArray || DL.isArray;
})(Dynamsoft.Lib);


// base64 & utf8
(function(DL){

	var _ret = {}, _const = {
			encodeChars : 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',
			decodeChars : [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
			-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
			-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63,
			52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1,
			-1,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,
			15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1,
			-1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
			41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1]
		};
		
	_ret.base64 = {
	    UTF16ToUTF8 : function(str) {
			var res = [], len = str.length;
			for (var i = 0; i < len; i++) {
				var code = str.charCodeAt(i);
				if (code > 0x0000 && code <= 0x007F) {
					// 1 bit
					// U+00000000 - U+0000007F 0xxxxxxx
					res.push(str.charAt(i));
				} else if (code >= 0x0080 && code <= 0x07FF) {
					// 2 bits
					// U+00000080 - U+000007FF 110xxxxx 10xxxxxx
					// 110xxxxx
					var byte1 = 0xC0 | ((code >> 6) & 0x1F);
					// 10xxxxxx
					var byte2 = 0x80 | (code & 0x3F);
					res.push(
						String.fromCharCode(byte1), 
						String.fromCharCode(byte2)
					);
				} else if (code >= 0x0800 && code <= 0xFFFF) {
					// 3 bits
					// U+00000800 - U+0000FFFF 1110xxxx 10xxxxxx 10xxxxxx
					// 1110xxxx
					var byte1 = 0xE0 | ((code >> 12) & 0x0F);
					// 10xxxxxx
					var byte2 = 0x80 | ((code >> 6) & 0x3F);
					// 10xxxxxx
					var byte3 = 0x80 | (code & 0x3F);
					res.push(
						String.fromCharCode(byte1), 
						String.fromCharCode(byte2), 
						String.fromCharCode(byte3)
					);
				} else if (code >= 0x00010000 && code <= 0x001FFFFF) {
					// 4 bits
					// U+00010000 - U+001FFFFF 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
				} else if (code >= 0x00200000 && code <= 0x03FFFFFF) {
					// 5 bits
					// U+00200000 - U+03FFFFFF 111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
				} else /** if (code >= 0x04000000 && code <= 0x7FFFFFFF)*/ {
					// 6 bits
					// U+04000000 - U+7FFFFFFF 1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
				}
			}
	 
			return res.join('');
		},
		UTF8ToUTF16 : function(str) {
			var res = [], len = str.length;
			var i = 0;
			for (var i = 0; i < len; i++) {
				var code = str.charCodeAt(i);
				if (((code >> 7) & 0xFF) == 0x0) {
					// 1 bit
					// 0xxxxxxx
					res.push(str.charAt(i));
				} else if (((code >> 5) & 0xFF) == 0x6) {
					// 2 bits
					// 110xxxxx 10xxxxxx
					var code2 = str.charCodeAt(++i);
					var byte1 = (code & 0x1F) << 6;
					var byte2 = code2 & 0x3F;
					var utf16 = byte1 | byte2;
					res.push(String.fromCharCode(utf16));
				} else if (((code >> 4) & 0xFF) == 0xE) {
					// 3 bits
					// 1110xxxx 10xxxxxx 10xxxxxx
					var code2 = str.charCodeAt(++i);
					var code3 = str.charCodeAt(++i);
					var byte1 = (code << 4) | ((code2 >> 2) & 0x0F);
					var byte2 = ((code2 & 0x03) << 6) | (code3 & 0x3F);
					var utf16 = ((byte1 & 0x00FF) << 8) | byte2
					res.push(String.fromCharCode(utf16));
				} else if (((code >> 3) & 0xFF) == 0x1E) {
					// 4 bits
					// 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
				} else if (((code >> 2) & 0xFF) == 0x3E) {
					// 5 bits
					// 111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
				} else /** if (((code >> 1) & 0xFF) == 0x7E)*/ {
					// 6 bits
					// 1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
				}
			}
	 
			return res.join('');
		},
		encode : function(_str) {
			var str = this.UTF16ToUTF8(_str),
				out = [], i = 0, len = str.length, c1, c2, c3;
			

			while(i < len) {
				c1 = str.charCodeAt(i++) & 0xff;
				if(i == len)
				{
					out.push( _const.encodeChars.charAt(c1 >> 2) );
					out.push( _const.encodeChars.charAt((c1 & 0x3) << 4) );
					out.push( '==' );
					break;
				}
				c2 = str.charCodeAt(i++);
				if(i == len)
				{
					out.push( _const.encodeChars.charAt(c1 >> 2) );
					out.push( _const.encodeChars.charAt(((c1 & 0x3)<< 4) | ((c2 & 0xF0) >> 4)) );
					out.push( _const.encodeChars.charAt((c2 & 0xF) << 2) );
					out.push( '=' );
					break;
				}
				c3 = str.charCodeAt(i++);
				out.push( _const.encodeChars.charAt(c1 >> 2) );
				out.push( _const.encodeChars.charAt(((c1 & 0x3)<< 4) | ((c2 & 0xF0) >> 4)) );
				out.push( _const.encodeChars.charAt(((c2 & 0xF) << 2) | ((c3 & 0xC0) >>6)) );
				out.push( _const.encodeChars.charAt(c3 & 0x3F) );
			}
			return out.join('');
		},
		
		encodeArray : function(_array) {
			var out = [], i = 0, len = _array.length, c1, c2, c3;

			while(i < len) {
				c1 = _array[i++] & 0xff;
				if(i == len)
				{
					out.push( _const.encodeChars.charAt(c1 >> 2) );
					out.push( _const.encodeChars.charAt((c1 & 0x3) << 4) );
					out.push( '==' );
					break;
				}
				c2 = _array[i++] & 0xff;
				if(i == len)
				{
					out.push( _const.encodeChars.charAt(c1 >> 2) );
					out.push( _const.encodeChars.charAt(((c1 & 0x3)<< 4) | ((c2 & 0xF0) >> 4)) );
					out.push( _const.encodeChars.charAt((c2 & 0xF) << 2) );
					out.push( '=' );
					break;
				}
				c3 = _array[i++] & 0xff;
				out.push( _const.encodeChars.charAt(c1 >> 2) );
				out.push( _const.encodeChars.charAt(((c1 & 0x3)<< 4) | ((c2 & 0xF0) >> 4)) );
				out.push( _const.encodeChars.charAt(((c2 & 0xF) << 2) | ((c3 & 0xC0) >>6)) );
				out.push( _const.encodeChars.charAt(c3 & 0x3F) );
			}
			return out.join('');
		},

		decode : function (str) {
			
			var _this=this, out=[], i=0, len=str.length,
				c1, c2, c3, c4;

			while(i < len) {
				/* c1 */
				do {
					c1 = _const.decodeChars[str.charCodeAt(i++) & 0xff];
				} while(i < len && c1 == -1);
				if(c1 == -1)
					break;

				/* c2 */
				do {
					c2 = _const.decodeChars[str.charCodeAt(i++) & 0xff];
				} while(i < len && c2 == -1);
				if(c2 == -1)
					break;

				out.push( String.fromCharCode((c1 << 2) | ((c2 & 0x30) >> 4)) );

				/* c3 */
				do {
					c3 = str.charCodeAt(i++) & 0xff;
					if(c3 == 61)
						return _this.UTF8ToUTF16(out.join(''));
					c3 = _const.decodeChars[c3];
				} while(i < len && c3 == -1);
				if(c3 == -1)
					break;

				out.push( String.fromCharCode(((c2 & 0XF) << 4) | ((c3 & 0x3C) >> 2)) );

				/* c4 */
				do {
					c4 = str.charCodeAt(i++) & 0xff;
					if(c4 == 61)
						return _this.UTF8ToUTF16(out.join(''));
					c4 = _const.decodeChars[c4];
				} while(i < len && c4 == -1);
				if(c4 == -1)
					break;
				out.push( String.fromCharCode(((c3 & 0x03) << 6) | c4) );
			}
			return _this.UTF8ToUTF16(out.join(''));
		}
	
	};
	
	_ret.utf8 = {
	
		fromUTF16 : function (str) {
			var out=[], i=0, len=str.length, c;

			while(i < len) {
				c = str.charCodeAt(i);
				if ((c >= 0x0001) && (c <= 0x007F)) {
					out.push( str.charAt(i) );
				} else if (c > 0x07FF) {
					out.push( String.fromCharCode(0xE0 | ((c >> 12) & 0x0F)) );
					out.push( String.fromCharCode(0x80 | ((c >>  6) & 0x3F)) );
					out.push( String.fromCharCode(0x80 | ((c >>  0) & 0x3F)) );
				} else {
					out.push( String.fromCharCode(0xC0 | ((c >>  6) & 0x1F)) );
					out.push( String.fromCharCode(0x80 | ((c >>  0) & 0x3F)) );
				}
				i++;
			}
			return out.join('');
		},

		toUTF16 : function (str) {
			var out=[], i=0, len=str.length, c, char2, char3;

			while(i < len) {
				c = str.charCodeAt(i++);
				switch(c >> 4)
				{ 
				  case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7:
					// 0xxxxxxx
					out.push( str.charAt(i-1) );
					break;
				  case 12: case 13:
					// 110x xxxx   10xx xxxx
					char2 = str.charCodeAt(i++);
					out.push( String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F)) );
					break;
				  case 14:
					// 1110 xxxx  10xx xxxx  10xx xxxx
					char2 = str.charCodeAt(i++);
					char3 = str.charCodeAt(i++);
					out.push( String.fromCharCode(((c & 0x0F) << 12) |
								   ((char2 & 0x3F) << 6) |
								   ((char3 & 0x3F) << 0)) );
					break;
				}
			}

			return out.join('');
		}
	
	};
	
	DL.mix(DL, _ret);
})(Dynamsoft.Lib);


// Dynamsoft.WebTwainEnv
(function(DL){
    var oldEnv = Dynamsoft.WebTwainEnv;

	Dynamsoft.WebTwainEnv =  {
		'ServerVersionInfo': '11,3,2,0',
		'ActiveXVersion': '11,3,0,0',
		'PluginVersion': '11,1,0,0',

		'Containers': false,
		'ContainerMap': false,
	    'ProductKey': '',
		'Trial': true,
		'ResourcesPath': 'Resources',
		'Debug': false,
		
		'AutoLoad': true,

		'OnWebTwainReady': false,
		
		'UseDefaultInstallUI': true,
		
		/// void OnWebTwainNotFound(containerID, width, height)
		'OnWebTwainNotFound': false,				// will set to Dynamsoft.Lib.detect.onNoControl
		
		/// void OnWebTwainOldPluginNotAllowed(containerID)
		'OnWebTwainOldPluginNotAllowed': false,		// will set to Dynamsoft.Lib.detect.onNotAllowedForChrome
		
		/// HTML5 only
		/// bool OnWebTwainNeedUpgrade(Array)
		/// return value:
		///		true handled custom UI
		///		false go on prompt Default UI, you can just change text by parameter Array
		///
		'OnWebTwainNeedUpgrade': false,
		
		/// HTML5 only
		/// The JavaScript code on this website is outdated. The default behavior is alert the error.
		/// void OnWebTwainNeedUpgradeWebJavascript(String error)
		'OnWebTwainNeedUpgradeWebJavascript': false,
		
		/// IE only
		'IfUseActiveXForIE10Plus': true

	};
	DL.mix(Dynamsoft.WebTwainEnv, oldEnv);
	
    Dynamsoft.WebTwainEnv.RegisterEvent = function (eventName, callback) {
		if((eventName === 'OnWebTwainReady' || !Dynamsoft.WebTwainEnv.UseDefaultInstallUI)
			&& DL.isFunction(callback)){
			Dynamsoft.WebTwainEnv[eventName] = callback;
		}
		
		return true;
    };
	
	Dynamsoft.WebTwainEnv.GetWebTwain = function (_cId) {
		var controlId = _cId, ids = Dynamsoft.WebTwainEnv.Containers;
		if(!controlId && ids.length>0){
			controlId = ids[0].ContainerId;
		}
		
		if(Dynamsoft.WebTwainEnv.ContainerMap && controlId 
			&& controlId in Dynamsoft.WebTwainEnv.ContainerMap
			&& document.getElementById(controlId)){
			
			return Dynamsoft.WebTwainEnv.ContainerMap[controlId];
			
		}

		return null;
    };

})(Dynamsoft.Lib);

// Dynamsoft.Lib
(function(DL){
	var TRUE = true,
		FALSE = false,
		ua = navigator.userAgent.toLowerCase(),
		_platform = navigator.platform.toLowerCase(),
		_protocol = document.location.protocol,
		_host = location.hostname,
		_path = location.pathname,
		_ssl = (_protocol === 'https:') ? TRUE : FALSE,
	
		_bWin = (_platform == 'win32') || (_platform == 'win64') || (_platform == 'windows'),
		_bMac = (_platform == 'mac68k') || (_platform == 'macppc') || (_platform == 'macintosh') || (_platform == 'macintel'),	_bLinux = (_platform.indexOf('linux')>=0),		

		_nMSIE = ua.indexOf('msie'),
		_nTrident = ua.indexOf('trident'),
		_nRV = ua.indexOf('rv:'),
		_isX64 = (_platform == 'win64') || (ua.indexOf('WOW64') >=0) || (ua.indexOf('x86_64')>=0) 
				|| (ua.indexOf('win64') >=0) || (ua.indexOf('x64') >=0),
		
		_nSafari,
		_bSafari,

		_indexOfChrome = ua.indexOf('chrome'),
		_bChrome = _indexOfChrome != -1,
		
		_nFirefox = ua.indexOf('firefox'),
		_bFirefox = _nFirefox != -1,
		
		_bIE = _bWin && !_bFirefox && !_bChrome && (_nMSIE != -1 || _nTrident != -1 || _nRV != -1),

		_strChromeVersion = '',
		_strFirefoxVersion = '',
		_strIEVersion = '',
		_bHTML5Edition = FALSE,
		_bPluginEdition = FALSE,
		_bActiveXEdition = FALSE,
		_bFileSystem = (_protocol !== 'https:' && _protocol !== 'http:'),
		_pathType = 0,
		_html5ip = '127.0.0.1',
		_ret, _tmp, _regexp;
		
	_tmp = ua.match(/version\/([\d.]+).*safari/);
	if(_tmp){
		_nSafari = _tmp[1];
		_bSafari = true;
	} else {
		_nSafari = 0;
		_bSafari = false;
	}
	

	if(_bChrome || _bFirefox){
		if(_bChrome){
			_tmp = ua.slice(_indexOfChrome + 7);
			_tmp = _tmp.slice(0, _tmp.indexOf(' '));
			_strChromeVersion = _tmp;
			_tmp = _tmp.slice(0, _tmp.indexOf('.'));
			if(_tmp >= 27){
				_bHTML5Edition = TRUE;
			} else {
				_bPluginEdition = TRUE;
			}
		} else {	// FF
			_tmp = ua.slice(_nFirefox + 8);
			_tmp = _tmp.slice(0, _tmp.indexOf(' '));
			_strFirefoxVersion = _tmp;
			_tmp = _tmp.slice(0, _tmp.indexOf('.'));
			if(_tmp >= 27){
				_bHTML5Edition = TRUE;
			} else {
				_bPluginEdition = TRUE;
			}
		}

	} else if(_bIE){
		
		if(_nMSIE != -1){
			// 'msie'
			_tmp = ua.slice(_nMSIE + 4);
			_tmp = _tmp.slice(0, _tmp.indexOf(';'));
			_strIEVersion = _tmp;		
		} else if(_nRV != -1){
			// 'rv:'
			_tmp = ua.slice(_nRV + 3);
			_tmp = _tmp.slice(0, _tmp.indexOf(';'));
			_tmp = _tmp.slice(0, _tmp.indexOf(')'));
			_strIEVersion = _tmp;
		} else if(_nTrident != -1){
			// 'trident'
			_tmp = ua.slice(_nTrident + 7);
			_tmp = _tmp.slice(0, _tmp.indexOf(';'));
			_strIEVersion = _tmp;
		}
		
		if (_strIEVersion === '' || _strIEVersion > 8.0) {
			if(_strIEVersion >= 10.0  && Dynamsoft.WebTwainEnv.IfUseActiveXForIE10Plus == false)
			{
			    _bHTML5Edition = TRUE;
			}
			else
			{
			    // IE11/IE10/IE9
			    _bPluginEdition = TRUE;
			}
		} else {
			// IE8/IE7/IE6
			_bActiveXEdition = TRUE;
		}
	} else if(_bSafari){
		_tmp = _nSafari;
		_tmp = _tmp.slice(0, _tmp.indexOf('.'));
			
		// safari
		if(_tmp >= 7){
			_bHTML5Edition = TRUE;
		} else {
			_bPluginEdition = TRUE;
		}
	} else {
		// other browser: plugin version
		_bPluginEdition = TRUE;
	}
	

	if(_host === ''){
		if (_bWin && _path.lastIndexOf('\\') > 1){
			_path = _path.substring(1, _path.lastIndexOf('\\')).replace(/%20/g, ' ');
		}else{
			_pathType = 1;
			_path = _path.substring(1, _path.lastIndexOf('/')).replace(/%20/g, ' ');
		}
	} else {
		_pathType = 1;
		_path = _path.substring(0, _path.lastIndexOf('/'));
	}
	
	if(!_bFileSystem){
		var oldPath = Dynamsoft.WebTwainEnv.ResourcesPath;
		
		if(typeof (oldPath) == 'undefined'){
			Dynamsoft.WebTwainEnv.ResourcesPath = [_path, '/'].join('');
		} else if(oldPath.indexOf('//') < 0 && _path != '') {
			Dynamsoft.WebTwainEnv.ResourcesPath = [_path, '/', oldPath].join('');
		}
	}

	_ret = {
		product: {
			name: 'Dynamic Web TWAIN',
			
			bChromeEdition: _bHTML5Edition,
			bPluginEdition: _bPluginEdition,
			bActiveXEdition: _bActiveXEdition,
			
			// for chrome edition
			ip: _html5ip,
			wsProtocol: 'dwt_command',
			
			// for ActiveX
			_iImageCaptureDriverType: 3,
			_iBrokerProcessType: 1,
			
			getChromeEditionPath: function(){
				
				var _pkgName;
				if(_bMac){
					if(Dynamsoft.WebTwainEnv.Trial)
						_pkgName = '/DynamicWebTWAINHTML5MACTrialEdition.pkg';
					else
						_pkgName = '/DynamicWebTWAINHTML5MACFullEdition.pkg';
				} else if(_bLinux){

					if(Dynamsoft.Lib.env.isX64)
						_pkgName = '/dynamic_web_twainx64.deb';
					else
						_pkgName = '/dynamic_web_twainx86.deb';
					
				} else {
					_pkgName = '/DynamicWebTWAINHTML5Edition.exe';
				}
				
				return Dynamsoft.WebTwainEnv.ResourcesPath + _pkgName;
			},	// Chrome Edition
			
			getLinuxChromeEditionPath: function(){
				
				var _pkgName;

				if(Dynamsoft.Lib.env.isX64)
					_pkgName = '/dynamic_web_twainx64.deb';
				else
					_pkgName = '/dynamic_web_twainx86.deb';
				
				return Dynamsoft.WebTwainEnv.ResourcesPath + _pkgName;
			},	// Chrome Edition

			// The relative path of the PKG file.
			getPKGPath: function(){
				var _pkgName;
				_pkgName = '/DynamicWebTWAINMacEdition.pkg';

				return Dynamsoft.WebTwainEnv.ResourcesPath + _pkgName;
			},
			
			// The relative path of the MSI file.
			getMSIPath: 	function(){ return Dynamsoft.WebTwainEnv.ResourcesPath + '/DynamicWebTWAINPlugIn.msi'; },

			// The relative path of the x86 cab file.
			getActiveXCABx86Path: function(){ 
			if(!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB)
			    return Dynamsoft.WebTwainEnv.ResourcesPath + '/DynamicWebTWAINActiveX.exe'; 
			else
			    return Dynamsoft.WebTwainEnv.ResourcesPath + '/DynamicWebTWAIN.cab'; 
			},

			// The relative path of the x64 cab file.
			getActiveXCABx64Path: function(){ 
			if(!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB)
			    return Dynamsoft.WebTwainEnv.ResourcesPath + '/DynamicWebTWAINActiveX.exe'; 
			else
				return Dynamsoft.WebTwainEnv.ResourcesPath + '/DynamicWebTWAINx64.cab';  },
			
			strMIMEType: 'Application/DynamicWebTwain-Plugin',
			strProClassID: '5220cb21-c88d-11cf-b347-00aa00a28331',  			
			strFullClassID: 'E7DA7F8D-27AB-4EE9-8FC0-3FEC9ECFE758',
			strTrialClassID: 'FFC6F181-A5CF-4ec4-A441-093D7134FBF2'
		},
		env:{
			bIE: _bIE,
			bChrome: _bChrome,
			bFirefox: _bFirefox,
			bSafari: _bSafari,
			
			bWin: _bWin,
			bWin64: (ua.indexOf('win64') != -1 || ua.indexOf('x64') != -1), //  remove ||  ua.indexOf('wow64') != -1
			isX64: _isX64,
			bMac: _bMac,
			bLinux: _bLinux,
			
			iPluginLength: _bIE ? 0: navigator.plugins.length,
			strChromeVersion : _bChrome ? _strChromeVersion : '',
			strFirefoxVersion : _bFirefox ? _strFirefoxVersion : '',
			strIEVersion: _bIE ? _strIEVersion : '',
			
			bFileSystem: _bFileSystem,
			basePath: _path,
			pathType: _pathType
		},
		config:{
			debug: FALSE,
			devMode: FALSE,
			usingMainMode: FALSE,
			bDiscardBlankImage: FALSE,
			msg: [],
			msgPrefix: '<span style="color:#cE5E04"><b>',
			msgSuffix: '</b></span><br />'
		},
		detect:{
			ssl: _ssl,
			cTwainIndex: 0,
			arySTwains: [],

			bFirst: TRUE,
			bOK: FALSE,
			bNoControlEvent: FALSE,
			__dialog: FALSE,
			scriptLoaded: FALSE,

			// for chrome
			detectType: _ssl ? 1 : (_protocol === 'http:' || _host==='') ? 0 : -1,	// 0: http, 1:https, -1:alls
			tryTimes: 0,
			
		
			ports: [{port:18619,ssl:TRUE}, {port:5492,ssl:TRUE}, {port:6679,ssl:TRUE}, {port:8992,ssl:TRUE},
					{port:18618,ssl:FALSE}, {port:5491,ssl:FALSE}, {port:6678,ssl:FALSE}, {port:8991,ssl:FALSE}],		

			cUrlIndex: 0,
			urls: [],

			onNoControl: FALSE,
			OnReady: FALSE,
			
			// old plugin only
			onNotAllowedForChrome: FALSE,
			
			// HTML5 only
			OnDetectNext: FALSE,
			OnCreatWS: FALSE
			
		},
		page : {
			bUnload: FALSE,
			OnUnload: FALSE
		},
		tmp : {
			'IfAllowLocalCache' : TRUE,
			'EmptyFunction': function () { }
		}
		
	};

	// common simple functions
	_ret.get = function (id)
	{
		if(!DL.page.bUnload)
			return document.getElementById(id);
		return FALSE;
	};

	_ret.log = function(txt){
		if(Dynamsoft.WebTwainEnv.Debug && !DL.isUndefined(window['console'])){
			var _fun = window['console']['log'];
			if(DL.isFunction(_fun)){
				window['console'].log(txt);
			}
		}
	};

	_ret.hide = function (id)
	{
		var o;
		if(typeof(id) === 'string'){
			o = _ret.get(id);
		}
		else if(id){
			o = id;
		}
			
		if(o){
			o.style.display = 'none';
		}
	};

	_ret.show = function (id)
	{
		var o;
		if(typeof(id) === 'string'){
			o = _ret.get(id);
		}
		else if(id){
			o = id;
		}
		
		if(o){
			o.style.display = '';
		}
	};

	_ret.toggle = function (id){
		var o;
		if(typeof(id) === 'string'){
			o = _ret.get(id);
		}
		else if(id){
			o = id;
		}
		
		if(o){
			if(o.style.display === 'none')
				o.style.display = '';
			else
				o.style.display = 'none';
		}
	};
	
	
	_ret.appendMessage = function(msg){
		if(typeof(msg) === 'string'){
			_ret.config.msg.push(msg);
		} else {

			if(Object.prototype.toString.call(msg) === '[object Array]'){
				for(var m in msg)
					_ret.appendMessage(msg[m]);
			}
		}
	};

	_ret.appendRichMessage = function(msg){
		_ret.appendMessage([_ret.config.msgPrefix, msg, _ret.config.msgSuffix]);
	};

	_ret.clearMessage = function(){
		if(_bIE && _strIEVersion == 8){
			// fixed IE8 bug
			_ret.config.msg.splice(0, _ret.config.msg.length);
		} else {
			_ret.config.msg.splice(0);
		}
		return TRUE;
	};
	
	_ret.getRealPath = function(f){
		if(f === undefined)
			return '';
	
		if(_ret.env.pathType == 1){
			return _ret.env.basePath + f;
		}
		
		return _ret.env.basePath + f.replace(new RegExp('/', 'g'), '\\\\');
	};

	_ret.getHex = function (_num) {
		var tmp;
		tmp = Number(_num).toString(16).toUpperCase();
		if (tmp.length == 1)
			tmp = ['0', tmp].join('');
		return tmp;
	};
	
	_ret.getColor = function (_in) {
		var tmp, b, g, r;

		b = _in >> 16;
		g = (_in & 0xFF00) >> 8;
		r = _in & 0xFF;

		tmp = ['#', _ret.getHex(r), _ret.getHex(g), _ret.getHex(b)].join('');

		return tmp;
	};
	
	_ret.replaceAll = function (srcString, str1, str2) {
		return srcString.replace(eval('/' + str1 + '/gi'), str2);
	};
	
	DL.mix(DL, _ret);
	
})(Dynamsoft.Lib);

// load Script / css
(function(DL){
	var doc = window['document'],
		head = doc.getElementsByTagName('head')[0] || doc.documentElement,
		scriptOnload = doc.createElement('script').readyState ?
			function(node, callback) {
				var oldCallback = node.onreadystatechange;
				node.onreadystatechange = function() {
					var rs = node.readyState;
					if (rs === 'loaded' || rs === 'complete') {
						node.onreadystatechange = null;
						oldCallback && oldCallback();
						callback.call(this);
					}
				};
			} :
			function(node, callback) {
				node.addEventListener('load', callback, false);
			};
			
	// getScript
	DL.getScript = function(url, _async, _callback) {
		var callback, node, u;
		if(DL.isFunction(_callback)){
			callback = _callback;
		} else {
			callback = function() {};
		}
		
		if(!DL.isString(url) || url == ''){
			callback();
			return;
		}
		
		node = doc.createElement('script');
		u =[Dynamsoft.WebTwainEnv.ResourcesPath, '/', url].join('');

		node.src = u;
		
		if(_async)
			node.async = true;
		
		node.charset = 'utf-8';
		

		scriptOnload(node, callback);
		
		head.insertBefore(node, head.firstChild);
		return node;
	};

	// getCss
	DL.getCss = function(url) {
		var node, u;
		
		if(!DL.isString(url) || url == ''){
			return;
		}

		node = doc.createElement('link');
		u =[Dynamsoft.WebTwainEnv.ResourcesPath, '/', url].join('');

		node.href = u;
		node.rel='stylesheet';
		
		head.insertBefore(node, head.firstChild);
		return node;
	};
	
})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 

// addEvent / removeEvent
(function(DL){
	var doc = window['document'], _ret, _funFixType;
	
	_funFixType = function(type){
		var _type = type;
		if(_type == 'mousewheel'){
			_type = KISSY.UA.gecko ? "DOMMouseScroll" : "mousewheel";
		}
		return _type;
	};

	_ret = {
		addEventListener : doc.addEventListener
			? function (element, type, fn) { var _type=_funFixType(type); if(element) element.addEventListener(_type, fn, false); }
			: function (element, type, fn) { var _type=_funFixType(type); if(element) element.attachEvent('on' + _type, fn); },

		removeEventListener : doc.removeEventListener
			? function (element, type, fn) { var _type=_funFixType(type); if(element) element.removeEventListener(_type, fn, false); }
			: function (element, type, fn) { var _type=_funFixType(type); if(element) element.detachEvent('on' + _type, fn); },
			

		getWheelDelta : function(evt) {
			var delta, wheelDelta = evt.wheelDelta, detail = evt.detail;

			if(wheelDelta) {
			  delta = wheelDelta / 120;
			}
			if(detail) {
			  delta = -(detail % 3 === 0 ? detail / 3 : detail);
			}
			return delta;
		}
	};
	DL.mix(DL, _ret);
})(Dynamsoft.Lib);


(function(DL){
	DL.Events = {'registedClass' : [], 'registedObjs' : []};

    //Add keydown / keyup Events
    var handler = function (e) {
        var _ret = true;
        DL.each(DL.Events.registedObjs, function (item) {
			DL.each(DL.Events.registedClass, function (cls) {
				if (item instanceof cls) {
					if (item.bFocus && item.handlerKeyDown) {
						_ret = item.handlerKeyDown(e);
						if (!_ret)
							return false;
					}
				}
			});
        });
        return _ret;
    };

	DL.addEventListener(document.documentElement, 'keydown', handler);

})(Dynamsoft.Lib);

(function(DL){

	DL.stopPropagation = function(evt){
	    var e = evt || window.event;
		if (e.preventDefault)
			e.preventDefault();

		if (e.stopPropagation)
			e.stopPropagation();

		e.returnValue = false;
		e.cancelBubble = true;
	}
})(Dynamsoft.Lib);

// an Array for addon event names

(function(DL){
	DL.Addon_Events = [];
	DL.Addon_Sendback_Events = [];
})(Dynamsoft.Lib);

// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 
(function () {
	Dynamsoft.Lib.Errors = {
	
		Server_Restarted: function (_stwain) {
			_stwain._errorCode = -2208;
			_stwain._errorString = 'The connection with the local scanning service (Dynamsoft WebTWAIN Service) encountered a problem and has been reset.';
        },

        HTML5NotSupport: function(_stwain){
			_stwain._errorCode = -2209;
			_stwain._errorString = 'The HTML5 edition does not support this method or property.';
		},
		
		HttpServerCannotEmpty: function(_stwain){
			_stwain._errorCode = -2300;
			_stwain._errorString = 'Http upload error: the HTTP Server cannot empty.';
		},
		
		NetworkError: function(_stwain){
			_stwain._errorCode = -2301;
			_stwain._errorString = 'Network error.';
		},
		InvalidResultFormat: function(_stwain){
			_stwain._errorCode = -2302;
			_stwain._errorString = 'The result format is invalid.';
		},

		UploadError: function(_stwain, bCanceled, _errorText, _errorStatus){
			if(bCanceled){
				_stwain._errorCode = -2303;
				_stwain._errorString = 'Upload cancelled.';
			} else {
				_stwain._errorCode = -2003;	// same to server error TWERR_HTTP_PROCESS
				if(_errorStatus && _errorStatus>0){
					_stwain._errorString = 'HTTP process error: ' + _errorStatus + '.';
				} else {
					_stwain._errorString = 'HTTP process error.';
				}
				
				if(_errorText){
					_stwain._errorString += ' ' + _errorText;
				}
				
			}
		},
		HttpDownloadUrlError: function(_stwain){
			_stwain._errorCode = -2304;
			_stwain._errorString = 'Http download error: the url is invalid.';
		},
		HttpDownloadError: function(_stwain, bCanceled, _errorText, _errorStatus){
			if(bCanceled) {
				_stwain._errorCode = -2305;
				_stwain._errorString = 'User cancelled the operation.';
			} else {
				_stwain._errorCode = -2003;	// same to server error TWERR_HTTP_PROCESS
				if(_errorStatus && _errorStatus>0){
					_stwain._errorString = 'HTTP process error: ' + _errorStatus + '.';
				} else {
					_stwain._errorString = 'HTTP process error.';
				}
				
				if(_errorText){
					_stwain._errorString += ' ' + _errorText;
				}
			}
		},
		UploadFileCannotEmpty: function(_stwain){
			_stwain._errorCode = -2306;
			_stwain._errorString = 'Upload Error: the upload file cannot be empty.';
		},
		InvalidWidthOrHeight: function(_stwain){
			_stwain._errorCode = -2307;
			_stwain._errorString = 'The width or height you entered is invalid.';
		},
		
		Server_Invalid: function (_stwain) {
			if(_stwain._errorCode == 0){
				_stwain._errorCode = -2308;
				_stwain._errorString = 'The local scanning service (Dynamsoft WebTWAIN Service) has been stopped.';
			}
        },
		InvalidLocalFilename: function (_stwain, m) {
			_stwain._errorCode = -2309;
			_stwain._errorString = 'The LocalFile is emtpy in ' + m + ' Function.';
        },
		
		BarCode_InvalidIndex: function (_result, m) {
			_result._errorCode = -2310;
			_result._errorString = 'The index out of range.';
        },
		BarCode_InvalidRemoteFilename: function (_result) {
			_result._errorCode = -2311;
			_result._errorString = 'The RemoteFile is emtpy in Barcode Download Function.';
        },

		ImageFileLengthCannotZero: function(_stwain){
			_stwain._errorCode = -2312;
			_stwain._errorString = 'The file length is emtpy.';
		},
		
		UploadExceededMaxSize: function(_stwain){
			_stwain._errorCode = -2313;
			_stwain._errorString = 'The size of the images you are about to upload has exceeded the allowed size.';
		},
		
		ParameterCannotEmpty: function(_stwain){
			_stwain._errorCode = -2314;
			_stwain._errorString = 'The parameter cannot be empty.';
		},
		
		Webcam_InvalidIndex: function (_result, m) {
			_result._errorCode = -2315;
			_result._errorString = 'The index out of range.';
        },
        
		Webcam_InvalidRemoteFilename: function (_result) {
			_result._errorCode = -2316;
			_result._errorString = 'The RemoteFile is emtpy in Webcam Download Function.';
        },
        
        OCR_InvalidIndex: function (_result, m) {
			_result._errorCode = -2321;
			_result._errorString = 'The index out of range.';
        },
        
        OCR_InvalidLeftOrTopOrRightOrBottom: function(_result){
			_result._errorCode = -2322;
			_result._errorString = 'The left or top or right or bottom you entered is invalid.';
		},
		
        OCR_InvalidOutputFormat: function (_result) {
			_result._errorCode = -2323;
			_result._errorString = 'The ocr output format out of range.';
        },
		
        OCR_InvalidPageSetMode: function (_result) {
			_result._errorCode = -2324;
			_result._errorString = 'The ocr page set mode out of range.';
        },
		
		InvalidIndex: function (_stwain) {
			_stwain._errorCode = -1033;
			_stwain._errorString = 'Invalid index.';
        },
		
		Pdf_InvalidRemoteFilename: function (_result) {
			_result._errorCode = -2317;
			_result._errorString = 'The RemoteFile is emtpy in Pdf Download Function.';
        },
		
		InvalidDestination: function (_stwain) {
			_stwain._errorCode = -2318;
			_stwain._errorString = 'Invalid destination file.';
        },
		
		InvalidSourceFile: function (_stwain) {
			_stwain._errorCode = -2319;
			_stwain._errorString = 'Invalid source file.';
        },
		
		InvalidFile: function (_stwain) {
			_stwain._errorCode = -2320;
			_stwain._errorString = 'Invalid file.';
        }
	};
})();
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 


(function (DL) {

    var dialogPolyfill = {}, bIE6 = false;	
	if(DL.env.bIE && DL.env.strIEVersion <= 6)
		bIE6=true;

	if (!Function.prototype.bind) { 
		Function.prototype.bind = function (oThis) { 
			if (typeof this !== "function") { 
				throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable"); 
			} 
			var aArgs = Array.prototype.slice.call(arguments, 1), 
				fToBind = this, 
				fNOP = function () {}, 
				fBound = function () { 
					return fToBind.apply(this instanceof fNOP && oThis 
						? this
						: oThis, 
					aArgs.concat(Array.prototype.slice.call(arguments))); 
				}; 
			fNOP.prototype = this.prototype; 
			fBound.prototype = new fNOP(); 
			return fBound; 
		}; 
	}
	if (!Array.prototype.indexOf)
	{
	  Array.prototype.indexOf = function(elt /*, from*/)
	  {
		var len = this.length >>> 0;
		var from = Number(arguments[1]) || 0;
		from = (from < 0)
			 ? Math.ceil(from)
			 : Math.floor(from);
		if (from < 0)
		  from += len;
		for (; from < len; from++)
		{
		  if (from in this &&
			  this[from] === elt)
			return from;
		}
		return -1;
	  };
	}

	function dispatchEvt(name, el){
		var event;
        if (document.createEvent) {
            event = document.createEvent('HTMLEvents');
            event.initEvent(name, true, true);
			
			if(el.dispatchEvent)
				el.dispatchEvent(event);
        } 
		else if (document.createEventObject) {
			event = document.createEventObject();
			event.bubbles = true;
			event.cancelable = true;
			el.fireEvent(name, event);
		}
		else {
            event = new Event(name);
			if(el.dispatchEvent)
				el.dispatchEvent(event);
        }
	}
	
    dialogPolyfill.reposition = function (element) {
        var scrollTop, topValue, innerHeight;
		
		scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
		
		if(window.innerHeight)
			innerHeight = window.innerHeight;
		else
			innerHeight = document.documentElement.clientHeight;
		
        topValue = scrollTop + (innerHeight - element.offsetHeight) / 2;
		
        element.style.top = topValue + 'px';
        element.dialogPolyfillInfo.isTopOverridden = true;
    };

    dialogPolyfill.inNodeList = function (nodeList, node) {
        for (var i = 0; i < nodeList.length; ++i) {
            if (nodeList[i] == node)
                return true;
        }
        return false;
    };

    dialogPolyfill.isInlinePositionSetByStylesheet = function (element) {
        for (var i = 0; i < document.styleSheets.length; ++i) {
            var styleSheet = document.styleSheets[i];
            var cssRules = null;
            // Some browsers throw on cssRules.
            try {
                cssRules = styleSheet.cssRules;
            } catch (e) { }
            if (!cssRules)
                continue;
            for (var j = 0; j < cssRules.length; ++j) {
                var rule = cssRules[j];
                var selectedNodes = null;
                // Ignore errors on invalid selector texts.
                try {
                    selectedNodes = document.querySelectorAll(rule.selectorText);
                } catch (e) { }
                if (!selectedNodes || !dialogPolyfill.inNodeList(selectedNodes, element))
                    continue;
                var cssTop = rule.style.getPropertyValue('top');
                var cssBottom = rule.style.getPropertyValue('bottom');
                if ((cssTop && cssTop != 'auto') || (cssBottom && cssBottom != 'auto'))
                    return true;
            }
        }
        return false;
    };

    dialogPolyfill.needsCentering = function (dialog) {
		
        var computedStyle;
		if(dialog.currentStyle) {
			//IE
			computedStyle = dialog.currentStyle;
		} else {
			//FF / Chrome / Safari
			computedStyle = getComputedStyle(dialog);
		}
		
        if (computedStyle.position != 'absolute')
            return false;

        // We must determine whether the top/bottom specified value is non-auto.  In
        // WebKit/Blink, checking computedStyle.top == 'auto' is sufficient, but
        // Firefox returns the used value. So we do this crazy thing instead: check
        // the inline style and then go through CSS rules.
        if ((dialog.style.top != 'auto' && dialog.style.top != '') ||
            (dialog.style.bottom != 'auto' && dialog.style.bottom != ''))
            return false;
        return !dialogPolyfill.isInlinePositionSetByStylesheet(dialog);
    };

    dialogPolyfill.showDialog = function (isModal) {
        if (this.open) {
            throw 'InvalidStateError: showDialog called on open dialog';
        }
        this.open = true;
        this.setAttribute('open', 'open');

        if (isModal) {
            // Find element with `autofocus` attribute or first form control
            var first_form_ctrl = null;
            var autofocus = null;
            var findElementToFocus = function (root) {
                for (var i = 0; i < root.children.length; i++) {
                    var elem = root.children[i];
                    if (first_form_ctrl === null && !elem.disabled && (
                        elem.nodeName == 'BUTTON' ||
                        elem.nodeName == 'INPUT' ||
                        elem.nodeName == 'KEYGEN' ||
                        elem.nodeName == 'SELECT' ||
                        elem.nodeName == 'TEXTAREA')) {
                        first_form_ctrl = elem;
                    }
                    if (elem.autofocus) {
                        autofocus = elem;
                        return;
                    }
                    findElementToFocus(elem);
                    if (autofocus !== null) return;
                }
            };

            findElementToFocus(this);

            if (autofocus !== null) {
                autofocus.focus();
            } else if (first_form_ctrl !== null) {
                first_form_ctrl.focus();
            }
        }

        if (dialogPolyfill.needsCentering(this))
            dialogPolyfill.reposition(this);
        if (isModal) {
            this.dialogPolyfillInfo.modal = true;
            dialogPolyfill.dm.pushDialog(this);
			

			if(bIE6){
				var backdrop = this.dialogPolyfillInfo.backdrop;
				backdrop.style.backgroundColor = '#000000';
				backdrop.style.filter = 'alpha(opacity=30)';

				this.style.position = 'absolute';
				var _this=this, vp, _initLeft, _initTop;

				_initLeft = this.currentStyle.left;
				_initTop = this.currentStyle.top;
				vp = document.compatMode === 'BackCompat' ? document.body : document.documentElement;
				
				if(_initLeft.indexOf('%')<0)
					_initLeft = Number(_initLeft.replace("px",""));
				else
					_initLeft = Number(_initLeft.replace("%","") * vp.clientWidth / 100.0);
				
				
				if(_initTop.indexOf('%')<0)
					_initTop = Number(_initTop.replace("px",""));
				else
					_initTop = Number(_initTop.replace("%","") * vp.clientHeight / 100.0);

				_this.style.left = '0';
				_this.style.top = _initTop + 'px';
				
				this._scrollFn = function() {
						var _maskTop=vp.scrollTop+"px",
							_maskLeft=vp.scrollLeft+"px",
							elOverlay= dialogPolyfill.dm.overlay,
							_backdrop = _this.dialogPolyfillInfo.backdrop;
						
						
						if((_initTop+vp.scrollTop+vp.clientHeight)<vp.scrollHeight)
							_this.style.top = _initTop+vp.scrollTop+"px";
						else
							_this.style.top = _maskTop;

						if(elOverlay)
							elOverlay.style.top = _maskTop;
						if(_backdrop)
							_backdrop.style.top = _maskTop;
						
						_this.style.left = _maskLeft;
						if(elOverlay)
							elOverlay.style.left = _maskLeft;
						if(_backdrop)
							_backdrop.style.left = _maskLeft;
						
						setTimeout(function(){_this._resizeFn();}, 100);
					};
				this._resizeFn = function(){
						var _vp = document.compatMode === 'BackCompat' ? document.body : document.documentElement,
							w=_vp.clientWidth+"px",
							h=_vp.clientHeight+"px",
							elOverlay=dialogPolyfill.dm.overlay,
							_backdrop = _this.dialogPolyfillInfo.backdrop;
						
						elOverlay.style.width = w;
						if(_backdrop)
							_backdrop.style.width = w;
						
						elOverlay.style.height = h;
						if(_backdrop)
							_backdrop.style.height = h;
						
					};
				this._scrollFn();
				window.attachEvent("onscroll", this._scrollFn);
				window.attachEvent("onload", this._resizeFn);
				window.attachEvent("onresize", this._resizeFn);
			}
        }
    };

    dialogPolyfill.close = function (retval) {
        if (!this.open)
            throw new InvalidStateError;
        this.open = false;
        this.removeAttribute('open');

        // Leave returnValue untouched in case it was set directly on the element
        if (typeof retval != 'undefined') {
            this.returnValue = retval;
        }

        // This won't match the native <dialog> exactly because if the user sets top
        // on a centered polyfill dialog, that top gets thrown away when the dialog is
        // closed. Not sure it's possible to polyfill this perfectly.
        if (this.dialogPolyfillInfo.isTopOverridden) {
            this.style.top = 'auto';
        }

        if (this.dialogPolyfillInfo.modal) {

			if(this.bIE6){
				window.detachEvent("onscroll", this._scrollFn);
				window.detachEvent("onload", this._resizeFn);
				window.detachEvent("onresize", this._resizeFn);
			}
            dialogPolyfill.dm.removeDialog(this);
        }
        // Triggering "close" event for any attached listeners on the <dialog>
        //dispatchEvt('close', this);

        return this.returnValue;
    };

    dialogPolyfill.registerDialog = function (element) {
        if (element.show) {
            // console.warn("This browser already supports <dialog>, the polyfill may not work correctly.");
        }

		
        DL.addEventListener(element, 'dialog_submit', function (e) {
            element.close(e.detail.target.value);
            e.preventDefault();
            e.stopPropagation();
        });
        element.show = dialogPolyfill.showDialog.bind(element, false);
        element.showModal = dialogPolyfill.showDialog.bind(element, true);
        element.close = dialogPolyfill.close.bind(element);
        element.dialogPolyfillInfo = {};
    };

    // The overlay is used to simulate how a modal dialog blocks the document. The
    // blocking dialog is positioned on top of the overlay, and the rest of the
    // dialogs on the pending dialog stack are positioned below it. In the actual
    // implementation, the modal dialog stacking is controlled by the top layer,
    // where z-index has no effect.
    TOP_LAYER_ZINDEX = 500000;
    MAX_PENDING_DIALOGS = 500000;

    dialogPolyfill.DialogManager = function () {
        this.pendingDialogStack = [];
        
		if(bIE6){
			this.overlay = document.createElement('iframe');
			this.overlay.style.position = 'absolute';
		} else {
			this.overlay = document.createElement('div');
			this.overlay.style.position = 'fixed';
		}
		
		this.overlay.style.display = 'block';
        this.overlay.style.left = '0px';
        this.overlay.style.top = '0px';
		this.overlay.style.margin = '0px';
		this.overlay.style.padding = '0px';
		
        this.overlay.style.backgroundColor = '#000000';
		this.overlay.style.filter = 'alpha(opacity=30)';
        this.overlay.style.opacity = '0.3';
        this.overlay.style.MozOpacity = '0.3';

        this.overlay.style.width = '100%';
		if(bIE6 && document.documentElement.clientHeight>0){
			// ie6
			this.overlay.style.height = document.documentElement.clientHeight + 'px';
		} else {
			this.overlay.style.height = '100%';
		}
		
		if(document.createEvent){
			DL.addEventListener(this.overlay, 'click', function (e) {
				var redirectedEvent = document.createEvent('MouseEvents');
				redirectedEvent.initMouseEvent(e.type, e.bubbles, e.cancelable, window,
					e.detail, e.screenX, e.screenY, e.clientX, e.clientY, e.ctrlKey,
					e.altKey, e.shiftKey, e.metaKey, e.button, e.relatedTarget);
				document.body.dispatchEvent(redirectedEvent);
			});
		}
    };

    dialogPolyfill.dm = new dialogPolyfill.DialogManager();

    dialogPolyfill.DialogManager.prototype.blockDocument = function () {
        if (!document.body.contains(this.overlay))
            document.body.appendChild(this.overlay);
    };

    dialogPolyfill.DialogManager.prototype.unblockDocument = function () {
        document.body.removeChild(this.overlay);
    };

    dialogPolyfill.DialogManager.prototype.updateStacking = function () {
        if (this.pendingDialogStack.length == 0) {
            this.unblockDocument();
            return;
        }
        this.blockDocument();

        var zIndex = TOP_LAYER_ZINDEX;
        for (var i = 0; i < this.pendingDialogStack.length; i++) {
            if (i == this.pendingDialogStack.length - 1)
                this.overlay.style.zIndex = zIndex++;
            var dialog = this.pendingDialogStack[i];
            dialog.dialogPolyfillInfo.backdrop.style.zIndex = zIndex++;
            dialog.style.zIndex = zIndex++;
        }
    };

    dialogPolyfill.DialogManager.prototype.pushDialog = function (dialog) {
        if (this.pendingDialogStack.length >= MAX_PENDING_DIALOGS) {
            throw "Too many modal dialogs";
        }

        var backdrop = document.createElement('div');
        backdrop.className='backdrop';
		if(bIE6)
			backdrop.style.position = 'absolute';
		
		if(document.createEvent){
			DL.addEventListener(backdrop, 'click', function (e) {
				var redirectedEvent = document.createEvent('MouseEvents');
				redirectedEvent.initMouseEvent(e.type, e.bubbles, e.cancelable, window,
					e.detail, e.screenX, e.screenY, e.clientX, e.clientY, e.ctrlKey,
					e.altKey, e.shiftKey, e.metaKey, e.button, e.relatedTarget);
				if(dialog.dispatchEvent)
					dialog.dispatchEvent(redirectedEvent);
			});
		}
        dialog.parentNode.insertBefore(backdrop, dialog.nextSibling);
        dialog.dialogPolyfillInfo.backdrop = backdrop;
        this.pendingDialogStack.push(dialog);
        this.updateStacking();
    };

    dialogPolyfill.DialogManager.prototype.removeDialog = function (dialog) {
		
        var index = this.pendingDialogStack.indexOf(dialog);
        if (index == -1)
            return;
        this.pendingDialogStack.splice(index, 1);
        var backdrop = dialog.dialogPolyfillInfo.backdrop;
        backdrop.parentNode.removeChild(backdrop);
        dialog.dialogPolyfillInfo.backdrop = null;
        this.updateStacking();
    };

    DL.Dialog = dialogPolyfill;
})(Dynamsoft.Lib);

// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 


KISSY.ready(function(S) {

	Dynamsoft.Lib.install = {
		'_divInstallBody': 'dwt-InstallBody',
		'_divDWTNonInstallContainerID': 'dwt-NonInstallContainerID',
		'_divDWTemessageContainer': '',
		'_dlgInstall': false,
		'bNeedUpgrade': false
	};

	Dynamsoft.Lib.install['_strDynamsoftWithClose'] =
			[
			'<div style="height:40px;width:350px;position:relative;">',
			'<span><div class="DYNLogo" ',
			'alt="Dynamsoft Corporation" border="0"></div>',
			'</span>',
			'<div style="height:30px;padding-left:205px; position:absolute; top:0; left:120px">',
			'<a href="javascript: void(0)" style="text-decoration:none; padding:15px" class="ClosetblCanNotScan">X</a>',
			'</div></div>'].join('');
		
	Dynamsoft.Lib.install['_strNonInstallDIV'] =  
			['<div style="border:1px solid #CCCCCC;text-align:center;" id="', 
				Dynamsoft.Lib.install._divDWTNonInstallContainerID, 
				'"></div>'].join('');
});

Dynamsoft.WebTwainEnv.ShowDialog = function (_dialogWidth, _dialogHeight, _strDialogMessageWithHtmlFormat, _bChangeImage) {

	var msgContainer;
	if (!Dynamsoft.Lib.get('J_waiting')) {
		
		var p=document.createElement('div');
		p.className = 'ds-dialog-wrap';
		p.style.width = '100%';
  
	    if (_bChangeImage)
	        msgContainer =
			    ['<div id="J_waiting" class="ds-dialog" style="width:455px;">',
			   '<div class="ks-dialog-header"></div>',
			   '<div class="ks-dialog-body">',
			   '<div class="ks-dialog-content"><div id="', Dynamsoft.Lib.install._divInstallBody, '"></div></div></div>',
			   '<div class="ks-dialog-footer"></div>', '</div>'];
	    else
			msgContainer =
			   ['<div id="J_waiting" class="ds-dialog">',
			   '<div class="ks-dialog-header"></div>',
			   '<div class="ks-dialog-body">',
			   '<div class="ks-dialog-content"><div id="', Dynamsoft.Lib.install._divInstallBody, '"></div></div></div>',
			   '<div class="ks-dialog-footer"></div>', '</div>'];
		
		p.innerHTML = msgContainer.join('');
		if (_bChangeImage)
		{
		    var imageEditor = KISSY.one('.D_ImageUIEditor')[0].parentNode;
		    imageEditor.appendChild(p);
		}
		else
		{
		    document.body.appendChild(p);
		}
		Dynamsoft.Lib.install._dlgFromImageEditor = _bChangeImage;
		Dynamsoft.Lib.install._dlgInstall = p;
		Dynamsoft.Lib.Dialog.registerDialog(Dynamsoft.Lib.install._dlgInstall);
	}
	
	if(_strDialogMessageWithHtmlFormat === false)
		return;

	if (_bChangeImage){
	    Dynamsoft.Lib.get(Dynamsoft.Lib.install._divInstallBody).innerHTML = [
	    '<div class="ds-dialog-body" style="height:' + _dialogHeight + 'px;width:' + _dialogWidth + 'px">',
		_strDialogMessageWithHtmlFormat,
		'</div>'].join('');
	} else {
		Dynamsoft.Lib.get(Dynamsoft.Lib.install._divInstallBody).innerHTML = [
			'<div class="ds-dialog-body" style="height:' + _dialogHeight + 'px">',
			Dynamsoft.Lib.install._strDynamsoftWithClose,
			_strDialogMessageWithHtmlFormat,
			'</div>'].join('');
	}
	
	var wrapDiv = Dynamsoft.Lib.get('J_waiting');
	wrapDiv.style.width = _dialogWidth;

	Dynamsoft.Lib.install._dlgInstall.showModal();

    for (var i = 0; i < document.links.length; i++) {
        if (document.links[i].className == 'ClosetblCanNotScan') {
            document.links[i].onclick = Dynamsoft__OnclickCloseInstallEx;
        }
    }
	
};

Dynamsoft.WebTwainEnv.OnWebTwainPreExecute = function (){
	Dynamsoft.Lib.detect.OnWebTwainPreExecute();
};

Dynamsoft.WebTwainEnv.OnWebTwainPostExecute = function (){
	Dynamsoft.Lib.detect.OnWebTwainPostExecute();
};

function Dynamsoft__OnclickCloseInstallEx(containerID) {
	var dlgInstall = Dynamsoft.Lib.install._dlgInstall;
    if (dlgInstall) {
        dlgInstall.close();
		if(Dynamsoft.Lib.install._dlgFromImageEditor)
        {
		    var imageEditor = KISSY.one('.D_ImageUIEditor')[0].parentNode;
		    imageEditor.removeChild(dlgInstall);
		}
		else
		{
		    document.body.removeChild(dlgInstall);
		}
		
        Dynamsoft.Lib.install._dlgInstall = false;
    }
	Dynamsoft.Lib.install.bNeedUpgrade = false;
	
	var tmp = Dynamsoft.Lib.get(Dynamsoft.Lib.install._divDWTNonInstallContainerID);
	if(tmp)
		tmp.parentNode.removeChild(tmp);
		
	if(containerID && Dynamsoft.Lib.isString(containerID)){
		Dynamsoft.Lib.show(containerID);
	} else {
		var k, ids = Dynamsoft.WebTwainEnv.Containers;
		for(k=0;k<ids.length;k++){
			Dynamsoft.Lib.show(ids[k].ContainerId);
		}
	}
	
    if (Dynamsoft.Lib.install._divDWTemessageContainer != '')
        Dynamsoft.Lib.show(Dynamsoft.Lib.install._divDWTemessageContainer);
}

(function(){
	Dynamsoft.Lib.mix(Dynamsoft.Lib.detect, {
		'global_dlg': false,
		'__dialog': false
	});

	Dynamsoft.Lib.detect.showMask = function () {
	    if(!Dynamsoft.WebTwainEnv.ScanDirectly)
		{
		    if(Dynamsoft.Lib.isFunction(OnWebTwainPreExecuteCallback)){
			    OnWebTwainPreExecuteCallback();
		    }
		    else
		        Dynamsoft.Lib.detect.OnWebTwainPreExecute();
		}
	};
	
	Dynamsoft.Lib.detect.OnWebTwainPreExecute = function () {
		if (Dynamsoft.Lib.detect.__dialog)
			return;

		var loading = [Dynamsoft.WebTwainEnv.ResourcesPath, '/reference/loading.gif'].join(''),
			imgContent = ['<div style="margin:0 auto;width:100px;line-height:300px"><img src="', loading, '" /></div>'].join('');

		var p=document.createElement('div');
		p.className = 'ds-dialog-wrap';
		p.innerHTML = imgContent;
		document.body.appendChild(p);

		Dynamsoft.Lib.detect.__dialog = p;
		Dynamsoft.Lib.Dialog.registerDialog(Dynamsoft.Lib.detect.__dialog);

		Dynamsoft.Lib.detect.__dialog.showModal();
	};

	Dynamsoft.Lib.detect.hideMask = function () {
	    if(!Dynamsoft.WebTwainEnv.ScanDirectly)
		{
		    if(Dynamsoft.Lib.isFunction(OnWebTwainPostExecuteCallback)){
			    OnWebTwainPostExecuteCallback();
		    }
		    else
		        Dynamsoft.Lib.detect.OnWebTwainPostExecute();
		}
	};
	
	Dynamsoft.Lib.detect.OnWebTwainPostExecute = function () {
		var dlg = Dynamsoft.Lib.detect.__dialog;
		if (dlg) {
			dlg.close();
			document.body.removeChild(dlg);
			Dynamsoft.Lib.detect.__dialog = false;
		}
	};
})();

// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 

(function(DL){
	var _ret = {
	
		getHexColor: function(strColor){
			var _this=this, len = strColor.length, ary=[];
			
			if(len === 7){
				ary.push(parseInt('0x' + strColor.slice(1,3)));
				ary.push(parseInt('0x' + strColor.slice(3,5)));
				ary.push(parseInt('0x' + strColor.slice(5,7)));
				return ary;
			}
			
			return [0x80,0x80,0x80];
		},
		
		// box
		drawBoxBorder: function(ctx, 
				left, top, width, height, 
				lightColor, darkColor){
				
			var _this = this, x, y, i, p, imgData, lightHex, darkHex, _left, _top, _width, _height;
			
			_left = Math.floor(left);
			_top = Math.floor(top);
			
			_width = Math.floor(width);
			_height = Math.floor(height);

			imgData = ctx.getImageData(_left, _top, _width, _height);
			p = imgData.data;
			lightHex = _this.getHexColor(lightColor);
			
			if(DL.isUndefined(darkColor))
				darkHex = lightHex;
			else
				darkHex = _this.getHexColor(darkColor);

			// Funs.output('draw border: ' + [_left, _top, _width, _height, lightHex, darkHex].join(','));

			// , border light color
			i = 0;
			for (x=0; x<_width; x++){
				p[i] = lightHex[0];
				p[i+1] = lightHex[1];
				p[i+2] = lightHex[2];
				i+=4;
			}
			
			x = 0;
			for (y=0; y<_height; y++){
				i = (y*_width + x)*4;
				p[i] = lightHex[0];
				p[i+1] = lightHex[1];
				p[i+2] = lightHex[2];
			}

			// , border dark color
			for (y=0; y<_height; y++){
				x = _width-1;
				i = (y*_width + x)*4;
				p[i] = darkHex[0];
				p[i+1] = darkHex[1];
				p[i+2] = darkHex[2];
			}
			
			i = (_height - 1) * _width * 4;
			for (x=0; x<_width; x++){
				p[i] = darkHex[0];
				p[i+1] = darkHex[1];
				p[i+2] = darkHex[2];
				i+=4;
			}
			
			ctx.putImageData(imgData, _left, _top);
		},

		drawImageWithHermite: function (srcCan, destCan, x, y, a_w2, a_h2){

			//var time1 = Date.now();

			var srcW = srcCan.width,
				srcH = srcCan.height,
				W2 = Math.min(a_w2, destCan.width),
				H2 = Math.min(a_h2, destCan.height),
				img = srcCan.getContext("2d").getImageData(0, 0, srcW, srcH),
				img2 = destCan.getContext("2d").getImageData(x, y, W2, H2),
				srcData = img.data,
				destData = img2.data,
				ratio_w = srcW / W2,
				ratio_h = srcH / H2,
				ratio_w_half = Math.ceil(ratio_w/2),
				ratio_h_half = Math.ceil(ratio_h/2), i, j;
				
			for(j = 0; j < H2; j++){
				for(i = 0; i < W2; i++){
					var gx_r = gx_g = gx_b = gx_a = 0,
						x2 = (i + j*W2) * 4,
						weight = 0,
						weights = 0,
						weights_alpha = 0,
						center_y = (j + 0.5) * ratio_h;
					
					for(var yy = Math.floor(j * ratio_h); yy < (j + 1) * ratio_h; yy++){
						var dy = Math.abs(center_y - (yy + 0.5)) / ratio_h_half,
							center_x = (i + 0.5) * ratio_w,
							w0 = dy*dy //pre-calc part of w
						
						for(var xx = Math.floor(i * ratio_w); xx < (i + 1) * ratio_w; xx++){
							var dx = Math.abs(center_x - (xx + 0.5)) / ratio_w_half,
								w = Math.sqrt(w0 + dx*dx);
								
							if(w >= -1 && w <= 1){
								//hermite filter
								weight = 2 * w*w*w - 3*w*w + 1;
								if(weight > 0){
									dx = 4*(xx + yy*srcW);
									//alpha
									gx_a += weight * srcData[dx + 3];
									weights_alpha += weight;
									//colors
									if(srcData[dx + 3] < 255)
										weight = weight * srcData[dx + 3] / 250;
									gx_r += weight * srcData[dx];
									gx_g += weight * srcData[dx + 1];
									gx_b += weight * srcData[dx + 2];
									weights += weight;
								}
							}
						}
					}
					destData[x2]     = gx_r / weights;
					destData[x2 + 1] = gx_g / weights;
					destData[x2 + 2] = gx_b / weights;
					destData[x2 + 3] = gx_a / weights_alpha;
				}
			}
			
			// console.log("hermite = "+(Math.round(Date.now() - time1)/1000)+" s");

			destCan.getContext("2d").clearRect(0, 0, destCan.width, destCan.height);
			destCan.getContext("2d").putImageData(img2, x, y);
		}
	};
	
	DL.mix(DL, _ret);
})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 


(function(DL){

	DL.DOM = {
		one : function(selector){
			return KISSY.one(selector);
		},

		getOffset : function (evt, _parent) {
			var el = evt.target,
				x = 0, y = 0, parentLeft = 0, parentTop = 0,
				scrollTop, scrollLeft, bFixed = false;
	
			while (el && !isNaN(el.offsetLeft) && !isNaN(el.offsetTop)) {

				scrollLeft = el.scrollLeft;
				scrollTop = el.scrollTop;

				if(el.tagName === 'BODY'){
					if(bFixed){
						scrollLeft = 0;
						scrollTop = 0;
					} else {
						scrollLeft = scrollLeft | document.documentElement.scrollLeft;
						scrollTop = scrollTop | document.documentElement.scrollTop;
					}
				} else {
					if(el.style.position === 'fixed'){
						bFixed = true;
					}
				}
				
				x += el.offsetLeft - scrollLeft;
				y += el.offsetTop - scrollTop;
				
				el = el.offsetParent;
			}
			
			if(_parent){
				parentLeft = _parent.Left;
				parentTop = _parent.Top;
			}

			x = evt.clientX - x - parentLeft;
			y = evt.clientY - y - parentTop;

			return { 'x': x, 'y': y };
		}
		
	};
	
	// Node functions: addClass removeClass append before style css

	// DOM functions: width height
	// IO BIO ready JSON 
})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: global
// final js: build\src.common.js
// 

// addEvent / removeEvent
(function(DL){
	
	ProgressBar.Orientation = {Horizontal: 0, Vertical: 1};
	ProgressBar.Direction = {LeftToRight: 0, RightToLeft: 1, TopToBottom: 0, BottomToTop: 1};
	ProgressBar.CreationType = {Replace: 0, AppendChild: 1};
	ProgressBar.AnimationStyle = {None: 0, Static: 1, StaticFull: 2, Custom: 3, CustomFull: 4, Flickering1: 10, Flickering2: 11, Flickering3: 12, LeftToRight1: 20, LeftToRight2: 21, RightToLeft1: 22, RightToLeft2: 23, TwoWay: 24};
	
	function ProgressBar(elementId, config) {
		var _this = this, i = 0;
		
		_this.isLoaded = false;
		_this.displayType = 0;
		_this.progress = 0.0;
		_this.progressPosition = 0;
		_this.borderWidth = {left: 0,right: 0,top: 0,bottom: 0};
		_this.orientation = (config.orientation || ProgressBar.Orientation.Horizontal);
		_this.direction = (config.direction || ProgressBar.Direction.LeftToRight);
		_this.creationType = (config.creationType || ProgressBar.CreationType.Replace);
		_this.value = 0;
		_this.initialValue = (config.value || 0);
		_this.minValue = (config.minValue || 0);
		_this.maxValue = (config.maxValue || 100);
		_this.showLabel = (typeof config.showLabel == "undefined" ? true : config.showLabel);
		_this.labelText = (config.labelText || '');
		_this.width = (config.width || 300);
		_this.height = (config.height || 20);
		_this.borderRadius = (config.borderRadius || 10);
		if (_this.orientation == ProgressBar.Orientation.Horizontal && _this.borderRadius > _this.height / 2)
			_this.borderRadius = Math.round(_this.height / 2);
		if (_this.orientation == ProgressBar.Orientation.Vertical && _this.borderRadius > _this.width / 2)
			_this.borderRadius = Math.round(_this.width / 2);
		_this.backColor = (config.backColor || '');
		_this.color = (config.color || '#fe8e14');
		_this.animationStyle = 0;
		_this.animationInterval = (config.animationInterval || 100);
		var tempClassNames = ["parent", "background", "wrapper", "left", "middle", "right", "horizontalText", "verticalText", "marker"];
		_this.extraClassName = {};
		for (i = 0; i < tempClassNames.length; i++) {
			if (!config.extraClassName) {
				_this.extraClassName[tempClassNames[i]] = ""
			} else if (typeof config.extraClassName == "string") {
				_this.extraClassName[tempClassNames[i]] = config.extraClassName
			} else {
				_this.extraClassName[tempClassNames[i]] = (config.extraClassName[tempClassNames[i]] || "")
			}
		}
		_this.onLoad = (config.onLoad || null);
		_this.onValueChanged = (config.onValueChanged || null);
		_this.onAnimate = (config.onAnimate || null);
		if (_this.creationType == ProgressBar.CreationType.Replace) {
			_this.parentElement = document.getElementById(elementId)
		} else {
			_this.parentElement = document.createElement("DIV");
			document.getElementById(elementId).appendChild(_this.parentElement)
		}
		
		_this.finishLoading();
	}
	ProgressBar.prototype.finishLoading = function() {
		var _this = this, tempStyle = '', _wrapper;
		_this.wrapperElement = null;
		_this.backgroundElement = null;
		_this.valueElement = null;
		_this.leftElement = null;
		_this.middleElement = null;
		_this.rightElement = null;
		_this.backgroundElement = document.createElement("DIV");
		_this.backgroundElement.className = "progressbar_background" + (_this.extraClassName.background ? " " : "") + _this.extraClassName.background;
		_this.backgroundElement.style.cssText = _this.backgroundElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius);
		_this.parentElement.appendChild(_this.backgroundElement);
		var borderRadiusCheck = ["border-radius", "border-bottom-right-radius", "-moz-border-radius-bottomright", "-webkit-border-bottom-right-radius", "-khtml-border-radius-bottomright", "-khtml-border-bottom-right-radius"];
		var i = 0, temp = "";
		for (i = 0; i < borderRadiusCheck.length; i++) {
			temp = ProgressBar._elementCurrentStyle(_this.backgroundElement, borderRadiusCheck[i]);
			if (temp || typeof temp == "string")
				break
		}
		if (temp != "" && ProgressBar._parseInt(temp) != _this.borderRadius)
			_this.borderRadius = ProgressBar._parseInt(temp);
		if ((_this.orientation == ProgressBar.Orientation.Horizontal) || (_this.orientation == ProgressBar.Orientation.Vertical)) {
			_this.displayType = 0
		} else {
			_this.displayType = 1
		}
		_this.parentElement.className = (_this.parentElement.className != "" ? " " : "") + "progressbar_parent" + (_this.extraClassName.parent ? " " : "") + _this.extraClassName.parent;
		if (_this.displayType == 0) {
			_wrapper = _this.wrapperElement = document.createElement("DIV");
			
			_wrapper.style.border = '1px solid #A0A0A0';
			_wrapper.style.cssFloat = "left";
			_wrapper.style.display = "inline-block";
			_wrapper.style.width = _this.width + "px";
			_wrapper.style.height = _this.height + "px";
			_wrapper.style.left = "0px";
			_wrapper.style.top = (-_this.height) + "px";
			_wrapper.style.backgroundColor = _this.backColor;
			_wrapper.style.backgroundRepeat = "no-repeat";
			_wrapper.style.position = "relative";
			_wrapper.style.cssText = _wrapper.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius);
			
			_this.parentElement.appendChild(_wrapper);
			_this.borderWidth = {left: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_wrapper, "border-left-width")),right: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_wrapper, "border-right-width")),top: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_wrapper, "border-top-width")),bottom: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_wrapper, "border-bottom-width"))}
		} else if (_this.displayType == 1) {
			if (_this.orientation == ProgressBar.Orientation.Horizontal) {
				if (_this.borderRadius > _this.width / 2)
					_this.borderRadius = _this.width
			} else if (_this.orientation == ProgressBar.Orientation.Vertical) {
				if (_this.borderRadius > _this.height / 2)
					_this.borderRadius = _this.height
			}
			_this.valueElement = document.createElement("DIV");
			_this.valueElement.className = "";
			_this.leftElement = document.createElement("DIV");
			_this.middleElement = document.createElement("DIV");
			_this.rightElement = document.createElement("DIV");
			
			_this.leftElement.style.border = '1px solid #A0A0A0';
			_this.leftElement.style.cssFloat = "left";
			_this.leftElement.style.display = "inline-block";
			_this.leftElement.style.backgroundColor = _this.backColor;
			_this.leftElement.style.backgroundRepeat = "no-repeat";
			_this.leftElement.style.position = "relative";
			_this.rightElement.style.border = '1px solid #A0A0A0';
			_this.rightElement.style.cssFloat = "left";
			_this.rightElement.style.display = "inline-block";
			_this.rightElement.style.backgroundColor = _this.backColor;
			_this.rightElement.style.backgroundRepeat = "no-repeat";
			_this.rightElement.style.position = "relative";
			_this.middleElement.style.border = '1px solid #A0A0A0';
			_this.middleElement.style.cssFloat = "left";
			_this.middleElement.style.display = "inline-block";
			_this.middleElement.style.overflow = "hidden";
			_this.middleElement.style.position = "relative";
			_this.valueElement.style.backgroundColor = _this.backColor;
			_this.valueElement.style.position = "relative";
			if (_this.orientation == ProgressBar.Orientation.Horizontal) {
				_this.leftElement.style.width = _this.borderRadius + "px";
				_this.leftElement.style.height = _this.height + "px";
				_this.leftElement.style.top = -_this.height + "px";
				_this.leftElement.style.left = "0px";
				_this.leftElement.style.borderRight = 'none';
				_this.leftElement.style.cssText = _this.leftElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius, 0, 0, _this.borderRadius);
				_this.rightElement.style.width = _this.borderRadius + "px";
				_this.rightElement.style.height = _this.height + "px";
				_this.rightElement.style.top = -_this.height + "px";
				_this.rightElement.style.borderLeft = 'none';
				//_this.rightElement.style.backgroundPosition = _this.borderRadius + 'px 0px';
				_this.rightElement.style.cssText = _this.rightElement.style.cssText + ProgressBar._createBorderRadiusCss(0, _this.borderRadius, _this.borderRadius, 0);
				_this.middleElement.style.width = (_this.width - (_this.borderRadius * 2)) + "px";
				_this.middleElement.style.height = _this.height + "px";
				_this.middleElement.style.top = -_this.height + "px";
				_this.middleElement.style.borderLeft = 'none';
				_this.middleElement.style.borderRight = 'none';
				_this.valueElement.style.width = "0px";
				_this.valueElement.style.height = _this.height + "px"
			} else if (_this.orientation == ProgressBar.Orientation.Vertical) {
				_this.leftElement.style.width = _this.width + "px";
				_this.leftElement.style.height = _this.borderRadius + "px";
				_this.leftElement.style.top = (-_this.height) + "px";
				_this.leftElement.style.left = "0px";
				_this.leftElement.style.borderBottom = 'none';
				_this.leftElement.style.cssText = _this.leftElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius, _this.borderRadius, 0, 0);
				_this.rightElement.style.width = _this.width + "px";
				_this.rightElement.style.height = _this.borderRadius + "px";
				_this.rightElement.style.top = (-_this.height) + "px";
				_this.rightElement.style.left = "0px";
				_this.rightElement.style.borderTop = 'none';
				//_this.rightElement.style.backgroundPosition = '0px ' + _this.borderRadius + 'px';
				_this.rightElement.style.cssText = _this.rightElement.style.cssText + ProgressBar._createBorderRadiusCss(0, 0, _this.borderRadius, _this.borderRadius);
				_this.middleElement.style.width = _this.width + "px";
				_this.middleElement.style.height = _this.height - _this.borderRadius * 2 + "px";
				_this.middleElement.style.top = (-_this.height) + "px";
				_this.middleElement.style.left = "0px";
				_this.middleElement.style.borderTop = 'none';
				_this.middleElement.style.borderBottom = 'none';
				_this.valueElement.style.width = _this.width + "px";
				_this.valueElement.style.height = "0px"
			}
			_this.middleElement.appendChild(_this.valueElement);
			_this.parentElement.appendChild(_this.leftElement);
			_this.parentElement.appendChild(_this.middleElement);
			_this.parentElement.appendChild(_this.rightElement);
			if (_this.orientation == ProgressBar.Orientation.Horizontal) {
				_this.borderWidth = {left: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_this.leftElement, "border-left-width")),right: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_this.rightElement, "border-right-width")),top: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_this.middleElement, "border-top-width")),bottom: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_this.middleElement, "border-bottom-width"))}
			} else if (_this.orientation == ProgressBar.Orientation.Vertical) {
				_this.borderWidth = {left: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_this.middleElement, "border-left-width")),right: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_this.middleElement, "border-right-width")),top: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_this.leftElement, "border-top-width")),bottom: ProgressBar._parseInt(ProgressBar._elementCurrentStyle(_this.rightElement, "border-bottom-width"))}
			}
		}
		_this.parentElement.style.width = (_this.width + _this.borderWidth.left + _this.borderWidth.right) + "px";
		_this.parentElement.style.height = (_this.height + _this.borderWidth.top + _this.borderWidth.bottom) + "px";
		_this.backgroundElement.style.cssFloat = "left";
		_this.backgroundElement.style.display = "inline-block";
		_this.backgroundElement.style.width = (_this.width + _this.borderWidth.left + _this.borderWidth.right) + "px";
		_this.backgroundElement.style.height = _this.height + "px";
		
		_this.backgroundElement.style.backgroundColor = "#FFFFFF";
		
		_this.backgroundElement.style.position = "relative";
		if (_this.displayType == 0)
			_this.backgroundElement.style.width = (_this.width + _this.borderWidth.left + _this.borderWidth.right) + "px";
		
		_this.backgroundElement.style.top = _this.borderWidth.top + "px";
		_this.markerElement = document.createElement("DIV");
		_this.markerElement.style.display = "inline-block";
		_this.markerElement.style.zoom = "1.0";
		_this.markerElement.style.width = _this.width + "px";
		_this.markerElement.style.height = _this.height + "px";
		_this.markerElement.style.top = (-_this.height * 2 - _this.borderWidth.top) + "px";
		_this.markerElement.style.left = _this.borderWidth.left + "px";
		_this.markerElement.style.backgroundColor = _this.color;
		_this.markerElement.style.lineHeight = (_this.height) + "px";
		_this.markerElement.style.position = "relative";
		_this.parentElement.appendChild(_this.markerElement);

		_this.isLoaded = true;
		_this.setValue(_this.initialValue);
		if (_this.onLoad != null)
			_this.onLoad()
	};
	ProgressBar.prototype.setValue = function(newValue) {
		var _this=this;
		if (newValue !== null && newValue < _this.minValue)
			newValue = _this.minValue;
		if (newValue !== null && newValue > _this.maxValue)
			newValue = _this.maxValue;

		if (newValue === null) {
		} else {
			_this.value = newValue
		}
		if (_this.isLoaded) {
			var progress = 0.0;
			if (_this.orientation == ProgressBar.Orientation.Horizontal) {
				progress = (_this.value / _this.maxValue) * _this.width;
				_this.progressPosition = progress;
				if (_this.displayType == 0) {
					if (_this.direction == ProgressBar.Direction.LeftToRight) {
						//_this.wrapperElement.style.backgroundPosition = (-_this.image.width + progress) + "px 0px"
					} else {
						//_this.wrapperElement.style.backgroundPosition = (_this.width - progress) + "px 0px"
					}
				} else if (_this.displayType == 1) {
					if (_this.direction == ProgressBar.Direction.LeftToRight) {
						if (progress <= _this.borderRadius) {
							//_this.leftElement.style.backgroundPosition = (-_this.image.width + progress) + "px 0px";
							//_this.rightElement.style.backgroundPosition = (-_this.image.width) + "px 0px";
							_this.valueElement.style.width = "0px"
						} else if (progress >= _this.width - _this.borderRadius) {
							//_this.leftElement.style.backgroundPosition = "0px 0px";
							//_this.rightElement.style.backgroundPosition = (-_this.image.width - (_this.width - progress - _this.borderRadius)) + "px 0px";
							_this.valueElement.style.width = _this.middleElement.style.width
						} else {
							//_this.leftElement.style.backgroundPosition = "0px 0px";
							//_this.rightElement.style.backgroundPosition = (-_this.image.width) + "px 0px";
							_this.valueElement.style.width = (progress - _this.borderRadius) + "px"
						}
					} else {
						if (progress <= _this.borderRadius) {
							//_this.leftElement.style.backgroundPosition = (_this.image.width) + "px 0px";
							//_this.rightElement.style.backgroundPosition = (_this.image.width - progress) + "px 0px";
							_this.valueElement.style.width = "0px"
						} else if (progress >= _this.width - _this.borderRadius) {
							//_this.leftElement.style.backgroundPosition = (_this.width - progress) + "px 0px";
							//_this.rightElement.style.backgroundPosition = "0px 0px";
							_this.valueElement.style.left = "0px";
							_this.valueElement.style.width = _this.middleElement.style.width
						} else {
							//_this.leftElement.style.backgroundPosition = _this.image.width + "px 0px";
							//_this.rightElement.style.backgroundPosition = "0px 0px";
							_this.valueElement.style.left = (_this.width - progress - _this.borderRadius) + "px";
							_this.valueElement.style.width = (progress - _this.borderRadius) + "px"
						}
					}
				}
				if (progress > 0) {
					if (_this.animationStyle != ProgressBar.AnimationStyle.StaticFull && _this.animationStyle != ProgressBar.AnimationStyle.CustomFull) {
						_this.markerElement.style.width = progress + "px"
					} else {
						_this.markerElement.style.width = _this.width + "px"
					}
					_this.markerElement.style.visibility = "visible"
				} else {
					_this.markerElement.style.width = _this.width + "px";
					if (_this.animationStyle != ProgressBar.AnimationStyle.StaticFull && _this.animationStyle != ProgressBar.AnimationStyle.CustomFull)
						_this.markerElement.style.visibility = "hidden"
				}
				if (_this.animationStyle != ProgressBar.AnimationStyle.StaticFull && _this.animationStyle != ProgressBar.AnimationStyle.CustomFull) {
					if (_this.direction == ProgressBar.Direction.LeftToRight) {
						_this.markerElement.style.left = _this.borderWidth.left + "px"
					} else {
						_this.markerElement.style.left = (_this.width - progress + _this.borderWidth.left) + "px"
					}
				} else {
					_this.markerElement.style.left = _this.borderWidth.left + "px"
				}
				var initTextTop = (-_this.height * 2 - _this.height - _this.borderWidth.top);
				var initMarkerTop = (-_this.height * 2 - _this.borderWidth.top);
				if (progress == 0 || _this.width == progress) {
					_this.markerElement.style.top = initMarkerTop + "px";
					_this.markerElement.style.height = _this.height + "px";
					_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius)
				} else if (progress < _this.borderRadius) {
					var markerHeight = _this.height - 2.25 * (_this.borderRadius - Math.sqrt(Math.pow(_this.borderRadius, 2) - Math.pow(_this.borderRadius - progress, 2)));
					var markerTop = initMarkerTop + (_this.height / 2) - (markerHeight / 2);
					var textTop = initTextTop - 2 * (initMarkerTop - markerTop);
					_this.markerElement.style.top = markerTop + "px";
					_this.markerElement.style.height = markerHeight + "px";
					if (_this.direction == ProgressBar.Direction.LeftToRight) {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius, 0, 0, _this.borderRadius)
					} else {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(0, _this.borderRadius, _this.borderRadius, 0)
					}
				} else if (_this.width - progress < _this.borderRadius) {
					var tempRoundness = ((_this.borderRadius - (_this.width - progress)) * 2 + (_this.borderRadius - Math.sqrt(Math.pow(_this.borderRadius, 2) - Math.pow(_this.borderRadius - (_this.width - progress), 2)))) / 3;
					if (_this.direction == ProgressBar.Direction.LeftToRight) {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius, tempRoundness, tempRoundness, _this.borderRadius)
					} else {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(tempRoundness, _this.borderRadius, _this.borderRadius, tempRoundness)
					}
				} else {
					_this.markerElement.style.top = initMarkerTop + "px";
					_this.markerElement.style.height = _this.height + "px";
					if (_this.direction == ProgressBar.Direction.LeftToRight) {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius, 0, 0, _this.borderRadius)
					} else {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(0, _this.borderRadius, _this.borderRadius, 0)
					}
				}
			} else if (_this.orientation == ProgressBar.Orientation.Vertical) {
				progress = (_this.value / _this.maxValue) * _this.height;
				_this.progressPosition = progress;
				if (_this.displayType == 0) {
					if (_this.direction == ProgressBar.Direction.TopToBottom) {
						//_this.wrapperElement.style.backgroundPosition = "0px " + (progress - _this.image.height) + "px"
					} else {
						//_this.wrapperElement.style.backgroundPosition = "0px " + (_this.height - progress) + "px"
					}
				} else if (_this.displayType == 1) {
					if (_this.direction == ProgressBar.Direction.TopToBottom) {
						if (progress <= _this.borderRadius) {
							//_this.leftElement.style.backgroundPosition = "0px " + (-_this.image.height + progress) + "px";
							//_this.rightElement.style.backgroundPosition = "0px " + (-_this.image.height) + "px";
							_this.valueElement.style.height = "0px"
						} else if (progress >= _this.height - _this.borderRadius) {
							//_this.leftElement.style.backgroundPosition = "0px 0px";
							//_this.rightElement.style.backgroundPosition = "0px " + (-_this.image.height - (_this.height - progress - _this.borderRadius)) + "px";
							_this.valueElement.style.height = _this.middleElement.style.height
						} else {
							//_this.leftElement.style.backgroundPosition = "0px 0px";
							//_this.rightElement.style.backgroundPosition = "0px " + (-_this.image.height) + "px";
							_this.valueElement.style.height = (progress - _this.borderRadius) + "px"
						}
					} else {
						if (progress <= _this.borderRadius) {
							//_this.leftElement.style.backgroundPosition = "0px " + (_this.borderRadius) + "px";
							//_this.rightElement.style.backgroundPosition = "0px " + (_this.borderRadius - progress) + "px";
							_this.valueElement.style.height = "0px"
						} else if (progress >= _this.height - _this.borderRadius) {
							//_this.leftElement.style.backgroundPosition = "0px " + (_this.height - progress) + "px";
							//_this.rightElement.style.backgroundPosition = "0px 0px";
							_this.valueElement.style.top = "0px";
							_this.valueElement.style.height = _this.middleElement.style.height
						} else {
							//_this.leftElement.style.backgroundPosition = "0px " + _this.borderRadius + "px";
							//_this.rightElement.style.backgroundPosition = "0px 0px";
							_this.valueElement.style.top = (_this.height - progress - _this.borderRadius) + "px";
							_this.valueElement.style.height = (progress + _this.borderRadius * 2) + "px"
						}
					}
				}
				if (progress > 0) {
					if (_this.animationStyle != ProgressBar.AnimationStyle.StaticFull && _this.animationStyle != ProgressBar.AnimationStyle.CustomFull) {
						_this.markerElement.style.height = progress + "px"
					} else {
						_this.markerElement.style.height = _this.height + "px";
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius)
					}
					_this.markerElement.style.visibility = "visible"
				} else {
					_this.markerElement.style.height = 0 + "px";
					if (_this.animationStyle != ProgressBar.AnimationStyle.StaticFull && _this.animationStyle != ProgressBar.AnimationStyle.CustomFull)
						_this.markerElement.style.visibility = "hidden"
				}
				var initTextLeft = _this.borderWidth.left;
				var initMarkerLeft = _this.borderWidth.left;
				if (progress == 0 || _this.height == progress) {
					_this.markerElement.style.left = initMarkerLeft + "px";
					_this.markerElement.style.width = _this.width + "px";
					_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius)
				} else if (progress < _this.borderRadius) {
					var markerWidth = 2.5 * progress;
					if (markerWidth > _this.width)
						markerWidth = _this.width;
					var markerLeft = initMarkerLeft + (_this.width / 2) - (markerWidth / 2);
					_this.markerElement.style.left = markerLeft + "px";
					_this.markerElement.style.width = markerWidth + "px";
					if (_this.direction == ProgressBar.Direction.BottomToTop) {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(0, 0, _this.borderRadius, _this.borderRadius)
					} else {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius, _this.borderRadius, 0, 0)
					}
				} else if (_this.height - progress < _this.borderRadius) {
					var tempRoundness = ((_this.borderRadius - (_this.height - progress)) * 2 + (_this.borderRadius - Math.sqrt(Math.pow(_this.borderRadius, 2) - Math.pow(_this.borderRadius - (_this.height - progress), 2)))) / 3;
					if (_this.direction == ProgressBar.Direction.BottomToTop) {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(tempRoundness, tempRoundness, _this.borderRadius, _this.borderRadius)
					} else {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius, _this.borderRadius, tempRoundness, tempRoundness)
					}
				} else {
					_this.markerElement.style.left = initMarkerLeft + "px";
					_this.markerElement.style.width = _this.width + "px";
					if (_this.direction == ProgressBar.Direction.BottomToTop) {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(0, 0, _this.borderRadius, _this.borderRadius)
					} else {
						_this.markerElement.style.cssText = _this.markerElement.style.cssText + ProgressBar._createBorderRadiusCss(_this.borderRadius, _this.borderRadius, 0, 0)
					}
				}

				if (_this.animationStyle != ProgressBar.AnimationStyle.StaticFull && _this.animationStyle != ProgressBar.AnimationStyle.CustomFull) {
					if (_this.direction == ProgressBar.Direction.TopToBottom) {
						_this.markerElement.style.top = (-_this.height * 2 - _this.borderWidth.top) + "px"
					} else {
						_this.markerElement.style.top = (-_this.height - progress - _this.borderWidth.top) + "px"
					}
				} else {
					_this.markerElement.style.top = (-_this.height * 2 - _this.borderWidth.top) + "px"
				}
			}
			_this.progress = (_this.value / _this.maxValue);
			
		}
		if (_this.onValueChanged != null)
			_this.onValueChanged()
	};
	ProgressBar._elementCurrentStyle = function(element, styleName) {
		if (element.currentStyle) {
			var i = 0, temp = "", changeCase = false;
			for (i = 0; i < styleName.length; i++)
				if (styleName[i].toString() != '-') {
					temp += (changeCase ? styleName[i].toString().toUpperCase() : styleName[i].toString());
					changeCase = false
				} else {
					changeCase = true
				}
			styleName = temp;
			return element.currentStyle[styleName]
		} else {
			return getComputedStyle(element, null).getPropertyValue(styleName)
		}
	};
	ProgressBar._parseInt = function(val) {
		var ret = parseInt(val);
		if (isNaN(ret))
			ret = 0;
		return ret
	};
	ProgressBar._createBorderRadiusCss = function(leftTopRadius, rightTopRadius, rightBottomRadius, leftBottomRadius) {
		if (leftTopRadius != null && rightTopRadius == null && rightBottomRadius == null && leftBottomRadius == null) {
			return "; -moz-border-radius: " + leftTopRadius + "px; -ms-border-radius: " + leftTopRadius + "px; -o-border-radius: " + leftTopRadius + "px; -webkit-border-radius: " + leftTopRadius + "px; -khtml-border-radius: " + leftTopRadius + "px; border-radius: " + leftTopRadius + "px;"
		} else {
			leftTopRadius = (leftTopRadius || 0);
			rightTopRadius = (rightTopRadius || 0);
			rightBottomRadius = (rightBottomRadius || 0);
			leftBottomRadius = (leftBottomRadius || 0);
			return "; -moz-border-radius: " + leftTopRadius + "px " + rightTopRadius + "px " + rightBottomRadius + "px " + leftBottomRadius + "px; -ms-border-radius: " + leftTopRadius + "px " + rightTopRadius + "px " + rightBottomRadius + "px " + leftBottomRadius + "px; -o-border-radius: " + leftTopRadius + "px " + rightTopRadius + "px " + rightBottomRadius + "px " + leftBottomRadius + "px; -webkit-border-radius: " + leftTopRadius + "px " + rightTopRadius + "px " + rightBottomRadius + "px " + leftBottomRadius + "px; -khtml-border-radius: " + leftTopRadius + "px " + rightTopRadius + "px " + rightBottomRadius + "px " + leftBottomRadius + "px; border-radius: " + leftTopRadius + "px " + rightTopRadius + "px " + rightBottomRadius + "px " + leftBottomRadius + "px;"
		}
	};
	
	DL.ProgressBar = ProgressBar;
})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: plugin ( noneie plugin & ActiveX )
// final js: build\src.plugin.js
// 


(function(DL){
	if (!DL.product.bPluginEdition && !DL.product.bActiveXEdition){
		return;
	}
	
// Super amazing, cross browser property function
if(!Object.defineProperty){
	Object.defineProperty = function(obj, name, _objGetSet){
		
		// wrapper functions
		var oldValue = obj[name],
			getFn = function () {
				return _objGetSet.get.apply(obj, [oldValue]);
			},
			setFn = function (newValue) {
				return oldValue = _objGetSet.set.apply(obj, [newValue]);
			};

		// Older Mozilla
		if (obj.__defineGetter__) {
			obj.__defineGetter__(name, getFn);
			obj.__defineSetter__(name, setFn);
		// IE6-7
		// must be a real DOM object (to have attachEvent) and must be attached to document (for onpropertychange to fire)
		} else {
	 
			var onPropertyChange = function (e) {
	 
				if (event.propertyName == name) {
					// temporarily remove the event so it doesn't fire again and create a loop
					obj.detachEvent("onpropertychange", onPropertyChange);
	 
					// get the changed value, run it through the set function
					var newValue = setFn(obj[name]);
	 
					// restore the get function
					obj[name] = getFn;
					obj[name].toString = getFn;
	 
					// restore the event
					obj.attachEvent("onpropertychange", onPropertyChange);
				}
			};  
	 
			obj[name] = getFn;
			obj[name].toString = getFn;

			obj.attachEvent("onpropertychange", onPropertyChange);
		}
	};
}

	var TRUE=!0, FALSE=!1, Funs = {
		isFunction : function(_fun){
			return _fun && typeof(_fun) === 'function';
		},
		
		
		checkErrorString : function(_st) {
			var errCode = _st.getSWebTwain().ErrorCode;
			if (errCode == 0) {
				return TRUE;
			}
			
			return FALSE;
		},
		
		wrapperRet : function(_st, _ret, sFun, fFun, bResponseString){
			if(Funs.checkErrorString(_st)){
				if(Funs.isFunction(sFun))
				{
					if(bResponseString)
						sFun(_st.getSWebTwain().HTTPPostResponseString);
					else
						sFun();
				}
			}else{
				if(Funs.isFunction(fFun))
				{
					 if(bResponseString)
						fFun(_st.getSWebTwain().ErrorCode, _st.getSWebTwain().ErrorString, _st.getSWebTwain().HTTPPostResponseString);
					  else
						fFun(_st.getSWebTwain().ErrorCode, _st.getSWebTwain().ErrorString);
				 }
			}
			
			return _ret;
		},
		
		// 0:BMP, 1:JPEG, 2:TIFF, 3:PNG, 4:PDF, 5:GIF
		getImageType : function(file){
			var len = file.length;
			if(len<4){
				return -1;
			}
			
			var nPos = file.lastIndexOf('.');
			if(nPos === -1)
				return -1;
			
			var tails = file.slice(nPos).toLowerCase();
			if(tails === '.bmp' || tails === '.dib')
				return 0;
			if(tails === '.jpg' || tails === '.jpe' ||  tails === '.jpeg' ||  tails === '.jfif')
				return 1;
			if(tails === '.tif' || tails === '.tiff')
				return 2;
			if(tails === '.png')
				return 3;
			if(tails === '.pdf')
				return 4;
			if(tails === '.gif')
				return 5;

			return -1;
		},
		replaceLocalFilename: function(_file){
			var f = _file;
			
			if(DL.env.bFileSystem)
				f = decodeURI(f);
			
			return f;
		},
		makeParams : function(){
			var args = arguments;
			if(args === undefined || args.length === 0)
				return undefined;
			else{
				return args;
			}
		}

	};

	DL.wrapperRet = Funs.wrapperRet;
	
	DL.DynamicLoadAddonFuns = [];
	
	// Load addon
	DL.attachAddon = function(st){
		DL.each(DL.DynamicLoadAddonFuns, function (aFun) {
			if (DL.isFunction(aFun)) {
				aFun(st);
			}
		});
	};
	
	// properties (get/set) / sync functions
	DL.attachProperty = function (st){

		// --- Other property start --

		Object.defineProperty(st, 'ErrorCode', {
			get : function(){// read-only
				return st.getSWebTwain().ErrorCode;
			}
		});

		Object.defineProperty(st, 'ErrorString', {
			get : function(){// read-only
				return st.getSWebTwain().ErrorString;
			}
		});
		
		
		Object.defineProperty(st, 'LogLevel', { get : function (){
			return st.getSWebTwain().LogLevel;
		}, set : function (v){
			v = v*1;
			st.getSWebTwain().LogLevel = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'Manufacturer', { get : function (){
			return st.getSWebTwain().Manufacturer;
		}, set : function (v){
			st.getSWebTwain().Manufacturer = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'ProductFamily', { get : function (){
			return st.getSWebTwain().ProductFamily;
		}, set : function (v){
			st.getSWebTwain().ProductFamily = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'ProductKey', { get : function (){
			return Dynamsoft.WebTwainEnv.ProductKey;
		}, set : function (v){
			Dynamsoft.WebTwainEnv.ProductKey = v;
			st.getSWebTwain().ProductKey = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'ProductName', { get : function (){
			return st.getSWebTwain().ProductName;
		}, set : function (v){
			st.getSWebTwain().ProductName = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'VersionInfo', { get : function (){
			return st.getSWebTwain().VersionInfo;
		}, set : function (v){
			st.getSWebTwain().VersionInfo = v;
			return TRUE;
		}});
		
		// --- Other property end --

		
		// --- SCAN property start --
	
	
		Object.defineProperty(st, 'BitDepth', { get : function (){
			return st.getSWebTwain().BitDepth;
		}, set : function (v){
			st.getSWebTwain().BitDepth = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'Brightness', { get : function (){
			return st.getSWebTwain().Brightness;
		}, set : function (v){
			st.getSWebTwain().Brightness = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'Contrast', { get : function (){
			return st.getSWebTwain().Contrast;
		}, set : function (v){
			st.getSWebTwain().Contrast = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CurrentSourceName', { get : function (){
			return st.getSWebTwain().CurrentSourceName;
		}});
		// Object.defineProperty(st, 'CurrentSourceName', { set : function (v){
			// return st.getSWebTwain().CurrentSourceName = v;
		// }});
		
		Object.defineProperty(st, 'DataSourceStatus', { get : function (){
			return st.getSWebTwain().DataSourceStatus;
		}});
		// Object.defineProperty(st, 'DataSourceStatus', { set : function (v){
			// return st.getSWebTwain().DataSourceStatus = v;
		// }});
		
		Object.defineProperty(st, 'DefaultSourceName', { get : function (){
			return st.getSWebTwain().DefaultSourceName;
		}});
		// Object.defineProperty(st, 'DefaultSourceName', { set : function (v){
			// return st.getSWebTwain().DefaultSourceName = v;
		// }});
		
		Object.defineProperty(st, 'Duplex', { get : function (){
			return st.getSWebTwain().Duplex;
		}});
		// Object.defineProperty(st, 'Duplex', { set : function (v){
			// return st.getSWebTwain().Duplex = v;
		// }});
		
		Object.defineProperty(st, 'IfAppendImage', { get : function (){
			return st.getSWebTwain().IfAppendImage;
		}, set : function (v){
			st.getSWebTwain().IfAppendImage = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfAutoBright', { get : function (){
			return st.getSWebTwain().IfAutoBright;
		}, set : function (v){
			st.getSWebTwain().IfAutoBright = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfAutoDiscardBlankpages', { get : function (){
			return st.getSWebTwain().IfAutoDiscardBlankpages;
		}, set : function (v){
			st.getSWebTwain().IfAutoDiscardBlankpages = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfAutoFeed', { get : function (){
			return st.getSWebTwain().IfAutoFeed;
		}, set : function (v){
			st.getSWebTwain().IfAutoFeed = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfAutomaticBorderDetection', { get : function (){
			return st.getSWebTwain().IfAutomaticBorderDetection;
		}, set : function (v){
			st.getSWebTwain().IfAutomaticBorderDetection = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfAutomaticDeskew', { get : function (){
			return st.getSWebTwain().IfAutomaticDeskew;
		}, set : function (v){
			st.getSWebTwain().IfAutomaticDeskew = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfAutoScan', { get : function (){
			return st.getSWebTwain().IfAutoScan;
		}, set : function (v){
			st.getSWebTwain().IfAutoScan = v;
			return TRUE;
		}});
		
//			Object.defineProperty(st, 'IfDeviceOnline', { get : function (){
//				return st.getSWebTwain().IfDeviceOnline;
//			}});
		// Object.defineProperty(st, 'IfDeviceOnline', { set : function (v){
			// return st.getSWebTwain().IfDeviceOnline = v;
		// }});
		
		Object.defineProperty(st, 'IfDisableSourceAfterAcquire', { get : function (){
			return st.getSWebTwain().IfDisableSourceAfterAcquire;
		}, set : function (v){
			st.getSWebTwain().IfDisableSourceAfterAcquire = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfDuplexEnabled', { get : function (){
			return st.getSWebTwain().IfDuplexEnabled;
		}, set : function (v){
			st.getSWebTwain().IfDuplexEnabled = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfFeederEnabled', { get : function (){
			return st.getSWebTwain().IfFeederEnabled;
		}, set : function (v){
			st.getSWebTwain().IfFeederEnabled = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfFeederLoaded', { get : function (){
			return st.getSWebTwain().IfFeederLoaded;
		}});
		// Object.defineProperty(st, 'IfFeederLoaded', { set : function (v){
			// return st.getSWebTwain().IfFeederLoaded = v;
		// }});
		
		Object.defineProperty(st, 'IfModalUI', { get : function (){
			return st.getSWebTwain().IfModalUI;
		}, set : function (v){
			st.getSWebTwain().IfModalUI = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfPaperDetectable', { get : function (){
			return st.getSWebTwain().IfPaperDetectable;
		}});
		// Object.defineProperty(st, 'IfPaperDetectable', { set : function (v){
			// return st.getSWebTwain().IfPaperDetectable = v;
		// }});
		
		Object.defineProperty(st, 'IfScanInNewThread', { get : function (){
			return st.getSWebTwain().IfScanInNewThread;
		}, set : function (v){
			st.getSWebTwain().IfScanInNewThread = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfShowCancelDialogWhenImageTransfer', { get : function (){
			return st.getSWebTwain().IfShowCancelDialogWhenImageTransfer;
		}, set : function (v){
			st.getSWebTwain().IfShowCancelDialogWhenImageTransfer = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfShowUI', { get : function (){
			return st.getSWebTwain().IfShowUI;
		}, set : function (v){
			st.getSWebTwain().IfShowUI = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfShowIndicator', { get : function (){
			return st.getSWebTwain().IfShowIndicator;
		}, set : function (v){
			st.getSWebTwain().IfShowIndicator = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfUseTwainDSM', { get : function (){
			return st.getSWebTwain().IfUseTwainDSM;
		}, set : function (v){
			st.getSWebTwain().IfUseTwainDSM = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfUIControllable', { get : function (){
			return st.getSWebTwain().IfUIControllable;
		}});
		// Object.defineProperty(st, 'IfUIControllable', { set : function (v){
			// return st.getSWebTwain().IfUIControllable = v;
		// }});
		
		Object.defineProperty(st, 'ImageBitsPerPixel', { get : function (){
			return st.getSWebTwain().ImageBitsPerPixel;
		}});
		// Object.defineProperty(st, 'ImageBitsPerPixel', { set : function (v){
			// return st.getSWebTwain().ImageBitsPerPixel = v;
		// }});
		
		Object.defineProperty(st, 'ImageCaptureDriverType', { get : function (){
			return st.getSWebTwain().ImageCaptureDriverType;
		}, set : function (v){
			st.getSWebTwain().ImageCaptureDriverType = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'ImageLayoutDocumentNumber', { get : function (){
			return st.getSWebTwain().ImageLayoutDocumentNumber;
		}});
		// Object.defineProperty(st, 'ImageLayoutDocumentNumber', { set : function (v){
			// return st.getSWebTwain().ImageLayoutDocumentNumber = v;
		// }});
		
		Object.defineProperty(st, 'ImageLayoutFrameBottom', { get : function (){
			return st.getSWebTwain().ImageLayoutFrameBottom;
		}});
		// Object.defineProperty(st, 'ImageLayoutFrameBottom', { set : function (v){
			// return st.getSWebTwain().ImageLayoutFrameBottom = v;
		// }});
		
		Object.defineProperty(st, 'ImageLayoutFrameLeft', { get : function (){
			return st.getSWebTwain().ImageLayoutFrameLeft;
		}});
		// Object.defineProperty(st, 'ImageLayoutFrameLeft', { set : function (v){
			// return st.getSWebTwain().ImageLayoutFrameLeft = v;
		// }});
		
		Object.defineProperty(st, 'ImageLayoutFrameNumber', { get : function (){
			return st.getSWebTwain().ImageLayoutFrameNumber;
		}});
		// Object.defineProperty(st, 'ImageLayoutFrameNumber', { set : function (v){
			// return st.getSWebTwain().ImageLayoutFrameNumber = v;
		// }});
		
		Object.defineProperty(st, 'ImageLayoutFrameRight', { get : function (){
			return st.getSWebTwain().ImageLayoutFrameRight;
		}});
		// Object.defineProperty(st, 'ImageLayoutFrameRight', { set : function (v){
			// return st.getSWebTwain().ImageLayoutFrameRight = v;
		// }});
		
		Object.defineProperty(st, 'ImageLayoutFrameTop', { get : function (){
			return st.getSWebTwain().ImageLayoutFrameTop;
		}});
		// Object.defineProperty(st, 'ImageLayoutFrameTop', { set : function (v){
			// return st.getSWebTwain().ImageLayoutFrameTop = v;
		// }});
		
		Object.defineProperty(st, 'ImageLayoutPageNumber', { get : function (){
			return st.getSWebTwain().ImageLayoutPageNumber;
		}});
		// Object.defineProperty(st, 'ImageLayoutPageNumber', { set : function (v){
			// return st.getSWebTwain().ImageLayoutPageNumber = v;
		// }});
		
		Object.defineProperty(st, 'ImageLength', { get : function (){
			return st.getSWebTwain().ImageLength;
		}});
		// Object.defineProperty(st, 'ImageLength', { set : function (v){
			// return st.getSWebTwain().ImageLength = v;
		// }});
		
		Object.defineProperty(st, 'ImagePixelType', { get : function (){
			return st.getSWebTwain().ImagePixelType;
		}});
		// Object.defineProperty(st, 'ImagePixelType', { set : function (v){
			// return st.getSWebTwain().ImagePixelType = v;
		// }});
		
		Object.defineProperty(st, 'ImageWidth', { get : function (){
			return st.getSWebTwain().ImageWidth;
		}});
		// Object.defineProperty(st, 'ImageWidth', { set : function (v){
			// return st.getSWebTwain().ImageWidth = v;
		// }});
		
		Object.defineProperty(st, 'ImageXResolution', { get : function (){
			return st.getSWebTwain().ImageXResolution;
		}});
		// Object.defineProperty(st, 'ImageXResolution', { set : function (v){
			// return st.getSWebTwain().ImageXResolution = v;
		// }});
		
		Object.defineProperty(st, 'ImageYResolution', { get : function (){
			return st.getSWebTwain().ImageYResolution;
		}});
		// Object.defineProperty(st, 'ImageYResolution', { set : function (v){
			// return st.getSWebTwain().ImageYResolution = v;
		// }});
		
		Object.defineProperty(st, 'MagData', { get : function (){
			return st.getSWebTwain().MagData;
		}});
		// Object.defineProperty(st, 'MagData', { set : function (v){
			// return st.getSWebTwain().MagData = v;
		// }});
		
		Object.defineProperty(st, 'MagType', { get : function (){
			return st.getSWebTwain().MagType;
		}});
		// Object.defineProperty(st, 'MagType', { set : function (v){
			// return st.getSWebTwain().MagType = v;
		// }});
		
		Object.defineProperty(st, 'PageSize', { get : function (){
			return st.getSWebTwain().PageSize;
		}, set : function (v){
			v = v*1;
			st.getSWebTwain().PageSize = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PendingXfers', { get : function (){
			return st.getSWebTwain().PendingXfers;
		}});
		// Object.defineProperty(st, 'PendingXfers', { set : function (v){
			// return st.getSWebTwain().PendingXfers = v;
		// }});
		
		Object.defineProperty(st, 'PixelFlavor', { get : function (){
			return st.getSWebTwain().PixelFlavor;
		}, set : function (v){
			st.getSWebTwain().PixelFlavor = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PixelType', { get : function (){
			return st.getSWebTwain().PixelType;
		}, set : function (v){
			st.getSWebTwain().PixelType = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'Resolution', { get : function (){
			return st.getSWebTwain().Resolution;
		}, set : function (v){
			v = v*1;
			st.getSWebTwain().Resolution = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'SourceCount', { get : function (){
			return st.getSWebTwain().SourceCount;
		}});
		// Object.defineProperty(st, 'SourceCount', { set : function (v){
			// return st.getSWebTwain().SourceCount = v;
		// }});
		
		Object.defineProperty(st, 'TransferMode', { get : function (){
			return st.getSWebTwain().TransferMode;
		}, set : function (v){
			st.getSWebTwain().TransferMode = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'Unit', { get : function (){
			return st.getSWebTwain().Unit;
		}, set : function (v){
			st.getSWebTwain().Unit = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'XferCount', { get : function (){
			return st.getSWebTwain().XferCount;
		}, set : function (v){
			v = v*1;
			st.getSWebTwain().XferCount = v;
			return TRUE;
		}});
		
		// capability
		//	Object.defineProperty(st, 'IfUIControllable', { set : function (v){
			// return st.getSWebTwain().IfUIControllable = v;
		// }});
		Object.defineProperty(st, 'Capability', { get : function (){
			return st.getSWebTwain().Capability;
		}, set : function (v){
			st.getSWebTwain().Capability = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapCurrentIndex', { get : function (){
			return st.getSWebTwain().CapCurrentIndex;
		}, set : function (v){
			st.getSWebTwain().CapCurrentIndex = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapCurrentValue', { get : function (){
			return st.getSWebTwain().CapCurrentValue;
		}, set : function (v){
			st.getSWebTwain().CapCurrentValue = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapDefaultIndex', { get : function (){
			return st.getSWebTwain().CapDefaultIndex;
		}});
		// Object.defineProperty(st, 'CapDefaultIndex', { set : function (v){
			// return st.getSWebTwain().CapDefaultIndex = v;
		// }});
		
		Object.defineProperty(st, 'CapDefaultValue', { get : function (){
			return st.getSWebTwain().CapDefaultValue;
		}});
		// Object.defineProperty(st, 'CapDefaultValue', { set : function (v){
			// return st.getSWebTwain().CapDefaultValue = v;
		// }});
		
		Object.defineProperty(st, 'CapDescription', { get : function (){
			return st.getSWebTwain().CapDescription;
		}, set : function (v){
			st.getSWebTwain().CapDescription = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapMaxValue', { get : function (){
			return st.getSWebTwain().CapMaxValue;
		}, set : function (v){
			st.getSWebTwain().CapMaxValue = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapMinValue', { get : function (){
			return st.getSWebTwain().CapMinValue;
		}, set : function (v){
			st.getSWebTwain().CapMinValue = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapNumItems', { get : function (){
			return st.getSWebTwain().CapNumItems;
		}, set : function (v){
			st.getSWebTwain().CapNumItems = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapStepSize', { get : function (){
			return st.getSWebTwain().CapStepSize;
		}, set : function (v){
			st.getSWebTwain().CapStepSize = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapType', { get : function (){
			return st.getSWebTwain().CapType;
		}, set : function (v){
			st.getSWebTwain().CapType = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapValue', { get : function (){
			return st.getSWebTwain().CapValue;
		}, set : function (v){
			st.getSWebTwain().CapValue = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapValueString', { get : function (){
			return st.getSWebTwain().CapValueString;
		}, set : function (v){
			st.getSWebTwain().CapValueString = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CapValueType', { get : function (){
			return st.getSWebTwain().CapValueType;
		}, set : function (v){
			st.getSWebTwain().CapValueType = v;
			return TRUE;
		}});
		// --- SCAN property end --
		
		
		
		
		
		
		
		// --- View & Edit property start --
		Object.defineProperty(st, 'AllowMultiSelect', { get : function() {
			return st.getSWebTwain().AllowMultiSelect;
		}, set : function (v){
			st.getSWebTwain().AllowMultiSelect = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'BackgroundColor', { get : function() {
			return st.getSWebTwain().BackgroundColor;
		}, set : function (v){
			st.getSWebTwain().BackgroundColor = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'BackgroundFillColor', { get : function() {
			return st.getSWebTwain().BackgroundFillColor;
		}, set : function (v){
			st.getSWebTwain().BackgroundFillColor = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'BlankImageCurrentStdDev', { get : function (){
			return st.getSWebTwain().BlankImageCurrentStdDev;
		}, set : function (v){
			// BlankImageCurrentStdDev is readonly
			return FALSE;
		}});
		
		Object.defineProperty(st, 'BlankImageMaxStdDev', { get : function (){
			return st.getSWebTwain().BlankImageMaxStdDev;
		}, set : function (v){
			st.getSWebTwain().BlankImageMaxStdDev = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'BlankImageThreshold', { get : function (){
			return st.getSWebTwain().BlankImageThreshold;
		}, set : function (v){
			st.getSWebTwain().BlankImageThreshold = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'CurrentImageIndexInBuffer', { get : function() {
			return st.getSWebTwain().CurrentImageIndexInBuffer;
		}, set : function (v){
			if(v != st.getSWebTwain().CurrentImageIndexInBuffer)
				st.getSWebTwain().CurrentImageIndexInBuffer = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'FitWindowType', { get : function() {
			return st.getSWebTwain().FitWindowType;
		}, set : function (v){
			st.getSWebTwain().FitWindowType = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'HowManyImagesInBuffer', { get : function() {
			return st.getSWebTwain().HowManyImagesInBuffer;
		}, set : function (v){
			st.getSWebTwain().HowManyImagesInBuffer = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfFitWindow', { get : function() {
			return st.getSWebTwain().IfFitWindow;
		}, set : function (v){
			st.getSWebTwain().IfFitWindow = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'ImageMargin', { get : function() {
			return st.getSWebTwain().ImageMargin;
		}, set : function (v){
			st.getSWebTwain().ImageMargin = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'MaxImagesInBuffer', { get : function() {
			return st.getSWebTwain().MaxImagesInBuffer;
		}, set : function (v){
			st.getSWebTwain().MaxImagesInBuffer = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'MouseX', { get : function() {
			return st.getSWebTwain().MouseX;
		}, set : function (v){
			// MouseX is readonly
			return FALSE;
		}});
		
		Object.defineProperty(st, 'MouseY', { get : function() {
			return st.getSWebTwain().MouseY;
		}, set : function (v){
			// MouseY is readonly
			return FALSE;
		}});
		
		Object.defineProperty(st, 'SelectedImagesCount', { get : function() {
			return st.getSWebTwain().SelectedImagesCount;
		}, set : function (v){
			st.getSWebTwain().SelectedImagesCount = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'SelectionImageBorderColor', { get : function() {
			return st.getSWebTwain().SelectionImageBorderColor;
		}, set : function (v){
			st.getSWebTwain().SelectionImageBorderColor = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'Zoom', { get : function() {
			return st.getSWebTwain().Zoom;
		}, set : function (v){
			st.getSWebTwain().Zoom = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'MouseShape', { get : function() {
			return st.getSWebTwain().MouseShape;
		}, set : function (v){
			st.getSWebTwain().MouseShape = v;
			return TRUE;
		}});
		// --- View & Edit property end --
		
		
		
		
		
		
		
		
		
		// --- Upload & Save property start --
		Object.defineProperty(st, 'HTTPPostResponseString', { get : function() {
			return st.getSWebTwain().HTTPPostResponseString;
		}});
		
		Object.defineProperty(st, 'AsyncMode', { get : function() {
			return st.getSWebTwain().AsyncMode;
		}, set : function (v){
			st.getSWebTwain().AsyncMode = v;
			return TRUE;
		}});
			
		Object.defineProperty(st, 'FTPPassword', { get : function() {
			return st.getSWebTwain().FTPPassword;
		}, set : function (v){
			st.getSWebTwain().FTPPassword = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'FTPPort', { get : function() {
			return st.getSWebTwain().FTPPort;
		}, set : function (v){
			if(v !== ''){
				v = v*1;
				st.getSWebTwain().FTPPort = v;
				return TRUE;
			}
			return FALSE;
		}});
		
		Object.defineProperty(st, 'FTPUserName', { get : function() {
			return st.getSWebTwain().FTPUserName;
		}, set : function (v){
			st.getSWebTwain().FTPUserName = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'HTTPPort', { get : function() {
			return st.getSWebTwain().HTTPPort;
		}, set : function (v){
			if(v !== ''){
				v = v*1;
				st.getSWebTwain().HTTPPort = v;
			} else {
				v = DL.detect.ssl? 443 : 80;
				st.getSWebTwain().HTTPPort = v;
			}
			return TRUE;
		}});
		Object.defineProperty(st, 'HTTPPassword', { get : function() {
			return st.getSWebTwain().HTTPPassword;
		}, set : function (v){
			st.getSWebTwain().HTTPPassword = v;
			return TRUE;
		}});			
		Object.defineProperty(st, 'HTTPUserName', { get : function() {
			return st.getSWebTwain().HTTPUserName;
		}, set : function (v){
			st.getSWebTwain().HTTPUserName = v;
			return TRUE;
		}});			

		Object.defineProperty(st, 'IfPASVMode', { get : function() {
			return st.getSWebTwain().IfPASVMode;
		}, set : function (v){
			st.getSWebTwain().IfPASVMode = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfShowProgressBar', { get : function() {
			return st.getSWebTwain().IfShowProgressBar;
		}, set : function (v){
			st.getSWebTwain().IfShowProgressBar = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'ProxyServer', { get : function() {
			return st.getSWebTwain().ProxyServer;
		}, set : function (v){
			st.getSWebTwain().ProxyServer = v;
			return TRUE;
		}});

//            Object.defineProperty(st, 'IfScanInThread', { get : function() {
//				return st.getSWebTwain().IfScanInThread;
//			}, set : function (v){
//				return st.getSWebTwain().IfScanInThread = v;
//			}});
		
		Object.defineProperty(st, 'IfShowFileDialog', { get : function() {
			return st.getSWebTwain().IfShowFileDialog;
		}, set : function (v){
			st.getSWebTwain().IfShowFileDialog = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfTiffMultiPage', { get : function() {
			return st.getSWebTwain().IfTiffMultiPage;
		}, set : function (v){
			st.getSWebTwain().IfTiffMultiPage = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFAuthor', { get : function() {
			return st.getSWebTwain().PDFAuthor;
		}, set : function (v){
			st.getSWebTwain().PDFAuthor = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFCompressionType', { get : function() {
			return st.getSWebTwain().PDFCompressionType;
		}, set : function (v){
			st.getSWebTwain().PDFCompressionType = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFCreationDate', { get : function() {
			return st.getSWebTwain().PDFCreationDate;
		}, set : function (v){
			st.getSWebTwain().PDFCreationDate = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFCreator', { get : function() {
			return st.getSWebTwain().PDFCreator;
		}, set : function (v){
			st.getSWebTwain().PDFCreator = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFKeywords', { get : function() {
			return st.getSWebTwain().PDFKeywords;
		}, set : function (v){
			st.getSWebTwain().PDFKeywords = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFModifiedDate', { get : function() {
			return st.getSWebTwain().PDFModifiedDate;
		}, set : function (v){
			st.getSWebTwain().PDFModifiedDate = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFProducer', { get : function() {
			return st.getSWebTwain().PDFProducer;
		}, set : function (v){
			st.getSWebTwain().PDFProducer = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFSubject', { get : function() {
			return st.getSWebTwain().PDFSubject;
		}, set : function (v){
			st.getSWebTwain().PDFSubject = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFTitle', { get : function() {
			return st.getSWebTwain().PDFTitle;
		}, set : function (v){
			st.getSWebTwain().PDFTitle = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'PDFVersion', { get : function() {
			return st.getSWebTwain().PDFVersion;
		}, set : function (v){
			st.getSWebTwain().PDFVersion = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'TIFFCompressionType', { get : function() {
			return st.getSWebTwain().TIFFCompressionType;
		}, set : function (v){
			st.getSWebTwain().TIFFCompressionType = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'JPEGQuality', { get : function() {
			return st.getSWebTwain().JPEGQuality;
		}, set : function (v){
			v = v*1;
			if(v>=100)
				v = 100;
			st.getSWebTwain().JPEGQuality = v;
			return TRUE;
		}});

		// --- Upload & Save property end --
		
		// --- start from 10.0
		
		Object.defineProperty(st, 'HttpContentTypeFieldValue', { get : function() {
			return st.getSWebTwain().HttpContentTypeFieldValue;
		}, set : function (v){
			return st.getSWebTwain().HttpContentTypeFieldValue = v;
		}});

		Object.defineProperty(st, 'SelectionRectAspectRatio', { get : function() {
			return st.getSWebTwain().SelectionRectAspectRatio;
		}, set : function (v){
			st.getSWebTwain().SelectionRectAspectRatio = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'IfAllowLocalCache', { get : function() {
			return st.getSWebTwain().IfAllowLocalCache;
		}, set : function (v){
			st.getSWebTwain().IfAllowLocalCache = v;
			return TRUE;
		}});
		

		Object.defineProperty(st, '_AutoCropMethod', { get : function() {
			return st.getSWebTwain().AutoCropMethod;
		}, set : function (v){
			return st.getSWebTwain().AutoCropMethod = v;
		}});
		
		// Others Property
		
		Object.defineProperty(st, 'BrokerProcessType', { get : function() {
			return st.getSWebTwain().BrokerProcessType;
		}, set : function (v){
			st.getSWebTwain().BrokerProcessType = v;
			return TRUE;
		}});
		
		
		Object.defineProperty(st, 'BorderStyle', { get : function() {
			return st.getSWebTwain().BorderStyle;
		}, set : function (v){
			st.getSWebTwain().BorderStyle = v;
			return TRUE;
		}});
		
		
		Object.defineProperty(st, 'IfShowPrintUI', { get : function() {
			return st.getSWebTwain().IfShowPrintUI;
		}, set : function (v){
			st.getSWebTwain().IfShowPrintUI = v;
			return TRUE;
		}});
		
		
		
		Object.defineProperty(st, 'VScrollBar', { get : function() {
			return st.getSWebTwain().VScrollBar;
		}, set : function (v){
			st.getSWebTwain().VScrollBar = v;
			return TRUE;
		}});
		
		
		Object.defineProperty(st, 'EnableInteractiveZoom', { get : function() {
			return st.getSWebTwain().EnableInteractiveZoom;
		}, set : function (v){
			st.getSWebTwain().EnableInteractiveZoom = v;
			return TRUE;
		}});
		
		
		Object.defineProperty(st, 'ImageEditorIfEnableEnumerator', { get : function() {
			return st.getSWebTwain().ImageEditorIfEnableEnumerator;
		}, set : function (v){
			st.getSWebTwain().ImageEditorIfEnableEnumerator = v;
			return TRUE;
		}});
		
		
		
		
		Object.defineProperty(st, 'ImageEditorIfReadonly', { get : function() {
			return st.getSWebTwain().ImageEditorIfReadonly;
		}, set : function (v){
			st.getSWebTwain().ImageEditorIfReadonly = v;
			return TRUE;
		}});
		
		
		Object.defineProperty(st, 'ImageEditorIfModal', { get : function() {
			return st.getSWebTwain().ImageEditorIfModal;
		}, set : function (v){
			st.getSWebTwain().ImageEditorIfModal = v;
			return TRUE;
		}});
		
		
		Object.defineProperty(st, 'ImageEditorWindowTitle', { get : function() {
			return st.getSWebTwain().ImageEditorWindowTitle;
		}, set : function (v){
			st.getSWebTwain().ImageEditorWindowTitle = v;
			return TRUE;
		}});
		
		
		
		
		Object.defineProperty(st, 'IfSSL', { get : function() {
			return st.getSWebTwain().IfSSL;
		}, set : function (v){
			st.getSWebTwain().IfSSL = v;
			return TRUE;
		}});
		
		
		Object.defineProperty(st, 'AllowPluginAuthentication', { get : function() {
			return st.getSWebTwain().AllowPluginAuthentication;
		}, set : function (v){
			st.getSWebTwain().AllowPluginAuthentication = v;
			return TRUE;
		}});
		
		
		Object.defineProperty(st, 'HttpFieldNameOfUploadedImage', { get : function() {
			return st.getSWebTwain().HttpFieldNameOfUploadedImage;
		}, set : function (v){
			st.getSWebTwain().HttpFieldNameOfUploadedImage = v;
			return TRUE;
		}});
		
		
		Object.defineProperty(st, 'MaxInternetTransferThreads', { get : function() {
			return st.getSWebTwain().MaxInternetTransferThreads;
		}, set : function (v){
			st.getSWebTwain().MaxInternetTransferThreads = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'MaxUploadImageSize', { get : function() {
			return st.getSWebTwain().MaxUploadImageSize;
		}, set : function (v){
			st.getSWebTwain().MaxUploadImageSize = v;
			return TRUE;
		}});

		Object.defineProperty(st, 'IfOpenImageWithGDIPlus', { get : function() {
			return st.getSWebTwain().IfOpenImageWithGDIPlus;
		}, set : function (v){
			st.getSWebTwain().IfOpenImageWithGDIPlus = v;
			return TRUE;
		}});

		// from 10.0.2
		
		// from 10.1
		Object.defineProperty(st, 'BufferMemoryLimit', { get : function() {
			return st.getSWebTwain().BufferMemoryLimit;
		}, set : function (v){
			st.getSWebTwain().BufferMemoryLimit = v;
			return TRUE;
		}});
		
		Object.defineProperty(st, 'Width', { get : function() {
			return st.getSWebTwain().style.width;
		}, set : function (v){
			var _this = this;
			st._ChangeWidth(v);
			return TRUE;
		}});			
		Object.defineProperty(st, 'Height', { get : function() {
			return st.getSWebTwain().style.height;
		}, set : function (v){
			var _this = this;
			st._ChangeHeight(v);
			return TRUE;
		}});

		Object.defineProperty(st, 'IfThrowException', { get : function() {
			return st.getSWebTwain().IfThrowException;
		}, set : function (v){
			st.getSWebTwain().IfThrowException = v;
			return TRUE;
		}});
		
		// from 10.1.2, ActiveX / plugin not support ShowPageNumber
		Object.defineProperty(st, 'ShowPageNumber', { get : function() {
			return FALSE;
		}, set : function (v){
			return FALSE;
		}});
	};
	
	DL.attachMethod = function(st){
		var _this = st;
		st.RegisterEvent = function(eventName, callback) {
			var __the = this, vFun = ['__', eventName].join('');
			
			_this[vFun] = callback;
			
			_this.getSWebTwain().RegisterEvent(eventName, callback);
			return TRUE;
		};
		st.onEvent = function(eventName, callback) {
			this.RegisterEvent(eventName, callback);
			return TRUE;
		};
		st.on = function(eventName, callback) {
			this.RegisterEvent(eventName, callback);
			return TRUE;
		};
		
		
		// --- SCAN start --
		
		st.CancelAllPendingTransfers = function(){
			return _this.getSWebTwain().CancelAllPendingTransfers();
		}
		st.CloseSource = function(){
			return _this.getSWebTwain().CloseSource();
		}
		st.CloseSourceManager = function(){
			return _this.getSWebTwain().CloseSourceManager();
		}
		st.DisableSource = function(){
			return _this.getSWebTwain().DisableSource();
		}
		st.FeedPage = function(){
			return _this.getSWebTwain().FeedPage();
		}
		st.GetDeviceType = function(){
			return _this.getSWebTwain().GetDeviceType();
		}
		st.GetSourceNameItems = function(i){
			return _this.getSWebTwain().GetSourceNameItems(i);
		}
		st.SourceNameItems = function(i){
			return _this.getSWebTwain().GetSourceNameItems(i);
		}
		st.GetSourceNames = function(){
			// return _this.getSWebTwain().GetSourceNames();
			// *** new for 10.0
			return [];
		}	
		
		st.GetSourceType = function(i){
			return _this.getSWebTwain().GetSourceType(i);
		}
		st.OpenSource = function(){
			return _this.getSWebTwain().OpenSource();
		}
		st.OpenSourceManager = function(){
			return _this.getSWebTwain().OpenSourceManager();
		}
		st.ResetImageLayout = function(){
			return _this.getSWebTwain().ResetImageLayout();
		}
		st.RewindPage = function(){
			return _this.getSWebTwain().RewindPage();
		}
		st.SelectSource = function(){
			return _this.getSWebTwain().SelectSource();
		}
		st.SelectSourceByIndex = function(i){
			return _this.getSWebTwain().SelectSourceByIndex(i);
		}
		st.SetFileXferInfo = function(localFile, format){
			var f = Funs.replaceLocalFilename(localFile);
			return _this.getSWebTwain().SetFileXferInfo(f, format);
		}
		st.SetImageLayout  = function(left, top, right, bottom){
			return _this.getSWebTwain().SetImageLayout(left, top, right, bottom);
		}
		st.CapGet = function(){
			return _this.getSWebTwain().CapGet();
		}
		st.CapGetCurrent = function(){
			return _this.getSWebTwain().CapGetCurrent();
		}
		st.CapGetDefault = function(){
			return _this.getSWebTwain().CapGetDefault();
		}
		st.CapGetFrameBottom = function(index){
			return _this.getSWebTwain().CapGetFrameBottom(index);
		}
		st.CapGetFrameLeft = function(index){
			return _this.getSWebTwain().CapGetFrameLeft(index);
		}
		st.CapGetFrameRight = function(index){
			return _this.getSWebTwain().CapGetFrameRight(index);
		}
		st.CapGetFrameTop = function(index){
			return _this.getSWebTwain().CapGetFrameTop(index);
		}
		st.CapGetHelp = function(){
			return _this.getSWebTwain().CapGetHelp();
		}
		st.CapGetLabel = function(){
			return _this.getSWebTwain().CapGetLabel();
		}
		st.CapGetLabels = function(){
			return _this.getSWebTwain().CapGetLabels();
		}
		st.CapIfSupported = function(msg){
			return _this.getSWebTwain().CapIfSupported(msg);
		}
		st.CapReset = function(){
			return _this.getSWebTwain().CapReset();
		}
		st.CapSet = function(){
			return _this.getSWebTwain().CapSet();
		}
		st.CapSetFrame = function(index, left, top, right, bottom){
			return _this.getSWebTwain().CapSetFrame(index, left, top, right, bottom);
		}
		st.GetCapItems = function(index){
			return _this.getSWebTwain().GetCapItems(index);
		}
		st.GetCapItemsString = function(index){
			return _this.getSWebTwain().GetCapItemsString(index);
		}
		st.SetCapItems = function(index, newVal){
			_this.getSWebTwain().SetCapItems(index, newVal);
			return Funs.checkErrorString(_this);
		}
		st.SetCapItemsString = function(index, newVal){
			_this.getSWebTwain().SetCapItemsString(index, newVal);
			return Funs.checkErrorString(_this);
		}
		// --- SCAN end --
		
		
		
		
		
		
		
		// --- View & Edit start --
		
		st.AddText = function (sImageIndex, x, y, text, txtColor, backgroundColor, backgroundRoundRadius, backgroundOpacity) {

			return _this.getSWebTwain().AddText(sImageIndex, x, y, text, txtColor, backgroundColor, backgroundRoundRadius, backgroundOpacity);
		}

		st.CreateTextFont = function (Height, Width, Escapement, Orientation, Weight, Italic, Underline, StrikeOut, CharSet, OutputPrecision, ClipPrecision, Quality, PitchAndFamily, FaceName) {

			return _this.getSWebTwain().CreateTextFont(Height, Width, Escapement, Orientation, Weight, Italic, Underline, StrikeOut, CharSet, OutputPrecision, ClipPrecision, Quality, PitchAndFamily, FaceName);
		}
		st.CopyToClipboard = function (sImageIndex) {
			return _this.getSWebTwain().CopyToClipboard(sImageIndex);
		}
		st.Erase = function (sImageIndex, left, top, right, bottom) {
			return _this.getSWebTwain().Erase(sImageIndex, left, top, right, bottom);
		}
		st.GetImageBitDepth = function (sImageIndex) {
			return _this.getSWebTwain().GetImageBitDepth(sImageIndex);
		}
		st.GetImageWidth = function (sImageIndex) {
			return _this.getSWebTwain().GetImageWidth(sImageIndex);
		}
		st.GetImageHeight = function (sImageIndex) {
			return _this.getSWebTwain().GetImageHeight(sImageIndex);
		}
		st.GetImageSize = function (sImageIndex, lWidth, lHeight) {
			return _this.getSWebTwain().GetImageSize(sImageIndex, lWidth, lHeight);
		}
		st.GetImageSizeWithSpecifiedType = function (sImageIndex, ImageType) {
			return _this.getSWebTwain().GetImageSizeWithSpecifiedType(sImageIndex, ImageType);
		}
		st.GetImageXResolution = function (sImageIndex) {
			return _this.getSWebTwain().GetImageXResolution(sImageIndex);
		}
		st.GetImageYResolution = function (sImageIndex) {
			return _this.getSWebTwain().GetImageYResolution(sImageIndex);
		}
		st.GetSelectedImageIndex = function (sIndex) {
			return _this.getSWebTwain().GetSelectedImageIndex(sIndex);
		}
		st.SetSelectedImageIndex = function (sIndex, sImageIndex) {
			_this.getSWebTwain().SetSelectedImageIndex(sIndex, sImageIndex);
			return Funs.checkErrorString(_this);
		}
		st.GetSelectedImagesSize = function (ImageType) {
			return _this.getSWebTwain().GetSelectedImagesSize(ImageType);
		}
		st.GetSkewAngle = function (sImageIndex) {
			return _this.getSWebTwain().GetSkewAngle(sImageIndex);
		}
		st.GetSkewAngleEx = function (sImageIndex, left, top, right, bottom) {
			return _this.getSWebTwain().GetSkewAngleEx(sImageIndex, left, top, right, bottom);
		}
		st.IsBlankImage = function (sImageIndex) {
			return _this.getSWebTwain().IsBlankImage(sImageIndex);
		}
		st.IsBlankImageEx = function (sImageIndex, left, top, right, bottom, bFuzzyMatch) {
			return _this.getSWebTwain().IsBlankImageEx(sImageIndex, left, top, right, bottom, bFuzzyMatch);
		}

		st.Mirror = function (sImageIndex) {
			return _this.getSWebTwain().Mirror(sImageIndex);
		}
		st.OverlayRectangle = function (sImageIndex, left, top, right, bottom, color, fOpacity) {
			_this.getSWebTwain().OverlayRectangle(sImageIndex, left, top, right, bottom, color, fOpacity);
			return Funs.checkErrorString(_this);
		}
		st.RemoveAllImages = function () {
			var __the = this, _ret;
			_this.getSWebTwain().RemoveAllImages();
			_ret = Funs.checkErrorString(_this);
			
			if(_ret){
				_this.__innerRefreshImage();
			}
			return _ret;
		}
		st.RemoveAllSelectedImages = function () {
			var __the = this, _ret;
			_this.getSWebTwain().RemoveAllSelectedImages();
			_ret = Funs.checkErrorString(_this);
			if(_ret){
				_this.__innerRefreshImage();
			}
			return _ret;
		}
		st.RemoveImage = function (sImageIndex) {
			return _this.getSWebTwain().RemoveImage(sImageIndex);
		}
		
		// Image Operate
		st.Rotate = function (sImageIndex, fAngle, bKeepSize) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().Rotate(index, fAngle, bKeepSize),
				bOK = (r==1);
			
			return bOK;
		}
		st.RotateEx = function (sImageIndex, fAngle, bKeepSize, enumInterpolationMethod) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().RotateEx(index, fAngle, bKeepSize, enumInterpolationMethod),
				bOK = (r==1);
			
			return bOK;
		}
		st.RotateLeft = function (sImageIndex) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().RotateLeft(index),
				bOK = (r==1);
			
			return bOK;
		}
		st.RotateRight = function (sImageIndex) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().RotateRight(index),
				bOK = (r==1);
			
			return bOK;
		}
		st.ChangeImageSize = function (sImageIndex, lNewWidth, lNewHeight, enumInterpolationMethod) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().ChangeImageSize(index, lNewWidth, lNewHeight, enumInterpolationMethod),
				bOK = (r==1);
			
			return bOK;
		}
		st.Flip = function (sImageIndex) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().Flip(index),
				bOK = (r==1);
			
			return bOK;
		}
		st.Crop = function (sImageIndex, left, top, right, bottom) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().Crop(index, left, top, right, bottom),
				bOK = (r==1);
			
			return bOK;
		}
		st.CropToClipboard = function (sImageIndex, left, top, right, bottom) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().CropToClipboard(index, left, top, right, bottom),
				bOK = (r==1);
			
			return bOK;
		}
		st.CutFrameToClipboard = function (sImageIndex, left, top, right, bottom) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().CutFrameToClipboard(index, left, top, right, bottom),
				bOK = (r==1);
			
			return bOK;
		}
		st.CutToClipboard = function (sImageIndex) {
			var __the = this, index = parseInt(sImageIndex),
				r = _this.getSWebTwain().CutToClipboard(index),
				bOK = (r==1);
			
			return bOK;
		}
		
		
		
		
		st.SetDPI = function (sImageIndex, xResolution, yResolution, bResampleImage, enumInterpolationMethod) {
			return _this.getSWebTwain().SetDPI(sImageIndex, xResolution, yResolution, bResampleImage, enumInterpolationMethod);
		}
		st.SetViewMode = function (sHorizontalImageCount, sVerticalImageCount) {
			return _this.getSWebTwain().SetViewMode(sHorizontalImageCount, sVerticalImageCount);
		}
		st.GetViewModeH = function () {
			return _this.getSWebTwain().GetViewModeH();
		}
		st.GetViewModeV = function () {
			return _this.getSWebTwain().GetViewModeV();
		}
		st.MoveImage = function (sSourceImageIndex, sTargetImageIndex) {
			return _this.getSWebTwain().MoveImage(sSourceImageIndex, sTargetImageIndex);
		}	
		st.SwitchImage = function (sImageIndex1, sImageIndex2) {
			return _this.getSWebTwain().SwitchImage(sImageIndex1, sImageIndex2);
		}
		st.Print = function () {
			return _this.getSWebTwain().Print();
		}
		// --- View & Edit end --
		
		
		
		
		
		
		
		
		// --- Event start --

				
		
		st.checkErrorString = function(){
			// *** new for 10.0
			var eCode = _this.ErrorCode;

			if (eCode === -2115){ //Cancel file dialog
				// D.appendRichMessage('File dialog cancelled.');
				return TRUE;
			}
			
			if (eCode === -2003) {
				var errMessageWin = window.open('', 'ErrorMessage', 'height=500,width=750,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no');
				errMessageWin.document.writeln(_this.HTTPPostResponseString);
			}

			// D.appendRichMessage(_this.ErrorString);
			return (eCode === 0);
		}
		// --- Event end --
		
			
		// --- Upload & Save  start --
		st.FileExists = function (localFile) {
			var f = Funs.replaceLocalFilename(localFile);
			return _this.getSWebTwain().FileExists(f);
		}

		st.SaveAllAsMultiPageTIFF = function (localFile, OnSuccess, OnFailure) {
			var f = Funs.replaceLocalFilename(localFile), _ret;
			_ret = _this.getSWebTwain().SaveAllAsMultiPageTIFF(f);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);

		}
		
		st.SaveAllAsPDF = function (localFile, OnSuccess, OnFailure) {
			var f = Funs.replaceLocalFilename(localFile);
			_ret = _this.getSWebTwain().SaveAllAsPDF(f);

			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}
		
		st.SaveAsBMP = function (localFile, sImageIndex, OnSuccess, OnFailure) {
			var f = Funs.replaceLocalFilename(localFile);
			_ret = _this.getSWebTwain().SaveAsBMP(f, sImageIndex);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.SaveAsJPEG = function (localFile, sImageIndex, OnSuccess, OnFailure) {
			var f = Funs.replaceLocalFilename(localFile);
			_ret = _this.getSWebTwain().SaveAsJPEG(f, sImageIndex);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.SaveAsPDF = function (localFile, sImageIndex, OnSuccess, OnFailure) {
			var f = Funs.replaceLocalFilename(localFile);
			_ret = _this.getSWebTwain().SaveAsPDF(f, sImageIndex);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.SaveAsPNG = function (localFile, sImageIndex, OnSuccess, OnFailure) {
			var f = Funs.replaceLocalFilename(localFile);
			_ret = _this.getSWebTwain().SaveAsPNG(f, sImageIndex);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.SaveAsTIFF = function (localFile, sImageIndex, OnSuccess, OnFailure) {
			var f = Funs.replaceLocalFilename(localFile);
			_ret = _this.getSWebTwain().SaveAsTIFF(f, sImageIndex);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.SaveSelectedImagesAsMultiPagePDF = function (localFile, OnSuccess, OnFailure) {
			var f = Funs.replaceLocalFilename(localFile), _ret;
			_ret = _this.getSWebTwain().SaveSelectedImagesAsMultiPagePDF(f);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.SaveSelectedImagesAsMultiPageTIFF = function (localFile, OnSuccess, OnFailure) {
			var f = Funs.replaceLocalFilename(localFile), _ret;
			 _ret = _this.getSWebTwain().SaveSelectedImagesAsMultiPageTIFF(f);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.SaveSelectedImagesToBase64Binary = function () {
			return _this.getSWebTwain().SaveSelectedImagesToBase64Binary();
		}

		st.ShowFileDialog = function (SaveDialog, Filter, FilterIndex, DefExtension, InitialDir, AllowMultiSelect, OverwritePrompt, Flags) {//, OnFilesSelected) {
			return _this.getSWebTwain().ShowFileDialog(SaveDialog, Filter, FilterIndex, DefExtension, InitialDir, AllowMultiSelect, OverwritePrompt, Flags);
		}
		
				
		st.FTPDownload = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
			var _ret = _this.getSWebTwain().FTPDownload(FTPServer, FTPRemoteFile);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}
		
		st.FTPDownloadDirectly = function (FTPServer, FTPRemoteFile, LocalFile, OnSuccess, OnFailure) {
			var _ret = _this.getSWebTwain().FTPDownloadDirectly(FTPServer, FTPRemoteFile, LocalFile);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}	
		
		st.FTPDownloadEx = function (FTPServer, FTPRemoteFile, ImageType, OnSuccess, OnFailure) {
			var _ret = _this.getSWebTwain().FTPDownloadEx(FTPServer, FTPRemoteFile, ImageType);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}	
		
		st.FTPUpload = function (FTPServer, sImageIndex, FTPRemoteFile, OnSuccess, OnFailure) {
			var _ret = _this.getSWebTwain().FTPUpload(FTPServer, sImageIndex, FTPRemoteFile);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}	
		
		st.FTPUploadDirectly = function (FTPServer, LocalFile, FTPRemoteFile, OnSuccess, OnFailure) {
			var _ret = _this.getSWebTwain().FTPUploadDirectly(FTPServer, LocalFile, FTPRemoteFile);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}	
		
		st.FTPUploadEx = function (FTPServer, sImageIndex, FTPRemoteFile, ImageType, OnSuccess, OnFailure) {
			var _ret = _this.getSWebTwain().FTPUploadEx(FTPServer, sImageIndex, FTPRemoteFile, ImageType);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}	

		st.FTPUploadAllAsMultiPageTIFF = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
			var _ret = _this.getSWebTwain().FTPUploadAllAsMultiPageTIFF(FTPServer, FTPRemoteFile);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}	
		
		st.FTPUploadAllAsPDF = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
			var _ret = _this.getSWebTwain().FTPUploadAllAsPDF(FTPServer, FTPRemoteFile);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}
		
		st.FTPUploadAsMultiPagePDF = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
			// upload all selected images, default always select one image, we should set all selected image index to server before call this,
			// all when selecte image, should set select to server ????????????
			var _ret = _this.getSWebTwain().FTPUploadAsMultiPagePDF(FTPServer, FTPRemoteFile);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}
		
		st.FTPUploadAsMultiPageTIFF = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
			// upload all selected images, default always select one image, we should set all selected image index to server before call this,
			// all when selecte image, should set select to server ????????????
			var _ret = _this.getSWebTwain().FTPUploadAsMultiPageTIFF(FTPServer, FTPRemoteFile);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.HTTPDownload = function (HTTPServer, HTTPRemoteFile, OnSuccess, OnFailure) {
			var _ret,
				imgType = Funs.getImageType(HTTPRemoteFile);
			return this.HTTPDownloadEx(HTTPServer, HTTPRemoteFile, imgType, OnSuccess, OnFailure);
		}
		
		st.HTTPDownloadDirectly = function (HTTPServer, HTTPRemoteFile, LocalFile, OnSuccess, OnFailure) {
			var _ret;
			_ret = _this.getSWebTwain().HTTPDownloadDirectly(HTTPServer, HTTPRemoteFile, LocalFile);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}
		
		st.HTTPDownloadEx = function (HTTPServer, HTTPRemoteFile, ImageType, OnSuccess, OnFailure) {
			var _ret;
			_ret = _this.getSWebTwain().HTTPDownloadEx(HTTPServer, HTTPRemoteFile, ImageType);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}
		
		st.HTTPUploadThroughPostDirectly = function (HTTPServer, LocalFile, ActionPage, fileName, OnSuccess, OnFailure) {
			var _ret;
			_ret = _this.getSWebTwain().HTTPUploadThroughPostDirectly(HTTPServer, LocalFile, ActionPage, fileName);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure, true);
		}
		
		st.HTTPUploadThroughPost = function (HTTPServer, sImageIndex, ActionPage, fileName, OnSuccess, OnFailure) {
			var _ret;
			_ret = _this.getSWebTwain().HTTPUploadThroughPost(HTTPServer, sImageIndex, ActionPage, fileName);

			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure, true);
		}
		
		st.HTTPUploadThroughPostEx = function (HTTPServer, sImageIndex, ActionPage, fileName, ImageType, OnSuccess, OnFailure) {
			var _ret;
			_ret = _this.getSWebTwain().HTTPUploadThroughPostEx(HTTPServer, sImageIndex, ActionPage, fileName, ImageType);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure, true);
		}


		st.ClearAllHTTPFormField = function () {
			_this.getSWebTwain().ClearAllHTTPFormField();
			return Funs.checkErrorString(_this);
		}

		st.SetHTTPFormField = function (FieldName, FieldValue) {
			_this.getSWebTwain().SetHTTPFormField(FieldName, FieldValue);
			return Funs.checkErrorString(_this);
		}
		
		// 0:BMP, 1:JPEG, 2:TIFF, 3:PNG, 4:PDF
		st.HTTPUploadAllThroughPostAsMultiPageTIFF = function (HTTPServer, ActionPage, fileName, OnSuccess, OnFailure) {
			var _ret;
			
			_ret = _this.getSWebTwain().HTTPUploadAllThroughPostAsMultiPageTIFF(HTTPServer, ActionPage, fileName);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure, true);
		}
		
		st.HTTPUploadThroughPostAsMultiPageTIFF = function (HTTPServer, ActionPage, fileName, OnSuccess, OnFailure) {
			var _ret;
			
			_ret = _this.getSWebTwain().HTTPUploadThroughPostAsMultiPageTIFF(HTTPServer, ActionPage, fileName);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure, true);
		}
		
		st.HTTPUploadAllThroughPostAsPDF = function (HTTPServer, ActionPage, fileName, OnSuccess, OnFailure) {
			var _ret;
			
			_ret = _this.getSWebTwain().HTTPUploadAllThroughPostAsPDF(HTTPServer, ActionPage, fileName);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure, true);
		}
		
		st.HTTPUploadThroughPostAsMultiPagePDF = function (HTTPServer, ActionPage, fileName, OnSuccess, OnFailure) {
			var _ret;
		
			_ret = _this.getSWebTwain().HTTPUploadThroughPostAsMultiPagePDF(HTTPServer, ActionPage, fileName);
			
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure, true);
		}
		

		st.HTTPUploadThroughPutDirectly = function (HTTPServer, LocalFile, RemoteFileName, OnSuccess, OnFailure) {
			var _ret;
			_ret = _this.getSWebTwain().HTTPUploadThroughPutDirectly(HTTPServer, LocalFile, RemoteFileName);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}
		
		st.HTTPUploadThroughPut = function (HTTPServer, sImageIndex, RemoteFileName, OnSuccess, OnFailure) {
			var imgType = Funs.getImageType(RemoteFileName);
			return this.HTTPUploadThroughPutEx(HTTPServer, sImageIndex, RemoteFileName, imgType, OnSuccess, OnFailure);
		}
		
		// 0:BMP, 1:JPEG, 2:TIFF, 3:PNG, 4:PDF, 5:GIF
		st.HTTPUploadThroughPutEx = function (HTTPServer, sImageIndex, RemoteFileName, ImageType, OnSuccess, OnFailure) {
			var _ret;
			_ret = _this.getSWebTwain().HTTPUploadThroughPutEx(HTTPServer, sImageIndex, RemoteFileName, ImageType);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.HTTPUploadAllThroughPutAsMultiPageTIFF = function (HTTPServer, RemoteFileName, OnSuccess, OnFailure) {
			var all = -1, imgType = 2;
			
			return this.HTTPUploadThroughPutEx(HTTPServer, all, RemoteFileName, imgType, OnSuccess, OnFailure);
		}

		st.HTTPUploadThroughPutAsMultiPageTIFF = function (HTTPServer, RemoteFileName, OnSuccess, OnFailure) {
			var bySelected = -2, imgType = 2;
			
			return this.HTTPUploadThroughPutEx(HTTPServer, bySelected, RemoteFileName, imgType, OnSuccess, OnFailure);
		}

		st.HTTPUploadAllThroughPutAsPDF = function (HTTPServer, RemoteFileName, OnSuccess, OnFailure) {
			var all = -1, imgType = 4;
			
			return this.HTTPUploadThroughPutEx(HTTPServer, all, RemoteFileName, imgType, OnSuccess, OnFailure);
		}
		
		st.HTTPUploadThroughPutAsMultiPagePDF = function (HTTPServer, RemoteFileName, OnSuccess, OnFailure) {
			var bySelected = -2, imgType = 4;
			
			return this.HTTPUploadThroughPutEx(HTTPServer, bySelected, RemoteFileName, imgType, OnSuccess, OnFailure);
		}

		// --- Upload & Save  end --
		
		// --- Others ---
		st.ShowImageEditor = function () {
			return _this.getSWebTwain().ShowImageEditor();
		}
		
		st.SetCookie = function(v){
			_this.getSWebTwain().SetCookie(v);
			return TRUE;
		}
		
		st.LoadImageFromBase64Binary = function(bry, ImageType){
			return _this.getSWebTwain().LoadImageFromBase64Binary(bry, ImageType);
		}
		
		st.SaveSelectedImagesToBytes = function(bufferSize, bry){
			return _this.getSWebTwain().SaveSelectedImagesToBytes(bufferSize, bry);
		}
		
		st.LoadImageFromBytes = function(bufferSize, bry, ImageType){
			return _this.getSWebTwain().LoadImageFromBytes(bufferSize, bry, ImageType);
		}
		
		st.UnregisterEvent = function(Name, Evt){
			return _this.getSWebTwain().UnregisterEvent(Name, Evt);
		}
		// --- Others end ---
		

		// start from 10.0 
		st.SetImageWidth = function(sIndex, NewWidth){
			return _this.getSWebTwain().SetImageWidth(sIndex, NewWidth);
		};
		
		/*
		st.HTTPDownloadStreamThroughPost = function(ServerName, RemoteFile){
			// not support mac
			if(DL.env.bMac)
				return FALSE;

			return _this.getSWebTwain().HTTPDownloadStreamThroughPost(ServerName, RemoteFile);
		};
		st.HTTPUploadStreamThroughPost = function(ServerName, RemoteFile, StreamContent){
			// not support mac
			if(DL.env.bMac)
				return FALSE;
			return _this.getSWebTwain().HTTPUploadStreamThroughPost(ServerName, RemoteFile, StreamContent);
		};
		*/
		
		st.HTTPDownloadThroughPost = function(ServerName, RemoteFile, ImageType, OnSuccess, OnFailure){
			var _ret;
			_ret = _this.getSWebTwain().HTTPDownloadThroughPost(ServerName, RemoteFile, ImageType);
			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		};
		
		//  Set custom DS data (DAT_CUSTOMDSDATA), the input string is encoded with base64
		st.SetCustomDSDataEx = function(strBase64){
			return _this.getSWebTwain().SetCustomDSDataEx(strBase64);
		};	
		//  Set custom DS data, load data from the specified file
		st.SetCustomDSData = function(FileName){
			return _this.getSWebTwain().SetCustomDSData(FileName);
		};
		// Get custom DS data, and returned string  is encoded with base64
		st.GetCustomDSDataEx = function(){
			return _this.getSWebTwain().GetCustomDSDataEx();
		};
		// Get custom DS data, and save the data to the specified file
		st.GetCustomDSData = function(FileName){
			return _this.getSWebTwain().GetCustomDSData(FileName);
		};
		
		
		st.ChangeBitDepth = function(sIndex, sBitDepth, bHighQuality){
			return _this.getSWebTwain().ChangeBitDepth(sIndex, sBitDepth, bHighQuality);
		};
		st.ConvertToGrayScale = function(sIndex){
			return _this.getSWebTwain().ConvertToGrayScale(sIndex);
		};
		st.ShowImageEditorEx = function(x, y, cx, cy, nCmdShow){
			return _this.getSWebTwain().ShowImageEditorEx(x, y, cx, cy, nCmdShow);
		};
		
		st.ClearTiffCustomTag = function(){
			_this.getSWebTwain().ClearTiffCustomTag();
			return Funs.checkErrorString(_this);
		};	
		st.SetTiffCustomTag = function(Tag, Content, Base64Str){
			_this.getSWebTwain().SetTiffCustomTag(Tag, Content, Base64Str);
			return Funs.checkErrorString(_this);
		};
		st.IsBlankImageExpress = function(sIndex){	// changed in 10.0
			return _this.getSWebTwain().IsBlankImageExpress(sIndex);
		};
		// -- end 10.0
		// -- start 10.1
		st._ChangeWidth = function(v){
			var container = document.getElementById(st._strDWTInnerContainerID), _v;

			if(DL.isString(v)){
				if(v.length>0){
					if(v.charAt(v.length-1) === '%'){
						_v = v;
					}
				}
			}
			
			if(!_v){
				var tmp = parseInt(v);
				if(tmp && tmp>2)
					_v = (tmp-2) + 'px';
			}

			if(_v){
				_this._strWidth = _v;
				_this.getSWebTwain().style.width = _v;
				if(container)
					container.style.width = _v;
			}		
			
			return TRUE;
		};
		st._ChangeHeight = function(v){
			var container = document.getElementById(st._strDWTInnerContainerID), _v;

			if(DL.isString(v)){
				if(v.length>0){
					if(v.charAt(v.length-1) === '%'){
						_v = v;
					}
				}
			}
			
			if(!_v){
				var tmp = parseInt(v);
				if(tmp)
					_v = tmp + 'px';
			}
			
			if(_v){
				_this._strHeight = _v;
				_this.getSWebTwain().style.height = _v;
				if(container)
					container.style.height = _v;
			}		

			return TRUE;
		};
		st.SetSize = function(w,h){
			var _this = this;
			_this._ChangeWidth(w);
			_this._ChangeHeight(h);
			return TRUE;
		};
		
		st.SetSelectedImageArea = function (sImageIndex, left, top, right, bottom) {
			return _this.getSWebTwain().SetSelectedImageArea(sImageIndex, left, top, right, bottom);
		};
		// -- end 10.1
		
		// -- start 10.3
		st.SetVideoRotateMode = function (EnumAngle) {
			return _this.getSWebTwain().SetVideoRotateMode(EnumAngle);
		};
		st.SetOpenSourceTimeout = function (iCountMs) {
			return _this.getSWebTwain().SetOpenSourceTimeout(iCountMs);
		};		
		// -- end 10.3

		
		// async functions

		st.LoadDibFromClipboard = function (OnSuccess, OnFailure) {
			var __the = this, _ret;
			_ret = _this.getSWebTwain().LoadDibFromClipboard();

			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.LoadImage = function (localFile, OnSuccess, OnFailure) {
			var __the = this, f = Funs.replaceLocalFilename(localFile), _ret;
			_ret = _this.getSWebTwain().LoadImage(f);

			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}

		st.LoadImageEx = function (localFile, ImageType, OnSuccess, OnFailure) {
			var __the = this, f = Funs.replaceLocalFilename(localFile), _ret;
			_ret = _this.getSWebTwain().LoadImageEx(f, ImageType);

			return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
		}
				
		st.EnableSource = function(obj, OnSuccess, OnFailure){
			// same as AcquireImage
			var __the = this, _ret;
			_ret = this.AcquireImage(obj, OnSuccess, OnFailure);
			
			return _ret;
		}
		
		st.AcquireImage = function(p1, p2, p3){
			var __the = this, _objWT = _this.getSWebTwain(), _ret,
				obj = null, OnSuccess = null, OnFailure = null;

			if(DL.isUndefined(p3) &&
				(DL.isFunction(p1) && DL.isFunction(p2)
					|| DL.isFunction(p1) && DL.isUndefined(p2)
					|| DL.isFunction(p1) && p2 == null
					|| p1 == null && DL.isFunction(p2))) {

				/// 4) AcquireImage(sFun, fFun)
				/// AcquireImage(null, fFun)
				/// AcquireImage(sFun)
				/// AcquireImage(sFun, null)
				obj = null;
				if(DL.isFunction(p1))
					OnSuccess = p1;
				if(DL.isFunction(p2))
					OnFailure = p2;

			} else {
				/// 2) AcquireImage(obj)
				/// 3) AcquireImage(obj, sFun, fFun)
				/// AcquireImage(null, sFun, fFun)

				if (!DL.isUndefined(p1)) {
					obj = p1;
				}
				
				if(DL.isFunction(p2))
					OnSuccess = p2;
				if(DL.isFunction(p3))
					OnFailure = p3;
			}
			
			if(obj !== undefined && obj !== null){
				
				var o;
				
				o = obj['SelectSourceByIndex'];
				if(o != null && typeof(o) != 'undefined'){
					_objWT.SelectSourceByIndex(o);
					_objWT.CloseSource();
					_objWT.OpenSource();
				}

				o = obj['IfShowUI'];
				if(o != null && typeof(o) != 'undefined')
					_objWT.IfShowUI = o;
				
				o = obj['PixelType'];
				if(o != null && typeof(o) != 'undefined')
					_objWT.PixelType = o;
				
				o = obj['Resolution'];
				if(o != null && typeof(o) != 'undefined')
					_objWT.Resolution = o;
				
				o = obj['IfFeederEnabled'];
				if(o != null && typeof(o) != 'undefined')
					_objWT.IfFeederEnabled = o;
				
				o = obj['IfDuplexEnabled'];
				if(o != null && typeof(o) != 'undefined')
					_objWT.IfDuplexEnabled = o;
					
				o = obj['IfDisableSourceAfterAcquire'];
				if(o != null && typeof(o) != 'undefined')
					_objWT.IfDisableSourceAfterAcquire = o;
			}
			
			_ret = _objWT.AcquireImage();
			
			// return Funs.wrapperRet(_this, _ret, OnSuccess, OnFailure);
			return _ret;
		}
		
		// inner functions arguments
		
		st._innerFun = function(m, p, bAjax){
			var __the = this, _objWT = _this.getSWebTwain(), _FUN = _objWT[m];
			
			if(typeof(_FUN) === 'function')
				return _FUN.apply(_objWT, p);
			else
				return _FUN;
		}
			
		st.ActiveUI = function(OnSuccess, OnFailure){
			// *** new for 10.0
		};

		// --------------------------------------------
		st.first = function() {
			var __the = this, len = _this.HowManyImagesInBuffer, current;
			if(len > 0){
				_this.CurrentImageIndexInBuffer = 0;
				_this.__innerRefreshImage();
			}
			return TRUE;
		};
		st.previous = function() {
			var __the = this, len = _this.HowManyImagesInBuffer, current;
			if(len > 0){
				current = _this.CurrentImageIndexInBuffer;
				if(current > 0){
					_this.CurrentImageIndexInBuffer = current - 1;
					_this.__innerRefreshImage();
				}
			}
			return TRUE;
		};
		st.next = function() {
			var __the = this, len = _this.HowManyImagesInBuffer, current;
			if(len > 0){
				current = _this.CurrentImageIndexInBuffer;
				if(current >= 0 && current < len-1){
					_this.CurrentImageIndexInBuffer = current + 1;
					_this.__innerRefreshImage();
				}
			}
			return TRUE;
		};
		st.last = function() {
			var __the = this, len = _this.HowManyImagesInBuffer, current;
			if(len > 0){
				_this.CurrentImageIndexInBuffer = len - 1;
				_this.__innerRefreshImage();
			}
			return TRUE;
		};
		st.__innerRefreshImage = function() {
			var __the = this, len = _this.HowManyImagesInBuffer, current;
			if(len > 0){
				current = _this.CurrentImageIndexInBuffer;
				if(_this.__OnRefreshUI)
					_this.__OnRefreshUI(current, len);
			}
		};	
		
		st._attachEvents = function() {
			var __the = this, _swt = _this.getSWebTwain(), _verArray;
			
			// version <= 9.2 does not support RegisterEvent
			_verArray = Dynamsoft.Lib.detect.getVersionArray(new String(_this.VersionInfo));
			if(_verArray.length<=2 || _verArray[0] < 9 || _verArray[0] == 9 && _verArray[1] <= 2){
				return;
			}

			if (_this.__OnPostTransfer != '')
				_swt.RegisterEvent('OnPostTransfer', _this.__OnPostTransfer);
			
			if (_this.__OnPostAllTransfers != '')
				_swt.RegisterEvent('OnPostAllTransfers', _this.__OnPostAllTransfers);
				
			if (_this.__OnMouseClick != '')
				_swt.RegisterEvent('OnMouseClick', _this.__OnMouseClick);
				
			if (_this.__OnPostLoad != '')
				_swt.RegisterEvent('OnPostLoad', _this.__OnPostLoad);
				
			if (_this.__OnImageAreaSelected != '')
				_swt.RegisterEvent('OnImageAreaSelected', _this.__OnImageAreaSelected);
				
			if (_this.__OnMouseDoubleClick != '')
				_swt.RegisterEvent('OnMouseDoubleClick', _this.__OnMouseDoubleClick);
				
			if (_this.__OnMouseRightClick != '')
				_swt.RegisterEvent('OnMouseRightClick', _this.__OnMouseRightClick);
				
			if (_this.__OnTopImageInTheViewChanged != '')
				_swt.RegisterEvent('OnTopImageInTheViewChanged', _this.__OnTopImageInTheViewChanged);
				
			if (_this.__OnImageAreaDeSelected != '')
				_swt.RegisterEvent('OnImageAreaDeSelected', _this.__OnImageAreaDeSelected);
				
			if (_this.__OnGetFilePath != '')
				_swt.RegisterEvent('OnGetFilePath', _this.__OnGetFilePath);

			if (_this.__OnAfterOperate != '')			
				_swt.RegisterEvent('OnAfterOperate', _this.__OnAfterOperate);
				
			if (_this.__OnBeforeOperate != '')	
				_swt.RegisterEvent('OnBeforeOperate', _this.__OnBeforeOperate);
				
			if (_this.__OnOperateStatus != '')
				_swt.RegisterEvent('OnOperateStatus', _this.__OnOperateStatus);
				
			if (_this.__OnBitmapChanged != '')
				_swt.RegisterEvent('OnBitmapChanged', _this.__OnBitmapChanged);
				
			if (_this.__OnMouseMove != '')
				_swt.RegisterEvent('OnMouseMove', _this.__OnMouseMove);
				
			if (_this.__OnPreAllTransfers != '')
				_swt.RegisterEvent('OnPreAllTransfers', _this.__OnPreAllTransfers);
				
			if (_this.__OnPreTransfer != '')
				_swt.RegisterEvent('OnPreTransfer', _this.__OnPreTransfer);
				
			if (_this.__OnSourceUIClose != '')
				_swt.RegisterEvent('OnSourceUIClose', _this.__OnSourceUIClose);
				
			if (_this.__OnTransferCancelled != '')
				_swt.RegisterEvent('OnTransferCancelled', _this.__OnTransferCancelled);
				
			if (_this.__OnTransferError != '')
				_swt.RegisterEvent('OnTransferError', _this.__OnTransferError);
				
			if (_this.__OnInternetTransferPercentage != '')
				_swt.RegisterEvent('OnInternetTransferPercentage', _this.__OnInternetTransferPercentage);

			if (_this.__OnInternetTransferPercentageEx != '')
				_swt.RegisterEvent('OnInternetTransferPercentageEx', _this.__OnInternetTransferPercentageEx);
		};
	};
})(Dynamsoft.Lib);

// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: plugin ( ActiveX for ie6/ie7/ie8 )
// final js: build\src.plugin.js
// 


// DWT Functions
(function(DL) {
	if (!DL.product.bActiveXEdition){
		return;
	}
	
	var Funs = {
		noControl : function(_objWebTwain) {
			if(DL.isFunction(DL.detect.onNoControl)){
				// custom onNoControl event
				DL.detect.onNoControl(_objWebTwain._strDWTControlContainerID, _objWebTwain._strWidth, _objWebTwain._strHeight);
			}else{
				var aryDWTs = DL.detect.arySTwains;
				// default onNoControl event: every control display 'no control'
				for (var i = 0; i < aryDWTs.length; i++) {
					var o = aryDWTs[i];
					if (!o._vPluginExist) {
						// Display the message and hide the main control
						o._createNonInstallDivPlugin();
						DL.show(o._strDWTNonInstallInnerContainerID);
						DL.hide(o._strDWTInnerContainerID);
					}
				}
			}
		}

	};
	
    function SWebTwain(cfg) {
        var swt = this, config = cfg || {};
		
        swt._strDWTControlContainerID = config.containerID || 'dwtcontrolContainer';
        swt._strWidth = config.width || 270;        // The width of the main control.
        swt._strHeight = config.height || 350;       // The height of the main control.
		
		if(DL.isString(swt._strWidth) && swt._strWidth.indexOf('%')>0){
		}else{
			swt._strWidth = [parseInt(swt._strWidth), 'px'].join('');
		}
		
		if(DL.isString(swt._strHeight) && swt._strHeight.indexOf('%')>0){
		}else{
			swt._strHeight = [parseInt(swt._strHeight), 'px'].join('');
		}
			
			
        swt._strObjectName = swt._strDWTControlContainerID + '_Obj';
		
		swt.__config = config;
		
		swt.__OnPluginReady = config.onPluginReady;
		swt.__OnPluginNotReady = config.onPluginNotReady;
		swt.Addon = {};

		// The ID of the container (Usually a DIV) which is used to contain DWT object. User must specify it.
        swt._strDWTInnerContainerID = swt._strDWTControlContainerID + '_CID'; 
		// The ID of the container (Usually a DIV) which is used to show a message if DWT is not installed. User must specify it.
        swt._strDWTNonInstallInnerContainerID = swt._strDWTControlContainerID + '_NonInstallCID';

		var o = document.createElement('div');
		document.body.appendChild(o);		
		swt._fakeControl = o;
		
        swt._createControl(); //Create an instance of the component in the DIV assigned by this._strDWTContainerID

    };

    SWebTwain.prototype._createControl = function() {

        var varDWTContainer;

        var _this = this, _outterWidth = _this._strWidth,
			_outterHeight = _this._strHeight,
			objString;
			
		if(DL.isString(_outterWidth)){
			if(_outterWidth.indexOf('%')>0){
				_outterWidth = '100%';
			}else{
				_outterWidth = parseInt(_outterWidth*1) + 2 + 'px';
			}			
		}
			
		if(DL.isString(_outterHeight)){
			if(_outterHeight.indexOf('%')>0){
				_outterHeight = '100%';
			}else{
				_outterHeight = parseInt(_outterHeight*1) + 2 + 'px';
			}
		}
		if(!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB)
		{
		    objString = ['<div id="',
			    _this._strDWTInnerContainerID,
			    '" style="width:',
			    _outterWidth,
			    ';height:',
			    _outterHeight,
			    '">',
    			
                '<object id="',
			    _this._strObjectName,
			    '" style="width:', _this._strWidth, ';height:', _this._strHeight, ';border:1px solid #AAAAAA"',

                ' classid="clsid:',
			    Dynamsoft.WebTwainEnv.Trial ? DL.product.strTrialClassID : DL.product.strFullClassID,
			    '" viewastext>',
    		
                '<param name="wmode" value="transparent"/>',
    			
                '</object>',
			    '</div>'];
		}
		else
		{
		    objString = ['<div id="',
			    _this._strDWTInnerContainerID,
			    '" style="width:',
			    _outterWidth,
			    ';height:',
			    _outterHeight,
			    '">',
    			
                '<object id="',
			    _this._strObjectName,
			    '" style="width:', _this._strWidth, ';height:', _this._strHeight, ';border:1px solid #AAAAAA"',
    			
			    ' codebase="',
                (DL.env.bWin64) ? DL.product.getActiveXCABx64Path() : DL.product.getActiveXCABx86Path(),
			    '#version=',
			    Dynamsoft.WebTwainEnv.ActiveXVersion,
			    '"',

                ' classid="clsid:',
			    Dynamsoft.WebTwainEnv.Trial ? DL.product.strTrialClassID : DL.product.strFullClassID,
			    '" viewastext>',
    			
    //            '<param name="Manufacturer" value="Dynamsoft Corporation" />',
    //            '<param name="ProductFamily" value="', DL.product.name, '" />',
    //            '<param name="ProductName" value="', DL.product.name, '" />',
                '<param name="wmode" value="transparent"/>',
    			
                '</object>',
			    '</div>'];
		}
		
		objString.push('<div id="', _this._strDWTNonInstallInnerContainerID, '" style="width: ', _outterWidth, ';display:none"></div>');

        varDWTContainer = document.getElementById(_this._strDWTControlContainerID);
        
        if (varDWTContainer)
            varDWTContainer.innerHTML = objString.join('');

        _this._fakeControl._objWebTwain = null;
        _this._fakeControl.getSWebTwain = function(){
			var _self = this;
			if(_self._objWebTwain === null)
				_self._objWebTwain = document.getElementById(_this._strObjectName); 
			return _self._objWebTwain;
		};

	};

    SWebTwain.prototype.getInstance = function() {
		var _this = this, swt = _this._fakeControl.getSWebTwain();
			
		if(swt){
			return _this._fakeControl;
		}

		return false;
    };

	// --------------------------------------------

    // Check if the control is fully loaded.
    DL.detect._controlDetect = function() {
        var aryDWTs = DL.detect.arySTwains,
			cWebTwain = aryDWTs[0],
			swt = cWebTwain && cWebTwain._fakeControl && cWebTwain._fakeControl.getSWebTwain();

        // If the ErrorCode is 0, it means everything is fine for the control. It is fully loaded.
		if (swt){
			if (swt.ErrorCode == 0) {

				clearInterval(DL.detect._varSeed);

				// Please put product key (since v9.0)
				for (var i = 0; i < aryDWTs.length; i++) {
					var o = aryDWTs[i], tmpSWT = o._fakeControl.getSWebTwain();

					// Events
					DL.__innerInitEvents(o._fakeControl, o.__config);
					o._fakeControl.__OnRefreshUI = o.__config.onRefreshUI || '';
					
					// binds properties / methods / addon
					DL.attachProperty(o._fakeControl);
					DL.attachMethod(o._fakeControl);
					o._fakeControl._attachEvents();
					
					DL.attachAddon(o._fakeControl);
					
					// set Product Key
					tmpSWT.ProductKey = Dynamsoft.WebTwainEnv.ProductKey;
					tmpSWT.BrokerProcessType = DL.product._iBrokerProcessType;
					if (!DL.env.bWin) {
						o._objectWebTwain.ImageCaptureDriverType = DL.product._iImageCaptureDriverType;
					}
					
					if (DL.isFunction(o.__OnPluginReady)) {
						o.__OnPluginReady();
					}
				}

			} else {

				// ActiveX					
				if(!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB)	
				{
					// install with msi, open a dialog
					if(!DL.detect.bNoControlEvent) {
						Funs.noControl(cWebTwain);
						DL.detect.bNoControlEvent = true;
					}
				}
				// install with CAB, do nothing
				// else{}
					
				if (DL.isFunction(swt.__OnPluginNotReady)) {
					swt.__OnPluginNotReady();
				}
			}
		} else {
			// Error
			clearInterval(DL.detect._varSeed);
		}
    };

	DL.ie = {};

    DL.ie.DynamicWebTwain = function(objectConfigs) {

        var o = new SWebTwain(objectConfigs);

        DL.detect.arySTwains.push(o);

        return o;
    };
	
    DL.ie.closeAll = function () {
		var aryDWTs = DL.detect.arySTwains, i, o, tmpSWT;

		for (i = 0; i < aryDWTs.length; i++) {
			o = aryDWTs[i];
			if(o && o._fakeControl){
				tmpSWT = o._fakeControl.getSWebTwain();
				if(tmpSWT && tmpSWT.ErrorCode==0)
					tmpSWT.RemoveAllImages();
			}
		}

        DL.detect.arySTwains = [];
    };
	
})(Dynamsoft.Lib);

// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: plugin ( noneie plugin & ActiveX for ie9 or above )
// final js: build\src.plugin.js
// 


// DWT Functions
(function(DL) {
	if (!DL.product.bPluginEdition){
		return;
	}

	var Funs = {
		noControl : function(_objWebTwain) {
			if(DL.isFunction(DL.detect.onNoControl)){
				// custom onNoControl event
				DL.detect.onNoControl(_objWebTwain._strDWTControlContainerID, _objWebTwain._strWidth, _objWebTwain._strHeight);
			}else{
				var aryDWTs = DL.detect.arySTwains;
				// default onNoControl event: every control display 'no control'
				for (var i = 0; i < aryDWTs.length; i++) {
					var o = aryDWTs[i];
					if (!o._vPluginExist) {
						// Display the message and hide the main control
						o._createNonInstallDivPlugin();
						DL.show(o._strDWTNonInstallInnerContainerID);
						DL.hide(o._strDWTInnerContainerID);
					}
				}
			}
		}

	};


    function SWebTwain(cfg) {
        var swt = this, config = cfg || {};
		
        swt._strDWTControlContainerID = config.containerID || 'dwtcontrolContainer';
        swt._strWidth = config.width || 270;        // The width of the main control.
        swt._strHeight = config.height || 350;       // The height of the main control.
		
		if(DL.isString(swt._strWidth) && swt._strWidth.indexOf('%')>0){
		}else{
			swt._strWidth = [parseInt(swt._strWidth), 'px'].join('');
		}
		
		if(DL.isString(swt._strHeight) && swt._strHeight.indexOf('%')>0){
		}else{
			swt._strHeight = [parseInt(swt._strHeight), 'px'].join('');
		}

        //--------------------------------------------------------------------------------------
        //					 Default value provided. You can change it accordingly
        //--------------------------------------------------------------------------------------
        swt._strObjectName = swt._strDWTControlContainerID + '_Obj';

        // Events
        DL.__innerInitEvents(swt, config);
		
		swt.__OnPluginReady = config.onPluginReady;
		swt.__OnPluginNotReady = config.onPluginNotReady;

		swt.__OnRefreshUI = config.onRefreshUI || '';
        //--------------------------------------------------------------------------------------
        //					 Default value provided. YOU CANNOT change it accordingly
        //--------------------------------------------------------------------------------------
        
		// The DWT Object
        swt._objectWebTwain = null;           
		// The ID of the container (Usually a DIV) which is used to contain DWT object. User must specify it.
        swt._strDWTInnerContainerID = swt._strDWTControlContainerID + '_CID'; 
		// The ID of the container (Usually a DIV) which is used to show a message if DWT is not installed. User must specify it.
        swt._strDWTNonInstallInnerContainerID = swt._strDWTControlContainerID + '_NonInstallCID';

		swt._vNotAllowedForChrome = false;
		swt._vPluginExist = false;
		swt.Addon = {};
    };

    SWebTwain.prototype.getSWebTwain = function() {
		var _this = this;
		return _this._objectWebTwain;
    };
	
    SWebTwain.prototype.getInstance = function() {
		var _this = this;
		if(_this._objectWebTwain)
			return _this;
		return false;
    };
	
    SWebTwain.prototype._createControl = function() {

        var _this = this, varDWTContainer,
			_outterWidth = _this._strWidth,
			_outterHeight = _this._strHeight,
			objString;

		if(DL.isString(_outterWidth)){
			if(_outterWidth.indexOf('%')>0){
				_outterWidth = '100%';
			}else{
				_outterWidth = parseInt(_outterWidth*1) + 2 + 'px';
			}			
		}
			
		if(DL.isString(_outterHeight)){
			if(_outterHeight.indexOf('%')>0){
				_outterHeight = '100%';
			}else{
				_outterHeight = parseInt(_outterHeight*1) + 2 + 'px';
			}
		}
		
		objString = ['<div id="',
					_this._strDWTInnerContainerID,
					'" style="width:',
					_outterWidth,
					';height:',
					_outterHeight,
					'">'];
        // For IE, render the ActiveX Object
        if (DL.env.bIE) {

            if(!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB)
            {
                objString.push('<object id="',
			    _this._strObjectName,
			    '" style="width:', _this._strWidth, ';height:', _this._strHeight, ';border:1px solid #AAAAAA"',
                ' classid="clsid:',
			    Dynamsoft.WebTwainEnv.Trial ? DL.product.strTrialClassID : DL.product.strFullClassID,
			    '" viewastext>',
                '<param name="wmode" value="transparent"/>',
    			
                '</object>');
            }
            else
            {
                objString.push('<object id="',
			    _this._strObjectName,
			    '" style="width:', _this._strWidth, ';height:', _this._strHeight, ';border:1px solid #AAAAAA"',
    			
    			' codebase="',
                (DL.env.bWin64) ? DL.product.getActiveXCABx64Path() : DL.product.getActiveXCABx86Path(),
    			'#version=',
    			Dynamsoft.WebTwainEnv.ActiveXVersion,
    			'"',

                ' classid="clsid:',
			    Dynamsoft.WebTwainEnv.Trial ? DL.product.strTrialClassID : DL.product.strFullClassID,
			    '" viewastext>',
    			
    //            '<param name="Manufacturer" value="Dynamsoft Corporation" />',
    //            '<param name="ProductFamily" value="', DL.product.name, '" />',
    //            '<param name="ProductName" value="', DL.product.name, '" />',
                '<param name="wmode" value="transparent"/>',
    			
                '</object>');
            }
			
        }
        // For non-IE, render the embed object
        else {
			var _width = _this._strWidth;
			
			if(DL.isString(_width) && _width.indexOf('%') == -1)
				_width = (parseInt(_width) - 2) + 'px';
			
            objString.push('<embed id="',
				_this._strObjectName,
				'" style="display: inline; width:',
				_width,
				';height:',
				_this._strHeight,
				'" type="',
				DL.product.strMIMEType,
				'"',
				' pluginspage="',
				(DL.env.bWin) ? DL.product.getMSIPath() : DL.product.getPKGPath(),
				'"></embed>');
        }
		
        objString.push('</div><div id="', _this._strDWTNonInstallInnerContainerID, '" style="width: ', _outterWidth, ';display:none"></div>');
		
        varDWTContainer = document.getElementById(_this._strDWTControlContainerID);
        
        if (varDWTContainer)
            varDWTContainer.innerHTML = objString.join('');
        _this._objectWebTwain = document.getElementById(_this._strObjectName);

	};

    SWebTwain.prototype._notAllowedForChrome = function() {
        // Display the message and hide the main control
        if (!DL.env.bIE) {
            ua = (navigator.userAgent.toLowerCase());
            if (ua.match(/chrome\/([\d.]+)/)) {
				if(this.__OnNotAllowedForChrome){
					this.__OnNotAllowedForChrome(_this._strDWTInnerContainerID);
				}else{
					this._createNonAllowedDivPlugin();
					document.getElementById(this._strDWTNonInstallInnerContainerID).style.display = 'inline';
					document.getElementById(this._strDWTInnerContainerID).style.display = 'none';
				}
            }
        }
    };
	
    SWebTwain.prototype._createNonAllowedDivPlugin = function() {
        var _this = this; o = document.getElementById(_this._strDWTNonInstallInnerContainerID);
        if (o.innerHTML != '')
            return;
		
		var _height = _this._strHeight;
		if(DL.isString(_height) && _height.indexOf('%') == -1)
			_height = (parseInt(_height) - 10) + 'px';

		var strObjString = ['<div style="display: block; border:1px solid black; width:',
			_this._strWidth,
			';height:',
			_height,
			'">',
			'<div style="margin: 200px 0 0 0; padding: 5px; font-size: 16px;line-height: 30px; ">',
			'<div>The Component is not allowed to run on this site.</div>',
			'<div>Please click <img src="',
			Dynamsoft.WebTwainEnv.ResourcesPath + '/reference/imgs/plug-in-blocked.png"/>',
			'at the right end of the address bar and click "<b>Always allow plug-ins</b>". Then refresh/restart the browser.</div>',
			'</div></div>'].join('');
			
        o.innerHTML = strObjString;
		
		for (var i = 0; i < document.links.length; i++) {
			if (document.links[i].className == "DWT_CloseNonAllowedDiv") {
				document.links[i].onclick = function(){
					document.getElementById(_this._strDWTNonInstallInnerContainerID).style.display = 'none';
					document.getElementById(_this._strDWTInnerContainerID).style.display = 'inline';
				};
			}
		}
    };

    SWebTwain.prototype._createNonInstallDivPlugin = function() {
        var _this = this, o = document.getElementById(_this._strDWTNonInstallInnerContainerID);
        if (o.innerHTML != '')
            return;

        var strHref = '';

        if (Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB && DL.env.bIE) {
                var strObjString = ["<div style='display: block; border:solid black 1px; text-align:center; width:",
				    _this._strWidth,
				    ';height:',
				    _this._strHeight,
				    "'>",
				    "<ul style='padding-top:100px;'>",
				    "<li>The Component is not installed</li>",
				    "<li>You need to download and install the ActiveX to use this sample.</li>",
				    "<li>Please follow the instructions in the information bar.</li>",
				    "</ul></div>"].join('');
        }
        else {

            var _http = ('https:' == location.protocol ? 'https://' : 'http://');

            if(DL.product.bChromeEdition){
			    strHref = DL.product.getChromeEditionPath();
		    }else{
		        if(!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB && DL.env.bIE){
		             if(DL.env.bWin64)
		                strHref = DL.product.getActiveXCABx64Path();
		            else
		                strHref = DL.product.getActiveXCABx86Path();
		        }else{
			        strHref = (DL.env.bWin) ? DL.product.getMSIPath() : DL.product.getPKGPath();
			    }
		    }
			
            var strObjString = ["<div style='display: block; border:solid black 1px; text-align:center; width:",
				_this._strWidth,
				";height:",
				_this._strHeight,
				"'>",
				"<ul style='padding-top:100px;'>",
				"<li>The Component is not installed</li>",
				"<li>You need to download and install to use this sample.</li>",
				"<li>Please click the below link to download it.</li>",
				"<li>After the installation, please RESTART your browser.</li>",
				"<li><a href='",
				strHref,
				"'>Download</a></li>",
				"</ul></div>"].join('');
        }

        o.innerHTML = strObjString;
    };

    // Check if the control is fully loaded.
    DL.detect._controlDetect = function() {
        var aryDWTs = DL.detect.arySTwains,
			cWebTwain = aryDWTs[0],
			swt = cWebTwain && cWebTwain._objectWebTwain;

        // If the ErrorCode is 0, it means everything is fine for the control. It is fully loaded.
        if (swt){
			if (swt.ErrorCode == 0) {
				clearInterval(DL.detect._varSeed);
				
				// Please put product key (since v9.0)
				for (var i = 0; i < aryDWTs.length; i++) {
					var o = aryDWTs[i];
					
					// binds properties / methods / addon
					DL.attachProperty(o);
					DL.attachMethod(o);
					o._attachEvents();
					
					DL.attachAddon(o);
					
					// set Product Key
					o._objectWebTwain.ProductKey = Dynamsoft.WebTwainEnv.ProductKey;
					o._objectWebTwain.BrokerProcessType = DL.product._iBrokerProcessType;
					if (!DL.env.bWin) {
						o._objectWebTwain.ImageCaptureDriverType = DL.product._iImageCaptureDriverType;
					}
					
					if (DL.isFunction(o.__OnPluginReady)) {
						o.__OnPluginReady();
					}
					
				}

			}
			else {
				
				if (!DL.env.bIE) {
					// refresh plugin
					
					var bNoControl = true;
					navigator.plugins.refresh(false);
					if (DL.env.iPluginLength != navigator.plugins.length) {
						for (var i = 0; i < navigator.mimeTypes.length; i++) {
							if (navigator.mimeTypes[i].type.toLowerCase().indexOf(DL.product.strMIMEType.toLowerCase()) > -1) {
								location.reload();
							}
						}
					}

					// find plugin
					for (var i = 0; i < navigator.mimeTypes.length; i++) {
						if (navigator.mimeTypes[i].type.toLowerCase().indexOf(DL.product.strMIMEType.toLowerCase()) > -1) {
							// ok, find plugin
							for (var j = 0; j < aryDWTs.length; j++) {
								var o = aryDWTs[j];
								
								bNoControl = false;
								o._vPluginExist = true;
								if (o._vNotAllowedForChrome == false) {
									o._notAllowedForChrome();
									o._vNotAllowedForChrome = true;
								}
							}

						}
					}

					if(bNoControl && !DL.detect.bNoControlEvent) {
						Funs.noControl(cWebTwain);
						DL.detect.bNoControlEvent = true;
					}	
				} else {
					// ActiveX					
					if(!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB)	
					{
						// install with msi, open a dialog
						if(!DL.detect.bNoControlEvent) {
							Funs.noControl(cWebTwain);
							DL.detect.bNoControlEvent = true;
						}
					}
					// install with CAB, do nothing
					// else{}
				}
				
					
				if (DL.isFunction(cWebTwain.__OnPluginNotReady)) {
					cWebTwain.__OnPluginNotReady();
				}
				
			}
		}
		else{
			// Error
			clearInterval(DL.detect._varSeed);
		}
    };

	DL.plugin = {};

    DL.plugin.DynamicWebTwain = function(objectConfigs) {

        var o = new SWebTwain(objectConfigs);
        o._createControl(); //Create an instance of the component in the DIV assigned by this._strDWTContainerID

        DL.detect.arySTwains.push(o);

        return o;
    };
	
    DL.plugin.closeAll = function () {
		var aryDWTs = DL.detect.arySTwains, i, o, tmpSWT;

		for (i = 0; i < aryDWTs.length; i++) {
			o = aryDWTs[i];
			if(o && o._objectWebTwain){
				tmpSWT = o._objectWebTwain;
				if(tmpSWT && tmpSWT.ErrorCode==0)
					tmpSWT.RemoveAllImages();
			}
		}
		
        DL.detect.arySTwains = [];
    };
	
})(Dynamsoft.Lib);

// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function(){
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}

    // add local Storage
    Dynamsoft.Lib.LS = (function () {
        var _bEnable = (window.localStorage) ? true : false,
			_ret = {
			    isSupportLS: function () {
			        return _bEnable;
			    },

			    item: function (name, value) {
			        var val = null;
			        if (this.isSupportLS()) {
			            if (value) {
			                localStorage.setItem(name, value);
			                val = value;
			            } else {
			                val = localStorage.getItem(name);
			            }

			            if (val === null)
			                return false;

			            return val;
			        } else {
			            // console.log('Your browser doesnot support local storage!');
			            return false;
			        }

			    },

			    removeItem: function (name) {
			        if (this.isSupportLS()) {
			            localStorage.removeItem(name);
			        } else {
			            // console.log('Your browser doesnot support local storage!');
			            return false;
			        }
			        return true;
			    }
			};

        return _ret;
    })();

})();
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function(DL){

	DL.html5 = DL.html5 || {};
	
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}
	
	var cmdseq = 1, Funs;
	
	Funs = Dynamsoft.Lib.html5.Funs = {
        notSupportProperty: function (m) {
            // alert('This version of Dynamic WebTWAIN does not support the property "' + m + '".');
        },
        notSupportMethod: function (m) {
            // alert('This version of Dynamic WebTWAIN does not support the method "' + m + '".');
        },
		getRandom: function (){
			var a = new Date().getTime() % 10000,
				b = [],
				tmp;
				
			for(var i=0; i<5; i++){
				tmp = Math.floor(Math.random() * 10);
				if(i==0 && tmp == 0){
					i=-1;
					continue;
				}
				b.push(tmp);
			}
			
			if(a<10){
				b.push('000');
			} else if(a<100){
				b.push('00');
			} else if(a<1000){
				b.push('0');
			}
			b.push(a);
			
			return b.join('');
		},

		generateCmdId: function(){
			cmdseq++;
			return cmdseq;
		},
	
		sendData: function(_ws, _strData, binData, bSendWithBinaryHeader) {
		
			var json_len, bin_len, total_len, buffer, dv, newBlob, i, stringDataBlob;
				
			if(!bSendWithBinaryHeader){
				try{
					_ws.send(_strData);
				} catch (e) {
					Dynamsoft.Lib.log(e);
				}
				return false;
			}
			
			buffer = new ArrayBuffer(12);
			bin_len = binData && binData.size ? binData.size : 0;
			
			stringDataBlob = new Blob([_strData]);
						
			json_len = stringDataBlob.size;
			total_len = json_len + bin_len;
			dv = new DataView(buffer);
			
			// total length
			for (i = 0; i < 8; i++) {
				if (total_len) {
					dv.setUint8(i, total_len % 256);
					total_len = parseInt(total_len / 256);
				} else {
					break;
				}
			}
			
			// strData length
			for (i = 0; i < 4; i++) {
				if (json_len) {
					dv.setUint8(8+i, json_len % 256);
					json_len = parseInt(json_len / 256);
				} else {
					break;
				}
			}

			newBlob = new Blob([buffer, stringDataBlob]);
			_ws.send(newBlob);
			
			if(bin_len > 0){
				_ws.send(binData);
			}
			
			return true;
		},		
        init: function (_stwain, _id) {

            // init container div
            var C, container, body, newDiv, tmp, _containerBox, parentNode, dlg, containerBox;

			dlg = [];
			dlg.push('<dialog id="dialogProgress" class="ds-dwt-dialogProgress" style="top:30%"><h3 id="finalMessage"></h3><p id="status">0%</p>');
			
			if(Dynamsoft.Lib.env.bIE){
				dlg.push('<div id="progressBar" value="" max="100"></div>');
			} else {
				dlg.push('<progress id="progressBar" value="" max="100"></progress>');
			}
			dlg.push('<br /><button id="btnCancel" value="cancel" autofcus >cancel</button></dialog>');
			
			containerBox = '<div class="ds-dwt-container-box"></div>';

            container = KISSY.one('#' + _id);
			container.html('');
            container.attr('class', _stwain.containerClass);
			container.append(containerBox);

			_containerBox = container.one('.ds-dwt-container-box');
			if(_containerBox){
				_containerBox.style('position', 'relative');
				Funs.changeImageUISize(_stwain, _stwain._width, _stwain._height);
			}

            // container.append(html);

            if (!Dynamsoft.Lib.dlgProgress) {
				// delete old one
				tmp = KISSY.one('#dialogProgress');
				if(tmp){
					tmp.remove();
				}
				
                container.append(dlg.join(''));
                tmp = container.one('#dialogProgress');
				
				if(Dynamsoft.Lib.env.bIE){
					var bar = Dynamsoft.Lib.get('progressBar');
					bar.objProgressBar = new Dynamsoft.Lib.ProgressBar("progressBar",{
						width: 300,
						height: 20
					});
				}
				
                if (tmp && tmp[0]) {
                    Dynamsoft.Lib.dlgProgress = tmp[0];
                    Dynamsoft.Lib.Dialog.registerDialog(Dynamsoft.Lib.dlgProgress);
                }

                Dynamsoft.Lib.dlgRef = 0;
                Dynamsoft.Lib.dialogShowStatus = false;
                Dynamsoft.Lib.cancelFrome = 0;

                var btnCancel = container.one('#btnCancel');
                btnCancel[0].onclick = function () {
                    var vCancelFrome = Dynamsoft.Lib.cancelFrome;
                    Dynamsoft.Lib.closeProgress(0);

                    if (Dynamsoft.Lib.bio) {
                        Dynamsoft.Lib.bio.abort();
                        Dynamsoft.Lib.bio = false;
                    }
                    else if (vCancelFrome == 3 || vCancelFrome == 4) {
                        _stwain.SetCancel();
                    }

                };
            }

            Funs.initImageUI(_stwain, _containerBox);

        },

        initImageUI: function (_stwain, _containerBox) {

            var container, _view_cfg, 
				_w=_stwain._width, _h=_stwain._height, bNeedResize = false;
			
			container = KISSY.one('#' + _stwain._strDWTControlContainerID);
			if(Dynamsoft.Lib.isString(_w) && _w.indexOf('%')>=0){

				_w = KISSY.DOM.width(container) * parseInt(_w) / 100;
				bNeedResize = true;
			}else{
				_w = parseInt(_w);
			}
			
			if(Dynamsoft.Lib.isString(_h) && _h.indexOf('%')>=0){
				_h = KISSY.DOM.height(container) * parseInt(_h) / 100;
				bNeedResize = true;
			}else{
				_h = parseInt(_h);
			}
			
			_view_cfg = {
                Container: _containerBox,
                Width: _w,
                Height: _h
            };
			
			Funs.bindUIViewEvents(_stwain, _view_cfg);

            _stwain._UIManager = new Dynamsoft.Lib.UI.ImageUIManager(_stwain, _view_cfg);
			
			if(bNeedResize){
				Funs.changeImageUISize(_stwain, _stwain._width, _stwain._height);
			}

        },

        changeImageUISize: function (_stwain, _width, _height) {
			var container, containerBox, _iWidth=-1, _iHeight=-1, 
				strWidth=_width, strHeight=_height, bNeedResize = false;
			
			container = KISSY.one('#' + _stwain._strDWTControlContainerID);
			if(Dynamsoft.Lib.isString(_width) && _width.indexOf('%')>=0){

				_w = KISSY.DOM.width(container) * parseInt(_width) / 100;
				bNeedResize = true;
			}else{
				_w = parseInt(_width);
				strWidth = [_w+2, 'px'].join('');
			}
			
			if(Dynamsoft.Lib.isString(_height) && _height.indexOf('%')>=0){
				_h = KISSY.DOM.height(container) * parseInt(_height) / 100;
				bNeedResize = true;
			}else{
				_h = parseInt(_height);
				strHeight = [_h+2, 'px'].join('');
			}

			if(container){
				containerBox = container.one('.ds-dwt-container-box');
				if(containerBox){
					containerBox.style('width', strWidth);
					containerBox.style('height', strHeight);
				}
			}
			
			if(bNeedResize){
				if(!_stwain.__funResize){
					_stwain.__funResize = function(){
						var newSize = Funs.__innerGetUIViewRealSize(_stwain._strDWTControlContainerID, _stwain._width, _stwain._height);
						
						if(_stwain._UIManager){
							return _stwain._UIManager.ChangeSize(newSize.width, newSize.height);
						}
						
						return true;
					};
				}
				
				Dynamsoft.Lib.removeEventListener(window, 'resize', _stwain.__funResize);
				Dynamsoft.Lib.addEventListener(window, 'resize', _stwain.__funResize);
			} else {
				if(_stwain.__funResize){
					Dynamsoft.Lib.removeEventListener(window, 'resize', _stwain.__funResize);
					_stwain.__funResize = false;
				}
			}
			
			var newSize = Funs.__innerGetUIViewRealSize(_stwain._strDWTControlContainerID, _w, _h);
			
			if(_stwain._UIManager){
				return _stwain._UIManager.ChangeSize(newSize.width, newSize.height);
			}
            
			return true;
			
        },

		__innerGetUIViewRealSize: function (_container, _width, _height) {
			var container, _w=-1, _h=-1;
			
			container = KISSY.one('#' + _container);
			if(Dynamsoft.Lib.isString(_width) && _width.indexOf('%')>=0){
				_w = KISSY.DOM.width(container) * parseInt(_width) / 100;
			}
			
			if(_w<0 && _width){
				_w = parseInt(_width);
			}
			
			if(Dynamsoft.Lib.isString(_height) && _height.indexOf('%')>=0){
				_h = KISSY.DOM.height(container) * parseInt(_height) / 100;
			}
			
			if(_h<0 && _height){
				_h = parseInt(_height);
			}

			return {'width':_w, 'height': _h};
        },
		
        bindUIViewEvents: function (_swt, _cfg) {
            var _this = _swt, ret;

            _cfg['onSelected'] = function (_selectedIndexes) {

                var selectedIndexesCount = _selectedIndexes.length, _cIndex;

                if (selectedIndexesCount > 0) {
					_this.__SelectedImagesCount = selectedIndexesCount;
                    _cIndex = _selectedIndexes[selectedIndexesCount - 1];
                    // note: must set current Index now
                    _this.__cIndex = _cIndex;
                    ret = Funs.__SetSelectedImages(_this, _this.__cIndex, _selectedIndexes);

                    if (ret && Dynamsoft.Lib.isFunction(_this.__OnRefreshUI))
                        _this.__OnRefreshUI(_cIndex);

                } else {
					_this.__SelectedImagesCount = 0;
				}
            };

            _cfg['onRefreshUI'] = function (_index) {
                Funs.__innerRefreshFromUIView(_this, _index);
            };
			
            _cfg['onResetCurrentIndex'] = function (_cIndex) {

				if (_cIndex >= 0 && _this.__cIndex != _cIndex) {					
					_this._innerFun('CurrentImageIndexInBuffer', Funs.makeParams(_cIndex));
					_this.__cIndex = _cIndex;
				}

            };

            _cfg['onMouseMove'] = function (params) {
				var _index = params.index;

				if(params){
					var x = params.x, y = params.y;
					_this.__MouseX = x;
					_this.__MouseY = y;
				}
                if (Dynamsoft.Lib.isFunction(_this.__OnMouseMove))
                    _this.__OnMouseMove(_index);

            };

            _cfg['onMouseClick'] = function (params) {
				var _index = params.index;

				if(params){
					var x = params.x, y = params.y;
					_this.__MouseX = x;
					_this.__MouseY = y;
				}
				
                if (Dynamsoft.Lib.isFunction(_this.__OnMouseClick))
                    _this.__OnMouseClick(_index);
            };
            _cfg['onMouseDoubleClick'] = function (params) {
				var _index = params.index;
                if (Dynamsoft.Lib.isFunction(_this.__OnMouseDoubleClick))
                    _this.__OnMouseDoubleClick(_index);
            };
            _cfg['onMouseRightClick'] = function (params) {
				var _index = params.index;

				if(params){
					var x = params.x, y = params.y;
					_this.__MouseX = x;
					_this.__MouseY = y;
				}
				
				if (Dynamsoft.Lib.isFunction(_this.__OnMouseRightClick)){
					return _this.__OnMouseRightClick(_index);
				}
				return true;
            };
			
            _cfg['onImageAreaSelected'] = function (params) {
                if (Dynamsoft.Lib.isFunction(_this.__OnImageAreaSelected)){
					if(!params.fromScroll){
						_this.__OnImageAreaSelected(params.index, params.left, params.top, params.right, params.bottom);
					}
				}
            };
            _cfg['onImageAreaDeSelected'] = function (_ImageIndex) {
                if (Dynamsoft.Lib.isFunction(_this.__OnImageAreaDeSelected))
                    _this.__OnImageAreaDeSelected(_ImageIndex);
            };
        },

        __pushElement: function (_array, arg) {
            if (Dynamsoft.Lib.isString(arg)) {
                _array.push('"');
                _array.push(arg);
                _array.push('"');
            } else if (Dynamsoft.Lib.isArray(arg)) {
                var bFirst = true;
                _array.push('[');
                Dynamsoft.Lib.each(arg, function (el) {
                    if (bFirst) {
                        bFirst = false;
                    } else {
                        _array.push(',');
                    }
                    Funs.__pushElement(_array, el);
                });
                _array.push(']');
            } else {
                //Number(el) || Dynamsoft.Lib.isBoolean(el)
				if(arg === undefined)
					_array.push('""');
				else
					_array.push(arg);
            }
        },
        makeParams: function () {
            var args = arguments;
            if (args === undefined || args.length === 0)
                return undefined;
            else {
                var ret = [];

                if (args.length === 1) {
                    var p1 = args[0];
                    ret.push('[');
                    Funs.__pushElement(ret, p1);
                    ret.push(']');
                } else if (args.length === 2) {
                    var p1 = args[0], p2 = args[1];
                    ret.push('[');
                    Funs.__pushElement(ret, p1);
                    ret.push(',');
                    Funs.__pushElement(ret, p2);
                    ret.push(']');
                } else {
                    Funs.__pushElement(ret, Array.prototype.slice.call(args));
                }
                return ret.join('');
            }
        },
        getJson: function (_stwain, m, p, cmdId) {
            var cmd = [];

            cmd.push('{');

            // id
            cmd.push('"id":"');
            cmd.push(_stwain.clientId);
            cmd.push('"');
			
			if(cmdId){
				cmd.push(',"cmdId":"');
				cmd.push(cmdId);
				cmd.push('"');
			}

            // method
            cmd.push(',"method":"');
            cmd.push(m);
            cmd.push('"');

            if (p !== undefined && p !== null) {
                cmd.push(',"parameter":');
                cmd.push(p);
            }

            cmd.push('}');

            return cmd.join('');
        },

        refreshImageAfterInvokeFun: function (_stwain, _index, funResult) {
            return (funResult == 1);
        },

        loadHttpBlob: function (_stwain, _get_or_post, _url, _async, sFun, fFun, progressFun) {
            var m = 'loadHttpBlob', _fFun, cfg, ret = false;

            _fFun = function (_datas, _pReason, _pIo) {
				var _reason, _io;
				if(_datas && KISSY.isArray(_datas) && _datas.length>2){
					_reason = _datas[1];
					_io = _datas[2];
				} else {
					_reason = _pReason;
					_io = _pIo;
				}
					
                if (_io.state == 2 && _io.status == 0) {
					if(_io.statusText === 'abort'){
						var bCanceled = true;
						Dynamsoft.Lib.Errors.HttpDownloadError(_stwain, bCanceled);
					} else {
						Dynamsoft.Lib.Errors.HttpDownloadUrlError(_stwain);
					}

                } else {

					Dynamsoft.Lib.Errors.HttpDownloadError(_stwain, false, _reason, _io.status);
                }

                if (Dynamsoft.Lib.isFunction(fFun)) {
                    fFun();
                }

            };
			
			
			cfg = {
                type: _get_or_post,
                url: _url,
                async: _async,
                success: sFun,
                error: _fFun,
                complete: function () {
                    Dynamsoft.Lib.bio = false;
                }
                
            };
			
			if(_stwain.HTTPUserName != ''){
				cfg.username = _stwain.HTTPUserName;
				cfg.password = _stwain.HTTPPassword;
			}
			
			if(_async){
				cfg.responseType = 'blob';
				if (Dynamsoft.Lib.isFunction(progressFun)) {
					cfg.beforeSend = function (_context) {
						var nativeXhr = _context.getNativeXhr();
						nativeXhr.addEventListener("progress", function (evt) {
							delete (evt['totalSize']);
							delete (evt['position']);
							
							progressFun(evt);
						}, false);
					};
				}
				
				ret = true;
			} else {
				
				// IE10+
				if(Dynamsoft.Lib.env.bIE){
					cfg.responseType = 'arraybuffer';
					cfg.success = function(_a1, _status, _io){
						var data,l,arr;
						
						data = _a1 || _io.responseData;
						if(data){
							arr = new Uint8Array(data);
						}

						_stwain._errorCode = 0;
						_stwain._errorString = '';
						sFun(arr);
						
						_stwain._HowManyImagesInBuffer = _stwain._innerFun('HowManyImagesInBuffer');
						_stwain.__cIndex = _stwain._innerFun('CurrentImageIndexInBuffer');

						ret = true;
					};
				} else {
						
					// Chrome or Firefox
					cfg.contentType = 'text/plain; charset=x-user-defined';
					cfg.mimeType = 'text/plain; charset=x-user-defined';
					cfg.success = function(_a1, _status, _io){
						var data,l,arr;
						
						data = _io.responseText;
						l = data.length;
						arr = new Uint8Array(l);
						
						for(var i = 0; i < l; i++) {
							arr[i] = data.charCodeAt(i);
						}
						
						_stwain._errorCode = 0;
						_stwain._errorString = '';
						sFun(arr);
						
						_stwain._HowManyImagesInBuffer = _stwain._innerFun('HowManyImagesInBuffer');
						_stwain.__cIndex = _stwain._innerFun('CurrentImageIndexInBuffer');

						
						ret = true;
					};
					
				}
				
				KISSY.mix(cfg, {headers:{'X-Requested-With':false}});
			}
			
			
			if(_get_or_post == 'post'){
				// add post data
				var post_data = _stwain.httpFormFields, formData;
				if(post_data){
					try{
						formData = new FormData();
						KISSY.each(post_data, function(v, k) {
							formData.append(k, v);
						});
						
						KISSY.mix(cfg, {
							'data': formData,
							'processData': false,
							'contentType': false
						});
						
					}catch(e){
					}
				}
			}
			
            var tmpIO = new KISSY.IO(cfg);
			if(_async){
				Dynamsoft.Lib.bio = tmpIO;
			}

			return ret;
        },
		
        getServerImageUrlPrefix: function (_stwain, _index) {
            var httpUrl = _stwain.httpUrl, _bFullImage = false,
				tmp = [httpUrl, 'img?id=', _stwain.clientId];

            return tmp.join('');
        },
		
        getServerSmallImageUrl: function (_stwain, _index, _act) {
            var httpUrl = _stwain.httpUrl, _bFullImage = false,
				tmp = [httpUrl, 'img?id=', _stwain.clientId];

            if (_index !== undefined && _index !== null) {
                tmp.push('&index=');
                tmp.push(_index);
            }

            // 1-undo 2-save
            if (_act) {
                tmp.push('&act=');
                tmp.push(_act);
            } else {
				tmp.push('&width=');
				tmp.push(_bFullImage? '-1' : _stwain._width/2);
				tmp.push('&height=');
				tmp.push(_bFullImage? '-1' : _stwain._height/2);
			}

            return tmp.join('');
        },


        combineUrl: function (_stwain, _host, page) {
            var url = [], host = _host;

			if(host === undefined || page === undefined){
				return false;
			}
			
			if(!Dynamsoft.Lib.isString(host)){
				host = new String(_host);
			}
			
			if (host.indexOf('http://') == 0 || host.indexOf('https://') == 0) {

			} else {
				if (_stwain.IfSSL)
					url.push('https://');
				else
					url.push('http://');
			}

			url.push(host);

			if (host.indexOf(':') < 0) {
				if(_stwain.HTTPPort == '')
					_stwain.HTTPPort = Dynamsoft.Lib.detect.ssl? 443 : 80;
					
				if((!Dynamsoft.Lib.detect.ssl && _stwain.HTTPPort != 80) 
					|| (Dynamsoft.Lib.detect.ssl && _stwain.HTTPPort != 443)){
					
					url.push(':');
					url.push(_stwain.HTTPPort);
				}
			}

			if (page.indexOf('/') !== 0)
				url.push('/');
			url.push(page);

            return url.join('');
        },

        httpPostUpload: function (_stwain, url, _blobData, _async, _sFun, _fFun) {
		
			if(!_blobData){

				Dynamsoft.Lib.Errors.UploadFileCannotEmpty(_stwain);
				
                if (Dynamsoft.Lib.isFunction(_fFun)) {
                    _fFun();
                }
				return;
			}
			
			var maxLen = _stwain.MaxUploadImageSize, len = _blobData.size, blobType = _blobData.type, blobData;
			if(len <= 0 || (len > maxLen && maxLen != -1) ){
			
				Dynamsoft.Lib.Errors.UploadExceededMaxSize(_stwain);
				
                if (Dynamsoft.Lib.isFunction(_fFun)) {
                    _fFun();
                }
				
				return;
			}

			if (blobType==='' || blobType && blobType != _stwain.HttpContentTypeFieldValue) {
				var slice = _blobData.slice || _blobData.webkitSlice || _blobData.mozSlice;
				blobData = slice.call(_blobData, 0, len, _stwain.HttpContentTypeFieldValue);
				blobData.name = _blobData.name;
			} else {
				blobData = _blobData;
			}
			
			blobData.remoteFilename = _stwain.__remoteFilename;

            Dynamsoft.Lib.bio = new KISSY.BIO({
                action: url,
                data: _stwain.httpFormFields,
				async: _async
            });

            _stwain.__HTTPPostResponseString = false;
            // _stwain.HTTPUserName
            // _stwain.HTTPPassword

            Dynamsoft.Lib.bio.on(KISSY.BIO.event.SUCCESS, function (ev) {
				// ev: {'status':'success|error','msg':false,'json':false,'response':false}

				Dynamsoft.Lib.bio = false;

				if (ev && Dynamsoft.Lib.isString(ev.response)) {
				    _stwain.__HTTPPostResponseString = ev.response;
				} else {
				    _stwain.__HTTPPostResponseString = '';
				}

				if (Dynamsoft.Lib.isFunction(_sFun)) {
				    _sFun(_stwain.__HTTPPostResponseString);
				}
            });
            Dynamsoft.Lib.bio.on(KISSY.BIO.event.ERROR, function (ev) {
				// ev: {'status':'success|error','msg':false,'json':false,'response':false,'canceled':false,'timeout':false}
				var bCanceled = (ev && ev.canceled), bTimeOut=(ev && ev.timeout), errorText = false, errorStatus = false;

				Dynamsoft.Lib.bio = false;
				if (ev && Dynamsoft.Lib.isString(ev.response)) {
				    _stwain.__HTTPPostResponseString = ev.response;
				} else {
				    _stwain.__HTTPPostResponseString = '';
				}
				
				if(!bCanceled){
					if (ev && ev.msg) {
						errorText = ev.msg;
					}
					
					if (ev && ev.httpStatus){
						errorStatus = ev.httpStatus;
					}
				}
				
				Dynamsoft.Lib.Errors.UploadError(_stwain, bCanceled, errorText, errorStatus);
                
                if (Dynamsoft.Lib.isFunction(_fFun)) {
                    _fFun(_stwain.__HTTPPostResponseString);
                }

            });

            Dynamsoft.Lib.bio.on(KISSY.BIO.event.PROGRESS, function (ev) {
                // ev {index:index, file:queue.getFile(index), result:result}

				delete (ev['totalSize']);
				delete (ev['position']);
				
                var p = (ev.total === 0) ? 100 : Math.round(ev.loaded * 100 / ev.total),
					msg = [ev.loaded, ' / ', ev.total].join('');

							
                _stwain._OnPercentDone([0, p, '', 'http']);	// http upload (post)

            });

            _stwain._OnPercentDone([0, -1, 'uploading...', 'http']); // http upload (post)

            Dynamsoft.Lib.bio.upload(blobData);

            return true;
        },

        httpPutImage: function (_stwain, url, blobData, _async, sFun, fFun, progressFun) {
			var cfg = {
                type: 'PUT',
                url: url,
                hasContent: true,
                processData: false,
				async: _async,
                data: blobData,
                success: sFun,
                error: fFun,
                complete: function () {
                    Dynamsoft.Lib.bio = false;
                },
                beforeSend: function (_context) {
                    if (Dynamsoft.Lib.isFunction(progressFun)) {
                        var nativeXhr = _context.getNativeXhr();
                        nativeXhr.upload.addEventListener("progress", function (evt) {
							delete (evt['totalSize']);
							delete (evt['position']);

                            progressFun(evt);
                        }, false);
                    }
                }

            };
			
			if(_stwain.HTTPUserName != ''){
				cfg.username = _stwain.HTTPUserName;
				cfg.password = _stwain.HTTPPassword;
			}
			

			if(!_async)
				KISSY.mix(cfg, {headers:{'X-Requested-With':false}});
			
            Dynamsoft.Lib.bio = new KISSY.IO(cfg);

            return true;
        },

        dialog: false,
        dialogRef: 0,

        showMask: function (m) {
            var _self = this;
            Dynamsoft.Lib.log('showMask:' + m + '--' + _self.dialogRef);

            if (_self.dialogRef == 0) {
                Dynamsoft.Lib.detect.showMask();
            }

            _self.dialogRef++;
        },
        hideMask: function (m) {
            var _self = this;

            Dynamsoft.Lib.log('hideMask:' + m + '--' + _self.dialogRef);

            if (_self.dialogRef > 1)
                _self.dialogRef--;
            else if (_self.dialogRef <= 1) {
                Dynamsoft.Lib.detect.hideMask();
                _self.dialog = false;
                _self.dialogRef = 0;
            }
        },


        setBtnCancelVisibleForProgress: function (swt, bVisible) {
            var _self = this;
            if ((Dynamsoft.Lib.cancelFrome == 0 && swt.__IfShowProgressBar == true) || 
        ( Dynamsoft.Lib.cancelFrome != 0 && swt.__IfShowCancelDialogWhenImageTransfer == true)) {
                var btnCancel = Dynamsoft.Lib.get('btnCancel');
                if (bVisible == false)
                    btnCancel.style.display = 'none';
                else
                    btnCancel.style.display = '';
            }

        },

        EVENTS: [
			'OnPostAllTransfers',
			'OnPostTransfer',
			'OnPostLoad',
			'OnPreTransfer',
			'OnPreAllTransfers',
			'OnResult',
			'OnTransferCancelled',
			'OnTransferError',
			'OnSourceUIClose',
			'OnBitmapChanged',
			'OnGetFilePath',
			'OnPercentDone'
        ],
        SEND_BACK_EVENTS: [
			'OnPreAllTransfers',
			'OnPreTransfer',
			'OnPostTransfer',
            'OnGetFilePath',
            'OnPostLoad'
        ],

        handleEvent: function (_stwain, _evt) {
            var _this = this, _evtId = _evt.result[0], ws = _stwain._objWS, handled = false;

            // default events sendback
            Dynamsoft.Lib.each(Funs.EVENTS, function (v, k) {
                if (_evt.event === v) {
                    var vFun1 = ['_', v].join('');
                    handled = true;

                    if (Dynamsoft.Lib.isFunction(_stwain[vFun1])) {
                        _stwain[vFun1](_evt.result, _evt);
                    }

                    return false;
                }
            });

            if (handled) {
                Dynamsoft.Lib.log('handled event:' + _evt.event);
                Dynamsoft.Lib.each(Funs.SEND_BACK_EVENTS, function (v, k) {

					if (Funs.isServerInvalid(_stwain)) {
						return false;
					}
						
                    if (_evt.event === v) {
                        Dynamsoft.Lib.log('sendback event:' + _evt.event);
						
						Funs.sendData(ws, Funs.getJson(_stwain, _evt.event, Funs.makeParams(_evtId), 0), false, true);
						
                        // _stwain._innerFun(_evt.event, Funs.makeParams(_evtId));
                        return false;
                    }
                });
            } else {
				// test addon events
				Dynamsoft.Lib.each(DL.Addon_Events, function (v, k) {
					if (_evt.event === v) {
						var vFun1 = ['_', v].join('');
						handled = true;

						if (Dynamsoft.Lib.isFunction(_stwain[vFun1])) {
							_stwain[vFun1](_evt.result);
						}

						return false;
					}
				});
				
				if (handled) {
					Dynamsoft.Lib.log('handled addon event:' + _evt.event);
					Dynamsoft.Lib.each(DL.Addon_Sendback_Events, function (v, k) {

						if (Funs.isServerInvalid(_stwain)) {
							return false;
						}
							
						if (_evt.event === v) {
							Dynamsoft.Lib.log('sendback addon event:' + _evt.event);
							
							Funs.sendData(ws, Funs.getJson(_stwain, _evt.event, Funs.makeParams(_evtId), 0), false, true);
							
							// _stwain._innerFun(_evt.event, Funs.makeParams(_evtId));
							return false;
						}
					});
				}
			}

            return handled;
        },

        // 0:BMP, 1:JPEG, 2:TIFF, 3:PNG, 4:PDF, 5:GIF
        getImageType: function (file) {
			if(file === undefined)
				return -1;
		
            var len = file.length;
            if (len < 4) {
                return -1;
            }

            var nPos = file.lastIndexOf('.');
            if (nPos === -1)
                return -1;

            var tails = file.slice(nPos).toLowerCase();
            if (tails === '.bmp' || tails === '.dib')
                return 0;
            if (tails === '.jpg' || tails === '.jpe' || tails === '.jpeg' || tails === '.jfif')
                return 1;
            if (tails === '.tif' || tails === '.tiff')
                return 2;
            if (tails === '.png')
                return 3;
            if (tails === '.pdf')
                return 4;
            if (tails === '.gif')
                return 5;

            return -1;
        },
        autoDiscardBlankImage: function (_this, evt) {
            if (Dynamsoft.Lib.config.bDiscardBlankImage) {
                var index = _this.__cIndex;
                if (_this.IsBlankImage(index)) {
                    _this.RemoveImage(index);
                }

                var str = ['Blank Discard (', evt, '): ', _this.ErrorString].join('');

                if (Dynamsoft.Lib.isFunction(_this.__OnPrintMsg))
                    _this.__OnPrintMsg(str);
            }
        },
        replaceLocalFilename: function (_file) {
            var f;
			
			if(_file === undefined)
				return '';

            _file = new String(_file);
			f = _file.replace(/\\/g, '\\\\');

            if (Dynamsoft.Lib.env.bFileSystem)
                f = decodeURI(f);

            return f;
        },

        __innerRefreshFromUIView: function (_swt, _cIndex, _fromCurrentImageIndex) {
            var _this = _swt;

            if (_cIndex >= 0) {
				if(!_fromCurrentImageIndex){
					_this.CurrentImageIndexInBuffer = _cIndex;
				}
                
				_this._UIManager.refreshEditor(_this._UIManager.GetCurrentImageIndex(), _this._UIManager.count());
            }

            if (Dynamsoft.Lib.isFunction(_this.__OnRefreshUI))
                _this.__OnRefreshUI(_cIndex);
        },
        
		__SetSelectedImages: function (_stwain, curIndex, selectedImages) {
			_stwain.__SelectedImagesCount = selectedImages.length;
			if(curIndex === undefined){
				curIndex = '';
			}
			
			return _stwain._innerFun('SetSelectedImages', Funs.makeParams(curIndex, selectedImages.join(',')));
		},
		
		GetImageInfo: function(_stwain, _index){
			var _this = _stwain;
			
			return _stwain._innerFun('GetImageInfo', Funs.makeParams(_index));
		},
		isServerInvalid: function(_stwain){
			var _this = _stwain, bNotStarted = !_this.bReady || _this._objWS === null;
			
			if(bNotStarted){
				Dynamsoft.Lib.Errors.Server_Invalid(_this);
			}

			return bNotStarted || _this._errorCode == -2208 || _this._errorCode == -2308;
		},
		isHttpServerInvalid: function(_stwain){

			var _this = _stwain, bNotStarted = !_this.bReady || _this.httpUrl === null;
			
			if(bNotStarted){
				Dynamsoft.Lib.Errors.Server_Invalid(_this);
			}
			
			return bNotStarted || _this._errorCode == -2208;
		},

        callbacks: [],
        pushCallback: function (m, c, t) {
            var o = {
                method: m,
                callback: c,
                ticks: t
            };

            Funs.callbacks(o);
        },

        refreshUIRef: 0

    };
	
})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function(DL){
	if (!DL.product.bChromeEdition){
		return;
	}

	DL.html5 = DL.html5 || {};

	var funAttachProperty = function (twainStyle){
		var _this = twainStyle;

		Object.defineProperty(_this, 'width', {
			get : function(){
				return this._parent._width;
			},
			set : function(v){
				this.SetSize(v, false);
			}
		});
		Object.defineProperty(_this, 'height', {
			get : function(){
				return this._parent._height;
			},
			set : function(v){
				this.SetSize(false, v);
			}
		});
	};

    DL.html5.STwainStyle = function(_stwain) {
        var _style = this;
        _style._parent = _stwain;
		funAttachProperty(_style);
    };

    DL.html5.STwainStyle.prototype.SetSize = function (w, h) {
		this._parent._innerSetSize(w, h);
    };

})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 

(function(D,S,Funs){
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}

    Dynamsoft.Lib.html5.STwain = function (cfg) {
        var swt = this, config = cfg || {};

        swt.clientId = Funs.getRandom();
		
        swt._strDWTControlContainerID = config.containerID || ('dwt-container-' + swt.clientId);
        swt._width = config.width;
        swt._height = config.height;
		
        swt.containerClass = 'ds-dwt-container noPadding';

        Funs.init(swt, swt._strDWTControlContainerID);

        swt.objectName = swt._strDWTControlContainerID + '_obj';

        swt.bReady = false;
        swt.httpFormFields = {};

        // ws info
        swt._objWS = null;
		swt.__wsRetry = 0;
		
        swt.curCommand = [];
        swt.curCommand_SaveImagesToBytes = [];

        // events

        Dynamsoft.Lib.__innerInitEvents(swt, config);

        swt.__OnMouseClick = config.onMouseClick || '';
        swt.__OnMouseDoubleClick = config.onMouseDoubleClick || '';
        swt.__OnMouseRightClick = config.onMouseRightClick || '';

        swt.__OnMouseMove = config.onMouseMove || '';
        swt.__OnImageAreaSelected = config.onImageAreaSelected || '';
        swt.__OnImageAreaDeSelected = config.onImageAreaDeSelected || '';

        /*
		swt.__OnAfterOperate = config.onAfterOperate || '';
		swt.__OnBeforeOperate = config.onBeforeOperate || '';
		swt.__OnOperateStatus = config.onOperateStatus || ''; 
		*/
        swt.__OnInternetTransferPercentage = config.onInternetTransferPercentage || ''; 
		swt.__OnInternetTransferPercentageEx = config.onInternetTransferPercentageEx || '';

        // html5 events
        swt.__OnWSReady = config.onWSReady || null;
        swt.__OnWSReconnect = config.onWSReconnect || null;
        swt.__OnWSClose = config.onWSClose || null;
        swt.__OnWSMessage = config.onWSMessage || null;
        swt.__OnWSError = config.onWSError || null;

        swt.__OnPercentDone = config.onPercentDone || '';
        swt.__OnRefreshUI = config.onRefreshUI || '';
        swt.__OnPrintMsg = config.onPrintMsg || '';
        swt.__OnResult = config.onResult || '';

        swt.HTTPPassword = config.HTTPPassword || '';
        swt.HTTPPort = config.HTTPPort || (Dynamsoft.Lib.detect.ssl? 443 : 80);

        swt.HTTPUserName = config.HTTPUserName || '';
        swt.__HTTPPostResponseString = '';
        swt.__strHttpContentTypeFieldValue = 'application/octet-stream';
        swt.__IfShowProgressBar = true;
        swt.__IfShowCancelDialogWhenImageTransfer = true;

        swt.__cIndex = -1;
        swt._HowManyImagesInBuffer = 0;
        swt._errorCode = 0;
        swt._errorString = '';
        swt.__bLoadingImage = false;
        swt.__backgroundColor = false;

        swt.__MouseX = 0;
        swt.__MouseY = 0;

        swt.__style = new Dynamsoft.Lib.html5.STwainStyle(swt);
		swt.__addon = {};
		
		swt.__remoteFilename = 'RemoteFile';
		
		swt.__sourceName = [];
		swt.__defaultSourceName = '';
		swt.__sourceCount = -1;
		swt.__SelectedImagesCount = 0;
		swt.__serverId = '';
		
		swt.__fSelectionRectAspectRatio = 0;
    };
	
	var STwainP = Dynamsoft.Lib.html5.STwain.prototype;

    STwainP.getInstance = function () {
        return this;
    };

    STwainP._OnReady = function (bReconnect) {
        var _this = this,
			o = Dynamsoft.Lib.detect.urls[Dynamsoft.Lib.detect.cUrlIndex],
			httpUrl = Dynamsoft.Lib.getHttpUrl(o),
			_objWS = _this._objWS;
			
        if (_objWS === null)
            return;
		
		Dynamsoft.Lib.detect.starting = false;
		Dynamsoft.Lib.detect.bOK = true;
        _this.bReady = true;
		_this.__wsRetry = 0;

        _objWS.onopen = null;
        _this.httpUrl = httpUrl;

        _objWS.onmessage = function (msg) {

			// receive message from server

            var rawData = msg.data;
            if (typeof (rawData) === 'object') {

                var curCmd = _this.curCommand_SaveImagesToBytes.shift() || {};
				
                if (curCmd.sFun)
                    curCmd.sFun(rawData);

                return;
            }


            if (_this.__OnWSMessage)
                _this.__OnWSMessage(rawData);

            var r = rawData.replace(/\0/g, '');
            if (r.indexOf('Exception:') >= 0 || r.indexOf('Error') == 0) {
				// not be here
			
                var str = rawData, handled = false,
					curCmd = _this.curCommand.pop() || {};

				Dynamsoft.Lib.log(str + '@' + curCmd.cmd);
				
                if (curCmd.fFun)
                    handled = curCmd.fFun(str);

                if (!handled && Dynamsoft.Lib.isFunction(_this.__OnPrintMsg))
                    _this.__OnPrintMsg(str);


                return;
            }

           	try
			{
				r = KISSY.JSON.parse(r);
			}
			catch(exp)
			{
				Dynamsoft.Lib.log(rawData);
			}

            if (r.event) {
                Funs.handleEvent(_this, r);
                return;
            }

            var curCmd;

			if (r.cmdId){
				// new server from 10.1
				var _cmdcount = _this.curCommand.length, i, findIndex = -1;
				for(i=_cmdcount-1; i>=0; i--){
					if(_this.curCommand[i].cmdId == r.cmdId){
						findIndex = i;
						curCmd = _this.curCommand.splice(findIndex, 1)[0];
						break;
					}
				}
				
				if(findIndex < 0){
					_cmdcount = _this.curCommand_SaveImagesToBytes.length;
					for(i=_cmdcount-1; i>=0; i--){
						if(_this.curCommand_SaveImagesToBytes[i].cmdId == r.cmdId){
							findIndex = i;
							curCmd = _this.curCommand_SaveImagesToBytes.splice(findIndex, 1)[0];
							break;
						}
					}
					if(findIndex < 0){
						return;
					}
				}
				
				
			} else {
				curCmd = _this.curCommand.pop() || {};
			}

            if (r.exception !== undefined && r.description !== undefined) {
                _this._errorCode = r.exception;
                _this._errorString = r.description;
            } else {
                _this._errorCode = 0;
                _this._errorString = '';
            }


            if(r.method =='ReadBarcode' || r.method =='OCRRecognize' || (r.request && r.request.method =='OCRProRecognize'))
            {
              if (curCmd.sFun)
                    curCmd.sFun(r);
                return;
            } else if(r.method =='ActiveUI' || r.method =='VersionInfo') {
				if (curCmd.sFun && r.result.length > 0) {
					curCmd.sFun(r.result);
					return;
				}
            } else if(r.method == 'ShowFileDialog' || r.method == 'SplitTiff' 
						 || r.method == 'SplitPDF' || r.method == 'EncodeAsBase64') {
							 
                if (curCmd.sFun) {
					curCmd.sFun(r.result);
					return;
				}
				
            }

            if (r.result && r.result.length && r.result[0] == '1') {
                if (curCmd.sFun)
                    curCmd.sFun();
            } else {
                if (r.exception) {

                    var handled = false;

                    if (curCmd.fFun)
                        handled = curCmd.fFun(_this._errorString);

                    if (!handled && r.exception && r.exception < 0 && r.exception != -2115) {

                        if (Dynamsoft.Lib.isFunction(_this.__OnPrintMsg))
                            _this.__OnPrintMsg(_this._errorString);
                    }

                } else {
                    var ret = ['result:'];
                    if (curCmd.fFun)
                        curCmd.fFun(Funs.__pushElement(ret, r.result));
                }
            }

        };

        _objWS.onclose = function () {
            _this.bReady = false;
			_this.__wsRetry = 0;
			Dynamsoft.Lib.Errors.Server_Invalid(_this);
			Dynamsoft.Lib.detect.bOK = false;
			
			if(!Dynamsoft.Lib.detect.starting){
				for (var i = 0; i < Dynamsoft.Lib.detect.arySTwains.length; i++) {
					if (Dynamsoft.Lib.detect.arySTwains[i] == _this) {
						Dynamsoft.Lib.detect.cTwainIndex = i;
						break;
					}
				}
				
				// if unload, stop reconnect
				if(!Dynamsoft.Lib.page.bUnload){
					setTimeout(Dynamsoft.Lib._reconnect, 1000);
					Dynamsoft.Lib.detect.starting = true;
				}
			}
			
            if (_this.__OnWSClose)
                _this.__OnWSClose();

            Funs.hideMask(true);
        };

        _objWS.onerror = function (e) {
            _this.bReady = false;
			_this.__wsRetry = 0;
			Dynamsoft.Lib.Errors.Server_Invalid(_this);
			Dynamsoft.Lib.detect.bOK = false;
			
			if(!Dynamsoft.Lib.detect.starting){
				for (var i = 0; i < Dynamsoft.Lib.detect.arySTwains.length; i++) {
					if (Dynamsoft.Lib.detect.arySTwains[i] == _this) {
						Dynamsoft.Lib.detect.cTwainIndex = i;
						break;
					}
				}
				
				// if unload, stop reconnect
				if(!Dynamsoft.Lib.page.bUnload){
					setTimeout(Dynamsoft.Lib._reconnect, 1000);
					Dynamsoft.Lib.detect.starting = true;
				}
			}
			
			if(e){
				Dynamsoft.Lib.log('websocket error: ' + e);
			}
			
			if (_this.__OnWSError)
                _this.__OnWSError();

            Funs.hideMask(true);
        };

		if(bReconnect){
			_this._innerActiveUI(function(r){
				var oldServerId = _this.__serverId, serverId;
				
				if(r && r.length>=2){
					serverId = r[1];
				} else {
					Dynamsoft.Lib.log('ActiveUI return parameters error.');
				}
				
				
				_this.__serverId = serverId;
				Dynamsoft.Lib.closeProgress('Reconnect');
			
				if (_this.ErrorCode == 0 && Dynamsoft.WebTwainEnv.ProductKey !== '' && Dynamsoft.WebTwainEnv.ProductKey !== '******')
					_this.ProductKey = Dynamsoft.WebTwainEnv.ProductKey;
				
				if(oldServerId != serverId){
				
					Dynamsoft.Lib.Errors.Server_Restarted(_this);
					
					if (Dynamsoft.Lib.isFunction(_this.__OnWSReconnect)) {
						var wsUrl = Dynamsoft.Lib.getWSUrl(o);
						_this.__OnWSReconnect(wsUrl, httpUrl);
					}
					
				} else {
				
					_this._errorCode = 0;
					_this._errorString = '';
					
				}
				
			});
			return;
		}

        Dynamsoft.Lib.LS.item('D_port', o.port);
        Dynamsoft.Lib.LS.item('D_ssl', o.ssl ? 'true' : 'false');

		_this._UIManager.OnReady();
		_this.SetViewMode(1,1);
		
        _this._innerActiveUI(function (r) {
			var serverId;

			if(r && r.length>=2){
				serverId = r[1];
			} else {
				Dynamsoft.Lib.log('ActiveUI return parameters error.');
			}
				
			_this.__serverId = serverId;
	
            if (_this.ErrorCode == 0 && Dynamsoft.WebTwainEnv.ProductKey !== '' && Dynamsoft.WebTwainEnv.ProductKey !== '******')
                _this.ProductKey = Dynamsoft.WebTwainEnv.ProductKey;
			
			// 11.2: init Log Level to 0
			_this.LogLevel = 0;

            if (Dynamsoft.Lib.isFunction(_this.__OnWSReady)) {
                var wsUrl = Dynamsoft.Lib.getWSUrl(o);
                _this.__OnWSReady(wsUrl, httpUrl);
            }

			if (Dynamsoft.Lib.detect.OnReady)
				Dynamsoft.Lib.detect.OnReady();
        });


    };

})(Dynamsoft.Lib, KISSY, Dynamsoft.Lib.html5.Funs);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function(DL){
	if (!DL.product.bChromeEdition){
		return;
	}
	
	var Funs = DL.html5.Funs;
	
	DL.DynamicLoadAddonFuns = [];
	
	// Load addon
	DL.attachAddon = function(st){
		DL.each(DL.DynamicLoadAddonFuns, function (aFun) {
			if (DL.isFunction(aFun)) {
				aFun(st);
			}
		});
	};
	
	// properties (get/set) / sync functions
	Dynamsoft.Lib.attachProperty = function (st){

		// properties (get/set) / sync functions	
		var _this = st;
		
		// --- Other property start --
		Object.defineProperty(_this, 'ErrorCode', {
			get : function(){// read-only
				return _this._errorCode;
			}
		});
			
		Object.defineProperty(_this, 'ErrorString', {
			get : function(){// read-only
				if (_this._errorCode != 0)
					return _this._errorString;

				return 'Successful.';
			}
		});
			
		Object.defineProperty(_this, 'LogLevel', {
			get : function(){
				return _this._innerFun('LogLevel');
			},
			set : function(v){
				var _v = v * 1;
				return _this._innerFun('LogLevel', Funs.makeParams(_v));
			}
		});
			
		Object.defineProperty(_this, 'Manufacturer', {
			get : function(){
				return _this._innerFun('Manufacturer');
			},
			set : function(v){
				return _this._innerFun('Manufacturer', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'ProductFamily', {
			get : function(){
				return _this._innerFun('ProductFamily');
			},
			set : function(v){
				return _this._innerFun('ProductFamily', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'ProductKey', {
			get : function(){
				return Dynamsoft.WebTwainEnv.ProductKey;
			},
			set : function(v){
				Dynamsoft.WebTwainEnv.ProductKey = v;
				return _this._innerFun('ProductKey', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'ProductName', {
			get : function(){
				return _this._innerFun('ProductName');
			},
			set : function(v){
				return _this._innerFun('ProductName', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'VersionInfo', {
			get : function(){
				return _this._innerFun('VersionInfo');
			}
		});

		// --- Other property end --


		// --- SCAN property start --
		Object.defineProperty(_this, 'BitDepth', {
			get : function(){
				return _this._innerFun('BitDepth');
			},
			set : function(v){
				return _this._innerFun('BitDepth', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'Brightness', {
			get : function(){
				return _this._innerFun('Brightness');
			},
			set : function(v){
				return _this._innerFun('Brightness', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'Contrast', {
			get : function(){
				return _this._innerFun('Contrast');
			},
			set : function(v){
				return _this._innerFun('Contrast', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CurrentSourceName', {
			get : function(){
				return _this._innerFun('CurrentSourceName');
			}
		});

		Object.defineProperty(_this, 'DataSourceStatus', {
			get : function(){
				return _this._innerFun('DataSourceStatus');
			}
		});

		Object.defineProperty(_this, 'DefaultSourceName', {
			get : function(){
				var tmp;
				if(_this.__defaultSourceName == '' || _this.__sourceCount == -1){
					tmp = _this.SourceCount;
				}

				return _this.__defaultSourceName;
			}
		});

		Object.defineProperty(_this, 'Duplex', {
			get : function(){
				return _this._innerFun('Duplex');
			}
		});

		Object.defineProperty(_this, 'IfAppendImage', {
			get : function(){
				return _this._innerFun('IfAppendImage');
			},
			set : function(v){
				return _this._innerFun('IfAppendImage', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfAutoBright', {
			get : function(){
				return _this._innerFun('IfAutoBright');
			},
			set : function(v){
				return _this._innerFun('IfAutoBright', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfAutoDiscardBlankpages', {
			get : function(){
				return _this._innerFun('IfAutoDiscardBlankpages');
			},
			set : function(v){
				return _this._innerFun('IfAutoDiscardBlankpages', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfAutoFeed', {
			get : function(){
				return _this._innerFun('IfAutoFeed');
			},
			set : function(v){
				return _this._innerFun('IfAutoFeed', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfAutomaticBorderDetection', {
			get : function(){
				return _this._innerFun('IfAutomaticBorderDetection');
			},
			set : function(v){
				return _this._innerFun('IfAutomaticBorderDetection', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfAutomaticDeskew', {
			get : function(){
				return _this._innerFun('IfAutomaticDeskew');
			},
			set : function(v){
				return _this._innerFun('IfAutomaticDeskew', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfAutoScan', {
			get : function(){
				return _this._innerFun('IfAutoScan');
			},
			set : function(v){
				return _this._innerFun('IfAutoScan', Funs.makeParams(v));
			}
		});

			// get : function(){//IfDeviceOnline() {
			//     return _this._innerFun('IfDeviceOnline');
			// }});
			// set : function(v){//IfDeviceOnline(v){
			//     return _this._innerFun('IfDeviceOnline', Funs.makeParams(v));
			// }});

		Object.defineProperty(_this, 'IfDisableSourceAfterAcquire', {
			get : function(){
				return _this._innerFun('IfDisableSourceAfterAcquire');
			},
			set : function(v){
				return _this._innerFun('IfDisableSourceAfterAcquire', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfDuplexEnabled', {
			get : function(){
				return _this._innerFun('IfDuplexEnabled');
			},
			set : function(v){
				return _this._innerFun('IfDuplexEnabled', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfFeederEnabled', {
			get : function(){
				return _this._innerFun('IfFeederEnabled');
			},
			set : function(v){
				return _this._innerFun('IfFeederEnabled', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfFeederLoaded', {
			get : function(){
				return _this._innerFun('IfFeederLoaded');
			}
		});
			// set : function(v){//IfFeederLoaded(v){
			// return _this._innerFun('IfFeederLoaded', Funs.makeParams(v));
			// }});

		Object.defineProperty(_this, 'IfModalUI', {
			get : function(){
				return _this._innerFun('IfModalUI');
			},
			set : function(v){
				return _this._innerFun('IfModalUI', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfPaperDetectable', {
			get : function(){
				return _this._innerFun('IfPaperDetectable');
			}
		});
			// set : function(v){//IfPaperDetectable(v){
			// return _this._innerFun('IfPaperDetectable', Funs.makeParams(v));
			// }});

		Object.defineProperty(_this, 'IfScanInNewThread', {
			get : function(){
				return _this._innerFun('IfScanInNewThread');
			},
			set : function(v){
				return _this._innerFun('IfScanInNewThread', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfShowCancelDialogWhenImageTransfer', {
			get : function(){
				return _this.__IfShowCancelDialogWhenImageTransfer;
			},
			set : function(v){
				return _this.__IfShowCancelDialogWhenImageTransfer = v;
			}
		});

		Object.defineProperty(_this, 'IfShowUI', {
			get : function(){
				return _this._innerFun('IfShowUI');
			},
			set : function(v){
				return _this._innerFun('IfShowUI', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfShowIndicator', {
			get : function(){
				return _this._innerFun('IfShowIndicator');
			},
			set : function(v){
				return _this._innerFun('IfShowIndicator', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfUseTwainDSM', {
			get : function(){
				return _this._innerFun('IfUseTwainDSM');
			},
			set : function(v){
				return _this._innerFun('IfUseTwainDSM', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'IfUIControllable', {
			get : function(){
				return _this._innerFun('IfUIControllable');
			}
		});

		Object.defineProperty(_this, 'ImageBitsPerPixel', {
			get : function(){
				return _this._innerFun('ImageBitsPerPixel');
			}
		});

		Object.defineProperty(_this, 'ImageCaptureDriverType', {
			get : function(){
				return _this._innerFun('ImageCaptureDriverType');
			},
			set : function(v){
				return _this._innerFun('ImageCaptureDriverType', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'ImageLayoutDocumentNumber', {
			get : function(){
				return _this._innerFun('ImageLayoutDocumentNumber');
			}
		});

		Object.defineProperty(_this, 'ImageLayoutFrameBottom', {
			get : function(){
				return _this._innerFun('ImageLayoutFrameBottom');
			}
		});

		Object.defineProperty(_this, 'ImageLayoutFrameLeft', {
			get : function(){
				return _this._innerFun('ImageLayoutFrameLeft');
			}
		});

		Object.defineProperty(_this, 'ImageLayoutFrameNumber', {
			get : function(){
				return _this._innerFun('ImageLayoutFrameNumber');
			}
		});

		Object.defineProperty(_this, 'ImageLayoutFrameRight', {
			get : function(){
				return _this._innerFun('ImageLayoutFrameRight');
			}
		});

		Object.defineProperty(_this, 'ImageLayoutFrameTop', {
			get : function(){
				return _this._innerFun('ImageLayoutFrameTop');
			}
		});

		Object.defineProperty(_this, 'ImageLayoutPageNumber', {
			get : function(){
				return _this._innerFun('ImageLayoutPageNumber');
			}
		});

		Object.defineProperty(_this, 'ImageLength', {
			get : function(){
				return _this._innerFun('ImageLength');
			}
		});

		Object.defineProperty(_this, 'ImagePixelType', {
			get : function(){
				return _this._innerFun('ImagePixelType');
			}
		});

		Object.defineProperty(_this, 'ImageWidth', {
			get : function(){
				return _this._innerFun('ImageWidth');
			}
		});

		Object.defineProperty(_this, 'ImageXResolution', {
			get : function(){
				return _this._innerFun('ImageXResolution');
			}
		});

		Object.defineProperty(_this, 'ImageYResolution', {
			get : function(){
				return _this._innerFun('ImageYResolution');
			}
		});

		Object.defineProperty(_this, 'MagData', {
			get : function(){
				return _this._innerFun('MagData');
			}
		});

		Object.defineProperty(_this, 'MagType', {
			get : function(){
				return _this._innerFun('MagType');
			}
		});

		Object.defineProperty(_this, 'PageSize', {
			get : function(){
				return _this._innerFun('PageSize');
			},
			set : function(v){
				var _v = v * 1;
				return _this._innerFun('PageSize', Funs.makeParams(_v));
			}
		});

		Object.defineProperty(_this, 'PendingXfers', {
			get : function(){
				return _this._innerFun('PendingXfers');
			}
		});

		Object.defineProperty(_this, 'PixelFlavor', {
			get : function(){
				return _this._innerFun('PixelFlavor');
			},
			set : function(v){
				return _this._innerFun('PixelFlavor', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'PixelType', {
			get : function(){
				return _this._innerFun('PixelType');
			},
			set : function(v){
				return _this._innerFun('PixelType', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'Resolution', {
			get : function(){
				return _this._innerFun('Resolution');
			},
			set : function(v){
				var _v = v * 1;
				return _this._innerFun('Resolution', Funs.makeParams(_v));
			}
		});

		Object.defineProperty(_this, 'SourceCount', {
			get : function(){

				var ret = _this._innerFunRaw('GetSourceNames'),
					_count = ret.length-1;
					
				if(_this._errorCode != 0){
					return 0;
				}
					
				if (_count<=0){
					_this.__sourceName = [];
					_this.__defaultSourceName = '';
					_this.__sourceCount = -1;
					return 0;
				} else if(_count == 1){
					// check empty
					if(ret[0] == ''){
						_this.__sourceName = [];
						_this.__defaultSourceName = '';
						_this.__sourceCount = 0;
						return 0;
					}
				}
				
				// the last one is default source name
				_this.__defaultSourceName = ret[ret.length-1];
				ret.splice(ret.length-1, 1);
				
				_this.__sourceName = ret;
				_this.__sourceCount = _count;
				
				return _count;
			}
		});

		Object.defineProperty(_this, 'TransferMode', {
			get : function(){
				return _this._innerFun('TransferMode');
			},
			set : function(v){
				return _this._innerFun('TransferMode', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'Unit', {
			get : function(){
				return _this._innerFun('Unit');
			},
			set : function(v){
				return _this._innerFun('Unit', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'XferCount', {
			get : function(){
				return _this._innerFun('XferCount');
			},
			set : function(v){
				var _v = v * 1;
				return _this._innerFun('XferCount', Funs.makeParams(_v));
			}
		});

			// capability set : function(v){//IfUIControllable(v){
			// return _this._innerFun('IfUIControllable', Funs.makeParams(v));
			// }});
			
		Object.defineProperty(_this, 'Capability', {
			get : function(){
				return _this._innerFun('Capability');
			},
			set : function(v){
				return _this._innerFun('Capability', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'CapCurrentIndex', {
			get : function(){
				return _this._innerFun('CapCurrentIndex');
			},
			set : function(v){
				return _this._innerFun('CapCurrentIndex', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapCurrentValue', {
			get : function(){
				return _this._innerFun('CapCurrentValue');
			},
			set : function(v){
				return _this._innerFun('CapCurrentValue', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapDefaultIndex', {
			get : function(){
				return _this._innerFun('CapDefaultIndex');
			}
		});
			// set : function(v){//CapDefaultIndex(v){
			// return _this._innerFun('CapDefaultIndex', Funs.makeParams(v));
			// }});

		Object.defineProperty(_this, 'CapDefaultValue', {
			get : function(){
				return _this._innerFun('CapDefaultValue');
			}
		});
			// set : function(v){//CapDefaultValue(v){
			// return _this._innerFun('CapDefaultValue', Funs.makeParams(v));
			// }});

		Object.defineProperty(_this, 'CapDescription', {
			get : function(){
				return _this._innerFun('CapDescription');
			},
			set : function(v){
				return _this._innerFun('CapDescription', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapMaxValue', {
			get : function(){
				return _this._innerFun('CapMaxValue');
			},
			set : function(v){
				return _this._innerFun('CapMaxValue', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapMinValue', {
			get : function(){
				return _this._innerFun('CapMinValue');
			},
			set : function(v){
				return _this._innerFun('CapMinValue', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapNumItems', {
			get : function(){
				return _this._innerFun('CapNumItems');
			},
			set : function(v){
				return _this._innerFun('CapNumItems', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapStepSize', {
			get : function(){
				return _this._innerFun('CapStepSize');
			},
			set : function(v){
				return _this._innerFun('CapStepSize', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapType', {
			get : function(){
				return _this._innerFun('CapType');
			},
			set : function(v){
				return _this._innerFun('CapType', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapValue', {
			get : function(){
				return _this._innerFun('CapValue');
			},
			set : function(v){
				return _this._innerFun('CapValue', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapValueString', {
			get : function(){
				return _this._innerFun('CapValueString');
			},
			set : function(v){
				return _this._innerFun('CapValueString', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'CapValueType', {
			get : function(){
				return _this._innerFun('CapValueType');
			},
			set : function(v){
				return _this._innerFun('CapValueType', Funs.makeParams(v));
			}
		});
		// --- SCAN property end --



		// --- View & Edit property start --
		Object.defineProperty(_this, 'AllowMultiSelect', {
			get : function(){
				return _this._UIManager.getView().GetAllowMultiSelect();
			},
			set : function(v){
				_this._UIManager.getView().SetAllowMultiSelect(v);
			}
		});
			
		Object.defineProperty(_this, 'BackgroundColor', {
			get : function(){
				return _this._UIManager.GetBackgroundColor();
			},
			set : function(v){
				return _this._UIManager.SetBackgroundColor(v);
			}
		});
		
		// ,
		Object.defineProperty(_this, 'BackgroundFillColor', {
			get : function(){
				return _this._innerFun('BackgroundFillColor');
			},
			set : function(v){
				return _this._innerFun('BackgroundFillColor', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'BlankImageCurrentStdDev', {
			get : function(){
				return _this._innerFun('BlankImageCurrentStdDev');
			},
			set : function(v){
				// BlankImageCurrentStdDev is readonly
				return false;
			}
		});
			
		Object.defineProperty(_this, 'BlankImageMaxStdDev', {
			get : function(){
				return _this._innerFun('BlankImageMaxStdDev');
			},
			set : function(v){
				return _this._innerFun('BlankImageMaxStdDev', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'BlankImageThreshold', {
			get : function(){
				return _this._innerFun('BlankImageThreshold');
			},
			set : function(v){
				return _this._innerFun('BlankImageThreshold', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'CurrentImageIndexInBuffer', {
			get : function(){
				// _this.__cIndex = _this._innerFun('CurrentImageIndexInBuffer');
				return _this.__cIndex;
			},
			set : function(v){
				var _v = v * 1;

				if (_v >= 0 && _v < _this._UIManager.count()) {
					if(_v != _this.__cIndex){
						_this._innerSendCmd('CurrentImageIndexInBuffer', Funs.makeParams(_v));
					}

					_this.__cIndex = _v;
					
					_this._UIManager.getView().Go(_this.__cIndex);
					Funs.__innerRefreshFromUIView(_this, _this.__cIndex, true);
				}
				return true;
			}
		});
			
			//enum EnumFitWindowType
			/*{
				enumFitWindow = 0
				enumFitHeight
				enumFitWidth
				enumFitWindowAuto	// Original Size
				enumFitHeightWidth
			};*/
			
		Object.defineProperty(_this, 'FitWindowType', {
			get : function(){
				return _this._UIManager.getView().GetFitWindowType();
			},
			set : function(v){
				var _v = v * 1;
				return _this._UIManager.getView().SetFitWindowType(_v);
			}
		});

		Object.defineProperty(_this, 'HowManyImagesInBuffer', {
			get : function(){

				return _this._HowManyImagesInBuffer;
			}
		});
			
		Object.defineProperty(_this, 'IfFitWindow', {
			get : function(){
				return _this._UIManager.getView().GetIfFitWindow();
			},
			set : function(v){
				if (v)
					return _this._UIManager.getView().SetIfFitWindow(true);
				else
					return _this._UIManager.getView().SetIfFitWindow(false);
			}
		});
			
		Object.defineProperty(_this, 'ImageMargin', {
			get : function(){
				return _this._UIManager.getView().GetImageMargin();
			},
			set : function(v){
				return _this._UIManager.getView().SetImageMargin(v);
			}
		});

		Object.defineProperty(_this, 'MaxImagesInBuffer', {
			get : function(){
				return _this._innerFun('MaxImagesInBuffer');
			},
			set : function(v){
				return _this._innerFun('MaxImagesInBuffer', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'MouseX', {
			get : function(){
				return _this.__MouseX;
			}
		});
			
		Object.defineProperty(_this, 'MouseY', {
			get : function(){
				return _this.__MouseY;
			}
		});
			
		Object.defineProperty(_this, 'SelectedImagesCount', {
			get : function(){
				if(_this._UIManager.count() <= 0)
					return 0;
				if(_this.__SelectedImagesCount == 0)
					return 1;
				return _this.__SelectedImagesCount;
			},
			set : function(v){
				var i, _count = v*1;
				
				if(_this._UIManager.count() <= 0)
					_count = 0;
				else if(_count<1)
					_count = 1;
				
				_this.__SelectedImagesCount = _count;
				_this._UIManager.getView().SetSelectedImageCount(_count);

				return _this._innerFun('SelectedImagesCount', Funs.makeParams(_count));
			}
		});
		
		Object.defineProperty(_this, 'SelectionImageBorderColor', {
			get : function(){
				return _this._UIManager.GetSelectionImageBorderColor();
			},
			set : function(v){
				return _this._UIManager.SetSelectionImageBorderColor(v);
			}
		});
			
		Object.defineProperty(_this, 'Zoom', {
			get : function(){
				return _this._UIManager.getView().GetZoom();
			},
			set : function(v){
				return _this._UIManager.getView().SetZoom(v);
			}
		});
			
		Object.defineProperty(_this, 'MouseShape', {
			get : function(){
				return _this._UIManager.getView().GetMouseShape();
			},
			set : function(v){
				return _this._UIManager.getView().SetMouseShape(v);
			}
		});
		// --- View & Edit property end --


		// --- Upload & Save property start --
		Object.defineProperty(_this, 'HTTPPostResponseString', {
			get : function(){
				if (_this.__HTTPPostResponseString)
					return _this.__HTTPPostResponseString;
				else
					return '';
			}
		});

		Object.defineProperty(_this, 'FTPPassword', {
			get : function(){
				return _this._innerFun('FTPPassword');
			},
			set : function(v){
				return _this._innerFun('FTPPassword', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'FTPPort', {
			get : function(){
				return _this._innerFun('FTPPort');
			},
			set : function(v){
				if (v !== '') {
					var _v = v * 1;
					return _this._innerFun('FTPPort', Funs.makeParams(_v));
				}
			}
		});
			
		Object.defineProperty(_this, 'FTPUserName', {
			get : function(){
				return _this._innerFun('FTPUserName');
			},
			set : function(v){
				return _this._innerFun('FTPUserName', Funs.makeParams(v));
			}
		});



		Object.defineProperty(_this, 'IfPASVMode', {
			get : function(){
				return _this._innerFun('IfPASVMode');
			},
			set : function(v){
				return _this._innerFun('IfPASVMode', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'IfShowProgressBar', {
			get : function(){
				return _this.__IfShowProgressBar;
			},
			set : function(v){
				return _this.__IfShowProgressBar = v;
			}
		});

		Object.defineProperty(_this, 'ProxyServer', {
			get : function(){
				return _this._innerFun('ProxyServer');
			},
			set : function(v){
				return _this._innerFun('ProxyServer', Funs.makeParams(v));
			}
		});
			
			
	//        get : function(){//IfScanInThread() {
	//            Dynamsoft.Lib.Errors.HTML5NotSupport(_this);
	//		    return false;
	//        }});
	//        set : function(v){//IfScanInThread(v) {
	//            Dynamsoft.Lib.Errors.HTML5NotSupport(_this);
	//		    return false;
	//        }});


		Object.defineProperty(_this, 'IfShowFileDialog', {
			get : function(){
				return _this._innerFun('IfShowFileDialog');
			},
			set : function(v){
				return _this._innerFun('IfShowFileDialog', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'IfTiffMultiPage', {
			get : function(){
				return _this._innerFun('IfTiffMultiPage');
			},
			set : function(v){
				return _this._innerFun('IfTiffMultiPage', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFAuthor', {
			get : function(){
				return _this._innerFun('PDFAuthor');
			},
			set : function(v){
				return _this._innerFun('PDFAuthor', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFCompressionType', {
			get : function(){
				return _this._innerFun('PDFCompressionType');
			},
			set : function(v){
				return _this._innerFun('PDFCompressionType', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFCreationDate', {
			get : function(){
				return _this._innerFun('PDFCreationDate');
			},
			set : function(v){
				return _this._innerFun('PDFCreationDate', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFCreator', {
			get : function(){
				return _this._innerFun('PDFCreator');
			},
			set : function(v){
				return _this._innerFun('PDFCreator', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFKeywords', {
			get : function(){
				return _this._innerFun('PDFKeywords');
			},
			set : function(v){
				return _this._innerFun('PDFKeywords', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFModifiedDate', {
			get : function(){
				return _this._innerFun('PDFModifiedDate');
			},
			set : function(v){
				return _this._innerFun('PDFModifiedDate', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFProducer', {
			get : function(){
				return _this._innerFun('PDFProducer');
			},
			set : function(v){
				return _this._innerFun('PDFProducer', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFSubject', {
			get : function(){
				return _this._innerFun('PDFSubject');
			},
			set : function(v){
				return _this._innerFun('PDFSubject', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFTitle', {
			get : function(){
				return _this._innerFun('PDFTitle');
			},
			set : function(v){
				return _this._innerFun('PDFTitle', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'PDFVersion', {
			get : function(){
				return _this._innerFun('PDFVersion');
			},
			set : function(v){
				return _this._innerFun('PDFVersion', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'TIFFCompressionType', {
			get : function(){
				return _this._innerFun('TIFFCompressionType');
			},
			set : function(v){
				return _this._innerFun('TIFFCompressionType', Funs.makeParams(v));
			}
		});
			
		Object.defineProperty(_this, 'JPEGQuality', {
			get : function(){
				return _this._innerFun('JPEGQuality');
			},
			set : function(v){
				var _v = v * 1;
				if (_v >= 100)
					_v = 100;
				return _this._innerFun('JPEGQuality', Funs.makeParams(_v));
			}
		});

		// --- Upload & Save property end --

		// --- start from 10.0
		Object.defineProperty(_this, 'HttpContentTypeFieldValue', {
			get : function(){
				return _this.__strHttpContentTypeFieldValue;
			},
			set : function(v){
				_this.__strHttpContentTypeFieldValue = v;
				return v;
			}
		});

		Object.defineProperty(_this, 'SelectionRectAspectRatio', {
			get : function(){
				return _this._UIManager.GetSelectionRectAspectRatio();
			},
			set : function(v){
				var tmp = parseFloat(v);
				if(tmp >= 0){
					_this._UIManager.SetSelectionRectAspectRatio(tmp);
					return true;
				}
				return false;
			}
		});
			
		Object.defineProperty(_this, 'IfAllowLocalCache', {
			get : function(){
				return _this._innerFun('IfAllowLocalCache');
			},
			set : function(v){
				return _this._innerFun('IfAllowLocalCache', Funs.makeParams(v));
			}
		});
		
		Object.defineProperty(_this, '_AutoCropMethod', {
			get : function(){
				return _this._innerFun('AutoCropMethod');
			},
			set : function(v){
				return _this._innerFun('AutoCropMethod', Funs.makeParams(v));
			}
		});

		// Others Property
		Object.defineProperty(_this, 'BrokerProcessType', {
			get : function(){
				return 1;
			},
			set : function(v){
				return true;
			}
		});

		Object.defineProperty(_this, 'BorderStyle', {
			get : function(){
				return 0;
			},
			set : function(v){
				return false;
			}
		});

		Object.defineProperty(_this, 'IfSSL', {
			get : function(){
				return _this._innerFun('IfSSL');
			},
			set : function(v){
				return _this._innerFun('IfSSL', Funs.makeParams(v));
			}
		});


		Object.defineProperty(_this, 'AllowPluginAuthentication', {
			get : function(){
				return _this._innerFun('AllowPluginAuthentication');
			},
			set : function(v){
				return _this._innerFun('AllowPluginAuthentication', Funs.makeParams(v));
			}
		});


		Object.defineProperty(_this, 'HttpFieldNameOfUploadedImage', {
			get : function(){
				return _this.__remoteFilename;
			},
			set : function(v){
				return _this.__remoteFilename = v;
			}
		});


		Object.defineProperty(_this, 'MaxInternetTransferThreads', {
			get : function(){
				return _this._innerFun('MaxInternetTransferThreads');
			},
			set : function(v){
				return _this._innerFun('MaxInternetTransferThreads', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'MaxUploadImageSize', {
			get : function(){
				return _this._innerFun('MaxUploadImageSize');
			},
			set : function(v){
				return _this._innerFun('MaxUploadImageSize', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'style', {
			get : function(){
				return _this.__style;
			}
		});
			
			// from 10.0.2
		Object.defineProperty(_this, 'Addon', {
			get : function(){
				return _this.__addon;
			}
		});

		// from 10.1
		Object.defineProperty(_this, 'BufferMemoryLimit', {
			get : function(){
				return _this._innerFun('BufferMemoryLimit');
			},
			set : function(v){
				return _this._innerFun('BufferMemoryLimit', Funs.makeParams(v));
			}
		});

		Object.defineProperty(_this, 'Width', {
			get : function(){
				return _this._width;
			},
			set : function(v){
				var _v=false;
				
				if(Dynamsoft.Lib.isString(v)){
					if(v.length>0){
						if(v.charAt(v.length-1) === '%'){
							_v = v;
						}
					}
				}
				
				if(!_v && v){
					var tmp = parseInt(v);
					if(tmp)
						_v = tmp + 'px';
				}

				if(_v){
					_this._width = _v;
					return Funs.changeImageUISize(_this, _v, false);
				}
				
				return false;
			}
		});
			
		Object.defineProperty(_this, 'Height', {
			get : function(){
				return _this._height;
			},
			set : function(v){
				var _v=false;
				
				if(Dynamsoft.Lib.isString(v)){
					if(v.length>0){
						if(v.charAt(v.length-1) === '%'){
							_v = v;
						}
					}
				}
				
				if(!_v && v){
					var tmp = parseInt(v);
					if(tmp)
						_v = tmp + 'px';
				}

				if(_v){
					_this._height = _v;
					return Funs.changeImageUISize(_this, false, _v);
				}
				
				return false;
			}
		});
		
		// from 10.1.2
		Object.defineProperty(_this, 'ShowPageNumber', {
			get : function(){
				return _this._UIManager.getView().GetShowPageNumber();
			},
			set : function(v){
				_this._UIManager.getView().SetShowPageNumber(v);
			}
		});
		

		// not support 10.1
		Object.defineProperty(_this, 'ImageEditorIfEnableEnumerator', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
			
		Object.defineProperty(_this, 'ImageEditorIfReadonly', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
			
		Object.defineProperty(_this, 'ImageEditorIfModal', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
			
		Object.defineProperty(_this, 'ImageEditorWindowTitle', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
			
		Object.defineProperty(_this, 'EnableInteractiveZoom', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
		
		Object.defineProperty(_this, 'IfShowPrintUI', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
			
		Object.defineProperty(_this, 'VScrollBar', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
			
		Object.defineProperty(_this, 'AsyncMode', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
			
		Object.defineProperty(_this, 'IfThrowException', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
		

		Object.defineProperty(_this, 'IfOpenImageWithGDIPlus', {
			get : function(){
				return true;
			},
			set : function(v){
				return true;
			}
		});
		
	};
})(Dynamsoft.Lib);

// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function(DL, STwain, Funs){
	if (!DL.product.bChromeEdition){
		return;
	}

	var STwainP = STwain.prototype;

    // async functions

    STwainP.__innerLoadImage = function (m, p, bRefreshUI, successFun, failedFun) {
        if (Dynamsoft.Lib.isFunction(successFun)) 
             return this.__innerAcquireImage(m, p, bRefreshUI, successFun, failedFun);
        else
            return this.__innerLoadImageFun(m, p);
    }

    STwainP.__innerLoadImageFun = function (m, p) {
        var _this = this;
		
		if (Funs.isServerInvalid(_this)) {
			return false;
		}

        var bRet = _this._innerFun(m, p);
		
		// refresh HowManyImagesInBuffer & CurrentImageIndexInBuffer 
		if(bRet){
			_this._HowManyImagesInBuffer = _this._innerFun('HowManyImagesInBuffer');
			_this.__cIndex = _this._innerFun('CurrentImageIndexInBuffer');
		}
		
        if (_this.__cIndex >= 0){
             if(bRet){
                _this._UIManager.refreshEditor(_this.__cIndex, _this._UIManager.count());
			 }
            _this.OnRefreshUI(_this.__cIndex);
        }
		 
        return bRet;
    };


    STwainP.__innerAcquireImage = function (m, p, bRefreshUI, successFun, failedFun) {

        var _this = this, bLoadImage = (m == "LoadImage" || m == "LoadImageEx");

        var _fFun = function (errorText) {

            _this.__bLoadingImage = false;
            var _cIndex = _this.__cIndex;
            if (_cIndex >= 0) _this.OnRefreshUI(_cIndex);

            if (Dynamsoft.Lib.isFunction(failedFun)) {
                failedFun(_this.ErrorCode, _this.ErrorString);
            }

            if (bLoadImage) {
                Dynamsoft.Lib.closeProgress(m);
            }
            else
                Funs.hideMask(m);

            if (errorText)
                Dynamsoft.Lib.log(errorText);

            return false;
        };
		
		if (Funs.isServerInvalid(_this)) {
			_fFun();
			return false;
		}

        if (bLoadImage)
            Dynamsoft.Lib.showProgress(_this, m, false);
        else
            Funs.showMask(m);
		
		// 10.1 change to display image under 1*1 mode
        // _this.__bLoadingImage = true;

        _this._innerSend(m, p, true, function () {
            // success
            _this.__bLoadingImage = false;
            if (bLoadImage) {
                Dynamsoft.Lib.closeProgress(m);
				var _cIndex = _this._UIManager.GetCurrentImageIndex();
				if (_cIndex >= 0){
					_this._UIManager.refreshEditor(_cIndex, _this._UIManager.count());
					_this.OnRefreshUI(_cIndex);
				}				
            } else {
                Funs.hideMask(m);
			}

		
            if (Dynamsoft.Lib.isFunction(successFun)) {
                successFun();
            }

        }, _fFun);

        return true;
    };

    STwainP.__innerSaveImage = function (m, p, sFun, fFun) {
        return this.__innerProgressFunction(m, p, false, sFun, fFun);
    }


    STwainP.__innerFTPDownloadDirectly = function (m, p, sFun, fFun) {
        Dynamsoft.Lib.cancelFrome = 4;
        return this.__innerProgressFunction(m, p, true, sFun, fFun);
    }

    STwainP.__innerFTPDownload = function (m, p, sFun, fFun) {
        var _this = this;
        Dynamsoft.Lib.cancelFrome = 4;
        if (Dynamsoft.Lib.isFunction(fFun))
            return this.__innerProgressFunction(m, p, true, function () {
                // success, send to server
                var _cIndex = _this.__cIndex;
                if (_cIndex >= 0) _this.OnRefreshUI(_cIndex);
                
                if (Dynamsoft.Lib.isFunction(sFun)) {
                    sFun();
                }
            }, fFun);
        else
        {
            var bReturn = this._innerFun(m, p);
            var _cIndex = _this.__cIndex;
            if (_cIndex >= 0) _this.OnRefreshUI(_cIndex);
			
			return bReturn;
        }
    }

    STwainP.__innerFTPUpload = function (m, p, sFun, fFun) {
        Dynamsoft.Lib.cancelFrome = 3;
        return this.__innerProgressFunction(m, p, true, sFun, fFun);
    }

    STwainP.__innerProgressFunction = function (m, p, bShowCancelButton, sFun, fFun) {
        var _this = this;
        if (!Dynamsoft.Lib.isFunction(fFun)) 
            return this._innerFun(m, p);

        var _fFun = function (errorText) {
            if (Dynamsoft.Lib.isFunction(fFun)) {
                fFun(_this.ErrorCode, _this.ErrorString);
            }

            Dynamsoft.Lib.closeProgress(m);


            if (errorText)
                Dynamsoft.Lib.log(errorText);

            return true;
        };
        Dynamsoft.Lib.showProgress(_this, m, bShowCancelButton);

        return this._innerSend(m, p, true, function () {
            // success
            Dynamsoft.Lib.closeProgress(m);


            if (Dynamsoft.Lib.isFunction(sFun)) {
                sFun();
            }

        }, _fFun);

    };


     STwainP.__innerGetBarcodeResultAsyncFunction = function (r) {

		var result = Dynamsoft.Lib.NewBarcodeResult();
		if(r)
		{
			result._errorCode = r.exception;
			result._errorString = r.description;
			result._resultlist = r.result;
			result._Count = r.result.length;
		}
		return result;
     };
     
     STwainP.__innerGetOCRResultAsyncFunction = function (r) {

		var result = Dynamsoft.Lib.NewOCRResult(this);
		if(r)
		{
			result._errorCode = r.exception;
			result._errorString = r.description;
			result._resultlist = r.result;
		}
		return result;
     };
     
     STwainP.__innerGetOCRProResultAsyncFunction = function (r) {

		var result = Dynamsoft.Lib.NewOCRProResult(this);
		if(r)
		{
			result._errorCode = r.code;
			result._errorString = r.message;
			result._request = r.request;
			result._errorlist = r.errorList;
			result._ocrTotalCount = r.ocrTotalCount;
            result._alreadyOCRCount = r.alreadyOCRCount;
			result._resultlist = r.resultDetail;
		}
		return result;
     };
    // inner functions arguments

	// ajax send command to server, return void
    STwainP._innerSendCmd = function (m, p) {
        var _this = this;
        if (Funs.isHttpServerInvalid(_this)) {
            return false;
        }
		
		_this._innerFunRaw(m, p, true, false);
    }

    STwainP._innerFun = function (m, p) {
        var _this = this, ret;
        if (Funs.isHttpServerInvalid(_this)) {
            return false;
        }
		
		ret = _this._innerFunRaw(m, p, false, false);

        if (Dynamsoft.Lib.isArray(ret))
            return ret[0];
        return ret;
    }
	
	// bAjax = true only when _innerSendCmd
	// 
    STwainP._innerFunRaw = function (m, p, bAjax, bResponseBinary) {
        var _this = this, newUrl, newData, responseDataType = 'text', cfg;
		
        if (Funs.isHttpServerInvalid(_this)) {
            return false;
        }
		
        _this._errorCode = 0;
        _this._errorString = '';

        newUrl = [_this.httpUrl, 'f/', m, '?', Funs.getRandom()].join('');
        newData = Funs.getJson(_this, m, p, 0);

        var ret, _async = false;
		//, _completeFun = null;

        if (bAjax){
            _async = true;
		} else {
            //Funs.showMask(m);
            //_completeFun = function (b) {
            //    Funs.hideMask(m);
            //};
        }
		
		cfg = {
            type: 'post',
            url: newUrl,
            data: newData,
            async: _async,
            // complete: _completeFun,
            success: function (_data, _status, _io) {
				var r=false;
				
				try{
					if(DL.isString(_data) && _io.responseHeaders['content-type'] === 'text/json')
						r = KISSY.JSON.parse(_data);
					else
						r = _data;
				}catch(e){}
				
                if (r) {

                    if (r.exception !== undefined && r.description !== undefined) {
                        _this._errorCode = r.exception;
                        _this._errorString = r.description;
                    } else {
                        _this._errorCode = 0;
                        _this._errorString = '';
                    }

                    ret = r.result;
                } else {
					Dynamsoft.Lib.Errors.InvalidResultFormat(_this);
                    ret = '';
                }

            },
            error: function () {
				Dynamsoft.Lib.Errors.NetworkError(_this);
                ret = '';
            }
        };
		
		if(bResponseBinary){
			
			// IE10+
			if(Dynamsoft.Lib.env.bIE){
				cfg.responseType = 'arraybuffer';
				cfg.success = function(_a1, _status, _io){
					var _data,arr,bJson=false;
					
					if(_io["responseHeadersString"]){
						var headers = _io["responseHeadersString"];
						if(headers.indexOf('text/json') != -1)
							bJson=true;
					}
					
					_data = _io.responseData;
					
					_this._errorCode = 0;
					_this._errorString = '';
					ret = false;

					if(_data){
						arr = new Uint8Array(_data);
						
						if(bJson){
							_data=String.fromCharCode.apply(null, arr);
						}else{
							ret = new Blob([arr], { type: _this.__strHttpContentTypeFieldValue });
						}
					}
					
					if(!_data || bJson)
					{
						// json failed
						var _text, len, r=false;
						
						if(bJson)
							_text = _data;
						else
							_text = _io.responseText;
						len = _text.length;
						
						if(len>0){
							if(_text.charAt(0) == '{') {
								try
								{
									r = KISSY.JSON.parse(_text);
									bJson = true;
								}
								catch(exp)
								{
									Dynamsoft.Lib.log(_text);
								}
							}
							
							if(bJson){

								if (r.exception !== undefined && r.description !== undefined) {
									_this._errorCode = r.exception;
									_this._errorString = r.description;
									ret = false;
								} else {
									ret = true;
								}

							} else {
								// IE9 ?
								arr = new Uint8Array(_text);
								ret = new Blob([arr], { type: _this.__strHttpContentTypeFieldValue });
							}
						}
					}
				};
			} else {
				// chrome or firefox
				cfg.contentType = 'text/plain; charset=x-user-defined';
				cfg.mimeType = 'text/plain; charset=x-user-defined';
				cfg.success = function(_param1, _status, _io){
					var data,l,arr;
					
					data = _io.responseText;
					l = data.length;
					
					_this._errorCode = 0;
					_this._errorString = '';
					
					if(l>0){
						var bJson = false, r;
						if(data.charAt(0) == '{') {
							try
							{
								r = KISSY.JSON.parse(data);
								bJson = true;
							}
							catch(exp)
							{
								Dynamsoft.Lib.log(data);
							}
						}
						
						if(bJson){

							if (r.exception !== undefined && r.description !== undefined) {
								_this._errorCode = r.exception;
								_this._errorString = r.description;
								ret = false;
							} else {
								ret = true;
							}

						} else {
						
							arr = new Uint8Array(l);
							
							for(var i = 0; i < l; i++) {
								arr[i] = data.charCodeAt(i);
							}
							
							ret = new Blob([arr], { type: _this.__strHttpContentTypeFieldValue });
						}
					
					}else {
						ret = '';
					}
					
				};
			}
		}
		
		if(!_async)
			KISSY.mix(cfg, {headers:{'X-Requested-With':false}});
		
		if(DL.env.bFileSystem)
			cfg.crossDomain=false;
		
        new KISSY.IO(cfg);


        return ret;
    };

    STwainP._innerSend = function (m, p, bSendByBinary, successFun, failedFun) {
        var _this = this, _objWS = _this._objWS,
			_fFun = false, _sFun = false, bServerInvalid = false;

		if(m != 'ActiveUI'){
			bServerInvalid = Funs.isServerInvalid(_this);
		}
		
        if (bServerInvalid) {
            if (Dynamsoft.Lib.isFunction(failedFun)) {
                failedFun();
            }
            return true;
        }

        if (Dynamsoft.Lib.isFunction(successFun)) {
            _sFun = successFun;
        }

        if (Dynamsoft.Lib.isFunction(failedFun)) {
            _fFun = failedFun;
        }
		
		// from 10.1, add command id
		var cmdId = Funs.generateCmdId(), ret;

		if(m == 'SaveSelectedImagesToBytes'){

			_this.curCommand_SaveImagesToBytes.push({
				'cmdId': cmdId,
				'sFun': _sFun,
				'fFun': _fFun,
				'objWS': _objWS,
				'json': Funs.getJson(_this, m, p, cmdId),
				'binary': bSendByBinary
			});
			
			if(_this.curCommand_SaveImagesToBytes.length == 1){
				ret = Funs.sendData(_objWS, Funs.getJson(_this, m, p, cmdId), false, bSendByBinary);
			} else {
				ret = true;
			}

		} else {
			_this.curCommand.push({
				'cmd': m,
				'cmdId': cmdId,
				'sFun': _sFun,
				'fFun': _fFun
			});

			ret = Funs.sendData(_objWS, Funs.getJson(_this, m, p, cmdId), false, bSendByBinary);
		}
		
		return ret;
    };

    // index
    // -1: all, -2: selected, >=0: index
    STwainP.__SaveSelectedImagesToBytes = function (ImageType, index, _async, sFun, fFun) {
		var _this=this;
		
		if(_async){
			return _this._innerSend('SaveSelectedImagesToBytes', Funs.makeParams(ImageType, index), true, sFun, fFun);
		} else {
			
			var bAjax = false, bResponseBinary = true, 
				blob = _this._innerFunRaw('SaveSelectedImagesToBytes', Funs.makeParams(ImageType, index), bAjax, bResponseBinary);
				
			if(_this.ErrorCode == 0){
				sFun(blob);
				return true;
			} else {
				fFun();
				return false;
			}
		}
    };

        // index
    STwainP.__SaveLocalFileToBytes = function (localFile, _async, sFun, fFun) {
		var _this=this;
		
		if(_async){
			return _this._innerSend('SaveSelectedImagesToBytes', Funs.makeParams(0, 0,localFile), true, sFun, fFun);
		} else {
			
			var bAjax = false, bResponseBinary = true, 
				blob = _this._innerFunRaw('SaveSelectedImagesToBytes', Funs.makeParams(0, 0, localFile), bAjax, bResponseBinary);
				
			if(_this.ErrorCode == 0){
				sFun(blob);
				return true;
			} else {
				fFun();
				return false;
			}
		}
    };

    STwainP.__LoadImageFromBytes = function (b, imageType, f, _async, sFun, fFun, start, totalSize) {
        var _this = this,
			m = 'LoadImageFromBytes',
			t = imageType || 3,
			sz = b.size || b.length,
			p,
			bServerInvalid = Funs.isServerInvalid(_this);
		
		if(!isNaN(start) && start >=0 && !isNaN(totalSize) && totalSize > 0)
		    p = ['[', sz, ',', 0, ',', t, ',"', f, '", ',start, ',',totalSize,']'].join('');
	    else
	        p = ['[', sz, ',', 0, ',', t, ',"', f, '"]'].join('');
	        
        var _fFun = function () {
            //Funs.hideMask(m);
            Dynamsoft.Lib.closeProgress(m);
            _this.__bLoadingImage = false;

			if(!bServerInvalid){
				var _cIndex = _this.__cIndex;
				if (_cIndex >= 0) _this.OnRefreshUI(_cIndex);
			}

            if (Dynamsoft.Lib.isFunction(fFun)) {
                fFun(_this._errorCode, _this._errorString);
            }

        };
			
		if (bServerInvalid) {
			_fFun();
			return false;
		}
		
        if (sz === 0) {
			Dynamsoft.Lib.Errors.ImageFileLengthCannotZero(_this);
			_fFun();
            return false;
        }
		
		// 10.1 change to display image under 1*1 mode
        // _this.__bLoadingImage = true;
		
		
        //Funs.showMask(m);
        // Dynamsoft.Lib.showProgress(m, false);
        Funs.setBtnCancelVisibleForProgress(_this, false);

        return this._innerSendBlob(m, p, b, _async, function () {
            // success
            //Funs.hideMask(m);
            if(start + sz == totalSize || totalSize <= 0 || isNaN(totalSize))
                Dynamsoft.Lib.closeProgress(m);
            _this.__bLoadingImage = false;
			
            var _cIndex = _this._UIManager.GetCurrentImageIndex();
            if (_async && _cIndex >= 0){
				_this._UIManager.refreshEditor(_cIndex, _this._UIManager.count());
				_this.OnRefreshUI(_cIndex);
			}

            if (Dynamsoft.Lib.isFunction(sFun)) {
                sFun();
            }

        }, _fFun);
    };

    STwainP._innerSendBlob = function (m, p, b, _async, successFun, failedFun) {
        var _this = this, _objWS = _this._objWS,
			_sFun = false, _fFun = false;

        if (Funs.isServerInvalid(_this)) {
            if (Dynamsoft.Lib.isFunction(failedFun)) {
                failedFun();
            }
            return;
        }

        if (Dynamsoft.Lib.isFunction(successFun)) {
            _sFun = successFun;
        }

        if (Dynamsoft.Lib.isFunction(failedFun)) {
            _fFun = failedFun;
        }
		
		if(_async){

			// from 10.1, add command id
			var cmdId = Funs.generateCmdId();

			_this.curCommand.push({
				'cmd': m,
				'cmdId': cmdId,
				'sFun': _sFun,
				'fFun': _fFun
			});

			Funs.sendData(_objWS, Funs.getJson(_this, m, p, cmdId), b, true);
		} else {
			var ret, newUrl, newData, responseDataType = 'text', cfg;
			
			if (Funs.isHttpServerInvalid(_this)) {
				return false;
			}
			
			_this._errorCode = 0;
			_this._errorString = '';

			newUrl = [_this.httpUrl, 'f/', m, '?', Funs.getRandom()].join('');

			newData = Funs.getJson(_this, m, p, 0);
			newData += '\r\n\r\n';
			newData += Dynamsoft.Lib.base64.encodeArray(b);

			cfg = {
				type: 'post',
				url: newUrl,
				processData: false,
				data: newData,
				async: false,
				success: function (_data, _status, _io) {
					var r=false;
					
					try{
						if(DL.isString(_data) && _io.responseHeaders['content-type'] === 'text/json')
							r = KISSY.JSON.parse(_data);
						else
							r = _data;
					}catch(e){}
					if (r !== undefined && r !== null) {

						if (r.exception !== undefined && r.description !== undefined) {
							_this._errorCode = r.exception;
							_this._errorString = r.description;
						} else {
							_this._errorCode = 0;
							_this._errorString = '';
						}

						ret = r.result;
					} else {
						Dynamsoft.Lib.Errors.InvalidResultFormat(_this);
						ret = '';
					}

				},
				error: function () {
					Dynamsoft.Lib.Errors.NetworkError(_this);
					ret = '';
				}
			};
			
			KISSY.mix(cfg, {headers:{'X-Requested-With':false}});
			if(DL.env.bFileSystem)
				cfg.crossDomain=false;
			
			new KISSY.IO(cfg);
			
			if(_this._errorCode == 0){

				if (Dynamsoft.Lib.isFunction(_sFun)) {
					_sFun();
				}
				
			} else {
				if (Dynamsoft.Lib.isFunction(_fFun)) {
					_fFun();
				}
			}
			return ret;
		}

    };

    STwainP._innerActiveUI = function (OnSuccess, OnFailure) {
        this._innerSend('ActiveUI', Funs.makeParams(Dynamsoft.Lib.env.WSVersion), false, OnSuccess, OnFailure);
    };
	
	STwainP._innerSetSize = function(w, h){
		var _this = this, _w=false, _h=false;

		if(Dynamsoft.Lib.isString(w)){
			if(w.length>0){
				if(w.charAt(w.length-1) === '%'){
					_w = w;
				}
			}
		}
		
		if(!_w && w){
			var tmp = parseInt(w);
			if(tmp)
				_w = tmp + 'px';
		}

		if(Dynamsoft.Lib.isString(h)){
			if(h.length>0){
				if(h.charAt(h.length-1) === '%'){
					_h = h;
				}
			}
		}
		
		if(!_h && h){
			var tmp = parseInt(h);
			if(tmp)
				_h = tmp + 'px';
		}
		
		if(_w)
			_this._width = _w;
		if(_h)
			_this._height = _h;

        return Funs.changeImageUISize(_this, _w, _h);
	}
})(Dynamsoft.Lib, Dynamsoft.Lib.html5.STwain, Dynamsoft.Lib.html5.Funs);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function(STwain, Funs){
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}

	var STwainP = STwain.prototype, DL=Dynamsoft.Lib, 
		aryEnableEvents=[
						'OnPreAllTransfers',
						'OnPreTransfer',
						'OnPostTransfer'];

	// --- Load / Acquire (async+sync) --
	
    STwainP.LoadDibFromClipboard = function (OnSuccess, failedFun) {
        return this.__innerLoadImage('LoadDibFromClipboard', null, true, OnSuccess, failedFun);
    }

    STwainP.LoadImage = function (localFile, OnSuccess, failedFun) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerLoadImage('LoadImage', Funs.makeParams(f), true, OnSuccess, failedFun);
    }

    STwainP.LoadImageEx = function (localFile, ImageType, OnSuccess, failedFun) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerLoadImage('LoadImageEx', Funs.makeParams(f, ImageType), true, OnSuccess, failedFun);
    }
	
    STwainP.EnableSource = function (obj, OnSuccess, OnFailure) {
        // same as AcquireImage
        return this.AcquireImage(obj, OnSuccess, OnFailure);
    }

	/// 
	/// Invoke:
	/// 1) AcquireImage()
	/// 2) AcquireImage(obj)
	/// 3) AcquireImage(obj, sFun, fFun)
	/// 4) AcquireImage(sFun, fFun)
	/// Others: 
	/// AcquireImage(null, sFun, fFun)
	/// AcquireImage(null, fFun)
	/// AcquireImage(sFun)
	/// AcquireImage(sFun, null)
	///
    STwainP.AcquireImage = function (p1, p2, p3) {
        var OnSuccess = null, OnFailure = null, strObj, _obj;
		
		if(DL.isUndefined(p3)
			&& (DL.isFunction(p1) && DL.isFunction(p2)
				|| DL.isFunction(p1) && DL.isUndefined(p2)
				|| DL.isFunction(p1) && p2 == null
				|| p1 == null && DL.isFunction(p2))) {
					
			/// 4) AcquireImage(sFun, fFun)
			/// AcquireImage(null, fFun)
			/// AcquireImage(sFun)
			/// AcquireImage(sFun, null)
			_obj = {};
			
			if(DL.isFunction(p1))
				OnSuccess = p1;
			if(DL.isFunction(p2))
				OnFailure = p2;

		} else {
			/// 2) AcquireImage(obj)
			/// 3) AcquireImage(obj, sFun, fFun)
			/// AcquireImage(null, sFun, fFun)

			if (DL.isUndefined(p1) || p1 == null) {
				_obj = {};
			} else {
				_obj = p1;
			}
			
			if(DL.isFunction(p2))
				OnSuccess = p2;
			if(DL.isFunction(p3))
				OnFailure = p3;
		}


		var iEnableEvents = 0;
		for(var i=0;i<aryEnableEvents.length;i++){
			var vFun = ['__', aryEnableEvents[i]].join('');
			if(DL.isFunction(this[vFun])){
				iEnableEvents = iEnableEvents | (1<<i);
			}
		}
		_obj['EnableEvents'] = iEnableEvents;

		
		strObj = ['[', KISSY.JSON.stringify(_obj), ']'].join('');

        return this.__innerAcquireImage('AcquireImage', strObj, false, OnSuccess, OnFailure);
    }

	// --- Load / Acquire (async+sync)  --
	
    // --- SCAN start --

    STwainP.CancelAllPendingTransfers = function () {
        return this._innerFun('CancelAllPendingTransfers');
    }
    STwainP.CloseSource = function () {
        return this._innerFun('CloseSource');
    }
    STwainP.CloseSourceManager = function () {
        return this._innerFun('CloseSourceManager');
    }
    STwainP.DisableSource = function () {
        return this._innerFun('DisableSource');
    }
    STwainP.FeedPage = function () {
        return this._innerFun('FeedPage');
    }
    STwainP.GetDeviceType = function () {
        return this._innerFun('GetDeviceType');
    }
	
    STwainP.GetSourceNameItems = function (i) {
        if(this.__sourceCount < 0)
            this.SourceCount;
		if(i<this.__sourceCount && i>=0)
			return this.__sourceName[i];
		else
			return '';
    }
	
	STwainP.SourceNameItems = function (i) {
	    if(this.__sourceCount < 0)
            this.SourceCount;
		if(i<this.__sourceCount && i>=0)
			return this.__sourceName[i];
		else
			return '';
    }
	
    STwainP.GetSourceNames = function () {
        var _this = this, ret = _this._innerFunRaw('GetSourceNames');
        if (_this._errorCode != 0)
            return [];
        return ret;
    }
	
    STwainP.GetSourceType = function (i) {
        return this._innerFun('GetSourceType', Funs.makeParams(i));
    }
    STwainP.OpenSource = function () {
        return this._innerFun('OpenSource');
    }
    STwainP.OpenSourceManager = function () {
        return this._innerFun('OpenSourceManager');
    }
    STwainP.ResetImageLayout = function () {
        return this._innerFun('ResetImageLayout');
    }
    STwainP.RewindPage = function () {
        return this._innerFun('RewindPage');
    }
    STwainP.SelectSource = function () {
        return this._innerFun('SelectSource');
    }

    STwainP.SelectSourceByIndex = function (index) {
        return this._innerFun('SelectSourceByIndex', Funs.makeParams(index));
    }
    STwainP.SetFileXferInfo = function (localFile, format) {
        var f = Funs.replaceLocalFilename(localFile);
        return this._innerFun('SetFileXferInfo', Funs.makeParams(f, format));
    }
    STwainP.SetImageLayout = function (left, top, right, bottom) {
        return this._innerFun('SetImageLayout', Funs.makeParams(left, top, right, bottom));
    }
    STwainP.CapGet = function () {
        return this._innerFun('CapGet');
    }
    STwainP.CapGetCurrent = function () {
        return this._innerFun('CapGetCurrent');
    }
    STwainP.CapGetDefault = function () {
        return this._innerFun('CapGetDefault');
    }
    STwainP.CapGetFrameBottom = function (index) {
        return this._innerFun('CapGetFrameBottom', Funs.makeParams(index));
    }
    STwainP.CapGetFrameLeft = function (index) {
        return this._innerFun('CapGetFrameLeft', Funs.makeParams(index));
    }
    STwainP.CapGetFrameRight = function (index) {
        return this._innerFun('CapGetFrameRight', Funs.makeParams(index));
    }
    STwainP.CapGetFrameTop = function (index) {
        return this._innerFun('CapGetFrameTop', Funs.makeParams(index));
    }
    STwainP.CapGetHelp = function () {
        return this._innerFun('CapGetHelp');
    }
    STwainP.CapGetLabel = function () {
        return this._innerFun('CapGetLabel');
    }
    STwainP.CapGetLabels = function () {
        return this._innerFun('CapGetLabels');
    }
    STwainP.CapIfSupported = function (msg) {
        return this._innerFun('CapIfSupported', Funs.makeParams(msg));
    }
    STwainP.CapReset = function () {
        return this._innerFun('CapReset');
    }
    STwainP.CapSet = function () {
        return this._innerFun('CapSet');
    }
    STwainP.CapSetFrame = function (index, left, top, right, bottom) {
        return this._innerFun('CapSetFrame', Funs.makeParams(index, left, top, right, bottom));
    }
    STwainP.GetCapItems = function (index) {
        return this._innerFun('GetCapItems', Funs.makeParams(index));
    }
    STwainP.GetCapItemsString = function (index) {
        return this._innerFun('GetCapItemsString', Funs.makeParams(index));
    }
    STwainP.SetCapItems = function (index, newVal) {
        return this._innerFun('SetCapItems', Funs.makeParams(index, newVal));
    }
    STwainP.SetCapItemsString = function (index, newVal) {
        return this._innerFun('SetCapItemsString', Funs.makeParams(index, newVal));
    }
    // --- SCAN end --

})(Dynamsoft.Lib.html5.STwain, Dynamsoft.Lib.html5.Funs);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function(DL){
	if (!DL.product.bChromeEdition){
		return;
	}
	
	var STwain = DL.html5.STwain, 
		STwainP = STwain.prototype, 
		Funs = DL.html5.Funs;

    // --- View & Edit start --

    STwainP.AddText = function (sImageIndex, x, y, text, txtColor, backgroundColor, backgroundRoundRadius, backgroundOpacity) {
        //if we has canvas, we should do this in js?????????????????????
        return this._innerFun('AddText', Funs.makeParams(sImageIndex, x, y, text, txtColor, backgroundColor, backgroundRoundRadius, backgroundOpacity));
    }

    STwainP.CreateTextFont = function (Height, Width, Escapement, Orientation, Weight, Italic, Underline, StrikeOut, CharSet, OutputPrecision, ClipPrecision, Quality, PitchAndFamily, FaceName) {
        //if we has canvas, we should do this in js?????????????????????
        return this._innerFun('CreateTextFont', Funs.makeParams(Height, Width, Escapement, Orientation, Weight, Italic, Underline, StrikeOut, CharSet, OutputPrecision, ClipPrecision, Quality, PitchAndFamily, FaceName));
    }
	
    STwainP.CopyToClipboard = function (sImageIndex) {
        return this._innerFun('CopyToClipboard', Funs.makeParams(sImageIndex));
    }
	
    STwainP.Erase = function (sImageIndex, left, top, right, bottom) {
        return this._innerFun('Erase', Funs.makeParams(sImageIndex, left, top, right, bottom));
    }
	
    STwainP.GetImageBitDepth = function (sImageIndex) {
        return this._innerFun('GetImageBitDepth', Funs.makeParams(sImageIndex));
    }
	
    STwainP.GetImageWidth = function (sImageIndex) {
        return this._innerFun('GetImageWidth', Funs.makeParams(sImageIndex));
    }
	
    STwainP.GetImageHeight = function (sImageIndex) {
        return this._innerFun('GetImageHeight', Funs.makeParams(sImageIndex));
    }
	
    STwainP.GetImageSize = function (sImageIndex, lWidth, lHeight) {
        return this._innerFun('GetImageSize', Funs.makeParams(sImageIndex, lWidth, lHeight));
    }
	
    STwainP.GetImageSizeWithSpecifiedType = function (sImageIndex, ImageType) {
        return this._innerFun('GetImageSizeWithSpecifiedType', Funs.makeParams(sImageIndex, ImageType));
    }
	
    STwainP.GetImageXResolution = function (sImageIndex) {
        return this._innerFun('GetImageXResolution', Funs.makeParams(sImageIndex));
    }
	
    STwainP.GetImageYResolution = function (sImageIndex) {
        return this._innerFun('GetImageYResolution', Funs.makeParams(sImageIndex));
    }
	
    STwainP.GetSelectedImageIndex = function (sIndex) {
		var _this = this;
		if(sIndex>=0){
			return _this._UIManager.GetSelectedImageIndex(sIndex);
		}
		return -1;
    }
	
    STwainP.SetSelectedImageIndex = function (sIndex, sImageIndex) {
        var _this = this, _count = _this.__SelectedImagesCount;
		
		if(sIndex<_this.__SelectedImagesCount && sIndex>=0){
			_this._UIManager.getView().SetSelectedImageIndex(sIndex, sImageIndex);
			return this._innerFun('SetSelectedImageIndex', Funs.makeParams(sIndex, sImageIndex));
		} else {
			// index out of range error
			DL.Errors.InvalidIndex(_this);
			return false;	
		}
    }
	
	
    STwainP.GetSkewAngle = function (sImageIndex) {
        return this._innerFun('GetSkewAngle', Funs.makeParams(sImageIndex));
    }
	
    STwainP.GetSkewAngleEx = function (sImageIndex, left, top, right, bottom) {
        return this._innerFun('GetSkewAngleEx', Funs.makeParams(sImageIndex, left, top, right, bottom));
    }
	
    STwainP.IsBlankImageEx = function (sImageIndex, left, top, right, bottom, bFuzzyMatch) {
        return this._innerFun('IsBlankImageEx', Funs.makeParams(sImageIndex, left, top, right, bottom, bFuzzyMatch));
    }

    STwainP.Mirror = function (sImageIndex) {
        return this._innerFun('Mirror', Funs.makeParams(sImageIndex));
    }
	
    STwainP.OverlayRectangle = function (sImageIndex, left, top, right, bottom, color, fOpacity) {
		var _this = this;
        if (Funs.isServerInvalid(_this)) {
			return false;
		}
		
        return this._UIManager.getView().OverlayRectangle(sImageIndex, left, top, right, bottom, color, fOpacity);
    }
	
    STwainP.RemoveAllImages = function () {
        var _this=this, ret;
		ret = _this._innerFun('RemoveAllImages');
		if(ret){
			_this._HowManyImagesInBuffer = 0;
			_this._UIManager.clear();
		}
		
		return ret;
    }
	
    STwainP.RemoveAllSelectedImages = function () {
        var _this = this, ret;
        ret = Funs.__SetSelectedImages(_this, _this._UIManager.GetCurrentImageIndex(), _this._UIManager.GetSelectedIndexes());
		if(ret)
		{
            ret = _this._innerFun('RemoveAllSelectedImages');
		    if(ret){
			    _this._HowManyImagesInBuffer = _this._innerFun('HowManyImagesInBuffer');
			    _this.__cIndex = _this._innerFun('CurrentImageIndexInBuffer');
			    if(_this._HowManyImagesInBuffer == 0){
				    _this._UIManager.clear();
			    }
    			
			    _this._UIManager.getView().SetSelectedImageCount(0);
			    _this.__SelectedImagesCount = 0;

		    }
		}

        return ret;
    }
	
    STwainP.RemoveImage = function (sImageIndex) {
		var _this = this, ret;

        ret = _this._innerFun('RemoveImage', Funs.makeParams(sImageIndex));
		
		if(ret){
		
			_this._HowManyImagesInBuffer = _this._innerFun('HowManyImagesInBuffer');
			_this.__cIndex = _this._innerFun('CurrentImageIndexInBuffer');
			if(_this._HowManyImagesInBuffer == 0){
				_this._UIManager.clear();
			}
		}

        return ret;
		
    }

    // Image Operate
    STwainP.Rotate = function (sImageIndex, fAngle, bKeepSize) {
        var _this = this, index = parseInt(sImageIndex),
			r = _this._innerFun('Rotate', Funs.makeParams(index, fAngle, bKeepSize)),
			bOK = (r == 1);

        if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
        return bOK;
    }
	
    STwainP.RotateEx = function (sImageIndex, fAngle, bKeepSize, enumInterpolationMethod) {
        var _this = this, index = parseInt(sImageIndex),
			r = _this._innerFun('RotateEx', Funs.makeParams(index, fAngle, bKeepSize, enumInterpolationMethod)),
			bOK = (r == 1);

        if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
        return bOK;
    }
	
    STwainP.RotateLeft = function (sImageIndex) {
        var _this = this, index = parseInt(sImageIndex),
			r = _this._innerFun('RotateLeft', Funs.makeParams(index)),
			bOK = (r == 1);

        if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
        return bOK;
    }
	
    STwainP.RotateRight = function (sImageIndex) {
        var _this = this, index = parseInt(sImageIndex),
			r = _this._innerFun('RotateRight', Funs.makeParams(index)),
			bOK = (r == 1);

        if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
        return bOK;
    }
	
    STwainP.ChangeImageSize = function (sImageIndex, _lNewWidth, _lNewHeight, enumInterpolationMethod) {
        var _this = this, index = parseInt(sImageIndex), 
			lNewWidth = 1 * _lNewWidth, lNewHeight = 1 * _lNewHeight,
			r, bOK;
		
		if(lNewWidth<=0 || lNewHeight<=0){
			DL.Errors.InvalidWidthOrHeight(_this);
			return false;
		}
		
		r = _this._innerFun('ChangeImageSize', Funs.makeParams(index, lNewWidth, lNewHeight, enumInterpolationMethod));
		bOK = (r == 1);
		if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
	

        return bOK;
    }
	
    STwainP.Flip = function (sImageIndex) {
        var _this = this, index = parseInt(sImageIndex),
			r = _this._innerFun('Flip', Funs.makeParams(index)),
			bOK = (r == 1);

        if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
        return bOK;
    }
	
    STwainP.Crop = function (sImageIndex, left, top, right, bottom) {
        var _this = this, index = parseInt(sImageIndex),
			r = _this._innerFun('Crop', Funs.makeParams(index, left, top, right, bottom)),
			bOK = (r == 1);

        if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
        return bOK;
    }
	
    STwainP.CropToClipboard = function (sImageIndex, left, top, right, bottom) {
        var _this = this, index = parseInt(sImageIndex),
			r = _this._innerFun('CropToClipboard', Funs.makeParams(index, left, top, right, bottom)),
			bOK = (r == 1);

        if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
        return bOK;
    }
	
    STwainP.CutFrameToClipboard = function (sImageIndex, left, top, right, bottom) {
        var _this = this, index = parseInt(sImageIndex),
			r = _this._innerFun('CutFrameToClipboard', Funs.makeParams(index, left, top, right, bottom)),
			bOK = (r == 1);

        if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
        return bOK;
    }
	
    STwainP.CutToClipboard = function (sImageIndex) {
        var _this = this, index = parseInt(sImageIndex),
			r = _this._innerFun('CutToClipboard', Funs.makeParams(index)),
			bOK = (r == 1);

        if (bOK) Funs.refreshImageAfterInvokeFun(_this, index);
        return bOK;
    }

    STwainP.SetDPI = function (sImageIndex, xResolution, yResolution, bResampleImage, enumInterpolationMethod) {
        return this._innerFun('SetDPI', Funs.makeParams(sImageIndex, xResolution, yResolution, bResampleImage, enumInterpolationMethod));
    }
	
    STwainP.SetViewMode = function (sHorizontalImageCount, sVerticalImageCount) {
		var _this = this, h, v;
		
		h = Math.floor(sHorizontalImageCount);
		v = Math.floor(sVerticalImageCount);
		
		_this._UIManager.SetViewMode(h, v);
		return true;
    }
	
    STwainP.MoveImage = function (sSourceImageIndex, sTargetImageIndex) {
        var _this = this, ret = _this._innerFun('MoveImage', Funs.makeParams(sSourceImageIndex, sTargetImageIndex));
        if (ret) {
            ret = _this._UIManager.MoveImage(sSourceImageIndex, sTargetImageIndex);
        }
        return ret;
    }
	
    STwainP.SwitchImage = function (sImageIndex1, sImageIndex2) {
        var _this = this, ret = _this._innerFun('SwitchImage', Funs.makeParams(sImageIndex1, sImageIndex2));
        if (ret) {
            _this._UIManager.SwitchImage(sImageIndex1, sImageIndex2);
        }

        return ret;
    }
	
    STwainP.Print = function (bPrintWithWindows) {
		var _this = this;
		if(bPrintWithWindows)
		{
		    var bIfShowPrintUI = true;
		    return this._innerSend('PrintEx', Funs.makeParams(bIfShowPrintUI), function () {}, function () {});
		}
		
        _this._UIManager.getView().Print();
		
		return true;
    }

    STwainP.SetSelectedImageArea = function (sImageIndex, left, top, right, bottom) {
        var _this = this;
        if (Funs.isServerInvalid(_this)) {
			return false;
		}
		
        return _this._UIManager.getView().SetSelectedImageArea(sImageIndex, left, top, right, bottom);
    }
    
    STwainP.CloseWorkingProcess = function () {
        return this._innerFun('CloseWorkerProcess');
    }

    // --- View & Edit end --

  /*  
    //For IBM
    STwainP.GetFileSize = function (filePath) {
        var f = Funs.replaceLocalFilename(filePath);
        return this._innerFun('GetFileSize', Funs.makeParams(f));
    }
    
    STwainP.EncodeAsBase64 = function (filePath, OnComplete) {
        var _this = this, f = Funs.replaceLocalFilename(filePath);
        
        var _fFun = function (base64) {
            if(Dynamsoft.Lib.isFunction(OnComplete)){
                OnComplete(filePath, base64, _this.ErrorCode, _this.ErrorString);
            }
            return true;
        };
        
        return this._innerSend('EncodeAsBase64', Funs.makeParams(f), true, _fFun, _fFun);
    }
    
    STwainP.DeleteFile = function (filePath) {
        var f = Funs.replaceLocalFilename(filePath);
        return this._innerFun('DWTDeleteFile', Funs.makeParams(f));
    }
    
    STwainP.DeleteFolder = function (filePath) {
        var f = Funs.replaceLocalFilename(filePath);
        return this._innerFun('DWTDeleteFolder', Funs.makeParams(f));
    }
    
    STwainP.CopyFile = function (sourceFilePath, destinationFilePath, OnComplete) {
        var _this = this, sf = Funs.replaceLocalFilename(sourceFilePath), 
        df = Funs.replaceLocalFilename(destinationFilePath);
        
        var _fFun = function () {
            if(Dynamsoft.Lib.isFunction(OnComplete)){
                OnComplete(sourceFilePath, destinationFilePath, _this.ErrorCode, _this.ErrorString);
            }
            return true;
        };
        
        return this._innerSend('DWTCopyFile', Funs.makeParams(sf, df), true, _fFun, _fFun);
    }
    
    STwainP.TiffPageCount = function (filePath) {
        var f = Funs.replaceLocalFilename(filePath);
        return this._innerFun('TiffPageCount', Funs.makeParams(f));
    }
    
    STwainP.SplitTiff = function (source, pageIndex, destination, OnComplete) {
        var _this = this, sf = Funs.replaceLocalFilename(source), 
        df = Funs.replaceLocalFilename(destination);
        
        var _fFun = function (r) {
            if(Dynamsoft.Lib.isFunction(OnComplete)){
				var count = 0;
				if(_this.ErrorCode == 0){
					if(r && r.length>=1){
						count = r[0];
					}
				}
				
                OnComplete(source, pageIndex, destination, count, _this.ErrorCode, _this.ErrorString);
            }
            return true;
        };
        
        return this._innerSend('SplitTiff', Funs.makeParams(sf, pageIndex, df), true, _fFun, _fFun);
    }
    
    STwainP.MergeTiff = function (fileArray, destination, OnComplete) {
        var _this = this, fSources = false,
		df = Funs.replaceLocalFilename(destination);
		
		if(Dynamsoft.Lib.isArray(fileArray)){
			fSources = Funs.replaceLocalFilename(fileArray.join(','));
		} else {
			fSources = '';
		}
        
        var _fFun = function () {
            if(Dynamsoft.Lib.isFunction(OnComplete)){
                OnComplete(fileArray, destination, _this.ErrorCode, _this.ErrorString);
            }
            return true;
        };
        
        return this._innerSend('MergeTiff', Funs.makeParams(fSources, df), true, _fFun, _fFun);
    }
    
     STwainP.GetCapDescription = function (Cap) {
        var _this = this;
        var valueString = [];
		
		_this.OpenSource();
        _this.Capability = Cap;
		_this.CapGet();
		var valueType = _this.CapValueType;
		var count = _this.CapNumItems;
		var i = 0;
		
		switch(valueType)
		{
		    case EnumDWT_CapValueType.TWTY_INT8:
		    case EnumDWT_CapValueType.TWTY_INT8:
            case EnumDWT_CapValueType.TWTY_INT16:
            case EnumDWT_CapValueType.TWTY_INT32:
            case EnumDWT_CapValueType.TWTY_UINT8:
            case EnumDWT_CapValueType.TWTY_UINT16:
            case EnumDWT_CapValueType.TWTY_UINT32:
            case EnumDWT_CapValueType.TWTY_BOOL:
            {               
		        for(i = 0; i< count; i++)
		        {
		            valueString.push(_this.__convertCAP_Item_toString(Cap, _this.GetCapItems(i), valueType));
		        }
		        break;
            }
            case EnumDWT_CapValueType.TWTY_STR32:
            case EnumDWT_CapValueType.TWTY_STR64:
            case EnumDWT_CapValueType.TWTY_STR128:
            case EnumDWT_CapValueType.TWTY_STR255:
            {
                 for(i = 0; i< count; i++)
                 {
                    valueString.push(_this.GetCapItems(i));           
                 }
                 break;
            }

            case EnumDWT_CapValueType.TWTY_FIX32:
            {
              for(i = 0; i< count; i++)
              {
                valueString.push(_this.GetCapItems(i));      
              }
              break;
            }
            
            case EnumDWT_CapValueType.TWTY_FRAME:
            {
              for(i = 0; i< count; i++)
              {
                var iLeft = _this.CapGetFrameLeft(i);
                var iRight = _this.CapGetFrameRight(i);
                var iTop = _this.CapGetFrameTop(i);
                var iBottom = _this.CapGetFrameBottom(i);
                var strLeft = parseInt(iLeft) == iLeft? iLeft.toFixed(1): iLeft;
                var strRight = parseInt(iRight) == iRight? iRight.toFixed(1): iRight;
                var strTop = parseInt(iTop) == iTop? iTop.toFixed(1): iTop;
                var strBottom = parseInt(iBottom) == iBottom? iBottom.toFixed(1): iBottom;
                var str = strLeft +" " + strRight +" "+ strTop +" "+ strBottom;

//                str.Format( "%d.%d  %d.%d  %d.%d  %d.%d", 
//                     Frame.Left.Whole,   (int)((Frame.Left.Frac/65536.0 + .0005)*1000),
//                     Frame.Right.Whole,  (int)((Frame.Right.Frac/65536.0 + .0005)*1000),
//                     Frame.Top.Whole,    (int)((Frame.Top.Frac/65536.0 + .0005)*1000),
//                     Frame.Bottom.Whole, (int)((Frame.Bottom.Frac/65536.0 + .0005)*1000) );

                 valueString.push(str);    
              }
            }
            break;
		}    
        return valueString;
    }

    STwainP.__convertCAP_Item_toString = function (Cap, item, valueType){
      var _this = this;
      var pszString = "Unknown capability";
      switch(Cap)
      {
        case EnumDWT_Cap.CAP_ALARMS:
          pszString = _this.__convertCAP_ALARMS_toString(item);
          break;

        case EnumDWT_Cap.ICAP_AUTOSIZE:
          pszString = _this.__convertICAP_AUTOSIZE_toString(item);
          break;

        case EnumDWT_Cap.ICAP_COMPRESSION:
          pszString = _this.__convertICAP_COMPRESSION_toString(item);
          break;

        case EnumDWT_Cap.ICAP_BARCODESEARCHMODE:
          pszString = _this.__convertICAP_BARCODESEARCHMODE_toString(item);
          break;

        case EnumDWT_Cap.ICAP_BITORDER:
          pszString = _this.__convertICAP_BITORDER_toString(item);
          break;

        case EnumDWT_Cap.ICAP_AUTODISCARDBLANKPAGES:
          pszString = _this.__convertICAP_AUTODISCARDBLANKPAGES_toString(item);
          break;

        case EnumDWT_Cap.ICAP_BITDEPTH:
          pszString = item;
          break;

        case EnumDWT_Cap.ICAP_BITDEPTHREDUCTION:
          pszString = _this.__convertICAP_BITDEPTHREDUCTION_toString(item);
          break;

        case EnumDWT_Cap.ICAP_SUPPORTEDBARCODETYPES:
          pszString = _this.__convertICAP_SUPPORTEDBARCODETYPES_toString(item);
          break;

        case EnumDWT_Cap.CAP_CAMERASIDE:
          pszString = _this.__convertCAP_CAMERASIDE_toString(item);
          break;

        case EnumDWT_Cap.CAP_CLEARBUFFERS:
          pszString = _this.__convertCAP_CLEARBUFFERS_toString(item);
          break;

        case EnumDWT_Cap.CAP_DEVICEEVENT:
          pszString = _this.__convertCAP_DEVICEEVENT_toString(item);
          break;

        case EnumDWT_Cap.CAP_DUPLEX:
          pszString = _this.__convertCAP_DUPLEX_toString(item);
          break;

        case EnumDWT_Cap.CAP_EXTENDEDCAPS:
          pszString = _this.__convertCAP_toString(item);
          break;

        case EnumDWT_Cap.CAP_FEEDERALIGNMENT:
          pszString = _this.__convertCAP_FEEDERALIGNMENT_toString(item);
          break;

        case EnumDWT_Cap.ICAP_FEEDERTYPE:
          pszString = _this.__convertICAP_FEEDERTYPE_toString(item);
          break;

        case EnumDWT_Cap.ICAP_IMAGEFILEFORMAT:
          pszString = _this.__convertICAP_IMAGEFILEFORMAT_toString(item);
          break;

        case EnumDWT_Cap.ICAP_FLASHUSED2:
          pszString = _this.__convertICAP_FLASHUSED2_toString(item);
          break;

        case EnumDWT_Cap.CAP_FEEDERORDER:
          pszString = _this.__convertCAP_FEEDERORDER_toString(item);
          break;

        case EnumDWT_Cap.CAP_FEEDERPOCKET:
          pszString = _this.__convertCAP_FEEDERPOCKET_toString(item);
          break;

        case EnumDWT_Cap.ICAP_FLIPROTATION:
          pszString = _this.__convertICAP_FLIPROTATION_toString(item);
          break;

        case EnumDWT_Cap.ICAP_FILTER:
          pszString = _this.__convertICAP_FILTER_toString(item);
          break;

        case EnumDWT_Cap.ICAP_ICCPROFILE:
          pszString = _this.__convertICAP_ICCPROFILE_toString(item);
          break;

        case EnumDWT_Cap.ICAP_IMAGEFILTER:
          pszString = _this.__convertICAP_IMAGEFILTER_toString(item);
          break;

        case EnumDWT_Cap.ICAP_IMAGEMERGE:
          pszString = _this.__convertICAP_IMAGEMERGE_toString(item);
          break;

        case EnumDWT_Cap.CAP_JOBCONTROL:
          pszString = _this.__convertCAP_JOBCONTROL_toString(item);
          break;

        case EnumDWT_Cap.ICAP_JPEGQUALITY:
          pszString = _this.__convertICAP_JPEGQUALITY_toString(item);
          break;

        case EnumDWT_Cap.ICAP_LIGHTPATH:
          pszString = _this.__convertICAP_LIGHTPATH_toString(item);
          break;

        case EnumDWT_Cap.ICAP_LIGHTSOURCE:
          pszString = _this.__convertICAP_LIGHTSOURCE_toString(item);
          break;

        case EnumDWT_Cap.ICAP_NOISEFILTER:
          pszString = _this.__convertICAP_NOISEFILTER_toString(item);
          break;

        case EnumDWT_Cap.ICAP_ORIENTATION:
          pszString = _this.__convertICAP_ORIENTATION_toString(item);
          break;

        case EnumDWT_Cap.ICAP_OVERSCAN:
          pszString = _this.__convertICAP_OVERSCAN_toString(item);
          break;

        case EnumDWT_Cap.ICAP_PLANARCHUNKY:
          pszString = _this.__convertICAP_PLANARCHUNKY_toString(item);
          break;

        case EnumDWT_Cap.ICAP_PIXELFLAVOR:
          pszString = _this.__convertICAP_PIXELFLAVOR_toString(item);
          break;

        case EnumDWT_Cap.CAP_PRINTERMODE:
          pszString = _this.__convertCAP_PRINTERMODE_toString(item);
          break;

        case EnumDWT_Cap.CAP_PRINTER:
          pszString = _this.__convertCAP_PRINTER_toString(item);
          break;

        case EnumDWT_Cap.CAP_POWERSUPPLY:
          pszString = _this.__convertCAP_POWERSUPPLY_toString(item);
          break;

        case EnumDWT_Cap.ICAP_PIXELTYPE:
          pszString = _this.__convertICAP_PIXELTYPE_toString(item);
          break;

        case EnumDWT_Cap.CAP_SEGMENTED:
          pszString = _this.__convertCAP_SEGMENTED_toString(item);
          break;

        case EnumDWT_Cap.ICAP_SUPPORTEDEXTIMAGEINFO:
          pszString = _this.__convertExtImageInfoName_toString(item);
          break;

        case EnumDWT_Cap.ICAP_SUPPORTEDSIZES:
          pszString = _this.__convertICAP_SUPPORTEDSIZES_toString(item);
          break;

        case EnumDWT_Cap.ICAP_XFERMECH:
          pszString = _this.__convertICAP_XFERMECH_toString(item);
          break;

        case EnumDWT_Cap.ICAP_UNITS:
          pszString = _this.__convertICAP_UNITS_toString(item);
          break;

        default:
          {
              switch(valueType)
              {
                case EnumDWT_CapValueType.TWTY_UINT8:
                case EnumDWT_CapValueType.TWTY_UINT16:
                case EnumDWT_CapValueType.TWTY_UINT32:
                case EnumDWT_CapValueType.TWTY_INT8:
                case EnumDWT_CapValueType.TWTY_INT16:
                case EnumDWT_CapValueType.TWTY_INT32:
                   pszString = item;
                  break;
                case EnumDWT_CapValueType.TWTY_BOOL:
                   pszString = item? "True" : "False";
                  break;
              }
          }
          break;
      }

      return pszString;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert CAP_ALARMS values to String
  STwainP.__convertCAP_ALARMS_toString = function (item){
      var text = "";

      switch(item)
      {
	    case TWAL_ALARM:
        text = "Alarm";
        break;

	    case TWAL_FEEDERERROR:
        text = "Feeder Error";
        break;

	    case TWAL_FEEDERWARNING:
        text = "Feeder Warning";
        break;

	    case TWAL_BARCODE:
        text = "Barcode";
        break;

	    case TWAL_DOUBLEFEED:
        text = "Double Feed";
        break;

	    case TWAL_JAM:
        text = "Paper Jam";
        break;

	    case TWAL_PATCHCODE:
        text = "Patch Code";
        break;

	    case TWAL_POWER:
        text = "Power";
        break;

	    case TWAL_SKEW:
        text = "Skew";
        break;

        default:
        text = "Unknown TWAL " + item;
        break;
      }

      return text;
    }
    
    
//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_AUTOSIZE values to String
    STwainP.__convertICAP_AUTOSIZE_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWAS_NONE:
        text = "None";
        break;

	    case 1://TWAS_AUTO:
        text = "Auto";
        break;

	    case 2://TWAS_CURRENT:
        text = "Current";
        break;

      default:
        text = "Unknown TWAS " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_COMPRESSION values to String
    STwainP.__convertICAP_COMPRESSION_toString = function (item){
      var text = "";

      switch(item)
      {
      case 0://TWCP_NONE:
        text = "None";
        break;

      case 1://TWCP_PACKBITS:
        text = "PACKBITS";
        break;

      case 2://TWCP_GROUP31D:
        text = "GROUP31D";
        break;

      case 3://TWCP_GROUP31DEOL:
        text = "GROUP31DEOL";
        break;

      case 4://TWCP_GROUP32D:
        text = "GROUP32D";
        break;

      case 5://TWCP_GROUP4:
        text = "GROUP4";
        break;

      case 6://TWCP_JPEG:
        text = "JPEG";
        break;

      case 7://TWCP_LZW:
        text = "LZW";
        break;

      case 8://TWCP_JBIG:
        text = "JBIG";
        break;

      case 9://TWCP_PNG:
        text = "PNG";
        break;

      case 10://TWCP_RLE4:
        text = "RLE4";
        break;

      case 11://TWCP_RLE8:
        text = "RLE8";
        break;

      case 12://TWCP_BITFIELDS:
        text = "BITFIELDS";
        break;

      default:
        text = "Unknown TWCP " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_BARCODESEARCHMODE values to String
    STwainP.__convertICAP_BARCODESEARCHMODE_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWBD_HORZ:
        text = "Horizontal";
        break;

	    case 1://TWBD_VERT:
        text = "Vertical";
        break;

	    case 2://TWBD_HORZVERT:
        text = "Horz Vert";
        break;

	    case 3://TWBD_VERTHORZ:
        text = "Vert Horz";
        break;

      default:
        text = "Unknown TWBD " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_BITORDER values to String
    STwainP.__convertICAP_BITORDER_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapBitOrder.TWBO_LSBFIRST:
        text = "LSB first";
        break;

	    case EnumDWT_CapBitOrder.TWBO_MSBFIRST:
        text = "MSB first";
        break;

      default:
        text = "Unknown TWBO " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_AUTODISCARDBLANKPAGES values to String
    STwainP.__convertICAP_AUTODISCARDBLANKPAGES_toString = function (item){
      var text = "";

      switch(item)
      {
	    case -2://TWBP_DISABLE:
        text = "Disable";
        break;

	    case -1://TWBP_AUTO:
        text = "Auto";
        break;

      default:
        text = "Unknown TWBP " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_BITDEPTHREDUCTION values to String
    STwainP.__convertICAP_BITDEPTHREDUCTION_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapBitdepthReduction.TWBR_THRESHOLD:
        text = "Threshold";
        break;

	    case EnumDWT_CapBitdepthReduction.TWBR_HALFTONE:
        text = "Halftone";
        break;

	    case EnumDWT_CapBitdepthReduction.TWBR_CUSTHALFTONE:
        text = "Custom Halftone";
        break;

	    case EnumDWT_CapBitdepthReduction.TWBR_DIFFUSION:
        text = "Diffusion";
        break;

      default:
        text = "Unknown TWBR " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_SUPPORTEDBARCODETYPES and TWEI_BARCODETYPE values to String
    STwainP.__convertICAP_SUPPORTEDBARCODETYPES_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWBT_3OF9:
        text = "3of9";
        break;

	    case 1://TWBT_2OF5INTERLEAVED:
        text = "2of5 interleaved";
        break;

	    case 2://TWBT_2OF5NONINTERLEAVED:
        text = "2of5 noninterleaved";
        break;

	    case 3://TWBT_CODE93:
        text = "code93";
        break;

	    case 4://TWBT_CODE128:
        text = "code128";
        break;

	    case 5://TWBT_UCC128:
        text = "UCC128";
        break;

	    case 6://TWBT_CODABAR:
        text = "Codebar";
        break;

	    case 7://TWBT_UPCA:
        text = "UPCA";
        break;

	    case 8://TWBT_UPCE:
        text = "UPCE";
        break;

	    case 9://TWBT_EAN8:
        text = "EAN8";
        break;

	    case 10://TWBT_EAN13:
        text = "EAN13";
        break;

	    case 11://TWBT_POSTNET:
        text = "POSTNET";
        break;

	    case 12://TWBT_PDF417:
        text = "PDF417";
        break;

	    case 13://TWBT_2OF5INDUSTRIAL:
        text = "2of5 industrial";
        break;

	    case 14://TWBT_2OF5MATRIX:
        text = "2of5 matrix";
        break;

	    case 15://TWBT_2OF5DATALOGIC:
        text = "2of5 datalogic";
        break;

	    case 16://TWBT_2OF5IATA:
        text = "2of5 IATA";
        break;

	    case 17://TWBT_3OF9FULLASCII:
        text = "3of9 fullASCII";
        break;

	    case 18://TWBT_CODABARWITHSTARTSTOP:
        text = "Codabar with start stop";
        break;

	    case 19://TWBT_MAXICODE:
        text = "MAXICODE";
        break;

      default:
        text = "Unknown TWBT " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert CAP_CAMERASIDE values to String
    STwainP.__convertCAP_CAMERASIDE_toString = function (item){
      var text = "";
      
      switch(item)
      {
	    case 0://TWCS_BOTH:
        text = "Both";
        break;

	    case 1://TWCS_TOP:
        text = "Top";
        break;

	    case 2://TWCS_BOTTOM:
        text = "Bottom";
        break;

      default:
        text = "Unknown TWCS " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert CAP_CLEARBUFFERS values to String
    STwainP.__convertCAP_CLEARBUFFERS_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWCB_AUTO:
        text = "Auto";
        break;

	    case 1://TWCB_CLEAR:
        text = "Clear";
        break;

	    case 2://TWCB_NOCLEAR:
        text = "No Clear";
        break;

      default:
        text = "Unknown TWCB " + item;
        break;
      }

      return text;
    }



//////////////////////////////////////////////////////////////////////////////
// Convert CAP_DEVICEEVENT values to String
    STwainP.__convertCAP_DEVICEEVENT_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0x8000://TWDE_CUSTOMEVENTS:
        text = "Custom Events";
        break;

	    case 0://TWDE_CHECKAUTOMATICCAPTURE:
        text = "Check Automatic Capture";
        break;

	    case 1://TWDE_CHECKBATTERY:
        text = "Check Battery";
        break;

	    case 2://TWDE_CHECKDEVICEONLINE:
        text = "Check Device Online";
        break;

	    case 3://TWDE_CHECKFLASH:
        text = "Check Flash";
        break;

	    case 4://TWDE_CHECKPOWERSUPPLY:
        text = "Check Power Supply";
        break;

	    case 5://TWDE_CHECKRESOLUTION:
        text = "Check Resolution";
        break;

	    case 6://TWDE_DEVICEADDED:
        text = "Device Added";
        break;

	    case 7://TWDE_DEVICEOFFLINE:
        text = "Device Offline";
        break;

	    case 8://TWDE_DEVICEREADY:
        text = "Device Ready";
        break;

	    case 9://TWDE_DEVICEREMOVED:
        text = "Device Removed";
        break;

	    case 10://TWDE_IMAGECAPTURED:
        text = "Image Captured";
        break;

	    case 11://TWDE_IMAGEDELETED:
        text = "Image Deleted";
        break;

	    case 12://TWDE_PAPERDOUBLEFEED:
        text = "Paper Doublefeed";
        break;

	    case 13://TWDE_PAPERJAM:
        text = "Paperjam";
        break;

	    case 14://TWDE_LAMPFAILURE:
        text = "Lamp Failure";
        break;

	    case 15://TWDE_POWERSAVE:
        text = "Power Save";
        break;

	    case 16://TWDE_POWERSAVENOTIFY:
        text = "Power Save Notify";
        break;

      default:
        text = "Unknown TWDE " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert CAP_DUPLEX values to String
    STwainP.__convertCAP_DUPLEX_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_DUPLEX.TWDX_NONE:
        text = "None";
        break;

	    case EnumDWT_DUPLEX.TWDX_1PASSDUPLEX:
        text = "1 Pass Duplex";
        break;

	    case EnumDWT_DUPLEX.TWDX_2PASSDUPLEX:
        text = "2 Pass Duplex";
        break;

      default:
        text = "Unknown TWDX " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
    STwainP.__convertCAP_toString = function (item){
      var text = "";

      switch(item)
      {
      case 0x1134://ICAP_AUTODISCARDBLANKPAGES:
        text = "ICAP_AUTODISCARDBLANKPAGES";
        break;
      case 0x8000://CAP_CUSTOMBASE:
        text = "CAP_CUSTOMBASE";
        break;

      case 0x0001://CAP_XFERCOUNT:
        text = "CAP_XFERCOUNT";
        break;

      case 0x0100://ICAP_COMPRESSION:
        text = "ICAP_COMPRESSION";
        break;

      case 0x0101://ICAP_PIXELTYPE:
        text = "ICAP_PIXELTYPE";
        break;

      case 0x0102://ICAP_UNITS:
        text = "ICAP_UNITS";
        break;

      case 0x0103://ICAP_XFERMECH:
        text = "ICAP_XFERMECH";
        break;

      case 0x1000://CAP_AUTHOR:
        text = "CAP_AUTHOR";
        break;

      case 0x1001://CAP_CAPTION:
        text = "CAP_CAPTION";
        break;

      case 0x1002://CAP_FEEDERENABLED:
        text = "CAP_FEEDERENABLED";
        break;

      case 0x1003://CAP_FEEDERLOADED:
        text = "CAP_FEEDERLOADED";
        break;

      case 0x1004://CAP_TIMEDATE:
        text = "CAP_TIMEDATE";
        break;

      case 0x1005://CAP_SUPPORTEDCAPS:
        text = "CAP_SUPPORTEDCAPS";
        break;

      case 0x1006://CAP_EXTENDEDCAPS:
        text = "CAP_EXTENDEDCAPS";
        break;

      case 0x1007://CAP_AUTOFEED:
        text = "CAP_AUTOFEED";
        break;

      case 0x1008://CAP_CLEARPAGE:
        text = "CAP_CLEARPAGE";
        break;

      case 0x1009://CAP_FEEDPAGE:
        text = "CAP_FEEDPAGE";
        break;

      case 0x100a://CAP_REWINDPAGE:
        text = "CAP_REWINDPAGE";
        break;

      case 0x100b://CAP_INDICATORS:
        text = "CAP_INDICATORS";
        break;

      case 0x100c://CAP_SUPPORTEDCAPSEXT:
        text = "CAP_SUPPORTEDCAPSEXT";
        break;

      case 0x100d://CAP_PAPERDETECTABLE:
        text = "CAP_PAPERDETECTABLE";
        break;

      case 0x100e://CAP_UICONTROLLABLE:
        text = "CAP_UICONTROLLABLE";
        break;

      case 0x100f://CAP_DEVICEONLINE:
        text = "CAP_DEVICEONLINE";
        break;

      case 0x1010://CAP_AUTOSCAN:
        text = "CAP_AUTOSCAN";
        break;

      case 0x1011://CAP_THUMBNAILSENABLED:
        text = "CAP_THUMBNAILSENABLED";
        break;

      case 0x1012://CAP_DUPLEX:
        text = "CAP_DUPLEX";
        break;

      case 0x1013://CAP_DUPLEXENABLED:
        text = "CAP_DUPLEXENABLED";
        break;

      case 0x1014://CAP_ENABLEDSUIONLY:
        text = "CAP_ENABLEDSUIONLY";
        break;

      case 0x1015://CAP_CUSTOMDSDATA:
        text = "CAP_CUSTOMDSDATA";
        break;

      case 0x1016://CAP_ENDORSER:
        text = "CAP_ENDORSER";
        break;

      case 0x1017://CAP_JOBCONTROL:
        text = "CAP_JOBCONTROL";
        break;

      case 0x1018://CAP_ALARMS:
        text = "CAP_ALARMS";
        break;

      case 0x1019://CAP_ALARMVOLUME:
        text = "CAP_ALARMVOLUME";
        break;

      case 0x101a://CAP_AUTOMATICCAPTURE:
        text = "CAP_AUTOMATICCAPTURE";
        break;

      case 0x101b://CAP_TIMEBEFOREFIRSTCAPTURE:
        text = "CAP_TIMEBEFOREFIRSTCAPTURE";
        break;

      case 0x101c://CAP_TIMEBETWEENCAPTURES:
        text = "CAP_TIMEBETWEENCAPTURES";
        break;

      case 0x101d://CAP_CLEARBUFFERS:
        text = "CAP_CLEARBUFFERS";
        break;

      case 0x101e://CAP_MAXBATCHBUFFERS:
        text = "CAP_MAXBATCHBUFFERS";
        break;

      case 0x101f://CAP_DEVICETIMEDATE:
        text = "CAP_DEVICETIMEDATE";
        break;

      case 0x1020://CAP_POWERSUPPLY:
        text = "CAP_POWERSUPPLY";
        break;

      case 0x1021://CAP_CAMERAPREVIEWUI:
        text = "CAP_CAMERAPREVIEWUI";
        break;

      case 0x1022://CAP_DEVICEEVENT:
        text = "CAP_DEVICEEVENT";
        break;

      case 0x1024://CAP_SERIALNUMBER:
        text = "CAP_SERIALNUMBER";
        break;

      case 0x1026://CAP_PRINTER:
        text = "CAP_PRINTER";
        break;

      case 0x1027://CAP_PRINTERENABLED:
        text = "CAP_PRINTERENABLED";
        break;

      case 0x1028://CAP_PRINTERINDEX:
        text = "CAP_PRINTERINDEX";
        break;

      case 0x1029://CAP_PRINTERMODE:
        text = "CAP_PRINTERMODE";
        break;

      case 0x102a://CAP_PRINTERSTRING:
        text = "CAP_PRINTERSTRING";
        break;

      case 0x102b://CAP_PRINTERSUFFIX:
        text = "CAP_PRINTERSUFFIX";
        break;

      case 0x102c://CAP_LANGUAGE:
        text = "CAP_LANGUAGE";
        break;

      case 0x102d://CAP_FEEDERALIGNMENT:
        text = "CAP_FEEDERALIGNMENT";
        break;

      case 0x102e://CAP_FEEDERORDER:
        text = "CAP_FEEDERORDER";
        break;

      case 0x1030://CAP_REACQUIREALLOWED:
        text = "CAP_REACQUIREALLOWED";
        break;

      case 0x1032://CAP_BATTERYMINUTES:
        text = "CAP_BATTERYMINUTES";
        break;

      case 0x1033://CAP_BATTERYPERCENTAGE:
        text = "CAP_BATTERYPERCENTAGE";
        break;

      case 0x1034://CAP_CAMERASIDE:
        text = "CAP_CAMERASIDE";
        break;

      case 0x1035://CAP_SEGMENTED:
        text = "CAP_SEGMENTED";
        break;

      case 0x1036://CAP_CAMERAENABLED:
        text = "CAP_CAMERAENABLED";
        break;

      case 0x1037://CAP_CAMERAORDER:
        text = "CAP_CAMERAORDER";
        break;

      case 0x1038://CAP_MICRENABLED:
        text = "CAP_MICRENABLED";
        break;

      case 0x1039://CAP_FEEDERPREP:
        text = "CAP_FEEDERPREP";
        break;

      case 0x103a://CAP_FEEDERPOCKET:
        text = "CAP_FEEDERPOCKET";
        break;

      case 0x103b://CAP_AUTOMATICSENSEMEDIUM:
        text = "CAP_AUTOMATICSENSEMEDIUM";
        break;

      case 0x103c://CAP_CUSTOMINTERFACEGUID:
        text = "CAP_CUSTOMINTERFACEGUID";
        break;

      case 0x1100://ICAP_AUTOBRIGHT:
        text = "ICAP_AUTOBRIGHT";
        break;

      case 0x1101://ICAP_BRIGHTNESS:
        text = "ICAP_BRIGHTNESS";
        break;

      case 0x1103://ICAP_CONTRAST:
        text = "ICAP_CONTRAST";
        break;

      case 0x1104://ICAP_CUSTHALFTONE:
        text = "ICAP_CUSTHALFTONE";
        break;

      case 0x1105://ICAP_EXPOSURETIME:
        text = "ICAP_EXPOSURETIME";
        break;

      case 0x1106://ICAP_FILTER:
        text = "ICAP_FILTER";
        break;

      case 0x1107://ICAP_FLASHUSED:
        text = "ICAP_FLASHUSED";
        break;

      case 0x1108://ICAP_GAMMA:
        text = "ICAP_GAMMA";
        break;

      case 0x1109://ICAP_HALFTONES:
        text = "ICAP_HALFTONES";
        break;

      case 0x110a://ICAP_HIGHLIGHT:
        text = "ICAP_HIGHLIGHT";
        break;

      case 0x110c://ICAP_IMAGEFILEFORMAT:
        text = "ICAP_IMAGEFILEFORMAT";
        break;

      case 0x110d://ICAP_LAMPSTATE:
        text = "ICAP_LAMPSTATE";
        break;

      case 0x110e://ICAP_LIGHTSOURCE:
        text = "ICAP_LIGHTSOURCE";
        break;

      case 0x1110://ICAP_ORIENTATION:
        text = "ICAP_ORIENTATION";
        break;

      case 0x1111://ICAP_PHYSICALWIDTH:
        text = "ICAP_PHYSICALWIDTH";
        break;

      case 0x1112://ICAP_PHYSICALHEIGHT:
        text = "ICAP_PHYSICALHEIGHT";
        break;

      case 0x1113://ICAP_SHADOW:
        text = "ICAP_SHADOW";
        break;

      case 0x1114://ICAP_FRAMES:
        text = "ICAP_FRAMES";
        break;

      case 0x1116://ICAP_XNATIVERESOLUTION:
        text = "ICAP_XNATIVERESOLUTION";
        break;

      case 0x1117://ICAP_YNATIVERESOLUTION:
        text = "ICAP_YNATIVERESOLUTION";
        break;

      case 0x1118://ICAP_XRESOLUTION:
        text = "ICAP_XRESOLUTION";
        break;

      case 0x1119://ICAP_YRESOLUTION:
        text = "ICAP_YRESOLUTION";
        break;

      case 0x111a://ICAP_MAXFRAMES:
        text = "ICAP_MAXFRAMES";
        break;

      case 0x111b://ICAP_TILES:
        text = "ICAP_TILES";
        break;

      case 0x111c://ICAP_BITORDER:
        text = "ICAP_BITORDER";
        break;

      case 0x111d://ICAP_CCITTKFACTOR:
        text = "ICAP_CCITTKFACTOR";
        break;

      case 0x111e://ICAP_LIGHTPATH:
        text = "ICAP_LIGHTPATH";
        break;

      case 0x111f://ICAP_PIXELFLAVOR:
        text = "ICAP_PIXELFLAVOR";
        break;

      case 0x1120://ICAP_PLANARCHUNKY:
        text = "ICAP_PLANARCHUNKY";
        break;

      case 0x1121://ICAP_ROTATION:
        text = "ICAP_ROTATION";
        break;

      case 0x1122://ICAP_SUPPORTEDSIZES:
        text = "ICAP_SUPPORTEDSIZES";
        break;

      case 0x1123://ICAP_THRESHOLD:
        text = "ICAP_THRESHOLD";
        break;

      case 0x1124://ICAP_XSCALING:
        text = "ICAP_XSCALING";
        break;

      case 0x1125://ICAP_YSCALING:
        text = "ICAP_YSCALING";
        break;

      case 0x1126://ICAP_BITORDERCODES:
        text = "ICAP_BITORDERCODES";
        break;

      case 0x1127://ICAP_PIXELFLAVORCODES:
        text = "ICAP_PIXELFLAVORCODES";
        break;

      case 0x1128://ICAP_JPEGPIXELTYPE:
        text = "ICAP_JPEGPIXELTYPE";
        break;

      case 0x112a://ICAP_TIMEFILL:
        text = "ICAP_TIMEFILL";
        break;

      case 0x112b://ICAP_BITDEPTH:
        text = "ICAP_BITDEPTH";
        break;

      case 0x112c://ICAP_BITDEPTHREDUCTION:
        text = "ICAP_BITDEPTHREDUCTION";
        break;

      case 0x112d://ICAP_UNDEFINEDIMAGESIZE:
        text = "ICAP_UNDEFINEDIMAGESIZE";
        break;

      case 0x112e://ICAP_IMAGEDATASET:
        text = "ICAP_IMAGEDATASET";
        break;

      case 0x112f://ICAP_EXTIMAGEINFO:
        text = "ICAP_EXTIMAGEINFO";
        break;

      case 0x1130://ICAP_MINIMUMHEIGHT:
        text = "ICAP_MINIMUMHEIGHT";
        break;

      case 0x1131://ICAP_MINIMUMWIDTH:
        text = "ICAP_MINIMUMWIDTH";
        break;

      case 0x1136://ICAP_FLIPROTATION:
        text = "ICAP_FLIPROTATION";
        break;

      case 0x1137://ICAP_BARCODEDETECTIONENABLED:
        text = "ICAP_BARCODEDETECTIONENABLED";
        break;

      case 0x1138://ICAP_SUPPORTEDBARCODETYPES:
        text = "ICAP_SUPPORTEDBARCODETYPES";
        break;

      case 0x1139://ICAP_BARCODEMAXSEARCHPRIORITIES:
        text = "ICAP_BARCODEMAXSEARCHPRIORITIES";
        break;

      case 0x113a://ICAP_BARCODESEARCHPRIORITIES:
        text = "ICAP_BARCODESEARCHPRIORITIES";
        break;

      case 0x113b://ICAP_BARCODESEARCHMODE:
        text = "ICAP_BARCODESEARCHMODE";
        break;

      case 0x113c://ICAP_BARCODEMAXRETRIES:
        text = "ICAP_BARCODEMAXRETRIES";
        break;

      case 0x113d://ICAP_BARCODETIMEOUT:
        text = "ICAP_BARCODETIMEOUT";
        break;

      case 0x113e://ICAP_ZOOMFACTOR:
        text = "ICAP_ZOOMFACTOR";
        break;

      case 0x113f://ICAP_PATCHCODEDETECTIONENABLED:
        text = "ICAP_PATCHCODEDETECTIONENABLED";
        break;

      case 0x1140://ICAP_SUPPORTEDPATCHCODETYPES:
        text = "ICAP_SUPPORTEDPATCHCODETYPES";
        break;

      case 0x1141://ICAP_PATCHCODEMAXSEARCHPRIORITIES:
        text = "ICAP_PATCHCODEMAXSEARCHPRIORITIES";
        break;

      case 0x1142://ICAP_PATCHCODESEARCHPRIORITIES:
        text = "ICAP_PATCHCODESEARCHPRIORITIES";
        break;

      case 0x1143://ICAP_PATCHCODESEARCHMODE:
        text = "ICAP_PATCHCODESEARCHMODE";
        break;

      case 0x1144://ICAP_PATCHCODEMAXRETRIES:
        text = "ICAP_PATCHCODEMAXRETRIES";
        break;

      case 0x1145://ICAP_PATCHCODETIMEOUT:
        text = "ICAP_PATCHCODETIMEOUT";
        break;

      case 0x1146://ICAP_FLASHUSED2:
        text = "ICAP_FLASHUSED2";
        break;

      case 0x1147://ICAP_IMAGEFILTER:
        text = "ICAP_IMAGEFILTER";
        break;

      case 0x1148://ICAP_NOISEFILTER:
        text = "ICAP_NOISEFILTER";
        break;

      case 0x1149://ICAP_OVERSCAN:
        text = "ICAP_OVERSCAN";
        break;

      case 0x1150://ICAP_AUTOMATICBORDERDETECTION:
        text = "ICAP_AUTOMATICBORDERDETECTION";
        break;

      case 0x1151://ICAP_AUTOMATICDESKEW:
        text = "ICAP_AUTOMATICDESKEW";
        break;

      case 0x1152://ICAP_AUTOMATICROTATE:
        text = "ICAP_AUTOMATICROTATE";
        break;

      case 0x1153://ICAP_JPEGQUALITY:
        text = "ICAP_JPEGQUALITY";
        break;

      case 0x1154://ICAP_FEEDERTYPE:
        text = "ICAP_FEEDERTYPE";
        break;

      case 0x1155://ICAP_ICCPROFILE:
        text = "ICAP_ICCPROFILE";
        break;

      case 0x1156://ICAP_AUTOSIZE:
        text = "ICAP_AUTOSIZE";
        break;

      case 0x1157://ICAP_AUTOMATICCROPUSESFRAME:
        text = "ICAP_AUTOMATICCROPUSESFRAME";
        break;

      case 0x1158://ICAP_AUTOMATICLENGTHDETECTION:
        text = "ICAP_AUTOMATICLENGTHDETECTION";
        break;

      case 0x1159://ICAP_AUTOMATICCOLORENABLED:
        text = "ICAP_AUTOMATICCOLORENABLED";
        break;

      case 0x115a://ICAP_AUTOMATICCOLORNONCOLORPIXELTYPE:
        text = "ICAP_AUTOMATICCOLORNONCOLORPIXELTYPE";
        break;

      case 0x115b://ICAP_COLORMANAGEMENTENABLED:
        text = "ICAP_COLORMANAGEMENTENABLED";
        break;

      case 0x115c://ICAP_IMAGEMERGE:
        text = "ICAP_IMAGEMERGE";
        break;

      case 0x115d://ICAP_IMAGEMERGEHEIGHTTHRESHOLD:
        text = "ICAP_IMAGEMERGEHEIGHTTHRESHOLD";
        break;

      case 0x115e://ICAP_SUPPORTEDEXTIMAGEINFO:
        text = "ICAP_SUPPORTEDEXTIMAGEINFO";
        break;

      case 0x1201://ACAP_AUDIOFILEFORMAT:
        text = "ACAP_AUDIOFILEFORMAT";
        break;

      case 0x1202://ACAP_XFERMECH:
        text = "ACAP_XFERMECH";
        break;

      default:
        {
          if(item < CAP_CUSTOMBASE)
          {
            text = "Unknown CAP " + item;
          }
          else if (item > CAP_CUSTOMBASE)
          {
            text = "Custom CAP " + item;
          }
          else // == CAP_CUSTOMBASE
          {
            text = "Invalid CAP " + item;
          }
        }
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert CAP_FEEDERALIGNMENT values to String
STwainP.__convertCAP_FEEDERALIGNMENT_toString = function (item){
  var text = "";

  switch(item)
  {
	case EnumDWT_CapFeederAlignment.TWFA_NONE:
    text = "None";
    break;

	case EnumDWT_CapFeederAlignment.TWFA_LEFT:
    text = "Left";
    break;

	case EnumDWT_CapFeederAlignment.TWFA_CENTER:
    text = "Center";
    break;

	case EnumDWT_CapFeederAlignment.TWFA_RIGHT:
    text = "Right";
    break;

  default:
    text = "Unknown TWFA " + item;
    break;
  }

  return text;
}

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_FEEDERTYPE values to String
    STwainP.__convertICAP_FEEDERTYPE_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWFE_GENERAL:
        text = "General";
        break;

	    case 1://TWFE_PHOTO:
        text = "Photo";
        break;

      default:
        text = "Unknown TWFE " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Cover ICAP_IMAGEFILEFORMAT values to String
    STwainP.__convertICAP_IMAGEFILEFORMAT_toString = function (item){
      var text = "";

      switch(item)
      {
      case EnumDWT_FileFormat.TWFF_TIFF:
        text = "tiff";
        break;

      case EnumDWT_FileFormat.TWFF_PICT:
        text = "pict";
        break;

      case EnumDWT_FileFormat.TWFF_BMP:
        text = "bmp";
        break;

      case EnumDWT_FileFormat.TWFF_XBM:
        text = "xbm";
        break;

      case EnumDWT_FileFormat.TWFF_JFIF:
        text = "jpeg";
        break;

      case EnumDWT_FileFormat.TWFF_FPX:
        text = "fpx";
        break;

      case EnumDWT_FileFormat.TWFF_TIFFMULTI:
        text = "multi image tiff";
        break;

      case EnumDWT_FileFormat.TWFF_PNG:
        text = "png";
        break;

      case EnumDWT_FileFormat.TWFF_SPIFF:
        text = "spiff";
        break;

      case EnumDWT_FileFormat.TWFF_EXIF:
        text = "exif";
        break;

      case EnumDWT_FileFormat.TWFF_PDF:
        text = "PDF";
        break;

      case EnumDWT_FileFormat.TWFF_JP2:
        text = "JP2";
        break;

      case EnumDWT_FileFormat.TWFF_JPN:
        text = "JPN";
        break;

      case EnumDWT_FileFormat.TWFF_JPX:
        text = "JPX";
        break;

      case EnumDWT_FileFormat.TWFF_DEJAVU:
        text = "DEJAVU";
        break;

      case EnumDWT_FileFormat.TWFF_PDFA:
        text = "PDF-A1";// 2.0 Adobe PDF/A, Version 1
        break;

      case EnumDWT_FileFormat.TWFF_PDFA2:
        text = "PDF-A2";// 2.1 Adobe PDF/A, Version 2
        break;

      default:
        text = "Unknown TWFF " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_FLASHUSED2 values to String
    STwainP.__convertICAP_FLASHUSED2_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapFlash.TWFL_NONE:
        text = "None";
        break;

	    case EnumDWT_CapFlash.TWFL_OFF:
        text = "Off";
        break;

	    case EnumDWT_CapFlash.TWFL_ON:
        text = "On";
        break;

	    case EnumDWT_CapFlash.TWFL_AUTO:
        text = "Auto";
        break;

	    case EnumDWT_CapFlash.TWFL_REDEYE:
        text = "Redeye";
        break;

      default:
        text = "Unknown TWFL " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert CAP_FEEDERORDER values to String
    STwainP.__convertCAP_FEEDERORDER_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapFeederOrder.TWFO_FIRSTPAGEFIRST:
        text = "First Page First";
        break;

	    case EnumDWT_CapFeederOrder.TWFO_LASTPAGEFIRST:
        text = "Last Page First";
        break;

      default:
        text = "Unknown TWFO " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert CAP_FEEDERPOCKET values to String
    STwainP.__convertCAP_FEEDERPOCKET_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWFP_POCKETERROR:
        text = "Pocket Error";
        break;

	    case 1://TWFP_POCKET1:
        text = "Pocket 1";
        break;

	    case 2://TWFP_POCKET2:
        text = "Pocket 2";
        break;

	    case 3://TWFP_POCKET3:
        text = "Pocket 3";
        break;

	    case 4://TWFP_POCKET4:
        text = "Pocket 4";
        break;

	    case 5://TWFP_POCKET5:
        text = "Pocket 5";
        break;

	    case 6://TWFP_POCKET6:
        text = "Pocket 6";
        break;

	    case 7://TWFP_POCKET7:
        text = "Pocket 7";
        break;

	    case 8://TWFP_POCKET8:
        text = "Pocket 8";
        break;

	    case 9://TWFP_POCKET9:
        text = "Pocket 9";
        break;

	    case 10://TWFP_POCKET10:
        text = "Pocket 10";
        break;

	    case 11://TWFP_POCKET11:
        text = "Pocket 11";
        break;

	    case 12://TWFP_POCKET12:
        text = "Pocket 12";
        break;

	    case 13://TWFP_POCKET13:
        text = "Pocket 13";
        break;

	    case 14://TWFP_POCKET14:
        text = "Pocket 14";
        break;

	    case 15://TWFP_POCKET15:
        text = "Pocket 15";
        break;

	    case 16://TWFP_POCKET16:
        text = "Pocket 16";
        break;

      default:
        text = "Unknown TWFP " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_FLIPROTATION values to String
    STwainP.__convertICAP_FLIPROTATION_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapFlipRotation.TWFR_BOOK:
        text = "Book";
        break;

	    case EnumDWT_CapFlipRotation.TWFR_FANFOLD:
        text = "Fanfold";
        break;

      default:
        text = "Unknown TWFR " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_FILTER values to String
    STwainP.__convertICAP_FILTER_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapFilterType.TWFT_RED:
        text = "Red";
        break;

	    case EnumDWT_CapFilterType.TWFT_GREEN:
        text = "Green";
        break;

	    case EnumDWT_CapFilterType.TWFT_BLUE:
        text = "Blue";
        break;

	    case EnumDWT_CapFilterType.TWFT_NONE:
        text = "None";
        break;

	    case EnumDWT_CapFilterType.TWFT_WHITE:
        text = "White";
        break;

	    case EnumDWT_CapFilterType.TWFT_CYAN:
        text = "Cyan";
        break;

	    case EnumDWT_CapFilterType.TWFT_MAGENTA:
        text = "Magenta";
        break;

	    case EnumDWT_CapFilterType.TWFT_YELLOW:
        text = "Yellow";
        break;

	    case EnumDWT_CapFilterType.TWFT_BLACK:
        text = "Black";
        break;

      default:
        text = "Unknown TWFT " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_ICCPROFILE values to String
    STwainP.__convertICAP_ICCPROFILE_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWIC_NONE:
        text = "None";
        break;

	    case 1://TWIC_LINK:
        text = "Link";
        break;

	    case 2://TWIC_EMBED:
        text = "Embed";
        break;

      default:
        text = "Unknown TWIC " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_IMAGEFILTER values to String
    STwainP.__convertICAP_IMAGEFILTER_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapImageFilter.TWIF_NONE:
        text = "None";
        break;

	    case EnumDWT_CapImageFilter.TWIF_AUTO:
        text = "Auto";
        break;

	    case EnumDWT_CapImageFilter.TWIF_LOWPASS:
        text = "Low Pass";
        break;

	    case EnumDWT_CapImageFilter.TWIF_BANDPASS:
        text = "Band Pass";
        break;

	    case EnumDWT_CapImageFilter.TWIF_HIGHPASS:
        text = "High Pass";
        break;

      default:
        text = "Unknown TWIF " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_IMAGEMERGE values to String
    STwainP.__convertICAP_IMAGEMERGE_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWIM_NONE:
        text = "None";
        break;

	    case 1://TWIM_FRONTONTOP:
        text = "Front on Top";
        break;

	    case 2://TWIM_FRONTONBOTTOM:
        text = "Front on Bottom";
        break;

	    case 3://TWIM_FRONTONLEFT:
        text = "Front on Left";
        break;

	    case 4://TWIM_FRONTONRIGHT:
        text = "Front on Right";
        break;

      default:
        text = "Unknown TWIM " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert CAP_JOBCONTROL values to String
    STwainP.__convertCAP_JOBCONTROL_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWJC_NONE:
        text = "None";
        break;

	    case 1://TWJC_JSIC:
        text = "JSIC";
        break;

	    case 2://TWJC_JSIS:
        text = "JSIS";
        break;

	    case 3://TWJC_JSXC:
        text = "JSXC";
        break;

	    case 4://TWJC_JSXS:
        text = "JSXS";
        break;

      default:
        text = "Unknown TWJC " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_JPEGQUALITY values to String
    STwainP.__convertICAP_JPEGQUALITY_toString = function (item){
      var text = "";

      switch(item)
      {
	    case -4://TWJQ_UNKNOWN:
        text = "Unknown";
        break;

	    case -3://TWJQ_LOW:
        text = "Low";
        break;

	    case -2://TWJQ_MEDIUM:
        text = "Medium";
        break;

	    case -1://TWJQ_HIGH:
        text = "High";
        break;

      default:
        text = "Unknown TWJC " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_LIGHTPATH values to String
    STwainP.__convertICAP_LIGHTPATH_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapLightPath.TWLP_REFLECTIVE:
        text = "Reflective";
        break;

	    case EnumDWT_CapLightPath.TWLP_TRANSMISSIVE:
        text = "Transmissive";
        break;

      default:
        text = "Unknown TWLP " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_LIGHTSOURCE values to String
    STwainP.__convertICAP_LIGHTSOURCE_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapLightSource.TWLS_RED:
        text = "Red";
        break;

	    case EnumDWT_CapLightSource.TWLS_GREEN:
        text = "Green";
        break;

	    case EnumDWT_CapLightSource.TWLS_BLUE:
        text = "Blue";
        break;

	    case EnumDWT_CapLightSource.TWLS_NONE:
        text = "None";
        break;

	    case EnumDWT_CapLightSource.TWLS_WHITE:
        text = "White";
        break;

	    case EnumDWT_CapLightSource.TWLS_UV:
        text = "UV";
        break;

	    case EnumDWT_CapLightSource.TWLS_IR:
        text = "IR";
        break;

      default:
        text = "Unknown TWLS " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_NOISEFILTER values to String
    STwainP.__convertICAP_NOISEFILTER_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapNoiseFilter.TWNF_NONE:
        text = "None";
        break;

	    case EnumDWT_CapNoiseFilter.TWNF_AUTO:
        text = "Auto";
        break;

	    case EnumDWT_CapNoiseFilter.TWNF_LONEPIXEL:
        text = "Low Pixel";
        break;

	    case EnumDWT_CapNoiseFilter.TWNF_MAJORITYRULE:
        text = "Majoriry Rule";
        break;

      default:
        text = "Unknown TWNF " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_ORIENTATION values to String
    STwainP.__convertICAP_ORIENTATION_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapORientation.TWOR_ROT0:
        text = "Orientation 0";
        break;

	    case EnumDWT_CapORientation.TWOR_ROT90:
        text = "Orientation 90";
        break;

	    case EnumDWT_CapORientation.TWOR_ROT180:
        text = "Orientation 180";
        break;

	    case EnumDWT_CapORientation.TWOR_ROT270:
        text = "Orientation 270";
        break;

	    case EnumDWT_CapORientation.TWOR_PORTRAIT:
        text = "Portrait";
        break;

	    case EnumDWT_CapORientation.TWOR_LANDSCAPE:
        text = "Landscape";
        break;

	    case EnumDWT_CapORientation.TWOR_AUTO:
        text = "Auto";
        break;

	    case EnumDWT_CapORientation.TWOR_AUTOTEXT:
        text = "Auto Text";
        break;

	    case EnumDWT_CapORientation.TWOR_AUTOPICTURE:
        text = "Auto Picture";
        break;

      default:
        text = "Unknown TWOR " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_OVERSCAN values to String
    STwainP.__convertICAP_OVERSCAN_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapOverscan.TWOV_NONE:
        text = "None";
        break;

	    case EnumDWT_CapOverscan.TWOV_AUTO:
        text = "Auto";
        break;

	    case EnumDWT_CapOverscan.TWOV_TOPBOTTOM:
        text = "Top Bottom";
        break;

	    case EnumDWT_CapOverscan.TWOV_LEFTRIGHT:
        text = "Left Right";
        break;

	    case EnumDWT_CapOverscan.TWOV_ALL:
        text = "All";
        break;

      default:
        text = "Unknown TWOV " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_PLANARCHUNKY values to String
    STwainP.__convertICAP_PLANARCHUNKY_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapPlanarChunky.TWPC_CHUNKY:
        text = "Chunky";
        break;

	    case EnumDWT_CapPlanarChunky.TWPC_PLANAR:
        text = "Planar";
        break;

      default:
        text = "Unknown TWPC " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_PIXELFLAVOR values to String
    STwainP.__convertICAP_PIXELFLAVOR_toString = function (item){
      var text = "";

      switch(item)
      {
      case EnumDWT_CapPixelFlavor.TWPF_CHOCOLATE:
        text = "Chocolate";
        break;

      case EnumDWT_CapPixelFlavor.TWPF_VANILLA:
        text = "Vanilla";
        break;

      default:
        text = "Unknown TWPF " + item;
        break;
      }

      return text;
    }


//////////////////////////////////////////////////////////////////////////////
// Convert CAP_PRINTERMODE values to String
    STwainP.__convertCAP_PRINTERMODE_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapPrinterMode.TWPM_SINGLESTRING:
        text = "Single String";
        break;

	    case EnumDWT_CapPrinterMode.TWPM_MULTISTRING:
        text = "Multi String";
        break;

	    case EnumDWT_CapPrinterMode.TWPM_COMPOUNDSTRING:
        text = "Compound String";
        break;

      default:
        text = "Unknown TWPM " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert CAP_PRINTER values to String
    STwainP.__convertCAP_PRINTER_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapPrinter.TWPR_IMPRINTERTOPBEFORE:
        text = "Imprinter Top Before";
        break;

	    case EnumDWT_CapPrinter.TWPR_IMPRINTERTOPAFTER:
        text = "Imprinter Top After";
        break;

	    case EnumDWT_CapPrinter.TWPR_IMPRINTERBOTTOMBEFORE:
        text = "Imprinter Bottom Before";
        break;

	    case EnumDWT_CapPrinter.TWPR_IMPRINTERBOTTOMAFTER:
        text = "Imprinter Bottom After";
        break;

	    case EnumDWT_CapPrinter.TWPR_ENDORSERTOPBEFORE:
        text = "Endorser Top Before";
        break;

	    case EnumDWT_CapPrinter.TWPR_ENDORSERTOPAFTER:
        text = "Endorser Top After";
        break;

	    case EnumDWT_CapPrinter.TWPR_ENDORSERBOTTOMBEFORE:
        text = "Endorser Bottom Before";
        break;

	    case EnumDWT_CapPrinter.TWPR_ENDORSERBOTTOMAFTER:
        text = "Endorser Bottom After";
        break;

      default:
        text = "Unknown TWPR " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert CAP_POWERSUPPLY values to String
    STwainP.__convertCAP_POWERSUPPLY_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWPS_EXTERNAL:
        text = "External";
        break;

	    case 1://TWPS_BATTERY:
        text = "Battery";
        break;

      default:
        text = "Unknown TWPS " + item;
        break;
      }

      return text;
    }
    
    
//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_PIXELTYPE values to String
  STwainP.__convertICAP_PIXELTYPE_toString = function (item){
      var text = "";

      switch(item)
      {
          case EnumDWT_PixelType.TWPT_BW:
            text = "Black & White";//"BW";
            break;

          case EnumDWT_PixelType.TWPT_GRAY:
            text = "Grayscale";//"GRAY";
            break;

          case EnumDWT_PixelType.TWPT_RGB:
            text = "RGB";
            break;

          case EnumDWT_PixelType.TWPT_PALLETE:
            text = "Palette";//"PALETTE";
            break;

          case EnumDWT_PixelType.TWPT_CMY:
            text = "CMY";
            break;

          case EnumDWT_PixelType.TWPT_CMYK:
            text = "CMYK";
            break;

          case EnumDWT_PixelType.TWPT_YUV:
            text = "YUV";
            break;

          case EnumDWT_PixelType.TWPT_YUVK:
            text = "YUVK";
            break;

          case EnumDWT_PixelType.TWPT_CIEXYZ:
            text = "CIEXYZ";
            break;
            
          case EnumDWT_PixelType.TWPT_LAB:
            text = "LAB";
            break;

          case EnumDWT_PixelType.TWPT_SRGB:
            text = "SRGB";
            break;

          case EnumDWT_PixelType.TWPT_SCRGB:
            text = "SCRGB";
            break;
            
          case EnumDWT_PixelType.TWPT_INFRARED:
            text = "INFRARED";
            break;

          default:
            text = "Unknown TWPT " + item;
            break;
          }

         return text;
    }
    
    //////////////////////////////////////////////////////////////////////////////
// Convert CAP_SEGMENTED values to String
    STwainP.__convertCAP_SEGMENTED_toString = function (item){
      var text = "";

      switch(item)
      {
	    case 0://TWSG_NONE:
        text = "None";
        break;

	    case 1://TWSG_AUTO:
        text = "Auto";
        break;

      default:
        text = "Unknown TWSG " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert Extended Image Info Attributes to String

    STwainP.__convertExtImageInfoName_toString = function (item){
      var text = "";

      switch(item)
      {
      case 0x1200://TWEI_BARCODEX:
        text = "TWEI_BARCODEX";
        break;

      case 0x1201://TWEI_BARCODEY:
        text = "TWEI_BARCODEY";
        break;

	    case 0x1202://TWEI_BARCODETEXT:
        text = "TWEI_BARCODETEXT";
        break;

	    case 0x1203://TWEI_BARCODETYPE:
        text = "TWEI_BARCODETYPE";
        break;

	    case 0x1204://TWEI_DESHADETOP:
        text = "TWEI_DESHADETOP";
        break;

	    case 0x1205://TWEI_DESHADELEFT:
        text = "TWEI_DESHADELEFT";
        break;

	    case 0x1206://TWEI_DESHADEHEIGHT:
        text = "TWEI_DESHADEHEIGHT";
        break;

	    case 0x1207://TWEI_DESHADEWIDTH:
        text = "TWEI_DESHADEWIDTH";
        break;

	    case 0x1208://TWEI_DESHADESIZE:
        text = "TWEI_DESHADESIZE";
        break;

	    case 0x1209://TWEI_SPECKLESREMOVED:
        text = "TWEI_SPECKLESREMOVED";
        break;

	    case 0x120A://TWEI_HORZLINEXCOORD:
        text = "TWEI_HORZLINEXCOORD";
        break;

	    case 0x120B://TWEI_HORZLINEYCOORD:
        text = "TWEI_HORZLINEYCOORD";
        break;

	    case 0x120C://TWEI_HORZLINELENGTH:
        text = "TWEI_HORZLINELENGTH";
        break;

	    case 0x120D://TWEI_HORZLINETHICKNESS:
        text = "TWEI_HORZLINETHICKNESS";
        break;

	    case 0x120E://TWEI_VERTLINEXCOORD:
        text = "TWEI_VERTLINEXCOORD";
        break;

	    case 0x120F://TWEI_VERTLINEYCOORD:
        text = "TWEI_VERTLINEYCOORD";
        break;

	    case 0x1210://TWEI_VERTLINELENGTH:
        text = "TWEI_VERTLINELENGTH";
        break;

	    case 0x1211://TWEI_VERTLINETHICKNESS:
        text = "TWEI_VERTLINETHICKNESS";
        break;

	    case 0x1212://TWEI_PATCHCODE:
        text = "TWEI_PATCHCODE";
        break;

	    case 0x1213://TWEI_ENDORSEDTEXT:
        text = "TWEI_ENDORSEDTEXT";
        break;

	    case 0x1215://TWEI_FORMCONFIDENCE:
        text = "TWEI_FORMCONFIDENCE";
        break;

	    case 0x1215://TWEI_FORMTEMPLATEMATCH:
        text = "TWEI_FORMTEMPLATEMATCH";
        break;

	    case 0x1216://TWEI_FORMTEMPLATEPAGEMATCH:
        text = "TWEI_FORMTEMPLATEPAGEMATCH";
        break;

	    case 0x1217://TWEI_FORMHORZDOCOFFSET:
        text = "TWEI_FORMHORZDOCOFFSET";
        break;

	    case 0x1218://TWEI_FORMVERTDOCOFFSET:
        text = "TWEI_FORMVERTDOCOFFSET";
        break;

	    case 0x1219://TWEI_BARCODECOUNT:
        text = "TWEI_BARCODECOUNT";
        break;

	    case 0x121A://TWEI_BARCODECONFIDENCE:
        text = "TWEI_BARCODECONFIDENCE";
        break;

	    case 0x121B://TWEI_BARCODEROTATION:
        text = "TWEI_BARCODEROTATION";
        break;

	    case 0x121C://TWEI_BARCODETEXTLENGTH:
        text = "TWEI_BARCODETEXTLENGTH";
        break;

	    case 0x121D://TWEI_DESHADECOUNT:
        text = "TWEI_DESHADECOUNT";
        break;

	    case 0x121E://TWEI_DESHADEBLACKCOUNTOLD:
        text = "TWEI_DESHADEBLACKCOUNTOLD";
        break;

	    case 0x121F://TWEI_DESHADEBLACKCOUNTNEW:
        text = "TWEI_DESHADEBLACKCOUNTNEW";
        break;

	    case 0x1220://TWEI_DESHADEBLACKRLMIN:
        text = "TWEI_DESHADEBLACKRLMIN";
        break;

	    case 0x1221://TWEI_DESHADEBLACKRLMAX:
        text = "TWEI_DESHADEBLACKRLMAX";
        break;

	    case 0x1222://TWEI_DESHADEWHITECOUNTOLD:
        text = "TWEI_DESHADEWHITECOUNTOLD";
        break;

	    case 0x1223://TWEI_DESHADEWHITECOUNTNEW:
        text = "TWEI_DESHADEWHITECOUNTNEW";
        break;

	    case 0x1224://TWEI_DESHADEWHITERLMIN:
        text = "TWEI_DESHADEWHITERLMIN";
        break;

	    case 0x1225://TWEI_DESHADEWHITERLAVE:
        text = "TWEI_DESHADEWHITERLAVE";
        break;

	    case 0x1226://TWEI_DESHADEWHITERLMAX:
        text = "TWEI_DESHADEWHITERLMAX";
        break;

	    case 0x1227://TWEI_BLACKSPECKLESREMOVED:
        text = "TWEI_BLACKSPECKLESREMOVED";
        break;

	    case 0x1228://TWEI_WHITESPECKLESREMOVED:
        text = "TWEI_WHITESPECKLESREMOVED";
        break;

	    case 0x1229://TWEI_HORZLINECOUNT:
        text = "TWEI_HORZLINECOUNT";
        break;

	    case 0x122A://TWEI_VERTLINECOUNT:
        text = "TWEI_VERTLINECOUNT";
        break;

	    case 0x122B://TWEI_DESKEWSTATUS:
        text = "TWEI_DESKEWSTATUS";
        break;

	    case 0x122C://TWEI_SKEWORIGINALANGLE:
        text = "TWEI_SKEWORIGINALANGLE";
        break;

	    case 0x122D://TWEI_SKEWFINALANGLE:
        text = "TWEI_SKEWFINALANGLE";
        break;

	    case 0x122E://TWEI_SKEWCONFIDENCE:
        text = "TWEI_SKEWCONFIDENCE";
        break;

	    case 0x122F://TWEI_SKEWWINDOWX1:
        text = "TWEI_SKEWWINDOWX1";
        break;

	    case 0x1230://TWEI_SKEWWINDOWY1:
        text = "TWEI_SKEWWINDOWY1";
        break;

	    case 0x1231://TWEI_SKEWWINDOWX2:
        text = "TWEI_SKEWWINDOWX2";
        break;

	    case 0x1232://TWEI_SKEWWINDOWY2:
        text = "TWEI_SKEWWINDOWY2";
        break;

	    case 0x1233://TWEI_SKEWWINDOWX3:
        text = "TWEI_SKEWWINDOWX3";
        break;

	    case 0x1234://TWEI_SKEWWINDOWY3:
        text = "TWEI_SKEWWINDOWY3";
        break;

	    case 0x1235://TWEI_SKEWWINDOWX4:
        text = "TWEI_SKEWWINDOWX4";
        break;

	    case 0x1236://TWEI_SKEWWINDOWY4:
        text = "TWEI_SKEWWINDOWY4";
        break;

	    case 0x1238://TWEI_BOOKNAME:
        text = "TWEI_BOOKNAME";
        break;

	    case 0x1239://TWEI_CHAPTERNUMBER:
        text = "TWEI_CHAPTERNUMBER";
        break;

	    case 0x123A://TWEI_DOCUMENTNUMBER:
        text = "TWEI_DOCUMENTNUMBER";
        break;

	    case 0x123B://TWEI_PAGENUMBER:
        text = "TWEI_PAGENUMBER";
        break;

	    case 0x123C://TWEI_CAMERA:
        text = "TWEI_CAMERA";
        break;

	    case 0x123D://TWEI_FRAMENUMBER:
        text = "TWEI_FRAMENUMBER";
        break;

	    case 0x123E://TWEI_FRAME:
        text = "TWEI_FRAME";
        break;

	    case 0x123F://TWEI_PIXELFLAVOR:
        text = "TWEI_PIXELFLAVOR";
        break;

	    case 0x1245://TWEI_PAGESIDE:
        text = "TWEI_PAGESIDE";
        break;

	    case 0x1243://TWEI_MAGDATA:
        text = "TWEI_MAGDATA";
        break;

	    case 0x1244://TWEI_MAGTYPE:
        text = "TWEI_MAGTYPE";
        break;

      default:
        text = "ExtImageInfo ID " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Convert ICAP_SUPPORTEDSIZES values to String
    STwainP.__convertICAP_SUPPORTEDSIZES_toString = function (item){
      var text = "";

      switch(item)
      {
	    case EnumDWT_CapSupportedSizes.TWSS_NONE:
        text = "None";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A4:
        text = "A4";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB5:
        text = "JIS B5";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_USLETTER:
        text = "US Letter";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_USLEGAL:
        text = "US Legal";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A5:
        text = "A5";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB4:
        text = "ISO B4";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB6:
        text = "ISO B6";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_USLEDGER:
        text = "US Ledger";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_USEXECUTIVE:
        text = "US Executive";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A3:
        text = "A3";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB3:
        text = "ISO B3";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A6:
        text = "A6";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C4:
        text = "C4";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C5:
        text = "C5";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C6:
        text = "C6";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_4A0:
        text = "4A0";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_2A0:
        text = "2A0";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A0:
        text = "A0";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A1:
        text = "A1";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A2:
        text = "A2";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A7:
        text = "A7";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A8:
        text = "A8";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A9:
        text = "A9";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_A10:
        text = "A10";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB0:
        text = "ISO B0";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB1:
        text = "ISO B1";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB2:
        text = "ISO B2";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB5:
        text = "ISO B5";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB7:
        text = "ISO B7";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB8:
        text = "ISO B8";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB9:
        text = "ISO B9";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_ISOB10:
        text = "ISO B10";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB0:
        text = "JIS B0";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB1:
        text = "JIS B1";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB2:
        text = "JIS B2";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB3:
        text = "JIS B3";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB4:
        text = "JIS B4";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB6:
        text = "JIS B6";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB7:
        text = "JIS B7";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB8:
        text = "JIS B8";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB9:
        text = "JIS B9";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_JISB10:
        text = "JIS B10";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C0:
        text = "C0";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C1:
        text = "C1";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C2:
        text = "C2";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C3:
        text = "C3";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C7:
        text = "C7";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C8:
        text = "C8";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C9:
        text = "C9";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_C10:
        text = "C10";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_USSTATEMENT:
        text = "US Statement";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_BUSINESSCARD:
        text = "Business Card";
        break;

	    case EnumDWT_CapSupportedSizes.TWSS_MAXSIZE:
        text = "MAX size";
        break;

      default:
        text = "Unknown TWSS " + item;
        break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Covert ICAP_XFERMECH values to String
    STwainP.__convertICAP_XFERMECH_toString = function (item){
      var text = "";

      switch(item)
      {
          case EnumDWT_TransferMode.TWSX_NATIVE:
            text = "Native";
            break;

          case EnumDWT_TransferMode.TWSX_FILE:
            text = "File";
            break;

          case EnumDWT_TransferMode.TWSX_MEMORY:
            text = "Memory";
            break;

          case EnumDWT_TransferMode.TWSX_MEMFILE:
            text = "Memory of File";
            break;

          default:
            text = "Unknown TWSX " + item;
            break;
      }

      return text;
    }

//////////////////////////////////////////////////////////////////////////////
// Covert ICAP_UNITS values to String
    STwainP.__convertICAP_UNITS_toString = function (item){
      var text = "";

      switch(item)
      {
          case EnumDWT_UnitType.TWUN_INCHES:
            text = "Inches";
            break;

          case EnumDWT_UnitType.TWUN_CENTIMETERS:
            text = "Centimeters";
            break;

          case EnumDWT_UnitType.TWUN_PICAS:
            text = "Picas";
            break;

          case EnumDWT_UnitType.TWUN_POINTS:
            text = "Points";
            break;

          case EnumDWT_UnitType.TWUN_TWIPS:
            text = "Twips";
            break;

          case EnumDWT_UnitType.TWUN_PIXELS:
            text = "Pixels";
            break;

          case EnumDWT_UnitType.TWUN_MILLIMETERS:
            text = "Millimeters";
            break;

          default:
            text = "Unknown TWUN " + item;
            break;
          }

      return text;
    }
    */


})(Dynamsoft.Lib);// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function(STwain, Funs){
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}

	var STwainP = STwain.prototype;

    // --- Upload & Save  start --
    STwainP.FileExists = function (localFile) {
        var f = Funs.replaceLocalFilename(localFile);
        return this._innerFun('FileExists', Funs.makeParams(f));
    }

    STwainP.SaveAllAsMultiPageTIFF = function (localFile, OnSuccess, OnFailure) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerSaveImage('SaveAllAsMultiPageTIFF', Funs.makeParams(f), OnSuccess, OnFailure);
    }

    STwainP.SaveAllAsPDF = function (localFile, OnSuccess, OnFailure) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerSaveImage('SaveAllAsPDF', Funs.makeParams(f), OnSuccess, OnFailure);
    }
// -- start
    STwainP.SaveAsBMP = function (localFile, sImageIndex, OnSuccess, OnFailure) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerSaveImage('SaveAsBMP', Funs.makeParams(f, sImageIndex), OnSuccess, OnFailure);
    }

    STwainP.SaveAsJPEG = function (localFile, sImageIndex, OnSuccess, OnFailure) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerSaveImage('SaveAsJPEG', Funs.makeParams(f, sImageIndex), OnSuccess, OnFailure);
    }

    STwainP.SaveAsPDF = function (localFile, sImageIndex, OnSuccess, OnFailure) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerSaveImage('SaveAsPDF', Funs.makeParams(f, sImageIndex), OnSuccess, OnFailure);
    }

    STwainP.SaveAsPNG = function (localFile, sImageIndex, OnSuccess, OnFailure) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerSaveImage('SaveAsPNG', Funs.makeParams(f, sImageIndex), OnSuccess, OnFailure);
    }

    STwainP.SaveAsTIFF = function (localFile, sImageIndex, OnSuccess, OnFailure) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerSaveImage('SaveAsTIFF', Funs.makeParams(f, sImageIndex), OnSuccess, OnFailure);
    }
    
    STwainP.SaveAsGIF = function (localFile, sImageIndex, OnSuccess, OnFailure) {
        var f = Funs.replaceLocalFilename(localFile);
        return this.__innerSaveImage('SaveAsGIF', Funs.makeParams(f, sImageIndex), OnSuccess, OnFailure);
    }
// --end
    STwainP.SaveSelectedImagesAsMultiPagePDF = function (localFile, OnSuccess, OnFailure) {
        var _this=this, f = Funs.replaceLocalFilename(localFile), ret;
		ret = Funs.__SetSelectedImages(_this, _this._UIManager.GetCurrentImageIndex(), _this._UIManager.GetSelectedIndexes());
		if(ret)
			return _this.__innerSaveImage('SaveSelectedImagesAsMultiPagePDF', Funs.makeParams(f), OnSuccess, OnFailure);
		return false;
    }

    STwainP.SaveSelectedImagesAsMultiPageTIFF = function (localFile, OnSuccess, OnFailure) {
        var _this=this, f = Funs.replaceLocalFilename(localFile), ret;
		ret = Funs.__SetSelectedImages(_this, _this._UIManager.GetCurrentImageIndex(), _this._UIManager.GetSelectedIndexes());
		if(ret)
			return _this.__innerSaveImage('SaveSelectedImagesAsMultiPageTIFF', Funs.makeParams(f), OnSuccess, OnFailure);
		return false;
    }

    STwainP.SaveSelectedImagesToBase64Binary = function () {
		var _this=this, ret;
		ret = Funs.__SetSelectedImages(_this, _this._UIManager.GetCurrentImageIndex(), _this._UIManager.GetSelectedIndexes());
		if(ret)
			return _this._innerFun('SaveSelectedImagesToBase64Binary');
		return false;
    }

    STwainP.ShowFileDialog = function (SaveDialog, Filter, FilterIndex, DefExtension, InitialDir, AllowMultiSelect, OverwritePrompt, Flags) { //, OnFilesSelected) {
		var _this=this, f = Funs.replaceLocalFilename(InitialDir);
		
//		var _fFun = function (aryFilePath) {
//		    if(Dynamsoft.Lib.isFunction(OnFilesSelected)) {
//		        var filePaths = [];
//		        for(var i = 0; i < aryFilePath.length; i++)
//		        {
//		            var path = Dynamsoft.Lib.base64.decode(aryFilePath[i]);
//		            filePaths.push(path);
//		        }
//    		
//		        OnFilesSelected(filePaths, _this.ErrorCode, _this.ErrorString);
//		    }
//		    return true;
//		};
//		
//		if(Dynamsoft.Lib.isFunction(OnFilesSelected)) 
//		    Flags = Flags + 100;
		    
        return this._innerSend('ShowFileDialog', Funs.makeParams(SaveDialog, Filter, FilterIndex, DefExtension, f, AllowMultiSelect, OverwritePrompt, Flags), true);//, _fFun,_fFun);

	}


    STwainP.FTPDownload = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
        return this.__innerFTPDownload('FTPDownload', Funs.makeParams(FTPServer, FTPRemoteFile), OnSuccess, OnFailure);
        //return this._innerFun('FTPDownload', Funs.makeParams(FTPServer, FTPRemoteFile));
    }

    STwainP.FTPDownloadDirectly = function (FTPServer, FTPRemoteFile, localFile, OnSuccess, OnFailure) {
		var f = Funs.replaceLocalFilename(localFile);
        return this.__innerFTPDownloadDirectly('FTPDownloadDirectly', Funs.makeParams(FTPServer, FTPRemoteFile, f), OnSuccess, OnFailure);
    }

    STwainP.FTPDownloadEx = function (FTPServer, FTPRemoteFile, ImageType, OnSuccess, OnFailure) {
        return this.__innerFTPDownload('FTPDownloadEx', Funs.makeParams(FTPServer, FTPRemoteFile, ImageType), OnSuccess, OnFailure);
    }

    STwainP.FTPUpload = function (FTPServer, sImageIndex, FTPRemoteFile, OnSuccess, OnFailure) {
        return this.__innerFTPUpload('FTPUpload', Funs.makeParams(FTPServer, sImageIndex, FTPRemoteFile), OnSuccess, OnFailure);
    }

    STwainP.FTPUploadDirectly = function (FTPServer, localFile, FTPRemoteFile, OnSuccess, OnFailure) {
		var f = Funs.replaceLocalFilename(localFile);
        return this.__innerFTPUpload('FTPUploadDirectly', Funs.makeParams(FTPServer, f, FTPRemoteFile), OnSuccess, OnFailure);
    }

    STwainP.FTPUploadEx = function (FTPServer, sImageIndex, FTPRemoteFile, ImageType, OnSuccess, OnFailure) {
        return this.__innerFTPUpload('FTPUploadEx', Funs.makeParams(FTPServer, sImageIndex, FTPRemoteFile, ImageType), OnSuccess, OnFailure);
    }

    STwainP.FTPUploadAllAsMultiPageTIFF = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
        return this.__innerFTPUpload('FTPUploadAllAsMultiPageTIFF', Funs.makeParams(FTPServer, FTPRemoteFile), OnSuccess, OnFailure);
    }

    STwainP.FTPUploadAllAsPDF = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
        return this.__innerFTPUpload('FTPUploadAllAsPDF', Funs.makeParams(FTPServer, FTPRemoteFile), OnSuccess, OnFailure);
    }

    STwainP.FTPUploadAsMultiPagePDF = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
        // upload all selected images, default always select one image, we should set all selected image index to server before call this,
        // all when selecte image, should set select to server ????????????
        return this.__innerFTPUpload('FTPUploadAsMultiPagePDF', Funs.makeParams(FTPServer, FTPRemoteFile), OnSuccess, OnFailure);
    }

    STwainP.FTPUploadAsMultiPageTIFF = function (FTPServer, FTPRemoteFile, OnSuccess, OnFailure) {
        // upload all selected images, default always select one image, we should set all selected image index to server before call this,
        // all when selecte image, should set select to server ????????????
        return this.__innerFTPUpload('FTPUploadAsMultiPageTIFF', Funs.makeParams(FTPServer, FTPRemoteFile), OnSuccess, OnFailure);
    }

    STwainP.HTTPDownload = function (HTTPServer, HTTPRemoteFile, OnSuccess, OnFailure) {
        var imgType = Funs.getImageType(HTTPRemoteFile);
        return this.HTTPDownloadThroughGet(HTTPServer, HTTPRemoteFile, imgType, OnSuccess, OnFailure);
    }

    STwainP.HTTPDownloadDirectly = function (HTTPServer, HTTPRemoteFile, localFile, OnSuccess, OnFailure) {

        var _this = this, _url = Funs.combineUrl(_this, HTTPServer, HTTPRemoteFile), _get_or_post, f;
		
		if(_url === false){
			Dynamsoft.Lib.Errors.ParameterCannotEmpty(_this);
			return false;
		}
		
        Dynamsoft.Lib.cancelFrome = 2;
        if (!localFile || localFile == '') {
			Dynamsoft.Lib.Errors.InvalidLocalFilename(_this, 'HTTPDownloadDirectly');
			if (Dynamsoft.Lib.isFunction(OnFailure)) {
				OnFailure(_this.ErrorCode, _this.ErrorString);
			}
            return false;
        }
		if (Funs.isServerInvalid(_this)) {
			if (Dynamsoft.Lib.isFunction(OnFailure)) {
				OnFailure(_this.ErrorCode, _this.ErrorString);
			}
			return false;
		}
							
		f = Funs.replaceLocalFilename(localFile);
		
        _get_or_post = 'get';

        Dynamsoft.Lib.showProgress(_this, "HTTPDownloadDirectly", true);
        var _progressFun = function (ev) {
            var p = (ev.total === 0) ? 100 : Math.round(ev.loaded * 100 / ev.total),
				msg = [ev.loaded, ' / ', ev.total].join('');

            _this._OnPercentDone([0, p, '', 'http']); // http download Directly
        }, _async = true;

        _this._OnPercentDone([0, -1, 'HTTP Downloading...', 'http']); // http download Directly
		
		if (!Dynamsoft.Lib.isFunction(OnSuccess)) {
			_async = false;
		}
		
        ret = Funs.loadHttpBlob(_this, _get_or_post, _url, _async, function (b) {
            _this._OnPercentDone([0, -1, 'Loading...']);
            // success, send to server
            var t = 3;
            _this.__LoadImageFromBytes(b, t, f, _async, OnSuccess, OnFailure);

        }, function () {
            // failed
            Dynamsoft.Lib.closeProgress('HTTPDownloadDirectly');
            if (Dynamsoft.Lib.isFunction(OnFailure)) {
                OnFailure(_this.ErrorCode, _this.ErrorString);
            }
        }, _progressFun);

        return ret;
    }

    STwainP.HTTPUploadThroughPostDirectly = function (HTTPServer, localFile, ActionPage, fileName, OnSuccess, OnFailure) {
       var _this = this, 
        m = 'HTTPUploadThroughPostDirectly',
        _url = Funs.combineUrl(_this, HTTPServer, ActionPage),
        _async = true, f;

		if(_url === false){
			Dynamsoft.Lib.Errors.ParameterCannotEmpty(_this);
			return false;
		}		
		
        if (!Dynamsoft.Lib.isFunction(OnSuccess)) {
			_async = false;
		}

		 Dynamsoft.Lib.cancelFrome = 1;

        var _fFun = function () {

            Dynamsoft.Lib.needShowTwiceShowDialog = false;
            Dynamsoft.Lib.closeProgress(m);
            
            if (Dynamsoft.Lib.isFunction(OnFailure)) {
                OnFailure(_this.ErrorCode, _this.ErrorString, _this.__HTTPPostResponseString);
            }
            
            return true;
        };

        // Funs.showMask(m);
        Dynamsoft.Lib.needShowTwiceShowDialog = true;
        Dynamsoft.Lib.showProgress(_this, m, false);

         if (HTTPServer === '') {
            Dynamsoft.Lib.Errors.HttpServerCannotEmpty(_this);
			_fFun();
            return false;
        }


        f = Funs.replaceLocalFilename(localFile);
		
		// must create __SaveSelectedLocalFileToBytes interface on server!
		_this.__SaveLocalFileToBytes(f, _async, function(blobData){
		Dynamsoft.Lib.needShowTwiceShowDialog = false;
         if (blobData && (Dynamsoft.Lib.dlgRef>0 || _this.__IfShowCancelDialogWhenImageTransfer == false || _async == false)) {
                blobData.name = fileName;
                Funs.setBtnCancelVisibleForProgress(_this, true);
                Funs.httpPostUpload(_this, _url, blobData, _async, function (result) {
                    // success
                    //Funs.hideMask(m);
                    Dynamsoft.Lib.closeProgress(m);

                    if (Dynamsoft.Lib.isFunction(OnSuccess)) {
                        OnSuccess(result);
                    }
                }, _fFun);

            } else {
                //Funs.hideMask(m);
                Dynamsoft.Lib.closeProgress(m);

            }

        }, _fFun);

        return true;
    }

    STwainP.HTTPUploadThroughPost = function (HTTPServer, sImageIndex, ActionPage, fileName, OnSuccess, OnFailure) {
        var imgType = Funs.getImageType(fileName);
        return this.HTTPUploadThroughPostEx(HTTPServer, sImageIndex, ActionPage, fileName, imgType, OnSuccess, OnFailure);
    }

    STwainP.HTTPUploadThroughPostEx = function (HTTPServer, sImageIndex, ActionPage, fileName, ImageType, OnSuccess, OnFailure) {
        var _this = this, 
			m = 'HTTPUploadThroughPostEx',
			_url = Funs.combineUrl(_this, HTTPServer, ActionPage), 
			_async = true,
			ret = false;

		if(_url === false){
			Dynamsoft.Lib.Errors.ParameterCannotEmpty(_this);
			return false;
		}
		
		if (!Dynamsoft.Lib.isFunction(OnSuccess)) {
			_async = false;
		}
		
        Dynamsoft.Lib.cancelFrome = 1;

        var _fFun = function () {
			var tmpLength = _this.curCommand_SaveImagesToBytes.length;
			
            Dynamsoft.Lib.needShowTwiceShowDialog = false;
            Dynamsoft.Lib.closeProgress(m);
            
            if (Dynamsoft.Lib.isFunction(OnFailure)) {
                OnFailure(_this.ErrorCode, _this.ErrorString, _this.__HTTPPostResponseString);
            }
			if(tmpLength > 0){
				Dynamsoft.Lib.cancelFrome = 1;
				Dynamsoft.Lib.needShowTwiceShowDialog = true;
				Dynamsoft.Lib.showProgress(_this, m, false);
				var last = _this.curCommand_SaveImagesToBytes[0];
				Funs.sendData(last.objWS, last.json, false, last.binary);
			}

            return true;
        };

        // Funs.showMask(m);
        Dynamsoft.Lib.needShowTwiceShowDialog = true;
        Dynamsoft.Lib.showProgress(_this, m, false);

        if (HTTPServer === '') {
            Dynamsoft.Lib.Errors.HttpServerCannotEmpty(_this);
			_fFun();
            return false;
        }
		
		if(sImageIndex == -2){
			// save selected images
			var ret1;
			ret1 = Funs.__SetSelectedImages(_this, _this._UIManager.GetCurrentImageIndex(), _this._UIManager.GetSelectedIndexes());
			if(!ret1){
				_fFun(_this._errorString);
				return false;
			}
		}
		
        _this.__SaveSelectedImagesToBytes(ImageType, sImageIndex, _async, function (blobData) {
		
            Dynamsoft.Lib.needShowTwiceShowDialog = false;
            if (blobData && (Dynamsoft.Lib.dlgRef>0 || _this.__IfShowCancelDialogWhenImageTransfer == false || _async == false)) {

                blobData.name = fileName;

                Funs.setBtnCancelVisibleForProgress(_this, true);
                Funs.httpPostUpload(_this, _url, blobData, _async, function (result) {
					var tmpLength = _this.curCommand_SaveImagesToBytes.length;

                    // success
                    //Funs.hideMask(m);
                    Dynamsoft.Lib.closeProgress(m);
					
					ret = true;
					

                    if (Dynamsoft.Lib.isFunction(OnSuccess)) {
                        OnSuccess(result);
                    }
							
					if(tmpLength > 0){
						Dynamsoft.Lib.cancelFrome = 1;
						Dynamsoft.Lib.needShowTwiceShowDialog = true;
						Dynamsoft.Lib.showProgress(_this, m, false);
						var last = _this.curCommand_SaveImagesToBytes[0];
						Funs.sendData(last.objWS, last.json, false, last.binary);
					}
					
                }, _fFun);

            } else {
                //Funs.hideMask(m);
                Dynamsoft.Lib.closeProgress(m);

            }

        }, _fFun);

        return ret;
    }


    STwainP.ClearAllHTTPFormField = function () {
        var _this = this;
        _this.httpFormFields = {};
		return true;
    }

    STwainP.SetHTTPFormField = function (FieldName, FieldValue) {
        var _this = this, _key = FieldName;

        if (!Dynamsoft.Lib.isString(_key))
            _key = '' + _key;

        _this.httpFormFields[_key] = FieldValue;
		return true;
    }

    // 0:BMP, 1:JPEG, 2:TIFF, 3:PNG, 4:PDF
    STwainP.HTTPUploadAllThroughPostAsMultiPageTIFF = function (HTTPServer, ActionPage, fileName, OnSuccess, OnFailure) {
        var all = -1, imgType = 2;

        return this.HTTPUploadThroughPostEx(HTTPServer, all, ActionPage, fileName, imgType, OnSuccess, OnFailure);
    }

    STwainP.HTTPUploadThroughPostAsMultiPageTIFF = function (HTTPServer, ActionPage, fileName, OnSuccess, OnFailure) {
        var _this=this, bySelected = -2, imgType = 2;

		return _this.HTTPUploadThroughPostEx(HTTPServer, bySelected, ActionPage, fileName, imgType, OnSuccess, OnFailure);

    }

    STwainP.HTTPUploadAllThroughPostAsPDF = function (HTTPServer, ActionPage, fileName, OnSuccess, OnFailure) {
        var _this=this, all = -1, imgType = 4;

        return this.HTTPUploadThroughPostEx(HTTPServer, all, ActionPage, fileName, imgType, OnSuccess, OnFailure);
    }

    STwainP.HTTPUploadThroughPostAsMultiPagePDF = function (HTTPServer, ActionPage, fileName, OnSuccess, OnFailure) {
        var _this=this, bySelected = -2, imgType = 4;

        return _this.HTTPUploadThroughPostEx(HTTPServer, bySelected, ActionPage, fileName, imgType, OnSuccess, OnFailure);
    }









    STwainP.HTTPUploadThroughPutDirectly = function (HTTPServer, localFile, RemoteFileName, OnSuccess, OnFailure) {
        Dynamsoft.Lib.Errors.HTML5NotSupport(this);
		return false;
        // *Directly HTTPUploadThroughPutDirectly
//        var _this = this, _url = Funs.combineUrl(_this, HTTPServer, RemoteFileName);

//        Funs.notSupportMethod("HTTPUploadThroughPutDirectly");
        // 		
        // must create __SaveSelectedLocalFileToBytes interface on server!
        /*
		_this.__SaveSelectedLocalFileToBytes(localFile, function(blobData){
			Funs.httpPutImage(_this, _url, blobData, function(result){
				_this.__HTTPPostResponseString = result;
			});
		}, function(errorText){
			Dynamsoft.Lib.log(errorText);
		});
		*/

//        return true;
    }

    STwainP.HTTPUploadThroughPut = function (HTTPServer, sImageIndex, RemoteFileName, OnSuccess, OnFailure) {
        var imgType = Funs.getImageType(RemoteFileName);
        return this.HTTPUploadThroughPutEx(HTTPServer, sImageIndex, RemoteFileName, imgType, OnSuccess, OnFailure);
    }

    // 0:BMP, 1:JPEG, 2:TIFF, 3:PNG, 4:PDF, 5:GIF
    STwainP.HTTPUploadThroughPutEx = function (HTTPServer, sImageIndex, RemoteFileName, ImageType, OnSuccess, OnFailure) {
        var _this = this, 
			m = 'HTTPUploadThroughPutEx',
			_url = Funs.combineUrl(_this, HTTPServer, RemoteFileName), 
			_async = true,
			ret = false;

		if(_url === false){
			Dynamsoft.Lib.Errors.ParameterCannotEmpty(_this);
			return false;
		}
		
		if (Dynamsoft.Lib.isFunction(OnSuccess)) {
			_async = false;
		}
			
        Dynamsoft.Lib.cancelFrome = 1;

        var _fFun = function (errorText) {
			var tmpLength = _this.curCommand_SaveImagesToBytes.length;
           
            Dynamsoft.Lib.needShowTwiceShowDialog = false;
            Dynamsoft.Lib.closeProgress(m);

            if (Dynamsoft.Lib.isFunction(OnFailure)) {
                OnFailure(_this.ErrorCode, _this.ErrorString, _this.__HTTPPostResponseString);
            }

			if(tmpLength > 0){
				Dynamsoft.Lib.cancelFrome = 1;
				Dynamsoft.Lib.needShowTwiceShowDialog = true;
				Dynamsoft.Lib.showProgress(_this, m, false);
				var last = _this.curCommand_SaveImagesToBytes[0];
				Funs.sendData(last.objWS, last.json, false, last.binary);
			}

            return true;
        }, _progressFun;

        if (HTTPServer === '') {
            Dynamsoft.Lib.Errors.HttpServerCannotEmpty(_this);
            _fFun(_this._errorString);
            return false;
        }

        Dynamsoft.Lib.needShowTwiceShowDialog = true;
        Dynamsoft.Lib.showProgress(_this, m, false);
		
		if(sImageIndex == -2){
			// save selected images
			var ret;
			ret = Funs.__SetSelectedImages(_this, _this._UIManager.GetCurrentImageIndex(), _this._UIManager.GetSelectedIndexes());
			if(!ret){
				_fFun(_this._errorString);
				return false;
			}
		}

        _this.__SaveSelectedImagesToBytes(ImageType, sImageIndex, _async, function (blobData) {
            Dynamsoft.Lib.needShowTwiceShowDialog = false;
            if (blobData && (Dynamsoft.Lib.dlgRef>0 || _this.__IfShowCancelDialogWhenImageTransfer == false || _async == false)) {

                _progressFun = function (ev) {
                    var p = (ev.total === 0) ? 100 : Math.round(ev.loaded * 100 / ev.total),
						msg = [ev.loaded, ' / ', ev.total].join('');

                    _this._OnPercentDone([0, p, '', 'http']); // http upload (put)
                };

                _this._OnPercentDone([0, -1, 'uploading...', 'http']); // http upload (put)
                Funs.setBtnCancelVisibleForProgress(_this, true);
                Funs.httpPutImage(_this, _url, blobData, _async, function (result) {
					var tmpLength = _this.curCommand_SaveImagesToBytes.length;

					_this.__HTTPPostResponseString = result;
                    // success
                    //Funs.hideMask(m);
                    Dynamsoft.Lib.closeProgress(m);
					
					ret = true;

                    if (Dynamsoft.Lib.isFunction(OnSuccess)) {
                        OnSuccess(_this.__HTTPPostResponseString);
                    }
					
										
					if(tmpLength > 0){
						Dynamsoft.Lib.cancelFrome = 1;
						Dynamsoft.Lib.needShowTwiceShowDialog = true;
						Dynamsoft.Lib.showProgress(_this, m, false);
						var last = _this.curCommand_SaveImagesToBytes[0];
						Funs.sendData(last.objWS, last.json, false, last.binary);
					}
					
                }, _fFun, _progressFun);
            } else {
                //Funs.hideMask(m);
                Dynamsoft.Lib.closeProgress(m);
            }

        }, _fFun);

        return ret;
    }

    STwainP.HTTPUploadAllThroughPutAsMultiPageTIFF = function (HTTPServer, RemoteFileName, OnSuccess, OnFailure) {
        var all = -1, imgType = 2;

        return this.HTTPUploadThroughPutEx(HTTPServer, all, RemoteFileName, imgType, OnSuccess, OnFailure);
    }

    STwainP.HTTPUploadThroughPutAsMultiPageTIFF = function (HTTPServer, RemoteFileName, OnSuccess, OnFailure) {
        var _this=this, bySelected = -2, imgType = 2;
        return _this.HTTPUploadThroughPutEx(HTTPServer, bySelected, RemoteFileName, imgType, OnSuccess, OnFailure);
    }

    STwainP.HTTPUploadAllThroughPutAsPDF = function (HTTPServer, RemoteFileName, OnSuccess, OnFailure) {
        var all = -1, imgType = 4;

        return this.HTTPUploadThroughPutEx(HTTPServer, all, RemoteFileName, imgType, OnSuccess, OnFailure);
    }

    STwainP.HTTPUploadThroughPutAsMultiPagePDF = function (HTTPServer, RemoteFileName, OnSuccess, OnFailure) {
        var _this=this, bySelected = -2, imgType = 4;

        return _this.HTTPUploadThroughPutEx(HTTPServer, bySelected, RemoteFileName, imgType, OnSuccess, OnFailure);
    }

    STwainP.GetSelectedImagesSize = function (ImageType) {
		var _this=this, ret;
		ret = Funs.__SetSelectedImages(_this, _this._UIManager.GetCurrentImageIndex(), _this._UIManager.GetSelectedIndexes());
		if(ret)
			return this._innerFun('GetSelectedImagesSize', Funs.makeParams(ImageType));
		return false;
    }
    // --- Upload & Save  end --

})(Dynamsoft.Lib.html5.STwain, Dynamsoft.Lib.html5.Funs);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 

(function(STwain, Funs){
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}

	var STwainP = STwain.prototype;

    STwainP.RegisterEvent = function (eventName, callback) {
		
        var vFun;
		
		vFun = ['__', eventName].join('');

        this[vFun] = callback;
		
		return true;
    };
    STwainP.onEvent = function (eventName, callback) {
        this.RegisterEvent(eventName, callback);
    };
    STwainP.on = function (eventName, callback) {
        this.RegisterEvent(eventName, callback);
    };

    // --- Event start --
    // Client Events, start with 'On' or '__On'
    STwainP.OnRefreshUI = function (_i, _maxIndex, bReplace, _rawImageWidth) {
        var _this = this, m = 'On RefreshUI';

        if (bReplace) {//the image has been edited
            _this._UIManager.refresh(_i, _maxIndex, true, _rawImageWidth);
        }

        if (Dynamsoft.Lib.isFunction(_this.__OnRefreshUI))
            _this.__OnRefreshUI(_this._UIManager.GetCurrentImageIndex(), _maxIndex);

        return true;
    }


    // Server Events, start with '_On'
    // OnBitmapChanged
    // type: 1-Append(after index), 2-Insert(before index), 3-Remove, 4-Edit(Replace)

    STwainP._OnBitmapChanged = function (evtResults) {
        var _this = this,
			_aryPicID = evtResults[1].split(','),
			_OpType = evtResults[2],
			_cIndex = evtResults[3],
			_maxIndex = evtResults[4],
			_rawImageWidth = 0,
			m = 'OnBitmapChanged:';
			
		if(evtResults.length>5){
			_rawImageWidth = evtResults[5];
		}
		
        // set current index in local
        _this.__cIndex = _cIndex;
        _this._HowManyImagesInBuffer = _maxIndex;
        Dynamsoft.Lib.log(m + evtResults);

        if (_OpType == 1 || _OpType == 2) {
            // append / insert
            Dynamsoft.Lib.each(_aryPicID, function (szItem) {
                var _index = parseInt(szItem), _id = 'item_' + _index;
                if (isNaN(_index) || _index < 0) {// continue
                    return true;
                }

				_this._UIManager.add(_index, _maxIndex, _rawImageWidth);
            });

            // refresh max index
            if (Dynamsoft.Lib.isFunction(_this.__OnRefreshUI))
                _this.__OnRefreshUI(_cIndex, _maxIndex);

        } else if (_OpType == 3) {
            // remove
            if (_aryPicID.length == 1 && _aryPicID[0] == -1 || _maxIndex==0) {
                // remove all
				 _this._UIManager.clear();
            } else {
                Dynamsoft.Lib.each(_aryPicID, function (szItem, item) {
                    var _index = parseInt(szItem);
                    if (isNaN(_index) || _index < 0) {// continue
                        return true;
                    }

                    _this._UIManager.remove(_index, _cIndex);
                });

                // refresh
                if (_cIndex >= 0 && !_this.__bLoadingImage && _this._UIManager.count()>0) {
                    _this._UIManager.refreshEditor(_cIndex, _maxIndex);
                }
            }

            if (Dynamsoft.Lib.isFunction(_this.__OnRefreshUI))
                _this.__OnRefreshUI(_cIndex, _maxIndex);
        } else if (_OpType == 4) {
            // refreshs edited
			Dynamsoft.Lib.each(_aryPicID, function (szItem, item) {
				var _index = parseInt(szItem);
				if (isNaN(_index) || _index < 0) {// continue
					return true;
				}
				if (_index >= 0 && !_this.__bLoadingImage) {
					_this.OnRefreshUI(_index, _maxIndex, true, _rawImageWidth);
				}
			});
        }

        if (Dynamsoft.Lib.isFunction(_this.__OnBitmapChanged))
            _this.__OnBitmapChanged(_aryPicID, _OpType, _cIndex, _maxIndex);

    }


    //OnPostLoad(char * Path, char * Name, long type) event
    STwainP._OnPostLoad = function (evtResults, _evt) {
        var _this = this, i, path, f, p, _cIndex;
		
		if (_evt !== undefined && _evt.exception !== undefined && _evt.description !== undefined) {
			_this._errorCode = _evt.exception;
			_this._errorString = _evt.description;
		}

        Dynamsoft.Lib.log('OnPostLoad Results:');

        p = evtResults[1].split(',');
        path = Dynamsoft.Lib.base64.decode(p[0]);
        name = Dynamsoft.Lib.base64.decode(p[1]);

        Dynamsoft.Lib.log(path);
        Dynamsoft.Lib.log(name);
        Dynamsoft.Lib.log(p[2]);

        Funs.autoDiscardBlankImage(_this, 'On PostLoad');
		
        _cIndex = _this.__cIndex;
        if (_cIndex >= 0){
			_this.OnRefreshUI(_cIndex);
		}

        if (Dynamsoft.Lib.isFunction(_this.__OnPostLoad))
            _this.__OnPostLoad(path, name, p[2]);
    }

    STwainP._OnPostTransfer = function (evtResults) {
        var _this = this;

        Dynamsoft.Lib.log('On PostTransfer Results:' + evtResults);

        Funs.autoDiscardBlankImage(_this, 'On PostTransfer');

        if (Dynamsoft.Lib.isFunction(_this.__OnPostTransfer))
            _this.__OnPostTransfer();
    }

    STwainP._OnPostAllTransfers = function (evtResults) {
        var _this = this, _errCode, _errString,
			_cIndex=_this._UIManager.GetCurrentImageIndex(), 
			_maxIndex=_this._UIManager.count();

		if(evtResults.length>=2){
			_this._errorCode = evtResults[1];
			_this._errorString = evtResults[2];
		}
		
        Dynamsoft.Lib.log('On PostAllTransfers Results:' + evtResults);
		_this.__bLoadingImage = false;
		
		_this._UIManager.refreshEditor(_cIndex, _maxIndex);

        if (Dynamsoft.Lib.isFunction(_this.__OnPostAllTransfers))
            _this.__OnPostAllTransfers();
    }

    STwainP._OnResult = function (evtResults) {
        var _this = this, aryRet = evtResults[1];

        if (Dynamsoft.Lib.isFunction(_this.__OnResult))
            _this.__OnResult(aryRet);
    }
    STwainP._OnTransferCancelled = function (evtResults) {
        var _this = this, 
			_cIndex=_this._UIManager.GetCurrentImageIndex(), 
			_maxIndex=_this._UIManager.count();
			
		_this.__bLoadingImage = false;
		
		_this._UIManager.refreshEditor(_cIndex, _maxIndex);

        if (Dynamsoft.Lib.isFunction(_this.__OnTransferCancelled))
            _this.__OnTransferCancelled();
    }
    STwainP._OnTransferError = function (evtResults) {
        var _this = this;

        if (Dynamsoft.Lib.isFunction(_this.__OnTransferError))
            _this.__OnTransferError();
    }
    STwainP._OnSourceUIClose = function (evtResults) {
        var _this = this;

        if (Dynamsoft.Lib.isFunction(_this.__OnSourceUIClose))
            _this.__OnSourceUIClose();
    }
    STwainP._OnPreTransfer = function (evtResults) {
        var _this = this;

        if (Dynamsoft.Lib.isFunction(_this.__OnPreTransfer))
            _this.__OnPreTransfer();
    }
    STwainP._OnPreAllTransfers = function (evtResults) {
        var _this = this;

		// 10.1 change to display image under 1*1 mode
		//_this.__bLoadingImage = true;
		
        if (Dynamsoft.Lib.isFunction(_this.__OnPreAllTransfers))
            _this.__OnPreAllTransfers();
    }
    STwainP._OnPercentDone = function (evtResults) {
        var _this = this;
        var bFTPOrHTTP = false;
        if ((Dynamsoft.Lib.cancelFrome == 0 && _this.__IfShowProgressBar == true) || 
        ( Dynamsoft.Lib.cancelFrome != 0 && _this.__IfShowCancelDialogWhenImageTransfer == true)) {
            var bar = Dynamsoft.Lib.get('progressBar'),
				status = Dynamsoft.Lib.get('status'),
				finalMessage = Dynamsoft.Lib.get('finalMessage'),
				al=0, strMessage;
				
            if (Dynamsoft.Lib.cancelFrome == 3 || Dynamsoft.Lib.cancelFrome == 4) {
                var bShowCancel = evtResults[3];
                if (bShowCancel == 0)
                    Funs.setBtnCancelVisibleForProgress(_this, false);
                else if (bShowCancel == 1)
                    Funs.setBtnCancelVisibleForProgress(_this, true);
            }

			al = evtResults[1];

            if (al < 0) {
                al = 0;
                Dynamsoft.Lib.progressMessage = evtResults[2];
                strMessage = Dynamsoft.Lib.progressMessage;
            } else {
                if (evtResults[2] != "")
                    strMessage = Dynamsoft.Lib.progressMessage + "(" + evtResults[2] + ")";
                else
                    strMessage = Dynamsoft.Lib.progressMessage;

               if(Dynamsoft.Lib.cancelFrome == 1 || Dynamsoft.Lib.cancelFrome == 2)
                {
                    if (evtResults[3] == "http")
                        bFTPOrHTTP = true;
                }
                if(Dynamsoft.Lib.cancelFrome == 3 || Dynamsoft.Lib.cancelFrome == 4)
                {
                    if (evtResults[4] == "ftp")
                        bFTPOrHTTP = true;
                }
            }
			
			if(finalMessage)
				finalMessage.innerHTML = strMessage;

            if (al || al===0) {
				if(status)
					status.innerHTML = (al + "%");
				
				if(bar){
					if(Dynamsoft.Lib.env.bIE){
						if(bar.objProgressBar){
							bar.objProgressBar.setValue(al);
						} else {
							bar.value = al;
						}
					} else {
						bar.value = al;
					}
				}

                if(bFTPOrHTTP == true)
                {
                    if (Dynamsoft.Lib.isFunction(_this.__OnInternetTransferPercentage)) 
                        _this.__OnInternetTransferPercentage(al, false);
                    if (Dynamsoft.Lib.isFunction(_this.__OnInternetTransferPercentageEx)) 
                        _this.__OnInternetTransferPercentageEx(al, false);
                }
            }
            if (al && (al >= 100 || Dynamsoft.Lib.dlgRef <= 0)) {

                //status.html("100%");
                //bar[0].value = 100;

                if (Dynamsoft.Lib.dlgRef <= 0) {
                    var m = 'OnPercentDone';

                    Dynamsoft.Lib.closeProgress(m);

                }
            }
        }

        if (Dynamsoft.Lib.isFunction(_this.__OnPercentDone))
            _this.__OnPercentDone();
    }

    //OnGetFilePath(BOOL bSave, long Count, long Index,  Path,  Name) event ?????????????
    STwainP._OnGetFilePath = function (evtResults) {
        var _this = this, i, path, f, p;

        p = evtResults[1].split(',');
        Dynamsoft.Lib.log('On GetFilePath Results:' + evtResults);

        path = Dynamsoft.Lib.base64.decode(p[3]);
        name = Dynamsoft.Lib.base64.decode(p[4]);

        if (Dynamsoft.Lib.isFunction(_this.__OnGetFilePath)) {
            _this.__OnGetFilePath(p[0], p[1], p[2], path, name);
        }

    }



    STwainP.checkErrorString = function () {
        var _this = this, eCode = _this.ErrorCode;

        if (eCode === -2115) { //Cancel file dialog
            // Dynamsoft.Lib.appendRichMessage('File dialog cancelled.');
            return true;
        }

        if (eCode === -2003) {
            var errMessageWin = window.open('', 'ErrorMessage', 'height=500,width=750,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no');
            errMessageWin.document.writeln(_this.__HTTPPostResponseString);
        }

        // Dynamsoft.Lib.appendRichMessage(_this.ErrorString);
        return (eCode === 0);
    }
    // --- Event end --

})(Dynamsoft.Lib.html5.STwain, Dynamsoft.Lib.html5.Funs);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 

(function(STwain, Funs){
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}

	var STwainP = STwain.prototype;

    // --- Others ---
    STwain.prototype.ShowImageEditor = function () {
		var _this = this;
	
		if (Funs.isServerInvalid(_this)) {
			return false;
		}
		
        return _this.ShowImageEditorEx(-1, -1, -1, -1, 0);// show and maximize the editor
    }

    STwain.prototype.SetCookie = function (v) {
		var _this = this;

		_this._cookie = v;
		document.cookie = v;

        return true;
    }

    STwain.prototype.LoadImageFromBase64Binary = function (bry, ImageType) {
        var _this=this, ret = _this._innerFun('LoadImageFromBase64Binary', Funs.makeParams(bry, ImageType));
		
		if(_this.ErrorCode == 0){
			_this._HowManyImagesInBuffer = _this._innerFun('HowManyImagesInBuffer');
			_this.__cIndex = _this._innerFun('CurrentImageIndexInBuffer');
		}
		return ret;
    }
	
    STwain.prototype.SaveSelectedImagesToBytes = function (bufferSize, bry) {
        // not support
        Dynamsoft.Lib.Errors.HTML5NotSupport(this);
		return false;
    }

    STwain.prototype.LoadImageFromBytes = function (bufferSize, bry, ImageType) {
        // not support
        Dynamsoft.Lib.Errors.HTML5NotSupport(this);
		return false;
    }

    STwain.prototype.UnregisterEvent = function (eventName, callback) {
        var vFun = ['__', eventName].join('');
        this[vFun] = null;
		return true;
    }
    // --- Others end ---


    STwain.prototype.first = function () {
        var _this = this, len = _this._UIManager.count();
        if (len > 0) {
            _this._UIManager.getView().Go(0);
			Funs.__innerRefreshFromUIView(_this, _this._UIManager.GetCurrentImageIndex());
        }
		return true;
    };
    STwain.prototype.previous = function () {
        var _this = this, len = _this._UIManager.count();
        if (len > 0) {
            _this._UIManager.getView().__Previous();
			Funs.__innerRefreshFromUIView(_this, _this._UIManager.GetCurrentImageIndex());
        }
		return true;
    };
    STwain.prototype.next = function () {
        var _this = this, len = _this._UIManager.count();
        if (len > 0) {
            _this._UIManager.getView().__Next();
			Funs.__innerRefreshFromUIView(_this, _this._UIManager.GetCurrentImageIndex());
        }
		return true;
    };
    STwain.prototype.last = function () {
        var _this = this, len = _this._UIManager.count();
        if (len > 0) {
            _this._UIManager.getView().Go(len - 1);
			Funs.__innerRefreshFromUIView(_this, _this._UIManager.GetCurrentImageIndex());
        }
		return true;
    };

    STwain.prototype.SetCancel = function (OnSuccess, OnFailure) {
        return this._innerSend('SetCancel', null, true, OnSuccess, OnFailure);
    };

    // start from 10.0 
    STwain.prototype.SetImageWidth = function (sIndex, NewWidth) {
        return this._innerFun('SetImageWidth', Funs.makeParams(sIndex, NewWidth));
    };

    
	STwain.prototype.HTTPDownloadStreamThroughPost = function(ServerName, RemoteFile){
		//Funs.notSupportMethod("HttpDownloadStreamThroughPost"); // HttpDownloadStreamThroughPost
		Dynamsoft.Lib.Errors.HTML5NotSupport(this);
		return false;
	
		// not support mac
		//if(Dynamsoft.Lib.env.bMac)
		//	return false;
	    //return this._innerFun('HttpDownloadStreamThroughPost', Funs.makeParams(ServerName, RemoteFile));
	};
	STwain.prototype.HTTPUploadStreamThroughPost = function(ServerName, RemoteFile, base64Data, OnSuccess, OnFailure){
        Dynamsoft.Lib.Errors.HTML5NotSupport(this);
		return false;
//		var _this=this, _url = Funs.combineUrl(_this, ServerName, RemoteFile), m='HttpUploadStreamThroughPost', fakeFile;

//		if(base64Data){
//			fakeFile = {
//				name: 'RemoteFile',
//				remoteFilename: 'RemoteFile',
//				data: base64Data,

//				toString: function(){
//					return this.data;
//				}
//			}
//		
//			Funs.httpPostUpload(_this, _url, fakeFile, true, function(){
//				// success
//				Funs.hideMask(m);
//				// _this.__HTTPPostResponseString = result;
//			
//				if(Dynamsoft.Lib.isFunction(sFun)){
//					sFun();
//				}
//			});
//			
//		}
//		
//		return true;
	};
	

    STwain.prototype.HTTPDownloadThroughPost = function (HTTPServer, HTTPRemoteFile, ImageType, OnSuccess, OnFailure) {
        var _this = this, _url = Funs.combineUrl(_this, HTTPServer, HTTPRemoteFile), _get_or_post, ret;
		
		if(_url === false){
			Dynamsoft.Lib.Errors.ParameterCannotEmpty(_this);
			return false;
		}
		
		if (Funs.isServerInvalid(_this)) {
			if (Dynamsoft.Lib.isFunction(OnFailure)) {
				OnFailure(_this.ErrorCode, _this.ErrorString);
			}
			return false;
		}
		
		
        Dynamsoft.Lib.cancelFrome = 2;
        Dynamsoft.Lib.showProgress(_this, 'HttpDownloadThroughPost', true);
        _get_or_post = 'post';
        var _progressFun = function (ev) {
            var p = (ev.total === 0) ? 100 : Math.round(ev.loaded * 100 / ev.total),
				msg = [ev.loaded, ' / ', ev.total].join('');

            _this._OnPercentDone([0, p, '', 'http']);	// http download (post)
        }, _async = true;

        _this._OnPercentDone([0, -1, 'HTTP Downloading...', 'http']);	// http download (post)
		
		if (!Dynamsoft.Lib.isFunction(OnSuccess)) {
			_async = false;
		}
		
        ret = Funs.loadHttpBlob(_this, _get_or_post, _url, _async, function (b) {
            _this._OnPercentDone([0, -1, 'Loading...']);
            // success, send to server
            var f = '', t = ImageType;
            if (t < -1 || t > 5) t = -1;	// out of range, set to -1

            _this.__LoadImageFromBytes(b, t, f, _async, OnSuccess, OnFailure);

        }, function () {
            // failed
            Dynamsoft.Lib.closeProgress('HttpDownloadThroughPost');
            if (Dynamsoft.Lib.isFunction(OnFailure)) {
                OnFailure(_this.ErrorCode, _this.ErrorString);
            }
        }, _progressFun);

        return ret;
    };


    STwain.prototype.HTTPDownloadEx = function (HTTPServer, HTTPRemoteFile, ImageType, OnSuccess, OnFailure) {
        var _this = this;
        return _this.HTTPDownloadThroughGet(HTTPServer, HTTPRemoteFile, ImageType, OnSuccess, OnFailure);
    }

    STwain.prototype.HTTPDownloadThroughGet = function (HTTPServer, HTTPRemoteFile, ImageType, OnSuccess, OnFailure) {
        var _this = this, _url = Funs.combineUrl(_this, HTTPServer, HTTPRemoteFile), _get_or_post, ret;
		
		if(_url === false){
			Dynamsoft.Lib.Errors.ParameterCannotEmpty(_this);
			return false;
		}
		
		if (Funs.isServerInvalid(_this)) {
			if (Dynamsoft.Lib.isFunction(OnFailure)) {
				OnFailure(_this.ErrorCode, _this.ErrorString);
			}
			return false;
		}
		
        Dynamsoft.Lib.cancelFrome = 2;
        _get_or_post = 'get';
        Dynamsoft.Lib.showProgress(_this, "HTTPDownloadThroughGet", true);
        var _progressFun = function (ev) {
            var p = (ev.total === 0) ? 100 : Math.round(ev.loaded * 100 / ev.total),
				msg = [ev.loaded, ' / ', ev.total].join('');

            _this._OnPercentDone([0, p, '', 'http']);	// http download (get)
        }, _async = true;

        _this._OnPercentDone([0, -1, 'HTTP Downloading...', 'http']); // http download (get)
		
		if (!Dynamsoft.Lib.isFunction(OnSuccess)) {
			_async = false;
		}
		
        ret = Funs.loadHttpBlob(_this, _get_or_post, _url, _async, function (b) {
            _this._OnPercentDone([0, -1, 'Loading...']);
            // success, send to server
            var f = '', t = ImageType;
            if (t < -1 || t > 5) t = -1;	// out of range, set to -1

            _this.__LoadImageFromBytes(b, t, f, _async, OnSuccess, OnFailure);

        }, function () {
            // failed
            Dynamsoft.Lib.closeProgress('HTTPDownloadThroughGet');
            if (Dynamsoft.Lib.isFunction(OnFailure)) {
                OnFailure(_this.ErrorCode, _this.ErrorString);
            }
        }, _progressFun);

        return ret;
    }

    //  Set custom DS data (DAT_CUSTOMDSDATA), the input string is encoded with base64
    STwain.prototype.SetCustomDSDataEx = function (strBase64) {
        return this._innerFun('SetCustomDSDataEx', Funs.makeParams(strBase64));
    };
    //  Set custom DS data, load data from the specified file
    STwain.prototype.SetCustomDSData = function (localFile) {
        var f = Funs.replaceLocalFilename(localFile);
        return this._innerFun('SetCustomDSData', Funs.makeParams(f));
    };
    // Get custom DS data, and returned string  is encoded with base64
    STwain.prototype.GetCustomDSDataEx = function () {
        return this._innerFun('GetCustomDSDataEx');
    };
    // Get custom DS data, and save the data to the specified file
    STwain.prototype.GetCustomDSData = function (localFile) {
        var f = Funs.replaceLocalFilename(localFile);
        return this._innerFun('GetCustomDSData', Funs.makeParams(f));
    };


    STwain.prototype.ChangeBitDepth = function (sIndex, sBitDepth, bHighQuality) {
        return this._innerFun('ChangeBitDepth', Funs.makeParams(sIndex, sBitDepth, bHighQuality));
    };
    STwain.prototype.ConvertToGrayScale = function (sIndex) {
        return this._innerFun('ConvertToGrayScale', Funs.makeParams(sIndex));
    };
    STwain.prototype.ShowImageEditorEx = function (x, y, cx, cy, nCmdShow) {
        var _this = this;
        return _this._UIManager.ShowImageEditorEx(x, y, cx, cy, nCmdShow);
    };

    STwain.prototype.ClearTiffCustomTag = function () {
        return this._innerFun('ClearTiffCustomTag');
    };
    STwain.prototype.SetTiffCustomTag = function (Tag, Content, Base64Str) {
        return this._innerFun('SetTiffCustomTag', Funs.makeParams(Tag, Content, Base64Str));
    };
    STwain.prototype.IsBlankImage = function (sIndex) {
        return this._innerFun('IsBlankImage', Funs.makeParams(sIndex, false));
    };
    STwain.prototype.IsBlankImageExpress = function (sIndex) {	// changed in 10.0
        return this._innerFun('IsBlankImage', Funs.makeParams(sIndex, true));
    };

    // -- end 10.0
	
    // -- start 10.1
    STwain.prototype.GetVersionInfoAsync = function (OnSuccess, OnFailure) {	// changed in 10.0
        return this._innerSend('VersionInfo', null, true, OnSuccess, OnFailure);
    };	
    // -- end 10.1

	// -- start 10.3
    STwain.prototype.SetOpenSourceTimeout = function (iCountMs) {	// changed in 10.0
        return this._innerFun('SetOpenSourceTimeout', Funs.makeParams(iCountMs));
    };
	// -- end 10.3
	
})(Dynamsoft.Lib.html5.STwain, Dynamsoft.Lib.html5.Funs);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function (DL) {
	if (!DL.product.bChromeEdition){
		return;
	}
	
	var TRUE = true, FALSE = false, Funs = {
			output: function (msg) {
				//console.log(msg);
			}
		};
		

	function ScrollBar(cfg)
	{
		var _this=this;

		// property
		
		// Position
		_this._maxPosition = 0;
		// Position
		_this._currentPosition = 0;

		// PageDown / PageUp Position
		_this._PagePositionSize = 1.0;
		_this._track = 1.0;
		
		// 
		_this.Horizontal = FALSE;
		
		// 
		_this.Width = 16;	// 16, 
		_this.Height = -1;

		// 
		_this.Left = 0;
		_this.Top = 0;
		_this.Right = 0 + _this.Width;
		_this.Bottom = 0 + _this.Height;

		// 
		_this.bgColor = '#D4D0C8';
		// 
		_this.boxOuterBorderLightColor = '#D4D0C8';
		// 
		_this.boxOuterBorderDarkColor = '#404040';
		// 
		_this.boxInnerBorderLightColor = '#FFFFFF';
		// 
		_this.boxInnerBorderDarkColor = '#808080';
		
		// 
		_this.arrowColor = '#D4D0C8';
		// 
		_this.arrowHoverColor = '#BBBBBB';

		// 
		_this.slideColor = '#D4D0C8';
		// 
		_this.draggingColor = '#BBBBBB';
		
		_this.hoverColor = '#D4D0C8';	// not used
		
		//  /  
		_this.arrowSize = _this.Width;
		// 
		_this.scrollSize = -1;
		// 
		_this.scrollZeroPos = _this.arrowSize;
		
		// 
		_this.slideSize = -1;
		_this.minslideSize = 18;
		
		// 
		_this.dragging = FALSE;
		// 
		_this.mousePos_StartDrag = {'x': -1, 'y': -1};
		// Value
		_this.mousePos_Dragging = {'x': -1, 'y': -1};
		// (not used)
		_this.mousePos = {'x': -1, 'y': -1};
		
		// canvas
		_this.bFocus = FALSE;
			
		_this.borderWidth = 1;	// 1, not used
		_this.borderStyle = 0;	// 0: normal 3D, 1: flat
		_this.canvas = FALSE;
		_this.bFloatValue = TRUE;
		
		// 
		_this.__init(cfg);
	}

	// Method

	ScrollBar.prototype.__changeSizeForData = function (width, height){
		var _this=this;
		_this.Width = width;
		_this.Height = height;
		if(_this.Horizontal){
			_this.scrollSize = _this.Width - 2 * _this.Height;
			_this.arrowSize = _this.Height;
		} else {
			_this.scrollSize = _this.Height - 2 * _this.Width;
			_this.arrowSize = _this.Width;
		}
		_this.scrollZeroPos = _this.arrowSize;
		
		if(_this.canvas){
			_this.canvas.width = width;
			_this.canvas.height = height;
		}
	}

	ScrollBar.prototype.__init = function (cfg){
		var _this=this, doc = window['document'];

		if(cfg.MaxValue)
			_this._maxPosition = cfg.MaxValue;
		if(cfg.Value)
			_this.SetPosition(cfg.Value);
				
		_this.Horizontal = cfg.Horizontal;
		
		
		_this.__changeSizeForData(cfg.Width, cfg.Height);

		// create canvas
		_this.canvas = document.createElement('canvas');
		_this.canvas.width = _this.Width;
		_this.canvas.height = _this.Height;
		_this.canvas.onselectstart = function(){return FALSE};

		
		Dynamsoft.Lib.addEventListener(_this.canvas, 'mousedown', function(evt){
			_this.onMouseDown(evt);
			DL.stopPropagation(evt);
		});

		Dynamsoft.Lib.addEventListener(_this.canvas, 'mouseenter', function(evt){
			_this.bFocus = TRUE;
			//_this.onMouseEnter(evt, _this);
		});
		
		Dynamsoft.Lib.addEventListener(_this.canvas, 'mouseleave', function(evt){
			_this.bFocus = FALSE;
			//_this.onMouseLeave(evt, _this);
		});
		
		/*
		var UA = KISSY.UA, MOUSE_WHEEL = UA.gecko ? 'DOMMouseScroll' : 'mousewheel';
		Dynamsoft.Lib.addEventListener(_this.canvas, MOUSE_WHEEL, function(evt){
			var delta, wheelDelta = originalEvent.wheelDelta, detail = originalEvent.detail;
			if(wheelDelta) {
			  delta = wheelDelta / 120;
			}
			if(detail) {
			  delta = -(detail % 3 === 0 ? detail / 3 : detail);
			}
		});
		*/


		_this['onValueChanged']	= cfg['onValueChanged'];

	};

	ScrollBar.prototype.InitScroll = function(totalSize, pagePositionSize){
		var _this=this, _maxPosition = 0;
		
		if(totalSize >= pagePositionSize && pagePositionSize >= 0){

			_this._PagePositionSize = pagePositionSize;
			_maxPosition = (totalSize - pagePositionSize);
			
			_this.SetMaxPosition(_maxPosition);

			return TRUE;
		}

		return FALSE;
	};
	
	ScrollBar.prototype.GetPagePositionSize = function(){
		var _this=this;
		return _this._PagePositionSize;
	};
	
	ScrollBar.prototype.SetPagePositionSize = function(pagePositionSize){
		var _this=this;
		_this._PagePositionSize = pagePositionSize;
		return TRUE;
	};

	ScrollBar.prototype.__getCurrentPage = function(){
		var _this=this;
		return _this._currentPosition / _this._PagePositionSize;
	};
	
	// Page: Page Number - 1
	ScrollBar.prototype.GetMaxPage = function(){
		var _this=this;
		return _this._maxPosition / _this._PagePositionSize - 1.0;
	};	

	ScrollBar.prototype.GetCurrentPosition = function(){
		var _this=this;
		return _this._currentPosition;
	};
	
	ScrollBar.prototype.SetPosition = function(v){
		var _this=this, _newPos = v;
		
		if(DL.isUndefined(v) || DL.isNaN(v)){
			v = 0;
		}
		
		if(_newPos<0)
			_newPos = 0;
		else if(_newPos>_this._maxPosition)
			_newPos = _this._maxPosition;

		_this._currentPosition = _newPos;
	};
	ScrollBar.prototype.GetEL = function(){
		return this.canvas;
	};
	ScrollBar.prototype.Refresh = function(){
		this.__drawScroll();
		return TRUE;
	};
	ScrollBar.prototype.ChangeControlSize = function(width, height){
		var _this=this;
		_this.__changeSizeForData(width, height);
		
		_this.__drawFrame();
		_this.__drawScroll();
	};
	ScrollBar.prototype.GetControlHeight = function(){
		return this.Height;
	};
	ScrollBar.prototype.GetControlWidth = function(){
		return this.Width;
	};	

	ScrollBar.prototype.onMouseDown = function(evt){
		var _this=this, offset = DL.DOM.getOffset(evt), bHoverClick=FALSE, 
			direction, eventEL, mouseMove, mouseUp, currentPos, oldCurrentPosition;

		Funs.output('mouse down' + offset.x + ' ' + offset.y);
		
		if(_this.Horizontal){
			currentPos = offset.x;
		} else {
			currentPos = offset.y;
		}

		if(currentPos <= _this.arrowSize){
			oldCurrentPosition = _this._currentPosition;
			_this.__click_previous();
			
			if(oldCurrentPosition != _this._currentPosition)
				_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onPrevious'});
		} else if(currentPos >= _this.scrollSize + _this.arrowSize){
			oldCurrentPosition = _this._currentPosition;
			_this.__click_next();
			
			if(oldCurrentPosition != _this._currentPosition)
				_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onNext'});
		} else {
			oldCurrentPosition = _this._currentPosition;
			direction = _this.__getPosDirection(offset.x, offset.y);
			if(direction<0){
				_this.PageUp();
				if(oldCurrentPosition != _this._currentPosition)
					_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onPageUp'});
			} else if(direction>0) {
				_this.PageDown();
				if(oldCurrentPosition != _this._currentPosition)
					_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onPageDown'});
			} else {
				bHoverClick = TRUE;
			}
		}



		if(bHoverClick){
			// mouse down on slide, start dragging
			_this.dragging = TRUE;
			_this.canvas.style.cursor = 'default';
			_this.mousePos_StartDrag.x = offset.x;
			_this.mousePos_StartDrag.y = offset.y;
			_this.mousePos_Dragging.x = offset.x;
			_this.mousePos_Dragging.y = offset.y;

			
			var evtEL, onSelectStart, oEvent = evt || event;
			disX = oEvent.clientX;
			disY = oEvent.clientY;
			
			if (_this.canvas.setCapture) {
				evtEL = _this.canvas;
				_this.canvas.setCapture();
			} else {
				evtEL = document;
			}

			
			onMouseMove = function (ev) {
				var oEvt = ev || event, offset = {'x':0, 'y':0};
				offset.x = _this.mousePos_StartDrag.x + oEvt.clientX - disX;
				offset.y = _this.mousePos_StartDrag.y + oEvt.clientY - disY;
				Funs.output('onMouseMove: ' + offset.x + ' ' + offset.y);
				if(_this.dragging){
					var newPos = _this.__caculateDraggingNewPosition(offset.x, offset.y);
					
					if(newPos != _this._currentPosition){
						_this.SetPosition(newPos);
						_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onMouseMoving'});
					}
					_this.__drawScroll('mousemove');
				}
			};

			onMouseUp = function(ev){
				var oEvt = ev || event, offset = {'x':0, 'y':0};
				offset.x = _this.mousePos_StartDrag.x + oEvt.clientX - disX;
				offset.y = _this.mousePos_StartDrag.y + oEvt.clientY - disY;
				Funs.output('onMouseUp: ' + offset.x + ' ' + offset.y);
				
				if (_this.canvas.releaseCapture) {
					_this.canvas.releaseCapture();
				}
				Dynamsoft.Lib.removeEventListener(evtEL, 'mouseup', onMouseUp);
				Dynamsoft.Lib.removeEventListener(evtEL, 'mousemove', onMouseMove);
				
				if(_this.dragging){
					var newPos = _this.__caculateDraggingNewPosition(offset.x, offset.y);
					if(newPos != _this._currentPosition){
						_this.SetPosition(newPos);
						_this.__drawScroll();
						_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onMouseUp'});
					}
					_this.dragging = FALSE;
					_this.mousePos_StartDrag.x = -1;
					_this.mousePos_StartDrag.y = -1;
				}
			};		
		
			Dynamsoft.Lib.addEventListener(evtEL, 'mouseup', onMouseUp);
			Dynamsoft.Lib.addEventListener(evtEL, 'mousemove', onMouseMove);

			_this.__drawScroll('mousedown');
		}
	};

	ScrollBar.prototype.GetScrollDelta = function(step){
		var _this=this, tmpSlideSize, delta;
		
		// 
		tmpSlideSize = _this.__caculateSlideSize();
		delta = step * tmpSlideSize;
		
		return delta;
	};

	ScrollBar.prototype.ManualMoving = function(delta){

		var _this=this, oldCurrentPosition;
		
		Funs.output('ManualMoving: ' + [_this._currentPosition, delta].join(','));
		if(DL.isUndefined(delta) || DL.isNaN(delta) || DL.isUndefined(_this._currentPosition) || DL.isNaN(_this._currentPosition))
			return;

		oldCurrentPosition = _this._currentPosition;
		
		_this.SetPosition(_this._currentPosition + delta);
		
		if(oldCurrentPosition != _this._currentPosition)
			_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onMouseMoving'});
		_this.__drawScroll('mousemove');
	}

	ScrollBar.prototype.ManualMovingScroll = function(delta){

		var _this=this, newPos=0, tmpSlideSize, oldCurrentPosition;
		
		oldCurrentPosition = _this._currentPosition;
		
		// 
		tmpSlideSize = _this.__caculateSlideSize();

		newPos = _this._currentPosition + (_this._PagePositionSize * delta / tmpSlideSize);
		
		Funs.output('ManualMovingScroll: ' + [delta, tmpSlideSize, delta / tmpSlideSize, _this._currentPosition, newPos].join(','));

		_this.SetPosition(newPos);
		
		if(oldCurrentPosition != _this._currentPosition)
			_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onMouseMoving'});
		_this.__drawScroll('mousemove');
	}

	ScrollBar.prototype.handlerKeyDown = function(evt){
		var _this = this, bGoOn = TRUE, oldCurrentPosition;
		if (!_this.bFocus)
			return bGoOn;
		
		oldCurrentPosition = _this._currentPosition;
		switch (evt.keyCode) {
			case 37: //left arrow
				if(_this.Horizontal){
					bGoOn = FALSE;
					_this.Previous();
					if(oldCurrentPosition != _this._currentPosition)
						_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onPrevious'});
				}

				break;
			case 39: //right arrow
			
				if(_this.Horizontal){
					bGoOn = FALSE;
					_this.Next();
					if(oldCurrentPosition != _this._currentPosition)
						_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onNext'});
				}
				break;
			case 38: //up arrow
				if(!_this.Horizontal){
					bGoOn = FALSE;
					_this.Previous();
					if(oldCurrentPosition != _this._currentPosition)
						_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onPrevious'});
				}
				break;
			case 40: //down arrow
				if(!_this.Horizontal){
					bGoOn = FALSE;
					_this.Next();
					if(oldCurrentPosition != _this._currentPosition)
						_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onNext'});
				}
				break;
			case 33: //page up
				bGoOn = FALSE;
				_this.PageUp();
				if(oldCurrentPosition != _this._currentPosition)
					_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onPageUp'});
				break;
			case 34: //page down
				bGoOn = FALSE;
				_this.PageDown();
				if(oldCurrentPosition != _this._currentPosition)
					_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onPageDown'});
				break;
			case 35: //end
				bGoOn = FALSE;
				_this.GoPosition(_this._maxPosition);
				if(oldCurrentPosition != _this._currentPosition)
					_this.__fireEvent('onValueChanged', {'Value':_this._currentPosition, 'EventName': 'onEnd'});
				break;
			case 36: //home
				bGoOn = FALSE;
				_this.GoPosition(0);
				if(oldCurrentPosition != _this._currentPosition)
					_this.__fireEvent('onValueChanged', {'Value':0, 'EventName': 'onBegin'});
				break;
			default:
				break;
		}

		return bGoOn;

	};


	ScrollBar.prototype.__click_previous = function(){
		var _this = this, ctx;

		Funs.output('__click_previous from mouse click arrow');
		
		_this.GoPosition(_this._currentPosition - _this._track, 200);

		if(_this.canvas){
			ctx = _this.canvas.getContext("2d");
			_this.__redrawUpOrLeftArrow(ctx, TRUE);
		}
	};
	ScrollBar.prototype.__click_next = function(){
		var _this = this, ctx;

		Funs.output('__click_next from mouse click arrow');
		_this.GoPosition(_this._currentPosition + _this._track, 200);
		
		if(_this.canvas){
			ctx = _this.canvas.getContext("2d");
			_this.__redrawDownOrRightArrow(ctx, TRUE);
		}
	};


	ScrollBar.prototype.Previous = function(){
		var _this=this;
		Funs.output('previous');
		_this.GoPosition(_this._currentPosition - _this._track);
	};
	ScrollBar.prototype.Next = function(){
		var _this=this;
		Funs.output('next');
		_this.GoPosition(_this._currentPosition + _this._track);
	};
	ScrollBar.prototype.PageUp = function(){
		var _this=this;
		Funs.output('pageUp');
		_this.GoPosition(_this._currentPosition - _this._PagePositionSize);
	};
	ScrollBar.prototype.PageDown = function(){
		var _this=this;
		Funs.output('pageDown');
		_this.GoPosition(_this._currentPosition + _this._PagePositionSize);
	};
	ScrollBar.prototype.GetMaxPosition = function(){
		return this._maxPosition;
	};	
	ScrollBar.prototype.SetMaxPosition = function(v){
		var _this=this;
		if(DL.isUndefined(v) || DL.isNaN(v)){
			_this._maxPosition = 0;
			_this._currentPosition = 0;
			return;
		}
		
		_this._maxPosition = v;
		if(_this._maxPosition < 0)
			_this._maxPosition = 0;

		if(_this._currentPosition<0)
			_this._currentPosition = 0;
		else if(_this._currentPosition>_this._maxPosition)
			_this._currentPosition = _this._maxPosition;

	};
	
	ScrollBar.prototype.GoPage = function(page){
		var _this=this, newPos;
		Funs.output('go page: ' + page);

		newPos =  page * _this._PagePositionSize;
		
		return _this.GoPosition(newPos);
	};
	
	ScrollBar.prototype.GoPosition = function(newPos, refreshTime){
		var _this=this, page;
		Funs.output('go position: ' + newPos);

		_this.SetPosition(newPos);
		
		if(refreshTime && refreshTime>0){
			setTimeout(function(){
				_this.__drawScroll();
			}, refreshTime);
		} else {
			_this.__drawScroll();
		}			
	};

	// box
	ScrollBar.prototype.__drawBoxBorder = function(ctx, 
			left, top, width, height, 
			lightColor, darkColor){
			
		var _this = this, x, y, i, p, imgData, lightHex, darkHex, _left, _top, _width, _height;
		
		_left = Math.floor(left);
		_top = Math.floor(top);
		
		if(width<=0 || height<=0){
			return;
		}
		
		try{
			_width = Math.floor(width);
			_height = Math.floor(height);
		}catch(e){
			return;
		}
		

		imgData = ctx.getImageData(_left, _top, _width, _height);
		p = imgData.data;
		lightHex = _this.__getHexColor(lightColor);
		darkHex = _this.__getHexColor(darkColor);

		// Funs.output('draw border: ' + [_left, _top, _width, _height, lightHex, darkHex].join(','));

		// , border light color
		i = 0;
		for (x=0; x<_width; x++){
			p[i] = lightHex[0];
			p[i+1] = lightHex[1];
			p[i+2] = lightHex[2];
			i+=4;
		}
		
		x = 0;
		for (y=0; y<_height; y++){
			i = (y*_width + x)*4;
			p[i] = lightHex[0];
			p[i+1] = lightHex[1];
			p[i+2] = lightHex[2];
		}

		// , border dark color
		for (y=0; y<_height; y++){
			x = _width-1;
			i = (y*_width + x)*4;
			p[i] = darkHex[0];
			p[i+1] = darkHex[1];
			p[i+2] = darkHex[2];
		}
		
		i = (_height - 1) * _width * 4;
		for (x=0; x<_width; x++){
			p[i] = darkHex[0];
			p[i+1] = darkHex[1];
			p[i+2] = darkHex[2];
			i+=4;
		}
		
		ctx.putImageData(imgData, _left, _top);

	};

	// 
	ScrollBar.prototype.__drawUpTriangle = function(ctx, left, top){

		var _this = this, x, y, i, p, imgData, max, w=9, h=4, _left, _top, _width, _height;
		
		_left = Math.floor(left);
		_top = Math.floor(top);
		
		_width = Math.floor(w);
		_height = Math.floor(h);

		imgData = ctx.getImageData(_left, _top, _width, _height);
		
		p = imgData.data;
		
		for (y=0; y<4; y++){
			x = 4-y;
			max = x + 1 + 2*y;
			
			i = (y*w + x)*4;
			while (x<max){
				p[i] = p[i+1] = p[i+2] = 0;
				x++;
				i+=4;
			}
		}

		ctx.putImageData(imgData, left, top);

	};

	// 
	ScrollBar.prototype.__drawDownTriangle = function(ctx, left, top){


		var _this = this, x, y, i, p, imgData, max, w=9, h=4, _left, _top, _width, _height;
		
		_left = Math.floor(left);
		_top = Math.floor(top);
		
		_width = Math.floor(w);
		_height = Math.floor(h);

		imgData = ctx.getImageData(_left, _top, _width, _height);
		p = imgData.data;
		
		for (y=0; y<4; y++){
			x = y;
			max = x + 7 - 2*y;
			
			i = (y*w + x)*4;
			while (x<max){
				p[i] = p[i+1] = p[i+2] = 0;
				x++;
				i+=4;
			}
		}

		ctx.putImageData(imgData, left, top);
		
	};

	// 
	ScrollBar.prototype.__drawLeftTriangle = function(ctx, left, top){

		var _this = this, x, y, i, p, imgData, max, w=4, h=7, _left, _top, _width, _height;
		_left = Math.floor(left);
		_top = Math.floor(top);
		
		_width = Math.floor(w);
		_height = Math.floor(h);

		imgData = ctx.getImageData(_left, _top, _width, _height);
		p = imgData.data;
		for (y=0; y<h; y++){

			if(y>3)
				x = y-3;
			else
				x = 3-y;
				
			i = (y*w + x)*4;
			while (x<w){
				p[i] = p[i+1] = p[i+2] = 0;
				x++;
				i+=4;
			}
		}

		ctx.putImageData(imgData, left, top);

	};

	// 
	ScrollBar.prototype.__drawRightTriangle = function(ctx, left, top){

		var _this = this, x, y, i, p, imgData, w=4, h=7, _left, _top, _width, _height;
		_left = Math.floor(left);
		_top = Math.floor(top);
		
		_width = Math.floor(w);
		_height = Math.floor(h);

		imgData = ctx.getImageData(_left, _top, _width, _height);
		p = imgData.data;
		
		for (y=0; y<h; y++){
			x = 0;
			
			if(y>3)
				max= 7-y;
			else
				max = y+1;

			i = (y*w + x)*4;
			while (x<max){
				p[i] = p[i+1] = p[i+2] = 0;
				x++;
				i+=4;
			}
		}
		

		ctx.putImageData(imgData, left, top);
		
	};

	// box3D
	ScrollBar.prototype.__drawBox = function(ctx, 
			left, top, width, height, 
			bgColor,
			outLightColor, outDarkColor,
			innerLightColor, innerDarkColor)
	{
		var _this=this, dt=0, _width, _height;
		
		if(width<=0 || height<=0){
			return;
		}
		
		try{
			_width = Math.floor(width);
			_height = Math.floor(height);
		}catch(e){
			return;
		}
		
		// 
		ctx.fillStyle = bgColor;
		ctx.fillRect(left, top, _width, _height);

		// 
		ctx.lineWidth = _this.borderWidth;
		
		// 
		DL.drawBoxBorder(ctx, 
			left+dt, top+dt, _width-dt, _height-dt, 
			outLightColor, outDarkColor);
		
		
		left += _this.borderWidth;
		top += _this.borderWidth;
		_width -= 2 * _this.borderWidth;
		_height -= 2 * _this.borderWidth;
		
		// 
		DL.drawBoxBorder(ctx, 
			left+dt, top+dt, _width-dt, _height-dt, 
			innerLightColor, innerDarkColor);

	};

	// 
	ScrollBar.prototype.__drawBackground = function(ctx, w, h){
		var _this = this, x, y, i, p, imgData, _left, _top, _width, _height;
		
		ctx.fillStyle = _this.bgColor;
		if(_this.Width > 0 && _this.Height > 0)
		{
		    ctx.fillRect(_this.borderWidth, _this.borderWidth, _this.Width - 2 * _this.borderWidth, _this.Height - 2 * _this.borderWidth);
		
		    _left = 0;
		    _top = 0;
    		
		    _width = Math.floor(w);
		    _height = Math.floor(h);

		    imgData = ctx.getImageData(_left, _top, _width, _height);
		    p = imgData.data;
		    for (y=0; y<h; y++){
			    x = (y%2);
			    i = (y*w + x)*4;
			    while (x<w){
				    p[i] = p[i+1] = p[i+2] = 255;
				    x+=2;
				    i+=8;
			    }
		    }

		    ctx.putImageData(imgData, 0, 0);
		}
		
	};

	// 
	ScrollBar.prototype.__drawUpButton = function(ctx, bHover){
		var _this = this, bgColor;
		
		if(bHover)
			bgColor = _this.arrowHoverColor;
		else
			bgColor = _this.arrowColor;
			
		// 
		_this.__drawBox(ctx, 
			0, 0, _this.arrowSize, _this.arrowSize, 
			bgColor,
			_this.boxOuterBorderLightColor, _this.boxOuterBorderDarkColor,
			_this.boxInnerBorderLightColor, _this.boxInnerBorderDarkColor);
		
		// 
		_this.__drawUpTriangle(ctx, 3, 6, _this.arrowColor);

	};	

	// 
	ScrollBar.prototype.__drawDownButton = function(ctx, bHover){
		var _this = this, bgColor;
		
		if(bHover)
			bgColor = _this.arrowHoverColor;
		else
			bgColor = _this.arrowColor;
			
		// 
		_this.__drawBox(ctx, 
			0, _this.Height - _this.arrowSize, _this.arrowSize, _this.arrowSize,
			bgColor,		
			_this.boxOuterBorderLightColor, _this.boxOuterBorderDarkColor,
			_this.boxInnerBorderLightColor, _this.boxInnerBorderDarkColor);

		// 
		_this.__drawDownTriangle(ctx, 4, _this.Height - 10, _this.arrowColor);
	};

	// 
	ScrollBar.prototype.__drawLeftButton = function(ctx, bHover){
		var _this = this, bgColor;
		
		if(bHover)
			bgColor = _this.arrowHoverColor;
		else
			bgColor = _this.arrowColor;
			
		// 
		_this.__drawBox(ctx, 
			0, 0, _this.arrowSize, _this.arrowSize, 
			bgColor,
			_this.boxOuterBorderLightColor, _this.boxOuterBorderDarkColor,
			_this.boxInnerBorderLightColor, _this.boxInnerBorderDarkColor);
		
		// 
		_this.__drawLeftTriangle(ctx, 5, 4, _this.arrowColor);

	};	

	// 
	ScrollBar.prototype.__drawRightButton = function(ctx, bHover){
		var _this = this, bgColor;
		
		if(bHover)
			bgColor = _this.arrowHoverColor;
		else
			bgColor = _this.arrowColor;
			
		// 
		_this.__drawBox(ctx, 
			_this.Width - _this.arrowSize, 0, _this.arrowSize, _this.arrowSize, 
			bgColor,
			_this.boxOuterBorderLightColor, _this.boxOuterBorderDarkColor,
			_this.boxInnerBorderLightColor, _this.boxInnerBorderDarkColor);

		// 
		_this.__drawRightTriangle(ctx, _this.Width - 10, 4, _this.arrowColor);
	};

	// ,
	ScrollBar.prototype.__drawFrame = function(){
		var _this = this, ctx, bHover = FALSE;
		if(_this.canvas){
			ctx = _this.canvas.getContext("2d");

			// 
			ctx.clearRect(0, 0, _this.Width, _this.Height);	

			_this.__drawBackground(ctx, _this.Width, _this.Height);

			_this.__redrawUpOrLeftArrow(ctx, bHover);
			_this.__redrawDownOrRightArrow(ctx, bHover);
		}
	};
	//  / , 
	ScrollBar.prototype.__redrawUpOrLeftArrow = function(ctx, bHover){
		var _this = this;
		if(_this.Horizontal){
			// 
			_this.__drawLeftButton(ctx, bHover);
		} else {
			// 
			_this.__drawUpButton(ctx, bHover);
		}
	};
	//  / , 
	ScrollBar.prototype.__redrawDownOrRightArrow = function(ctx, bHover){
		var _this = this;
		if(_this.Horizontal){
			// 
			_this.__drawRightButton(ctx, bHover);
		} else {
			// 
			_this.__drawDownButton(ctx, bHover);
		}
	};

	/*
	'mousedown'
	'mousemove'
	'mouseover'
	'mouseup'
	*/
	ScrollBar.prototype.__drawScroll = function(_eventType){

		var _this = this, scrollLength = 0, tmpNewSlideBegin, tmpSlideSize, eventType = _eventType || '', ctx, fillStyle;

		if (_this._maxPosition > 0 && _this.canvas) {
			_this.canvas.style.display = '';

			// 
			tmpSlideSize = _this.__caculateSlideSize();
			
			// , 
			tmpNewSlideBegin = Math.ceil(_this.scrollZeroPos + _this._currentPosition * tmpSlideSize / _this._PagePositionSize);
			
			Funs.output('__drawScroll: ' + [tmpNewSlideBegin, _this.__getCurrentPage(), tmpSlideSize].join(','));

			ctx = _this.canvas.getContext("2d");
			
			_this.__drawFrame();
			
			//hover or click on the glider
			if (eventType == 'mousedown' || eventType == 'mousemove') {
				fillStyle = _this.bgColor; // _this.draggingColor;
			} else {
				fillStyle = _this.bgColor;
			}
			
			// 
			if(_this.Horizontal){
				_this.__drawBox(ctx,
					tmpNewSlideBegin, 0, _this.slideSize, _this.Height, 
					fillStyle,
					_this.boxOuterBorderLightColor, _this.boxOuterBorderDarkColor,
					_this.boxInnerBorderLightColor, _this.boxInnerBorderDarkColor);
					
			} else {
				_this.__drawBox(ctx,
					0, tmpNewSlideBegin, _this.Width, _this.slideSize, 
					fillStyle,
					_this.boxOuterBorderLightColor, _this.boxOuterBorderDarkColor,
					_this.boxInnerBorderLightColor, _this.boxInnerBorderDarkColor);
			}


		} else {
			if(_this.canvas) {
				_this.canvas.style.display = 'none';
			}
		}
	};

	// Value
	ScrollBar.prototype.__caculateDraggingNewPosition = function(x,y){

		var _this=this, tmpSlideSize, newPos=0, delta=0, mouseClickPos;
		// 
		tmpSlideSize = _this.__caculateSlideSize();
		
		slidePos = _this.__caculateSlidePos();

		if(_this.Horizontal){
			startPos = x - _this.arrowSize;
			delta = x - _this.mousePos_Dragging.x;
			mouseClickPos = x;
		} else {
			startPos = y - _this.arrowSize;
			delta = y - _this.mousePos_Dragging.y;
			mouseClickPos = y;
		}

		Funs.output('__caculateDraggingNewPosition: ' + [_this._currentPosition, _this._PagePositionSize, delta, tmpSlideSize].join(','));
		newPos = _this._currentPosition + (_this._PagePositionSize * delta / tmpSlideSize);
		
		if(newPos < 0)
			newPos = 0;

		if(newPos>_this._maxPosition)
			newPos = _this._maxPosition;
		
		_this.mousePos_Dragging.x = x;
		_this.mousePos_Dragging.y = y;

		return newPos;
	};
	// 
	// -1: /  0:(hover)  1: /
	ScrollBar.prototype.__getPosDirection = function(x,y){

		var _this=this, slidePos, mouseClickPos;
		slidePos = _this.__caculateSlidePos();
		
		if(_this.Horizontal){
			mouseClickPos = x;
		} else {
			mouseClickPos = y;
		}
			
		if(mouseClickPos<slidePos.start){
			return -1;
		} else if(mouseClickPos<=slidePos.end){
			return 0;
		} else {
			return 1;
		}
	};

	// 
	ScrollBar.prototype.__caculateSlidePos = function(){

		var _this=this, pos={'start':0, 'end':0}, tmpSlideSize, maxEnd;

		// 
		tmpSlideSize = _this.__caculateSlideSize();
		
		maxEnd = _this.scrollSize + _this.arrowSize;
		
		pos.start = _this.__getCurrentPage() * tmpSlideSize + _this.arrowSize;
		pos.end = pos.start + _this.slideSize;
		
		if(pos.end >= maxEnd){
			pos.end = maxEnd;
			pos.start = maxEnd - _this.slideSize;
		}
		
		return pos;
	};


	// 
	// 1Pos
	ScrollBar.prototype.__caculateSlideSize = function(){
		var _this=this, tmpSlideSize=0, scroll_size=0;
		scroll_size = _this.scrollSize;

		if(_this._maxPosition > 0 && scroll_size > 0){
			
			//  = scroll * ( Pos / Pos),  Pos = Pos + Pos
			_this.slideSize = scroll_size * (_this._PagePositionSize / (_this._maxPosition + _this._PagePositionSize));
			
			//  
			if(_this.slideSize < _this.minslideSize){
				
				//  = 
				_this.slideSize = _this.minslideSize;
				
				// 1Pos
				tmpSlideSize = (scroll_size - _this.slideSize) * _this._PagePositionSize / (_this._maxPosition);
			} else {
				// 1Pos
				tmpSlideSize = _this.slideSize;
			}
		}

		return tmpSlideSize;
	};

	ScrollBar.prototype.__fireEvent = function (evtName, params) {
		var _this = this;
		if (DL.isFunction(_this[evtName])) {
			return _this[evtName](params);
		}
		return TRUE;
	};

	ScrollBar.prototype.SetVisible = function(bShow){
		var _this=this;
		
		if(_this.canvas){
			if(bShow){
				_this.canvas.style.display = '';
				_this.__drawFrame();
				_this.__drawScroll();	
			} else {
				_this._maxPosition = 0;
				_this._currentPosition = 0;
				_this.canvas.style.display = 'none';
			}
		}
	};
	ScrollBar.prototype.GetVisible = function(){
		var _this=this;
		
		if(_this.canvas){
			if(_this.canvas.style.display == 'none'){
				return FALSE;
			} else {
				return TRUE;
			}
		}
		return FALSE;
	};

	ScrollBar.prototype.Destroy = function(){
		var _this=this;
		
		_this._maxPosition = 0;
		_this._currentPosition = 0;
		
	};

	// 
	ScrollBar.prototype.SetLocation = function (x, y){
		var _this=this;
		_this.Left = x;
		_this.Top = y;
		_this.Right = x + _this.Width;
		_this.Bottom = x + _this.Height;
		
		// scroll bar 
		if(_this.canvas){
			if(_this.canvas.parentNode)
				_this.canvas.parentNode.style.position = "relative";
			_this.canvas.style.position = "absolute";
			_this.canvas.style.left = x + 'px';
			_this.canvas.style.top = y + 'px';
		}
	};


	/*
	// Event
	OnScrollToBegin
	OnScrollToEnd

	OnPageUp (ScrollUp/ScrollLeft)
	OnPageDown (ScrollDown/ScrollRight)

	OnUp		(-1)
	OnDown	(+1)

	OnKeyUp
	OnKeyDown
	OnMouseWheel


	*/


    Dynamsoft.Lib.UI = Dynamsoft.Lib.UI || {};
	Dynamsoft.Lib.UI['ScrollBar'] = ScrollBar;
	
})(Dynamsoft.Lib);


// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function (DL) {
	if (!DL.product.bChromeEdition){
		return;
	}
	
	var Funs = {
			output: function (msg) {
				 //console.log(msg);
			}
		};

	function ImageAreaSelector(parent){
		var _this=this;
				
		_this.__controlWidth = 0;
		_this.__controlHeight = 0;
		
		// draw Area
		_this.drawWidth = 0;
		_this.drawHeight = 0;
		_this.Left = 0;
		_this.Top = 0;
		_this.Right = 0;
		_this.Bottom = 0;
		
		_this.imageControl = parent;
		
		// if starting drawing rect
		_this.__mousedownStatus = 0;		// 0: no mousedown  1: mousedown for drawing rect  2: mousedown for moving rect
		
		// the mouse start pos when drawing
		_this.mouse_zero_x = -1;
		_this.mouse_zero_y = -1;
		
		// the current mouse pos
		_this.mouse_x = 0;
		_this.mouse_y = 0;

		
		// the selected area on Current Canvas Layer
		_this.selectedCanvasArea = {
			left: 0,
			top: 0,
			right:0,
			bottom: 0
		};
		
		_this.canvas = false;
		_this.lastClick = false;
	};
	
	
	ImageAreaSelector.prototype.GetEL = function () {
		var _this = this;
		
		if(!_this.canvas){
			_this.canvas = document.createElement('canvas');
			_this.canvas.style.position = 'absolute';
			_this.canvas.style.left = '0';
			_this.canvas.style.top = '0';
		}
		
		return _this.canvas;
	};

	ImageAreaSelector.prototype.ChangeControlSize = function (width, height) {
		var _this = this, p;

		
		// 
		_this.__controlWidth = width;
		_this.__controlHeight = height;

		// canvas 
		if(_this.canvas){
			_this.canvas.width = _this.__controlWidth;
			_this.canvas.height = _this.__controlHeight;
		}
	};

	// 
	ImageAreaSelector.prototype.SetDrawImageLocationAndSize = function (left, top, width, height){
		var _this = this;

		Funs.output('SetLocationAndSize: ' + [left, top, width, height].join(','));

		// 
		_this.drawWidth = width;
		_this.drawHeight = height;
		
		// 
		_this.Left = left;
		_this.Top = top;
		
		// 
		_this.Right = _this.Left + _this.drawWidth;
		_this.Bottom = _this.Top + _this.drawHeight;

	};

	ImageAreaSelector.prototype.__fireEvent = function (evtName, params) {
		var _this = this;
		if (DL.isFunction(_this[evtName])) {
			return _this[evtName](params);
		}
		return true;
	};
	ImageAreaSelector.prototype.__GetMouseShape = function () {
		var _this = this;
		return _this.imageControl.bMouseHand;
	};

	ImageAreaSelector.prototype.__GetSelectionRectAspectRatio = function () {
		var _this = this;
		return _this.imageControl.__fSelectionRectAspectRatio;
	};

	ImageAreaSelector.prototype.__restoreCanvas = function (ctx, w, h) {
		var _this = this;
		//ctx.clearRect(0, 0, w, h);
		ctx.canvas.width = w;
		ctx.canvas.height = h;
	};
	
	
	// 
	ImageAreaSelector.prototype.__draw_dashRect = function (left, top, width, height) {
		var _this = this, ctx = _this.canvas.getContext("2d"), 
			_MaxWidth = _this.drawWidth, _MaxHeight = _this.drawHeight,
			_left = left, _top = top, _width = width, _height = height;

		if(!_this.canvas)
			return;
		Funs.output('__select_rect: ' + [left, top, width, height].join(','));
		
		if(_width < 0){
			//_width = -_width;
			//_left = _left - _width;
		}
		if(_width>_MaxWidth){
			_width=_MaxWidth;
		}
			
		if(_height < 0){
			//_height = -_height;
			//_top = _top - _height;
		}
		if(_height>_MaxHeight){
			_height=_MaxHeight;
		}
		
		if(_left<0){
			_left = 0;
		}else if(_left+_width>_MaxWidth){
			_width = _MaxWidth-_left;
		}

		if(_top<0){
			_top = 0;
		} else if(_top+_height>_MaxHeight){
			_height = _MaxHeight-_top;
		}

		ctx = _this.canvas.getContext("2d");
		_this.__restoreCanvas(ctx, ctx.canvas.width, ctx.canvas.height);
		
		if(_width > 0 && _height > 0)
			ctx.__dashedLineRect(_left + _this.Left, _top + _this.Top, _width, _height);
	};
	
	// Set Selected Area
	ImageAreaSelector.prototype.SetSelectedArea = function (left, top, right, bottom, bFireEvent) {
		var _this = this, ctx = _this.canvas.getContext("2d"), 
			_left, _top, _right, _bottom, _width, _height, 
			_MaxWidth = _this.drawWidth, _MaxHeight = _this.drawHeight,
			bDeselected = false;

		Funs.output('SetSelectedArea: ' + [left, top, right, bottom].join(','));
		if(!_this.canvas)
			return false;
		
		// (left,top), (right,bottom)
		if(left < right){
			_left = left;
			_right = right;
		} else {
			_left = right;
			_right = left;
		}
		
		if(top < bottom){
			_top = top;
			_bottom = bottom;
		} else {
			_top = bottom;
			_bottom = top;
		}		
		
		// 
		if(_left<0)
			_left = 0;
		if(_top<0)
			_top = 0;
			
		_width = _right - _left;
		_height = _bottom - _top;
				
		if(_width>_MaxWidth){
			_width=_MaxWidth;
			_right = _left + _width;
		}
		if(_height>_MaxHeight){
			_height=_MaxHeight;
			_bottom = _top + _height;
		}
		
		// deSelected
		if(left > _MaxWidth || top > _MaxHeight){
			// 
			bDeselected = true;
		} else if(Math.abs(_width) + Math.abs(_height) <= 5){
			// 
			bDeselected = true;
		}
		
		// 
		
		if(bDeselected){
		
			_left = _this.selectedCanvasArea.left;
			_top = _this.selectedCanvasArea.top;
			_right = _this.selectedCanvasArea.right;
			_bottom = _this.selectedCanvasArea.bottom;
			
			
			if(_left==0 && _top==0 && _right==0 && _bottom==0){

			} else {
			
				_this.selectedCanvasArea.left = 0;
				_this.selectedCanvasArea.top = 0;
				_this.selectedCanvasArea.right = 0;
				_this.selectedCanvasArea.bottom = 0;
				
				// deSelected
				_this.__restoreCanvas(ctx, ctx.canvas.width, ctx.canvas.height);
				
				// deSelected
				if(bFireEvent){
					_this.__fireEvent('onImageAreaDeSelected');
				}
			}
			
		} else {
		
			_this.selectedCanvasArea.left = _left;
			_this.selectedCanvasArea.top = _top;
			_this.selectedCanvasArea.right = _right;
			_this.selectedCanvasArea.bottom = _bottom;

			_this.__draw_dashRect(_left, _top, _width, _height);

			if(bFireEvent && (_this.__mousedownStatus==0)){
				_this.__fireEvent('onImageAreaSelected', {
					'left': _left,
					'top': _top,
					'right': _right,
					'bottom': _bottom,
					'fromScroll': false
				});
			}
		}

		return true;
	};
	
	
	ImageAreaSelector.prototype.ReFireSelectedEventWhenImageMoved = function () {
		var _this = this, _left, _top, _right, _bottom;
		
		_left = _this.selectedCanvasArea.left;
		_top = _this.selectedCanvasArea.top;
		_right = _this.selectedCanvasArea.right;
		_bottom = _this.selectedCanvasArea.bottom;
		
		if(_left != 0 && _top != 0 && _right != 0 && _bottom != 0){
			_this.__fireEvent('onImageAreaSelected', {
				'left': _left,
				'top': _top,
				'right': _right,
				'bottom': _bottom,
				'fromScroll': true
			});
		}

	};


	ImageAreaSelector.prototype.SetMouseShape = function (bMouseHandShape) {
		var _this = this, ctx, _left, _top, _right, _bottom;
		
		if(_this.canvas){
			ctx = _this.canvas.getContext("2d")
			if (bMouseHandShape) {
				// cursor style: mouse hand
				_this.canvas.style.cursor = 'pointer';

				_left = _this.selectedCanvasArea.left;
				_top = _this.selectedCanvasArea.top;
				_right = _this.selectedCanvasArea.right;
				_bottom = _this.selectedCanvasArea.bottom;
		
				if(_left==0 && _top==0 && _right==0 && _bottom==0){
					
				} else {
					_this.SetSelectedArea(0, 0, 0, 0, true);
				}
			} else {
				// cursor style: +
				_this.canvas.style.cursor = 'crosshair';
			};
		}

	};
	
	ImageAreaSelector.prototype.Destroy = function(){
		var _this=this, p;
		Funs.output('Destroy:');
		if(_this.canvas){
			p = _this.canvas.parentNode;
			if(p){
				p.removeChild(_this.canvas);
			}
		}

		// remove from events list
		var evtObjs = Dynamsoft.Lib.UI['ImageAreaSelectorEvt'],
			index = evtObjs.indexOf(_this);
			
		if (index >= 0)
			evtObjs.splice(index, 1);

	};
	
	ImageAreaSelector.prototype.__movingRect = function () {
		
	
	};
	
	ImageAreaSelector.prototype.__funReSelectArea = function(bOut) {
	
		var _this = this, _left, _top, _right, _bottom, ratio, bFireEvent = true;
		_left = _this.mouse_zero_x;
		_top = _this.mouse_zero_y;
		_right = _this.mouse_x;
		_bottom = _this.mouse_y;
		
		ratio = _this.__GetSelectionRectAspectRatio();
		
		if(ratio > 0){
			var tmpWidth, tmpHeight, _tmp = 1;
			
			if(ratio < 1){
				tmpHeight = _bottom - _top;
				tmpWidth = tmpHeight * ratio;

				if(_right > _left && _bottom > _top || _right < _left && _bottom < _top){
					// (left,top) -> (right,bottom) or (right,bottom) -> (left,top), change _right to add tmpWidth
					_right = _left + tmpWidth;
					_tmp = -1;
					
					// means: tmpWidth = _right - _left = _tmp * (_left - _right);
				} else if (_right > _left && _bottom < _top || _right < _left && _bottom > _top){
					// (left,bottom) -> (right,top) or (right,top) -> (left,bottom), change _right to sub tmpWidth
					_right = _left - tmpWidth;
					
					// means: tmpWidth = _left - _right = _tmp * (_left - _right);
				}


				//  _right  _bottom
				if(_right > _this.drawWidth || _right < 0){
					
					if(_right > _this.drawWidth){
						_right = _this.drawWidth;
					} else if(_right < 0){
						_right = 0;
					}
					
					tmpWidth = _tmp * (_left - _right);
					tmpHeight = tmpWidth / ratio;
					_bottom = _top + tmpHeight;
				}
				
				
			} else {
				tmpWidth = _right - _left;
				tmpHeight = tmpWidth / ratio;
				
				
				if(_right > _left && _bottom > _top || _right < _left && _bottom < _top){
					// (left,top) -> (right,bottom) or (right,bottom) -> (left,top), change _bottom to add tmpHeight
					_bottom = _top + tmpHeight;					
					_tmp = -1;
					
					// means: tmpHeight = _bottom - _top = _tmp * (_top - _bottom);

				} else if (_right > _left && _bottom < _top || _right < _left && _bottom > _top){
					// (left,bottom) -> (right,top) or (right,top) -> (left,bottom), change _bottom to sub tmpHeight
					_bottom = _top - tmpHeight;
					
					// means: tmpHeight = _top - _bottom = _tmp * (_top - _bottom);

				}
				
				//  _bottom _right
				if(_bottom > _this.drawHeight || _bottom < 0){
					
					if(_bottom > _this.drawHeight){
						_bottom = _this.drawHeight;
					} else if(_bottom < 0){
						_bottom = 0;
					}
					
					tmpHeight = _tmp * (_top - _bottom);
					tmpWidth = tmpHeight * ratio;
					_right = _left + tmpWidth;
				}
				
				
			}
		}
		
		_this.SetSelectedArea(_left, _top, _right, _bottom, true);
	};
	
	ImageAreaSelector.prototype.BindEvents = function () {
		var _this = this, ctx;

		ctx = _this.canvas.getContext("2d");
		
		Dynamsoft.Lib.UI['ImageAreaSelectorEvt'].push(_this);
				
		Dynamsoft.Lib.addEventListener(_this.canvas, 'mousemove', function (evt) {
			var mousePos;
			
			mousePos = DL.DOM.getOffset(evt, _this);
			if(mousePos.x<0)
				mousePos.x = 0;
			else if(mousePos.x>_this.drawWidth)
				mousePos.x = _this.drawWidth;
			
			if(mousePos.y<0)
				mousePos.y = 0;
			else if(mousePos.y>_this.drawHeight)
				mousePos.y = _this.drawHeight;

			/*
			if(!_this.__GetMouseShape())
			{
				if(_this.__isInSelectedArea(mousePos)){
					_this.canvas.style.cursor = 'move';
				} else {
					_this.canvas.style.cursor = 'crosshair';
				}
			}
			*/

			if(_this.__mousedownStatus){
				if(mousePos.x == _this.mouse_zero_x && mousePos.y == _this.mouse_zero_y){
					// not move
					return;
				}
			}
			
			
			_this.mouse_x = mousePos.x;
			_this.mouse_y = mousePos.y;
			
			_this.__fireEvent('onMouseMove', { 'e': evt, 
					'dragging': (_this.__mousedownStatus!=0),
					'x': mousePos.x, 'y': mousePos.y, 
					'origX': _this.mouse_zero_x, 'origY': _this.mouse_zero_y});
					
			if(!_this.__GetMouseShape())
			{
				if(_this.__mousedownStatus){
					_this.__funReSelectArea();
				}
			}
		});

		Dynamsoft.Lib.addEventListener(_this.canvas, 'mousedown', function (evt) {
			var mousePos, cDate = new Date(), diffDate;
			
			_this.__mousedownStatus = 1;
			if(_this.lastClick){
				diffDate = cDate.getTime() - _this.lastClick.getTime();
			}
			
			_this.lastClick = cDate;
			mousePos = DL.DOM.getOffset(evt, _this);
			
			if(mousePos.x<0)
				mousePos.x = 0;
			else if(mousePos.x>_this.drawWidth)
				mousePos.x = _this.drawWidth;
			
			if(mousePos.y<0)
				mousePos.y = 0;
			else if(mousePos.y>_this.drawHeight)
				mousePos.y = _this.drawHeight;
			
			Funs.output('click on selector canvase: ' + [mousePos.x, mousePos.y].join(','));
			
			//  ()
			//if(!_this.__isInSelectedArea(pos)){
				// 
				_this.SetSelectedArea(0, 0, 0, 0, true);
			//} else {
				// 
			//}
			
			_this.mouse_zero_x = parseInt(mousePos.x);
			_this.mouse_zero_y = parseInt(mousePos.y);

			if(diffDate < 500){
				// double click
				_this.__fireEvent('onMouseDoubleClick', { 'e': evt, 'x': mousePos.x, 'y': mousePos.y });
				_this.lastClick = false;
			} else {
				if (evt.which ? evt.which == 3 : evt.button == 2) {
					// 
					_this.__fireEvent('onMouseRightClick', { 'e': evt, 'x': mousePos.x, 'y': mousePos.y });
				} else {
					// 
					_this.__fireEvent('onMouseClick', { 'e': evt, 'x': mousePos.x, 'y': mousePos.y });
				}
			}
			

			DL.stopPropagation(evt);
		});


		Dynamsoft.Lib.addEventListener(_this.canvas, 'mouseup', function (evt) {
			var mousePos;
			
			
			if(_this.mouse_zero_x < 0 &&_this.mouse_zero_y < 0){
				_this.__mousedownStatus = 0;
				_this.mouse_zero_x = -1;
				_this.mouse_zero_y = -1;
				return;
			}
			
			mousePos = DL.DOM.getOffset(evt, _this);
			if(mousePos.x<0)
				mousePos.x = 0;
			else if(mousePos.x>_this.drawWidth)
				mousePos.x = _this.drawWidth;
			
			if(mousePos.y<0)
				mousePos.y = 0;
			else if(mousePos.y>_this.drawHeight)
				mousePos.y = _this.drawHeight;

			_this.mouse_x = mousePos.x;
			_this.mouse_y = mousePos.y;
			_this.__mousedownStatus = 0;
			
			if(_this.__GetMouseShape())
			{
				// deselect			
				_this.__restoreCanvas(ctx, ctx.canvas.width, ctx.canvas.height);
				//_this.__fireEvent('onMouseUp', { 'e': evt, 'x': mousePos.x, 'y': mousePos.y });

			} else {
				var deltaX = mousePos.x - _this.mouse_zero_x, deltaY = mousePos.y - _this.mouse_zero_y;

				if(Math.abs(deltaX)<3 && Math.abs(deltaY)<3){
					// Ignore mouse click
				} else {
					_this.__funReSelectArea();
					_this.__fireEvent('onMouseUp', { 'e': evt, 'x': mousePos.x, 'y': mousePos.y, 'out': false});
				}
			}
			
			_this.mouse_zero_x = -1;
			_this.mouse_zero_y = -1;
			DL.stopPropagation(evt);
		});

	};

	ImageAreaSelector.prototype.__InvokeMouseUpOutside = function (evt) {
		var _this = this;
		
		var mousePos;
		
		if(_this.mouse_zero_x < 0 &&_this.mouse_zero_y < 0){
			_this.__mousedownStatus = 0;
			_this.mouse_zero_x = -1;
			_this.mouse_zero_y = -1;
			return;
		}
		
		mousePos = DL.DOM.getOffset(evt, _this);
		if(mousePos.x<0)
			mousePos.x = 0;
		else if(mousePos.x>_this.drawWidth)
			mousePos.x = _this.drawWidth;
		
		if(mousePos.y<0)
			mousePos.y = 0;
		else if(mousePos.y>_this.drawHeight)
			mousePos.y = _this.drawHeight;
			
		if(_this.__mousedownStatus)
		{
			_this.__mousedownStatus = 0;
			if(!_this.__GetMouseShape()){
				var deltaX = mousePos.x - _this.mouse_zero_x, deltaY = mousePos.y - _this.mouse_zero_y;
				
				if(Math.abs(deltaX)<3 && Math.abs(deltaY)<3){
					// Ignore mouse click
				} else {
					_this.__funReSelectArea(true);
				}
			}
		}
		
		_this.mouse_zero_x = -1;
		_this.mouse_zero_y = -1;
		
		_this.__fireEvent('onMouseUp', { 'e': evt, 'x': -1, 'y': -1, 'out': true});
	};
		 
	ImageAreaSelector.prototype.__isInSelectedArea = function (pos) {
		var _this=this, _left, _top, _right, _bottom;
		
		_left = _this.selectedCanvasArea.left;
		_top = _this.selectedCanvasArea.top;
		_right = _this.selectedCanvasArea.right;
		_bottom = _this.selectedCanvasArea.bottom;
		
		Funs.output('__deselectWhenMouseClick: ' + [		
			pos.x, pos.y,
			_this.selectedCanvasArea.left,
			_this.selectedCanvasArea.top,
			_this.selectedCanvasArea.right,
			_this.selectedCanvasArea.bottom
		].join(','));
		if(_left==0 && _top==0 && _right==0 && _bottom==0){
			return false;
		}
		
		if((pos.x >= _left && pos.x <= _right) && (pos.y >= _top && pos.y <= _bottom)){
			// 
			return true;
		}
		
		return false;
	};
	
    Dynamsoft.Lib.UI = Dynamsoft.Lib.UI || {};
	Dynamsoft.Lib.UI['ImageAreaSelector'] = ImageAreaSelector;
	Dynamsoft.Lib.UI['ImageAreaSelectorEvt'] = [];
	
	Dynamsoft.Lib.addEventListener(window,  'mouseup', function(evt){
		var evtObjs = Dynamsoft.Lib.UI['ImageAreaSelectorEvt'];
		for(var i=0; i<evtObjs.length; i++){
			evtObjs[i].__InvokeMouseUpOutside(evt);
		}
		
	});

})(Dynamsoft.Lib);

(function (DL) {
	if (!DL.product.bChromeEdition){
		return;
	}
		
	CanvasRenderingContext2D.prototype.__dashedLineRect = function (x, y, width, height, pattern) {
		// default interval distance -> 3px  
		if (typeof pattern === 'undefined') {
			pattern = 3;
		}
		var fromX = [x, x, x + width, x];
		var fromY = [y, y, y, y + height];
		var toX = [x + width, x, x + width, x + width]
		var toY = [y, y + height, y + height, y + height]
		for (var i = 0; i < 4; i++) {
			// calculate the delta x and delta y  
			var dx = (toX[i] - fromX[i]);
			var dy = (toY[i] - fromY[i]);
			var distance = Math.floor(Math.sqrt(dx * dx + dy * dy));
			var dashlineInteveral = (pattern <= 0) ? distance : (distance / pattern);
			var deltay = (dy / distance) * pattern;
			var deltax = (dx / distance) * pattern;
			// draw dash line  
			this.beginPath();
			for (var dl = 0; dl < dashlineInteveral; dl++) {
				if (dl % 2) {
					this.lineTo(fromX[i] + dl * deltax, fromY[i] + dl * deltay);
				} else {
					this.moveTo(fromX[i] + dl * deltax, fromY[i] + dl * deltay);
				}
			}
			this.stroke();
		}
	};

})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function (DL) {
	if (!DL.product.bChromeEdition){
		return;
	}
	
	var Funs = {
			output: function (msg) {
				//console.log(msg);
			}
		};
		
	function ImageOverlay(cfg){
		var _this=this;
		
		_this.MaxWidth = -1;
		_this.MaxHeight = -1;
		_this.fZoomValue = -1;
		_this.ctx = false;
		_this.left = -1;
		_this.top = -1;
		
		if(cfg){
			_this.MaxWidth = cfg.MaxWidth;
			_this.MaxHeight = cfg.MaxHeight;
			_this.fZoomValue = cfg.fZoomValue; 
			_this.ctx = cfg.ctx;
			_this.left = cfg.left;
			_this.top = cfg.top;
		}
		 
		_this.aryOverlayInfo = [];
	};
	
	ImageOverlay.prototype.SetContext = function(ctx){
		this.ctx = ctx;
	};
	
	ImageOverlay.prototype.SetLocation = function(x, y){
		var _this = this;
		_this.left = x;
		_this.top = y;
	};
	
	ImageOverlay.prototype.SetImageSize = function(w, h){
		var _this = this;
		_this.MaxWidth = w;
		_this.MaxHeight = h;
	};
	
	ImageOverlay.prototype.SetZoom = function(v){
		var _this = this;
		_this.fZoomValue = v;
	};
	
	ImageOverlay.prototype.Add = function(iLeft, iTop, iRight, iBottom, ColorRGB, Opacity, bDrawNow)
	{
		var _this = this, oSingleOverLay;

		oSingleOverLay = {
			l: iLeft,
			t: iTop,
			r: iRight,
			b: iBottom,
			c: ColorRGB,
			o: Opacity
		};
		_this.aryOverlayInfo.push(oSingleOverLay);
		
		if(bDrawNow){
			_this.__drawOne(oSingleOverLay);
		}
		return true;
	};
	
	ImageOverlay.prototype.Clear = function()
	{
		var _this = this;
		_this.aryOverlayInfo.splice(0);
	};
		
	ImageOverlay.prototype.Destroy = function()
	{
		var _this = this;
		_this.ctx = false;
		_this.Clear();
	};
	
	ImageOverlay.prototype.Draw = function()
	{
		var _this = this, n, i, obj;
		if(_this.ctx){
			n = _this.aryOverlayInfo.length;
            for (i = 0; i < n; i++) {
                obj = _this.aryOverlayInfo[i];
				_this.__drawOne(obj);
            }
		}
	};
	
	
	ImageOverlay.prototype.__drawOne = function(objOverlayInfo){
		var _this = this, iLeft, iTop, iRight, iBottom, iWidth, iHeight, color, opacity, tmp;
		
		if(!_this.ctx)
			return;
		
		
		iLeft = objOverlayInfo.l;
		iTop = objOverlayInfo.t;
		iRight = objOverlayInfo.r;
		iBottom = objOverlayInfo.b;
		color = objOverlayInfo.c;
		opacity = objOverlayInfo.o;
		
		if (iLeft < 0) iLeft = 0;
		if (iTop < 0) iTop = 0;
		if (iRight > _this.MaxWidth) iRight = _this.MaxWidth;
		if (iBottom > _this.MaxHeight) iBottom = _this.MaxHeight;
		
		// console.log('overlay zoom: ' + _this.fZoomValue);
		
		iLeft *= _this.fZoomValue;
		iTop *= _this.fZoomValue;
		iRight *= _this.fZoomValue;
		iBottom *= _this.fZoomValue;
		
		iWidth = iRight - iLeft;
		iHeight = iBottom - iTop;
		
		if (Dynamsoft.Lib.isNumber(color)) {
			color = Dynamsoft.Lib.getColor(color);
		}
		
		tmp = _this.ctx.globalAlpha;
		_this.ctx.fillStyle = color;
		_this.ctx.globalAlpha = parseFloat(opacity);
		_this.ctx.fillRect(
				_this.left + iLeft,
				_this.top + iTop,
				iWidth,
				iHeight
			);
		_this.ctx.globalAlpha = tmp;
	};
	

    Dynamsoft.Lib.UI = Dynamsoft.Lib.UI || {};
	Dynamsoft.Lib.UI['ImageOverlay'] = ImageOverlay;
	
})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 

(function (DL) {
	if (!DL.product.bChromeEdition){
		return;
	}
	
	// : (0,0)
	var TRUE = true, FALSE = false, Funs = {
			isNaNOrUndefined: function(o) {
				return DL.isUndefined(o) || DL.isNaN(o);
			},
			getAdjustedImageSize: function (w, h, _maxW, _maxH) {

				var ret = {'w':w, 'h':h, 'zoom': 1.0}, maxW = Math.floor(_maxW + 0.5), maxH = Math.floor(_maxH + 0.5);
				
				Funs.output(['image info:', w, ',', h, '; max is ', maxW, ',', maxH].join(''));

				if (maxW <= w || maxH <= h) {
					// image exceed max size

					if (maxW <= w && maxH <= h) {
						// both exceed
						var wratio = maxW / w,
							hratio = maxH / h;

						if (wratio < hratio) {
							ret.w = Math.floor(w * wratio + 0.5);
							ret.h = Math.floor(h * wratio + 0.5);
							ret.zoom = wratio;
						} else {
							ret.w = Math.floor(w * hratio + 0.5);
							ret.h = Math.floor(h * hratio + 0.5);
							ret.zoom = hratio;
						}

					} else if (maxW <= w) {
						ret.zoom = maxW / w;
						ret.w = Math.floor(maxW + 0.5);
						ret.h = Math.floor(h * ret.zoom + 0.5);
					}
					else if (maxH <= h) {
						ret.zoom = maxH / h;
						ret.w = Math.floor(w * ret.zoom + 0.5);
						ret.h = Math.floor(maxH + 0.5);
					}
				}
				
				Funs.output(['change result:', ret.w, ',', ret.h].join(''));
				
				return ret;

			},
			getHex: function (_num) {
				var tmp;
				tmp = Number(_num).toString(16).toUpperCase();
				if (tmp.length == 1)
					tmp = ['0', tmp].join('');
				return tmp;
			},
			
			getColor: function (_in) {
				var tmp, b, g, r;

				b = _in >> 16;
				g = (_in & 0xFF00) >> 8;
				r = _in & 0xFF;

				tmp = ['#', Funs.getHex(r), Funs.getHex(g), Funs.getHex(b)].join('');

				return tmp;
			},
			
			SetPageNumber: function (oDivPageNumber, i){
				
				var tagIndex = i*1, tagLineWidth, tagLineHeight;

				oDivPageNumber.innerHTML = (tagIndex + 1);
				
				if(tagIndex>=99 && tagIndex<999){
					// xxx
					tagLineWidth = 32;
					tagLineHeight = 24;
				} else if(tagIndex>=999 && tagIndex<9999) {
					// xxxx
					tagLineWidth = 40;
					tagLineHeight = 30;
				} else if(tagIndex>=9999 && tagIndex<99999) {
					// xxxxx
					tagLineWidth = 46;
					tagLineHeight = 34;
				} else if(tagIndex>=99999) {
					// xxxxxx
					tagLineWidth = 55;
					tagLineHeight = 36;
				} else {
					tagLineWidth = 24;
					tagLineHeight = 20;
				}
				
				oDivPageNumber.style.width = tagLineWidth + 'px';
				oDivPageNumber.style.height = tagLineHeight + 'px';
				
				if(DL.env.bFirefox)
				{
					// FFline-height
				}
				else
				{
					oDivPageNumber.style.lineHeight = tagLineHeight + 'px';
				}
			},
			output: function (msg) {
				if (Dynamsoft.WebTwainEnv.Debug) {
					DL.log(msg);
				}
			}
		};

		
	function ImageControl(cfg){
		var _this = this;
		
		
		// property
		// -- styles
		
		// ImageControl / 
		_this._width = 0;
		_this._height = 0;

		// canvas/   SetZoom() Stretch() ChangeControlSize() AttachImage() SetIfFitWindow() 
		//              __getScrollInfoWithNewZoom() __recaculateDrawArea()
		_this.canvasWidth = 0;
		_this.canvasHeight = 0;
		
		_this.Left = 0;
		_this.Top = 0;
		_this.Right = 0;
		_this.Bottom = 0;
		
		_this.borderWidth = 1;	// 1, 
		_this.borderColor = '#EEEEEE';
		_this.selectionBorderColor = '#7DA2CE';
		_this.backgroundColor = '#DDDDDD';

		// --
		_this.bIfFitWindow = true;	//  false: OriginalSize 	true: see _this.fitWindowType
		_this.fitWindowType = 0; //  0: FitsWindowSize  1: FitsWindowHeight  2:FitsWindowWidth  4:Stretch  (3 or others):OriginalSize

		_this.imageAreaSelector = false;
		_this.bSelect = false;
		_this.scrollH = false;
		_this.scrollV = false;
		_this.scrollArrowSize = 16;

		_this.cIndex = -1;
		_this.objImage = false;
		
		_this.bMouseHand = false;
		_this.fUserSetZoom = 1.0;
		_this.fZoomValue = 1.0;
		_this.fZoomInStep = 1.2;
		_this.fZoomOutStep = 0.8;

		_this.mousePosition = { x: -1, y: -1};
		
		// Mouse HandMoving
		_this.mousePreviosPositionWhenMoving = { x: -1, y: -1};
		
		_this.drawArea = {
			width: _this.canvasWidth,
			height: _this.canvasHeight,
			x: 0,
			y: 0
		};

		// the selected area on Image
		_this.selectedImageArea = {
			left: 0,
			top: 0,
			right:0,
			bottom: 0
		};
		
		_this.MoveStep = 10;
		_this.__fSelectionRectAspectRatio = 0;
		
		_this.bFocus = FALSE;
		_this.__overlay = FALSE;
		_this.bShowPageNumber = FALSE;
		
		
		_this.bVisible = TRUE;
		_this.divOut = FALSE;
		_this.divInner = FALSE;
		_this.divTag = FALSE;
		_this.canvas = FALSE;
		
		_this.bOrigMode = TRUE; // 1*1 or -1*-1
		_this.bHasOverlay = FALSE;
		_this._origImageWidth = -1;
		_this._origImageHeight = -1;
		
		// init
		_this.__init(cfg);
	}

	// Method
	ImageControl.prototype.ChangeControlSize = function (width, height){
		var _this = this;

		_this._width = width;
		_this._height = height;
		
		_this.canvasWidth = width;
		_this.canvasHeight = height;

		// 
		_this.Right = _this.Left + _this._width;
		_this.Bottom = _this.Top + _this._height;
		
		_this.divInner.style.height = _this.canvasHeight + 'px';
		
		_this.__recaculateDrawArea();

		// Selector
		_this.imageAreaSelector.ChangeControlSize(_this.canvasWidth, _this.canvasHeight);

		_this.Show();
		return true;
	}
	
	ImageControl.prototype.SetVisible = function (bShow){
		var _this=this;
		
		_this.bVisible = bShow;
		if(bShow){
			_this.divOut.style.display = '';
			_this.Show();
		} else {
			_this.divOut.style.display = 'none';
		}
		return true;
	};
	ImageControl.prototype.SetOrigMode = function (bOrigMode){
		var _this = this;
		if(_this.bOrigMode && bOrigMode == false && _this.objImage){
			_this.objImage.onload = undefined;
			_this.objImage.src = 'data:,';
			_this.objImage = FALSE;
		}

		this.bOrigMode = bOrigMode;
	};


	// 
	ImageControl.prototype.__init = function (cfg){
		var _this=this, doc = window['document'];

		if(cfg.Width)
			_this.canvasWidth = cfg.Width;

		if(cfg.Height)
			_this.canvasHeight = cfg.Height;

		if(cfg.index)
			_this.cIndex = cfg.index;
			
		_this.divOut = doc.createElement('div');
		_this.divOut.style.position = 'absolute';
		_this.divOut.onselectstart=function(){return false};
		
		_this.divInner = doc.createElement('div');
		_this.divInner.style.position = 'relative';
		_this.divInner.style.height = _this.canvasHeight + 'px';
		
		_this.divTag = doc.createElement('div');
		_this.divTag.className = 'imgTag';
		_this.divTag.style.position = 'absolute';
		_this.divTag.style.height = '20px';

		_this.canvas = doc.createElement('canvas');
		_this.canvas.width = _this.canvasWidth;
		_this.canvas.height = _this.canvasHeight;
		
		_this.divOut.appendChild(_this.divInner);
		_this.divInner.appendChild(_this.divTag);
		_this.divInner.appendChild(_this.canvas);

		_this.__createSelector(cfg);

		if(DL.isFunction(cfg['onMouseRightClick']))
			_this['onMouseRightClick'] = cfg['onMouseRightClick'];
		if(DL.isFunction(cfg['onMouseClick']))
			_this['onMouseClick'] = cfg['onMouseClick'];

		_this.__overlay = new Dynamsoft.Lib.UI.ImageOverlay();
	};

	ImageControl.prototype.bindEvents = function(){
		var _this=this, p;
		
		p = _this.divOut.parentNode;
		if(p){

			_this.imageAreaSelector.ChangeControlSize(_this.canvasWidth, _this.canvasHeight);
			_this.imageAreaSelector.BindEvents();
			_this.imageAreaSelector.SetMouseShape(_this.bMouseHand);

		}
		
		return true;
	};
	
	ImageControl.prototype.__getRealZoomValue = function () {
		var _this=this,
			fZoomOnOrignalImage;
			
		if(_this.bOrigMode) {
			fZoomOnOrignalImage = _this.fZoomValue;
		} else {
			if(_this._origImageWidth <= 0) {
				_this.__getImageOrignalSize();
			}
			
			if(_this._origImageWidth > 0) {
			    if(_this.objImage != null && _this.objImage.width != null)
				fZoomOnOrignalImage = _this.fZoomValue * _this.objImage.width / _this._origImageWidth;
			} else {
				Funs.output('cannot get image width.');
				fZoomOnOrignalImage = -1;
			}
		}
		
		return fZoomOnOrignalImage;
	};
	ImageControl.prototype.__getOrigImageWidth = function (){
		var _this=this;
		if(_this.bOrigMode && _this.objImage)
			return _this.objImage.width;
		else
			return _this._origImageWidth;
	};	
	ImageControl.prototype.__getOrigImageHeight = function (){
		var _this=this;
		if(_this.bOrigMode && _this.objImage)
			return _this.objImage.height;
		else
			return _this._origImageHeight;
	};
	
	ImageControl.prototype.__createSelector = function (cfg){
		var _this=this;
		if(!_this.imageAreaSelector){
			_this.imageAreaSelector = new Dynamsoft.Lib.UI.ImageAreaSelector(_this);
			var el = _this.imageAreaSelector.GetEL();
			_this.divInner.appendChild(el);
			
			_this.imageAreaSelector['onMouseUp'] = function (params){
					_this.mousePreviosPositionWhenMoving.x = -1;
					_this.mousePreviosPositionWhenMoving.y = -1;
			};
			
			_this.imageAreaSelector['onMouseMove'] = function (params){
				var mouseX, mouseY, mouseOrigX, mouseOrigY, o, bDragging = params.dragging, fRealZoomValue;
				
				o = _this.__getOrigImagePos();
				if(Funs.isNaNOrUndefined(o.x) || Funs.isNaNOrUndefined(o.y))
					return;

				// mousePos(origX, origY)
				fRealZoomValue = _this.__getRealZoomValue();
				if(fRealZoomValue<0){
					return;
				}
				
				mouseX = (params.x + o.x) / fRealZoomValue;
				mouseY = (params.y + o.y) / fRealZoomValue;
				
				_this.__fireEvent('onMouseMove', { 'e': params.e, 'x': mouseX, 'y': mouseY, 'index': _this.cIndex });
				
				if(_this.bMouseHand && bDragging){
					var startX, startY, deltaX, deltaY, 
						bShowScrollV = _this.__isShowScrollV(), bShowScrollH = _this.__isShowScrollH();
					
					startX = _this.mousePreviosPositionWhenMoving.x;
					startY = _this.mousePreviosPositionWhenMoving.y;
					
					//console.log('startX: ' + [startY, params.y].join(','));

					deltaX = (startX - params.x);
					deltaY = (startY - params.y);
										
					_this.mousePreviosPositionWhenMoving.x = params.x;
					_this.mousePreviosPositionWhenMoving.y = params.y;

					if(bShowScrollH && _this.scrollH){
						//console.log('deltaX: ' + deltaX);
						_this.scrollH.ManualMoving(deltaX);
					}

					if(bShowScrollV && _this.scrollV){
						//console.log('deltaY: ' + deltaY);
						_this.scrollV.ManualMoving(deltaY);
					}
				}
			};
			
			_this.imageAreaSelector['onMouseClick'] = function (params){
				var origX, origY, o, fRealZoomValue;
				o = _this.__getOrigImagePos();
				
				if(Funs.isNaNOrUndefined(o.x) || Funs.isNaNOrUndefined(o.y))
					return;

				// mousePos(origX, origY)
				fRealZoomValue = _this.__getRealZoomValue();
				if(fRealZoomValue<0){
					return;
				}
				
				origX = (params.x + o.x) / fRealZoomValue;
				origY = (params.y + o.y) / fRealZoomValue;
				
				//console.log('origX: ' + [params.y , o.y].join(','));
				_this.mousePreviosPositionWhenMoving.x = params.x;
				_this.mousePreviosPositionWhenMoving.y = params.y;

				_this.__fireEvent('onMouseClick', { 'e': params.e, 'x': origX, 'y': origY, 'index': _this.cIndex });
			};

			_this.imageAreaSelector['onMouseDoubleClick'] = function (params){
				var origX, origY, o, fRealZoomValue;
				o = _this.__getOrigImagePos();
				if(Funs.isNaNOrUndefined(o.x) || Funs.isNaNOrUndefined(o.y))
					return;

				// mousePos(origX, origY)
				fRealZoomValue = _this.__getRealZoomValue();
				if(fRealZoomValue<0){
					return;
				}
								
				origX = (params.x + o.x) / fRealZoomValue;
				origY = (params.y + o.y) / fRealZoomValue;
				
				_this.mousePreviosPositionWhenMoving.x = params.x;
				_this.mousePreviosPositionWhenMoving.y = params.y;
				
				_this.__fireEvent('onMouseDoubleClick', { 'e': params.e, 'x': origX, 'y': origY, 'index': _this.cIndex });
			};			
			_this.imageAreaSelector['onMouseRightClick'] = function (params){
				var origX, origY, o, fRealZoomValue;
				o = _this.__getOrigImagePos();
				if(Funs.isNaNOrUndefined(o.x) || Funs.isNaNOrUndefined(o.y))
					return;

				// mousePos(origX, origY)
				fRealZoomValue = _this.__getRealZoomValue();
				if(fRealZoomValue<0){
					return;
				}
						
				origX = (params.x + o.x) / fRealZoomValue;
				origY = (params.y + o.y) / fRealZoomValue;
				
				_this.__fireEvent('onMouseRightClick', { 'e': params.e, 'x': origX, 'y': origY, 'index': _this.cIndex });
			};
		
			_this.imageAreaSelector['onImageAreaSelected'] = function (params){
				var _left = params.left, _top = params.top, 
					_right = params.right, _bottom = params.bottom, 
					_bFromScroll = params.fromScroll,
					o, fRealZoomValue;
				
				Funs.output('selected Area in Selector: ' + [_left, _top, _right, _bottom].join(','));

				// 
				if(_this.fZoomValue > 0){
					
					o = _this.__getOrigImagePos();
					if(Funs.isNaNOrUndefined(o.x) || Funs.isNaNOrUndefined(o.y))
						return;

					// Selectorzoom
					_left = (_left + o.x);
					_top = (_top + o.y);
					_right = (_right + o.x);
					_bottom = (_bottom + o.y);
					
					Funs.output('selected zoomed Image Area: ' + [_left, _top, _right, _bottom].join(','));

					// 
					fRealZoomValue = _this.__getRealZoomValue();
					if(fRealZoomValue<0){
						return;
					}
										
					_left = _left / fRealZoomValue;
					_top = _top / fRealZoomValue;
					_right = _right / fRealZoomValue;
					_bottom = _bottom / fRealZoomValue;
					
					Funs.output('selected orig Image Area: ' + [_left, _top, _right, _bottom].join(','));

					// 
					if(_left<0)
						_left = 0;
						
					if(_top<0)
						_top = 0;
					if(_right>_this.__getOrigImageWidth())
						_right = _this.__getOrigImageWidth();
						
					if(_bottom>_this.__getOrigImageHeight())
						_bottom = _this.__getOrigImageHeight();
						
					// onImageAreaSelected
					_this.__fireEvent('onImageAreaSelected', 
						{ 
							'index': _this.cIndex, 
							'left': _left, 'top': _top, 'right': _right, 'bottom': _bottom,
							'fromScroll': _bFromScroll
						});
				}
				
			};
		
			_this.imageAreaSelector['onImageAreaDeSelected'] = function (){
				_this.__fireEvent('onImageAreaDeSelected', _this.cIndex);
			};
			
			if(DL.isFunction(cfg['onMouseMove'])){
				_this['onMouseMove'] = cfg['onMouseMove'];
			}
			if(DL.isFunction(cfg['onMouseClick'])){
				_this['onMouseClick'] = cfg['onMouseClick'];
			}
			if(DL.isFunction(cfg['onMouseRightClick'])){
				_this['onMouseRightClick'] = cfg['onMouseRightClick'];
			}
			if(DL.isFunction(cfg['onMouseDoubleClick'])){
				_this['onMouseDoubleClick'] = cfg['onMouseDoubleClick'];
			}
			if(DL.isFunction(cfg['onImageAreaSelected'])){
				_this['onImageAreaSelected'] = cfg['onImageAreaSelected'];
			}
			if(DL.isFunction(cfg['onImageAreaDeSelected'])){
				_this['onImageAreaDeSelected'] = cfg['onImageAreaDeSelected'];
			}
			if(DL.isFunction(cfg['OnGetImageInfo'])){
				_this['OnGetImageInfo'] = cfg['OnGetImageInfo'];
			}			
		}
	};
	ImageControl.prototype.__isShowScrollH = function (){
		var _this = this;
		
		if(!_this.objImage)
			return false;
			
		// canvas
		return (_this.canvasHeight < _this._height);
	}
	ImageControl.prototype.__isShowScrollV = function (){
		var _this = this;
		
		if(!_this.objImage)
			return false;
			
		// canvas
		return (_this.canvasWidth < _this._width);
	}
	
	ImageControl.prototype.ImageMoveLeft = function (){
		var _this = this, bShowScrollH = _this.__isShowScrollH(), delta;

		if(bShowScrollH && _this.scrollH){
			delta = -0.2 * _this.scrollH.GetPagePositionSize();
			_this.scrollH.ManualMoving(delta);
		}

		return true;
	};
	ImageControl.prototype.ImageMoveRight = function (){
		var _this = this, bShowScrollH = _this.__isShowScrollH(), delta;
		
		if(bShowScrollH && _this.scrollH){
			delta = 0.2 * _this.scrollH.GetPagePositionSize();
			_this.scrollH.ManualMoving(delta);
		}

		return true;
	};
	ImageControl.prototype.ImageMoveUp = function (){
		var _this = this, bShowScrollV = _this.__isShowScrollV(), delta;

		if(bShowScrollV && _this.scrollV){
			delta = -0.2 * _this.scrollV.GetPagePositionSize();
			_this.scrollV.ManualMoving(delta);
		}
		return true;
	};
	ImageControl.prototype.ImageMoveDown = function (){
		var _this = this, bShowScrollV = _this.__isShowScrollV(), delta;

		if(bShowScrollV && _this.scrollV){
			delta = 0.2 * _this.scrollV.GetPagePositionSize();
			_this.scrollV.ManualMoving(delta);
		}
		return true;
	};	

	ImageControl.prototype.ImageMovePageUp = function () {
		var _this = this, bShowScrollV = _this.__isShowScrollV(), delta;

		if(bShowScrollV && _this.scrollV){
			delta = -1 * _this.scrollV.GetPagePositionSize();
			_this.scrollV.ManualMoving(delta);
		}
		return true;
	};
	ImageControl.prototype.ImageMovePageDown = function () {
		var _this = this, bShowScrollV = _this.__isShowScrollV(), delta;

		if(bShowScrollV && _this.scrollV){
			delta = _this.scrollV.GetPagePositionSize();
			_this.scrollV.ManualMoving(delta);
		}
		return true;
	};
	ImageControl.prototype.ImageMoveHome = function () {
		var _this = this, 
			bShowScrollV = _this.__isShowScrollV(), bShowScrollH = _this.__isShowScrollH(), 
			delta, max;

		if(bShowScrollV && _this.scrollV){
			max = _this.scrollV.GetMaxPosition();
			_this.scrollV.ManualMoving(-max);
		}

		if(bShowScrollH && _this.scrollH){
			max = _this.scrollH.GetMaxPosition();
			_this.scrollH.ManualMoving(-max);
		}
		return true;
	};	
	ImageControl.prototype.ImageMoveEnd = function () {
		var _this = this, 
			bShowScrollV = _this.__isShowScrollV(), bShowScrollH = _this.__isShowScrollH(), 
			delta, max;

		if(bShowScrollV && _this.scrollV){
			max = _this.scrollV.GetMaxPosition();
			_this.scrollV.ManualMoving(max);
		}

		if(bShowScrollH && _this.scrollH){
			max = _this.scrollH.GetMaxPosition();
			_this.scrollH.ManualMoving(max);
		}
		return true;
	};
	
	// 
	ImageControl.prototype.SetLocation = function (x, y){
		var _this=this;
		_this.Left = x;
		_this.Top = y;
		_this.Right = x + _this.canvasWidth;
		_this.Bottom = y + _this.canvasHeight;
		
		Funs.output('SetLocation:' + x + ', ' + y);
		// canvas 
		if(_this.divOut){
			if(_this.divOut.parentNode)
				_this.divOut.parentNode.style.position = "relative";
			_this.divOut.style.left = x + 'px';
			_this.divOut.style.top = y + 'px';
			
			_this.__refreshImageAreaSelectorLocationAndSize();
			_this.__refreshImageOverlayInfo();
		}
		return true;
	};

	// 
	ImageControl.prototype.SetMouseShape = function (bHand){
		var _this=this, old = _this.bMouseHand;
		if(bHand)
			_this.bMouseHand = true;
		else
			_this.bMouseHand = false;

		Funs.output('SetMouseShape: ' + [old, _this.bMouseHand].join('->'));

		if(_this.imageAreaSelector)
			_this.imageAreaSelector.SetMouseShape(_this.bMouseHand);
		return true;
	};
	// 
	ImageControl.prototype.SetBackgroundColor = function (bkcolor){
		var _this=this;
		Funs.output('SetBackgroundColor:' + bkcolor);
		_this.backgroundColor = bkcolor;
		if(_this.drawArea.width<_this.canvasWidth || _this.drawArea.height<_this.canvasHeight){
			_this.Show();
		}
		return true;
	};
	// border
	ImageControl.prototype.SetSelectionImageBorderColor = function (selectionBorderColor){
		var _this=this;
		Funs.output('SetSelectionImageBorderColor:' + selectionBorderColor);
		_this.selectionBorderColor = selectionBorderColor;
		_this.__refreshBorder();
		return true;
	};

	ImageControl.prototype.GetEL = function(){
		Funs.output('GetEL:');
		return this.divOut;
	};

	ImageControl.prototype.__getOrigImagePos = function (){
		
		var _this=this, _left = _this.drawArea.x, _top = _this.drawArea.y, 
			_width = _this.drawArea.width,
			_height = _this.drawArea.height;
		
		// _left , _top
		if(_width <= _this.canvasWidth){
			// _left
			_left = _left + (_this.canvasWidth - _width) * 0.5;
		}
		
		if(_height <= _this.canvasHeight){
			// _top
			_top = _top + (_this.canvasHeight - _height) * 0.5;
		}
		
		return {'x': _left, 'y': _top};
	};

	ImageControl.prototype.__getImageDrawLocationAndSize = function (left, top){

		var _this=this, _left = left, _top = top, _width, _height;

		// 				
		if(Funs.isNaNOrUndefined(_left))
			_left = 0;	
		if(Funs.isNaNOrUndefined(_top))
			_top = 0;

		_width = _this.drawArea.width;
		_height = _this.drawArea.height;
		
		// _left , _top
		if(_width <= _this.canvasWidth){
			// left
			_left = (_this.canvasWidth - _width) * 0.5;
			_width = _this.drawArea.width;
		} else {
			// 
			_left = _left -_this.drawArea.x;
			_left = _left<0? 0 : _left;
			_width = _this.canvasWidth;
		}
		
		if(_height <= _this.canvasHeight){
			// top
			_top = (_this.canvasHeight - _height) * 0.5;
			_height = _this.drawArea.height;
		} else {
			// 
			_top = _top -_this.drawArea.y;
			_top = _top<0? 0 : _top;
			_height = _this.canvasHeight;
		}
		
		_left += _this.borderWidth;
		_top += _this.borderWidth;
		
		return {'left': _left, 'top': _top, 'width': _width, 'height': _height};
	};
	
	ImageControl.prototype.__refreshImageOverlayInfo = function (){

		var _this=this, posInfo, fZoomOnOrignalImage = 1.0;

		posInfo = _this.__getImageDrawLocationAndSize();
		fZoomOnOrignalImage = _this.__getRealZoomValue();
		if(fZoomOnOrignalImage<0){
			return;
		}

		_this.__overlay.SetLocation(posInfo.left, posInfo.top);
		_this.__overlay.SetImageSize(_this._origImageWidth, _this._origImageHeight);
		_this.__overlay.SetZoom(fZoomOnOrignalImage);
		
		if(_this.canvas){
			_this.__overlay.SetContext(_this.canvas.getContext("2d"));
		} else {
			_this.__overlay.SetContext(false);
		}
	};
	
	// Image Area Selector
	ImageControl.prototype.__refreshImageAreaSelectorLocationAndSize = function (){

		var _this=this, posInfo;
		if(_this.imageAreaSelector){
		
			posInfo = _this.__getImageDrawLocationAndSize();
		
			// SelectorImage Draw
			_this.imageAreaSelector.SetDrawImageLocationAndSize(posInfo.left, posInfo.top, posInfo.width, posInfo.height);		
			// Selector
			_this.imageAreaSelector.ChangeControlSize(_this.canvasWidth, _this.canvasHeight);
			
		}
		
		return true;
	};
	
	ImageControl.prototype.SetBindIndex = function (index){
		this._bindIndex = index;
		return true;
	};
	ImageControl.prototype.GetBindIndex = function (){
		return this._bindIndex;
		return true;
	};
	
	ImageControl.prototype.SetCurrentIndex = function (index){
		var _this = this;
		
		_this.cIndex = index;
		return true;
	};

	ImageControl.prototype.GetCurrentIndex = function (){
		var _this = this;
		return _this.cIndex;
	};
	// Loading...
	ImageControl.prototype.ClearImage = function () {
		var _this = this;
		
		// 
		if(_this.bOrigMode){
			_this.objImage.onload = undefined;
			_this.objImage.src = 'data:,';
		}
		
		_this.objImage = FALSE;
		_this.bHasOverlay = FALSE;
		_this.__overlay.Clear();
		
		_this._origImageWidth = -1;
		_this._origImageHeight = -1;
		return true;
	};
	
	ImageControl.prototype.__getImageOrignalSize = function (){
		var _this = this;

		if(_this.bOrigMode){
			// 
			_this._origImageWidth = _this.objImage.width;
			_this._origImageHeight = _this.objImage.height;
		} else {
			if (_this.cIndex >= 0){
				// zoom
				var imageInfo = _this.__fireEvent('OnGetImageInfo', _this.cIndex);
				_this._origImageWidth = imageInfo.width;
				if(_this.objImage != null && _this.objImage.height != null && _this.objImage.width != null)
				    _this._origImageHeight = _this._origImageWidth * _this.objImage.height / _this.objImage.width;
			} else {
				
				_this._origImageWidth = -1;
				_this._origImageHeight = -1;
				
			}
		}
		
		// console.log('orig (w, h): ' + [_this._origImageWidth, _this._origImageHeight].join(','));
	};
	
	//
	ImageControl.prototype.AttachImage = function (objImage, notUsedW, notUsedH, notUsedIndex, overlays, bOrigMode){
		var _this = this;
		
		Funs.output('AttachImage: objImage,' + [notUsedW, notUsedH, notUsedIndex, bOrigMode].join(','));
		
		// 
		if(_this.bOrigMode){
			_this.objImage.onload = undefined;
			_this.objImage.src = 'data:,';
		}

		_this.objImage = objImage;
		_this.bOrigMode = bOrigMode;
	
		// _this.cIndex = index;
		// 
		_this.__resetTag();
		
		if(overlays){
			var i, o, len = overlays.length;
			_this.__overlay.Clear();
			if(len){
				_this.bHasOverlay = TRUE;
			}
			
			for(i=0; i<len; i++){
				o = overlays[i];
				_this.__overlay.Add(o.Left, o.Top, o.Right, o.Bottom, o.ColorRGB, o.Opacity);
			}
		}
		
		_this.__getImageOrignalSize();

		var bNeedZoom = false;
		
		if(_this.bIfFitWindow && (_this.fitWindowType == 0 || _this.fitWindowType == 1 || _this.fitWindowType == 2 || _this.fitWindowType == 4)){
			bNeedZoom = false;
		} else {
			bNeedZoom = bOrigMode && (_this.fUserSetZoom != 1.0);
		}
		
		if(bNeedZoom){
			_this.SetZoom(_this.fUserSetZoom);
		} else {
			
			if(bOrigMode && !_this.bIfFitWindow){
				// move to center
				var params = {}, newScrollInfo;

				params.x = _this.drawArea.x;
				params.y = _this.drawArea.y;
				params.fOldZoom = 1;
				params.fNewZoom = 1;
				params.oldIfFitWindow = true;
				params.oldFitWindowType = 0;
				params.oldCanvasWidth = _this.canvasWidth;
				params.oldCanvasHeight = _this.canvasHeight;
				
				_this.fitWindowType = 3;
				
				_this.__recaculateDrawArea();
				newScrollInfo = _this.__getScrollInfoWithNewZoom(params);
				_this.__setDrawArea(newScrollInfo.x, newScrollInfo.y, _this.drawArea.width, _this.drawArea.height);

				_this.__resetScroll();
			} else {
				
				_this.__recaculateDrawArea();
			}
			
		}
		return true;
	};
	
	
	// 
	ImageControl.prototype.Show = function (bShowFromScrollEvent) {
		var _this = this, ctx, _borderWidth;
		
		if(_this.bVisible){
			_this.divOut.style.display = '';
		} else {
			_this.divOut.style.display = 'none';
			return;
		}

		Funs.output('Show:' + [_this.canvasWidth, _this.canvasHeight].join(','));
		ctx = _this.canvas.getContext("2d");
		_this.__restoreCanvas(ctx, _this.canvasWidth, _this.canvasHeight);
				
		if(_this.drawArea.width <=0 || _this.drawArea.height <= 0
			|| _this.canvasWidth <=0 || _this.canvasHeight <= 0){
			return false;
		}
		
		// 
		if(!bShowFromScrollEvent)
			_this.__resetScroll();

		// 
		_this.__resetTag();
		
		if(!_this.objImage
			|| _this.objImage.src == 'data:,'
			|| _this.objImage.width == 0 || _this.objImage.height == 0 
			|| _this.objImage.src == ''){

			// fill background color
			ctx.fillStyle = _this.backgroundColor;
			ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
			
			// if width>53px show "Loading..."
			
			if(_this._width > 53){
				ctx.font = "12px Times New Roman";
				ctx.textAlign = "center";
				ctx.strokeText("Loading ...", ctx.canvas.width * 0.5, ctx.canvas.height * 0.5);
			}

			//Actually draw the image on canvas

			return false;
		}

		ctx.clearRect(0, 0, _this.canvasWidth, _this.canvasHeight);
		if (_this.cIndex == -1){
			return;
		}
		
		Funs.output('draw info: ' + [_this.objImage.width, _this.objImage.height, _this.drawArea.x, _this.drawArea.y, _this.drawArea.width, _this.drawArea.height].join(','));
		
		if(_this.drawArea.width<_this.canvasWidth || _this.drawArea.height<_this.canvasHeight){
			// 
			ctx.fillStyle = _this.backgroundColor;
			ctx.fillRect(0, 0, _this.canvasWidth, _this.canvasHeight);
		}

		ctx.drawImage(_this.objImage, Math.floor(-_this.drawArea.x), Math.floor(-_this.drawArea.y), 
									Math.floor(_this.drawArea.width), Math.floor(_this.drawArea.height));

		_this.__overlay.Draw();

		return true;
	};

	// 
	ImageControl.prototype.SetSelect = function(bSelect){
		var _this=this;
		Funs.output('SetSelect:' + bSelect);
		_this.bSelect = bSelect;
		_this.__resetTag();
		_this.__refreshBorder();
		return true;
	};

		
	// 
	ImageControl.prototype.GetIndex = function (){
		return this.cIndex;
	};

	// 
	ImageControl.prototype.SetSelectedImageArea = function (iLeft, iTop, iRight, iBottom){
		var _this = this, 
			_left = iLeft, _top = iTop, _right = 0, _bottom = 0,
			fZoomOnOrignalImage = 1.0;

		Funs.output('SetSelectedImageArea:' + [iLeft, iTop, iRight, iBottom].join(', '));

		if (iRight < iLeft && iBottom < iTop) {
			_left = parseInt(iRight);
			_top = parseInt(iBottom);
			_right = parseInt(iLeft);
			_bottom = parseInt(iTop);
		} else {
			_right = parseInt(iRight);
			_bottom = parseInt(iBottom);
			_left = parseInt(iLeft);
			_top = parseInt(iTop);
		}
		
		_this.selectedImageArea.left = _left;
		_this.selectedImageArea.top = _top;
		_this.selectedImageArea.right = _right;
		_this.selectedImageArea.bottom = _bottom;
		 
		if(_this.imageAreaSelector){
			if(_this._origImageWidth <= 0)
				_this.__getImageOrignalSize();
				
			if(_this._origImageWidth > 0){
				fZoomOnOrignalImage = _this.__getRealZoomValue();
				if(fZoomOnOrignalImage<0){
					return false;
				}

			} else {
				return false;
			}
			
			// ImageSelector Canvas
			var _canvasLeft = _left * fZoomOnOrignalImage, _canvasTop = _top * fZoomOnOrignalImage, 
				_canvasRight = _right * fZoomOnOrignalImage, _canvasBottom = _bottom * fZoomOnOrignalImage;
			
			_this.imageAreaSelector.SetSelectedArea(_canvasLeft, _canvasTop, _canvasRight, _canvasBottom);

			return true;
		}

		return false;
	};
	// Overlay
	ImageControl.prototype.OverlayRectangle = function (iLeft, iTop, iRight, iBottom, ColorRGB, Opacity){
		var _this=this;

		Funs.output('OverlayRectangle:' + [iLeft, iTop, iRight, iBottom, ColorRGB, Opacity].join(', '));
		_this.bHasOverlay = TRUE;
		
		if(_this._origImageWidth <= 0)
			_this.__getImageOrignalSize();
		
		_this.__refreshImageOverlayInfo();
		_this.__overlay.Add(iLeft, iTop, iRight, iBottom, ColorRGB, Opacity, true);
		
		return true;
	};
	// 
	ImageControl.prototype.GetMousePosition = function (){
		Funs.output('GetMousePosition:');
		return this.mousePosition;
	};
	ImageControl.prototype.__setDrawArea = function (x, y, width, height){
		var _this=this;

		_this.drawArea.x = x;
		_this.drawArea.y = y;
		_this.drawArea.width = width;
		_this.drawArea.height = height;
		
		
		if(_this.drawArea.width > _this.canvasWidth && _this.drawArea.x > _this.drawArea.width - _this.canvasWidth){
			_this.drawArea.x = _this.drawArea.width - _this.canvasWidth;
		}
		
		if(_this.drawArea.height > _this.canvasHeight && _this.drawArea.y > _this.drawArea.height - _this.canvasHeight){
			_this.drawArea.y = _this.drawArea.height - _this.canvasHeight;
		}

		_this.__refreshImageAreaSelectorLocationAndSize();
		_this.__refreshImageOverlayInfo();
		
	};
	ImageControl.prototype.GetZoom = function (){
		var _this = this;
		return _this.fZoomValue;
	};
	ImageControl.prototype.SetZoom = function (newZoomValue){

		var _this=this, oldZoomValue, params = {}, newScrollInfo;

		Funs.output('SetZoom:' + [oldZoomValue, newZoomValue].join('->'));
		
		_this.fUserSetZoom = newZoomValue;

		params.x = _this.drawArea.x;
		params.y = _this.drawArea.y;
		params.fOldZoom = _this.fZoomValue;
		params.fNewZoom = newZoomValue;
		params.oldIfFitWindow = _this.bIfFitWindow;
		params.oldFitWindowType = _this.fitWindowType;
		params.oldCanvasWidth = _this.canvasWidth;
		params.oldCanvasHeight = _this.canvasHeight;
		
		_this.bIfFitWindow = false;
		_this.fitWindowType = 3;
		_this.fZoomValue = newZoomValue;
		
		if(!_this.objImage)
			return;
		
		_this.__recaculateDrawArea();
		newScrollInfo = _this.__getScrollInfoWithNewZoom(params);
		_this.__setDrawArea(newScrollInfo.x, newScrollInfo.y, _this.drawArea.width, _this.drawArea.height);

		// 
		_this.__resetScroll();
		_this.Show();

		return true;
	};
	ImageControl.prototype.SetSelectionRectAspectRatio = function (ratio){
		var _this=this;
		Funs.output('SetSelectionRectAspectRatio:' + ratio);
		if(ratio < 0)
			ratio = 0;
		
		_this.__fSelectionRectAspectRatio = ratio;
		return true;
	};
	ImageControl.prototype.SetIfFitWindow = function (bIfFitWindow, enumDWTFitWindowType){
		var _this=this;
		Funs.output('SetIfFitWindow:' + [bIfFitWindow, enumDWTFitWindowType].join(','));
		_this.bIfFitWindow = bIfFitWindow;
		if(bIfFitWindow){
			_this.fitWindowType = enumDWTFitWindowType;
		} else {
			_this.fitWindowType = 3;
		}

		_this.__recaculateDrawArea();
		_this.Show();
		return true;
	};
	ImageControl.prototype.Stretch = function (){
		var _this=this;
		Funs.output('Stretch');
		
		_this.canvasWidth = _this._width;
		_this.canvasHeight = _this._height;
		
		_this.__setDrawArea(0, 0, _this.canvasWidth, _this.canvasHeight);
		
		_this.__refreshImageAreaSelectorLocationAndSize();
		_this.__refreshImageOverlayInfo();
		return true;
	};
	ImageControl.prototype.Destroy = function(){
		var _this=this;
		Funs.output('Destroy:');
		
		_this.SetBindIndex(-1);
		
		_this.ClearImage();
		
		if(_this.imageAreaSelector){
			_this.imageAreaSelector.Destroy();
			_this.imageAreaSelector = false;
		}
		
		if(_this.__overlay){
			_this.__overlay.Destroy();
		}
		
		
		return true;
	};
	
	ImageControl.prototype.SetShowPageNumber = function (bShowPageNumber){
		var _this = this;
		_this.bShowPageNumber = bShowPageNumber;
		_this.__resetTag();
		return true;
	};

	// private Methods


	// (x,y) / old zoom / old canvas width / old canvas height / old fit window info
	// , __recaculateDrawArea()
	// input params:
	// {
	//		'x': -1, 'y': -1,
	//		'fOldZoom': -1,
	//		'oldCanvasWidth': -1,
	//		'oldCanvasHeight': -1
	//		'oldIfFitWindow': -1,
	//		'oldFitWindowType': -1,
	//	}
	// zoom
	ImageControl.prototype.__getScrollInfoWithNewZoom = function (params){
		var _this = this, ret = {'x':0, 'y':0},
			cx, cy, origin_cx, origin_cy, new_cx, new_cy, fits = false,
			fNewZoom, bIfFitWindow, fitWindowType, fOldZoom, oldCanvasWidth, oldCanvasHeight,
			newCanvasWidth, newCanvasHeight;
		
		fNewZoom = _this.fZoomValue;
		if(fNewZoom<=0 || !_this.objImage)
			return ret;
		
		cx = params.x;
		cy = params.y;
		
		bIfFitWindow = params.oldIfFitWindow;
		fitWindowType = params.oldFitWindowType;
		
		if(bIfFitWindow){
			if(fitWindowType == 0){
				fits = true;
			} else if(fitWindowType == 1){
				fits = true;
			} else if(fitWindowType == 2){
				fits = true;
			} else if(fitWindowType == 4){
				fits = true;
			}
		}

		if(fits){
			// current center position
			cx = origin_cx = _this.objImage.width * 0.5;
			cy = origin_cy = _this.objImage.height * 0.5;
			
			// new center position:
			new_cx = origin_cx * fNewZoom;
			new_cy = origin_cy * fNewZoom;
			
		} else {
			oldCanvasWidth = params.oldCanvasWidth;
			oldCanvasHeight = params.oldCanvasHeight;
			fOldZoom = params.fOldZoom;
			
			// current center position
			cx = cx + oldCanvasWidth * 0.5;
			cy = cy + oldCanvasHeight * 0.5;

			// translate to origin image center position
			origin_cx = cx / fOldZoom;
			origin_cy = cy / fOldZoom;

			// new center position:
			new_cx = origin_cx * fNewZoom;
			new_cy = origin_cy * fNewZoom;

		}
		
		newCanvasWidth = _this.canvasWidth;
		newCanvasHeight = _this.canvasHeight;
		
		var bShowScrollV = _this.__isShowScrollV();
		var bShowScrollH = _this.__isShowScrollH();
		
		// new (left,top) position
		if(bShowScrollH) {
			// show H scroll
			ret.x = new_cx - newCanvasWidth * 0.5;
			if(ret.x < 0)
				ret.x = 0;
		} else {
			// hide H scroll
			ret.x = (_this.drawArea.width - newCanvasWidth) * 0.5;
		}

		if(bShowScrollV){// show V scroll
			ret.y = new_cy - newCanvasHeight * 0.5;
			if(ret.y < 0)
				ret.y = 0;
		} else {
			// hide V scroll
			ret.y = (_this.drawArea.height - newCanvasHeight) * 0.5;
		}

		return ret;
	};

	ImageControl.prototype.__recaculateDrawArea = function (){

		var _this = this, bStretchMode = false, bOrigImage = false, newImageSize, bShowHSroll = false, bShowVScroll = false;
	
		_this.canvasWidth = _this._width;
		_this.canvasHeight = _this._height;
		
		if(_this.objImage){
		
			if(_this.bIfFitWindow){
		

				if(_this.fitWindowType == 0){			
					// FitsWindowSize
					newImageSize = Funs.getAdjustedImageSize(_this.objImage.width, _this.objImage.height, _this.canvasWidth, _this.canvasHeight);
					_this.fZoomValue = newImageSize.zoom;
				} else if(_this.fitWindowType == 1){
					// FitsWindowHeight
					newImageSize = Funs.getAdjustedImageSize(_this.objImage.width, _this.objImage.height, _this.objImage.width, _this.canvasHeight);
					// check is show H scroll
					if(newImageSize.w > _this._width){
						// 
						bShowHSroll = true;
						_this.canvasHeight = _this._height - _this.scrollArrowSize;
						
						// zoom /  / 
						newImageSize = Funs.getAdjustedImageSize(_this.objImage.width, _this.objImage.height, _this.objImage.width, _this.canvasHeight);
					}
					
					_this.fZoomValue = newImageSize.zoom;
				} else if(_this.fitWindowType == 2){
					// FitsWindowWidth
					newImageSize = Funs.getAdjustedImageSize(_this.objImage.width, _this.objImage.height, _this.canvasWidth, _this.objImage.height);
					
					// check is show V scroll
					if(newImageSize.h > _this._height){
						// 
						bShowHSroll = true;
						_this.canvasWidth = _this._width - _this.scrollArrowSize;
						
						// zoom /  / 
						newImageSize = Funs.getAdjustedImageSize(_this.objImage.width, _this.objImage.height, _this.canvasWidth, _this.objImage.height);
					}
					
					_this.fZoomValue = newImageSize.zoom;
				} else if(_this.fitWindowType == 4){
					// Stretch Mode
					bStretchMode = true;
				} else {
					// OriginalSize
					newImageSize = {'w': _this.objImage.width, 'h': _this.objImage.height};
					bOrigImage = true;
					_this.fZoomValue = _this.fUserSetZoom;
				}
			} else {
				newImageSize = {'w': _this.objImage.width * _this.fZoomValue, 'h': _this.objImage.height * _this.fZoomValue};
				bOrigImage = true;
			}
			
		} else {
			bStretchMode = true;
		}
		
		if(bStretchMode){
			_this.Stretch();
		} else {
			if(bOrigImage){
				// check is show V scroll
				if(newImageSize.h > _this._height){
					// 
					bShowHSroll = true;
					_this.canvasWidth = _this._width - _this.scrollArrowSize;
				}
				
				// check is show H scroll
				if(newImageSize.w > _this._width){
					// 
					bShowHSroll = true;
					_this.canvasHeight = _this._height - _this.scrollArrowSize;						
				}
			}
		
			_this.drawArea.width = newImageSize.w;
			_this.drawArea.height = newImageSize.h;
			
			if(_this.drawArea.width < _this.canvasWidth){
				_this.drawArea.x = (_this.drawArea.width - _this.canvasWidth) * 0.5;
			} else {
				_this.drawArea.x = 0;
			}
			
			if(_this.drawArea.height < _this.canvasHeight){
				_this.drawArea.y = (_this.drawArea.height - _this.canvasHeight) * 0.5;
			} else {
				_this.drawArea.y = 0;
			}
			
			Funs.output('draw Area: ' + [_this.drawArea.x, _this.drawArea.y, _this.drawArea.width, _this.drawArea.height].join(','));
			//console.log('fZoom in control: ' + _this.fZoomValue);
			
			_this.__refreshImageAreaSelectorLocationAndSize();
			_this.__refreshImageOverlayInfo();
		}

	};
	ImageControl.prototype.__resetScroll = function () {
		var _this = this, cfg, el, 
			bShowScrollV = _this.__isShowScrollV(), bShowScrollH = _this.__isShowScrollH(),
			cValue, maxScrollValue, parent, _maxY, _maxX;
		
		if(_this.canvas){
			parent = _this.canvas.parentNode;
		}
		
		if(!parent)
			return;

		// create V scroll
		if(bShowScrollV){
			cPosition = _this.drawArea.y;

			if(!_this.scrollV) {
				cfg = {
					Width: _this.scrollArrowSize,
					Height: _this.canvasHeight,
					Horizontal: false
				};
				cfg['onValueChanged'] = function(newValueObj){
					_this.drawArea.y = newValueObj.Value;

					if(_this.drawArea.height > _this.canvasHeight && _this.drawArea.y > _this.drawArea.height - _this.canvasHeight){
						_this.drawArea.y = _this.drawArea.height - _this.canvasHeight;
					}
					// 
					_this.__reselectArea();
					_this.Show(true);
				};
				_this.scrollV = new Dynamsoft.Lib.UI.ScrollBar(cfg);
				_this.scrollV.InitScroll(_this.drawArea.height, _this.canvasHeight);
				_this.scrollV.SetLocation(1,1);
				el = _this.scrollV.GetEL();
				el.style.position = 'absolute';
				parent.appendChild(el);
				
			} else {
				// show
				el = _this.scrollV.GetEL();
				if(_this.scrollV.GetControlHeight() != _this.canvasHeight){
					_this.scrollV.ChangeControlSize(_this.scrollArrowSize, _this.canvasHeight);
				}
				el.style.display = '';
				_this.scrollV.InitScroll(_this.drawArea.height, _this.canvasHeight);
				_this.scrollV.SetPosition(cPosition);
	
			}
			
			// 
			el.style.top = _this.borderWidth + 'px';
			el.style.left = _this.borderWidth + _this._width - _this.scrollArrowSize + 'px';
			
			_this.scrollV.Refresh();
		} else {
			if(_this.scrollV) {
				// hide
				el = _this.scrollV.GetEL();
				el.style.display = 'none';
			}
		}
		
		// create H scroll
		if(bShowScrollH){
			cPosition = _this.drawArea.x;

			if(!_this.scrollH) {
				cfg = {
					Width: _this.canvasWidth,
					Height: _this.scrollArrowSize,
					Horizontal: true
				};
				cfg['onValueChanged'] = function(newValueObj){
					_this.drawArea.x = newValueObj.Value;
					if(_this.drawArea.width > _this.canvasWidth && _this.drawArea.x > _this.drawArea.width - _this.canvasWidth){
						_this.drawArea.x = _this.drawArea.width - _this.canvasWidth;
					}

					// 
					_this.__reselectArea();
					_this.Show(true);
				};
				
				_this.scrollH = new Dynamsoft.Lib.UI.ScrollBar(cfg);
				_this.scrollH.InitScroll(_this.drawArea.width, _this.canvasWidth);
				_this.scrollH.SetLocation(1,1);
				el = _this.scrollH.GetEL();
				el.style.position = 'absolute';
				parent.appendChild(el);
				
			} else {
				// show
				el = _this.scrollH.GetEL();
				if(_this.scrollH.GetControlWidth() != _this.canvasWidth){
					_this.scrollH.ChangeControlSize(_this.canvasWidth, _this.scrollArrowSize);
				}
				
				el.style.display = '';
				_this.scrollH.InitScroll(_this.drawArea.width, _this.canvasWidth);
				_this.scrollH.SetPosition(cPosition);
			}
			
			// 
			el.style.top = _this.borderWidth + _this._height - _this.scrollArrowSize + 'px';
			el.style.left = _this.borderWidth + 'px';
			
			_this.scrollH.Refresh();
		} else {
			if(_this.scrollH) {
				// hide
				el = _this.scrollH.GetEL();
				el.style.display = 'none';
			}
		}
	};
	ImageControl.prototype.__restoreCanvas = function (ctx, w, h) {
		var _this = this;
		ctx.canvas.width = w;
		ctx.canvas.height = h;
	};
	ImageControl.prototype.__reselectArea = function () {
		var _this = this;
		if(_this.imageAreaSelector)
			_this.imageAreaSelector.ReFireSelectedEventWhenImageMoved();
	};

	//  for test
	ImageControl.prototype.__zoomIn = function (){
		var _this = this;
		_this.SetZoom(1.1 * _this.fZoomValue);
	};
	//  for test
	ImageControl.prototype.__zoomOut = function (){
		var _this = this;
		_this.SetZoom(0.9 * _this.fZoomValue);
	};

	ImageControl.prototype.__refreshBorder = function(){
		var _this=this;
		if(_this.bSelect){
			// set border
			_this.divOut.style.border = _this.borderWidth + 'px solid ' + _this.selectionBorderColor;
		} else {
			_this.divOut.style.border = _this.borderWidth + 'px solid ' + _this.borderColor;
		}
	};
	
	ImageControl.prototype.__resetTag = function () {
		var _this=this;
		if(_this.bShowPageNumber){
			Funs.SetPageNumber(_this.divTag, _this.cIndex);

			if(_this.bSelect){
				_this.divTag.className = 'imgTag imgTag_Selected';
			} else {
				_this.divTag.className = 'imgTag imgTag_Normal';
			}

			_this.divTag.style.display = 'block';
		} else {
			_this.divTag.innerHTML = '';
			_this.divTag.style.display = 'none';
		}
	};
	
	// Loading...
	ImageControl.prototype.ClearControl = function () {
		var _this = this;
		
		_this.ClearImage();

		_this.bShowPageNumber = FALSE;
		
		_this.Show();
		return true;
	};
	
	// Events:
	ImageControl.prototype.__fireEvent = function (evtName, params) {
		var _this = this;
		if (DL.isFunction(_this[evtName])) {
			return _this[evtName](params);
		}
		return true;
	};

	
    DL.UI = DL.UI || {};
	DL.UI['ImageControl'] = ImageControl;

})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 

var ___ii=0, Funs2;

(function(DL){
	if (!DL.product.bChromeEdition){
		return;
	}

	Funs2 = {

		getImageUrl: function (_baseUrl, _index, w, h) {
			var tmp = [_baseUrl];

			if (_index !== undefined && _index !== null) {
				tmp.push('&index=');
				tmp.push(_index);
			}

			tmp.push('&width=');
			tmp.push(w);
			tmp.push('&height=');
			tmp.push(h);
			tmp.push('&ticks=');
			tmp.push(___ii++);

			return tmp.join('');
		},
		// 1-undo 2-save
		getUrlByAct : function (_baseUrl, _index, _act) {
			var tmp = [_baseUrl];

			if (_index !== undefined && _index !== null) {
				tmp.push('&index=');
				tmp.push(_index);
			}
			
			if (_act) {
				tmp.push('&act=');
				tmp.push(_act);
			}
			tmp.push('&ticks=');
			tmp.push(___ii++);

			return tmp.join('');
		},
		
		output: function (_ImageBaseUI, msg) {

	        if (Dynamsoft.WebTwainEnv.Debug) {
	            DL.log(msg);
	        }

	    },
	    
	    print: function (_aryPrintUrl) {
	       var _html, iWidth = 850, HeightConstant = 1120, i = 0;
	       var iTotalWidth = 0, iTotalHeight = 0, imageTemp = ""; 
	       
	       	if (Dynamsoft.Lib.product.bChromeEdition)
	       	{
	       	    if(DL.env.bIE)
	       	        HeightConstant = 1289;
	       	    if(DL.env.bFirefox)
	       	        HeightConstant = 1169;
	       	}
	       	    
	       var iHeight = HeightConstant;
	       
	       for(i = 0; i< _aryPrintUrl.length; i++)
	       {
	            var objPrintUrl = _aryPrintUrl[i];
	            var _imgWidth = objPrintUrl.Width;
	            var _imgHeight = objPrintUrl.Height;
	            var _url = objPrintUrl.Url;
	            var wZ = iWidth/_imgWidth, hZ = iHeight/_imgHeight;
                if(wZ < hZ)
                {
                    iHeight = parseInt(_imgHeight * wZ);
                }
                else if(wZ > hZ)
                {
                    iWidth = parseInt(_imgWidth * hZ);
                }
                iTotalWidth += _imgWidth;
                iTotalHeight += _imgHeight;
                imageTemp = imageTemp + '<div style="width:850px;height:' + HeightConstant+ 'px"> <img id="D_img' + i + '" src="' + _url + '" style="position:relative;left:0px;top:0px;width: '+iWidth+'px;height: '+iHeight+'px" /></div>';
	       }
	        
	        var img,
				p = ['alwaysRaised=yes,z-look=yes,top=0,left=0,toolbar=no,menubar=no,location=no,status=no,width=', iTotalWidth, ',height=', iTotalHeight].join(''),
				_html = '<html><body id="D_img">'+ imageTemp+ '</body></html>';
	        var printWindow = window.open('about:blank', '_blank', p);
            if(printWindow)
            {
	            printWindow.document.write(_html);
	            printWindow.document.close();

	            printWindow.focus();

	            img = printWindow.document.getElementById('D_img');
	            if (img) {
	                img.onload = function () {
	                    printWindow.print();
	                    printWindow.close();
	                    Dynamsoft.Lib.log('print image...ok');
	                }

	            } else {
	                Dynamsoft.Lib.log('cannot find image');
	            }
            }
        }
	};

})(Dynamsoft.Lib);

(function (DL) {
	if (!DL.product.bChromeEdition){
		return;
	}
	
     var doc = document,
		registedObjsView = [];
		
	function PrintUrl(_url, _iWidth, _iHeight) {
	    var _this = this;
	    _this.Url = _url;
	    _this.Width = _iWidth;
	    _this.Height = _iHeight;
	};
		
		
	function ModelImageControl() {
		var _this = this;
		_this.bIsDirty = false;
		
		//
		_this.imageToShow;
		
		//
		_this.imageWidth = 0;
		
		//
		_this.imageHeight = 0;
		
		//
		_this.rawWidth = 0;
		
		_this.bOriginalImage = false;
		
		_this.imageUrl;
		
		//n*nserver
		//4*4 -> 2*2
		//2*2 -> 4*4 
		
		//
		_this.iImageControlWidth;
		//
		_this.iImageControlHeight;

		//index
		_this.imageIndex = -1;
		
		//OverlayRectangle
		_this.aryOverlayRectangleData = [];
		
	};
	
	ModelImageControl.prototype.Clear = function(){
		var _this = this;            
		if(_this.imageToShow)
        {
			_this.imageToShow.onload = undefined;
			_this.imageToShow.src = 'data:,';
		}
		
		_this.imageToShow = false;
		_this.imageUrl = '';
		_this.aryOverlayRectangleData = [];
	};
	
	//
	function ControlLoadImage(controlIndex, imageIndex, view, imgControl, modelImageControl, width, height, attachImagesForControl, bOnlyFromServer, baseUrl)
	{
	    var _this = this;
		
		//index
	    _this.iControlIndex = controlIndex;
		
		//index
	    _this.iImageIndex = imageIndex;
	    
	    //
	    _this.View = view;
	    _this.imgControl = imgControl;
	    _this.modelImageControl = modelImageControl;
	    _this.iWidth = width; 
	    _this.iHeight = height; 
	    _this.AttachImagesForControl = attachImagesForControl;
	    _this.bOnlyFromServer = bOnlyFromServer;
	    _this.BaseUrl = baseUrl;
	};
	
	function OverlayRectangleData(iLeft, iTop, iRight, iBottom, ColorRGB, Opacity)
	{
	    var _this = this;
	    _this.Left = iLeft;
	    _this.Top = iTop;
	    _this.Right = iRight;
	    _this.Bottom = iBottom;
	    _this.ColorRGB = ColorRGB;
	    _this.Opacity = Opacity;
	}

	function ImageUIView(cfg) {
		var _this = this;
		if(!Dynamsoft.WebTwainEnv.ScanDirectly)
		{
		_this.bFocus = false;
		_this.borderWidth = DL.isUndefined(cfg.borderWidth) ? 1 : cfg.borderWidth;
		
		_this.canvas = document.createElement('div');

        if(_this.canvas)
        {
		    _this.canvas.style.width = cfg.Width + 'px';
		    _this.canvas.style.height = cfg.Height + 'px';

		    if(_this.borderWidth > 0){
    		   
	            _this.canvas.style.border = _this.borderWidth + 'px solid #CCCCCC';
		    }
		    _this.canvas.style.display = 'block';
		}

		_this.BaseUrl = false;
		
		cfg.Container.append(_this.canvas);     

	    DL.addEventListener(_this.canvas, 'mouseenter', function(evt){
	      _this.bFocus = true;
	    });

	    DL.addEventListener(_this.canvas, 'mouseleave', function(evt){
	      _this.bFocus = false;
	    });

		 // bind events
        DL.addEventListener(_this.canvas, 'mousewheel', function (e) {
            if (!_this.bFocus)
                return true;
			
            var delta = DL.getWheelDelta(e);

            if (delta < 0) {
				_this.__MousewheelValue--;

                //_this.fire('onRefreshUI', _this.cIndex);
            } else if (delta > 0) {
				_this.__MousewheelValue++;
                //_this.fire('onRefreshUI', _this.cIndex);
            }

			DL.stopPropagation(e);
			
			setTimeout(function(){
				_this.__MousewheelChanged(_this);
			}, 200);
			
            return false;
        });
		
		//view
		_this.imageViewWidth = cfg.Width;
		
		//view
		_this.imageViewHeight = cfg.Height;
		
		//view
		_this.imagesPerRow = 1;
		
		//view
		_this.imagesPerColumn = 1;

		//
		_this.MAX_ROWS = 128;
		//
		_this.MAX_COLUMNS = 128;
		
		// true: -1*-1; false:n*n, n*-1, 1*1
		_this.bSingleMode = false;
		//*,_this.bSingleMode = false true:n*n,1*1; false:n*-1
		_this.bVerticalMode = true;
   
		// -1* -1
		_this.bHand = false;
		_this.bIfFitWindow = true;
		
		// 0: FitWindow; 1: FitWindowHeight; 2:FitWindowWidth; 3: OriginalSize; 4:Strech
		_this.enumDWTFitWindowType = 0;
		_this.fZoom = 1.0;
		_this.zoomInStep = 1.2;
        _this.zoomOutStep = 0.8;
		_this.MIN_ZOOM = 0.02;
		_this.MAX_ZOOM = 65;
  
		//
		_this.ImageMargin = 0;
		//view  n*n
		_this.iControlWidth;
		//view  n*n
		_this.iControlHeight;

		//view
		_this.iCurrentRow = -1;
		_this.iOldFirstVisibleRow = 0;
   
		//view
		_this.iCurrentColumn = -1;
		_this.iOldFirstVisibleColum = 0;

		_this.AllowMultiSelect = true;
		
		//
		_this.SelectionImageBorderColor = "#7DA2CE";
		//"#DDDDDD"; //
		_this.BackgroundColor = "#FFFFFF";

		// cIndex: current image index
		_this.cCurrentIndex = -1;
		_this.sHowManyImages = 0;
   
		//n*n, n*-1, 1*1, -1*-1
		_this.bScrollBar = true;
		
		_this.__InitiHorizontalScrollBar(cfg);
		
		_this.__InitiVerticalScrollBar(cfg);
		}
		
		//index
		_this.aryCurrentSelectedImageIndicesInBuffer = [];
		
		//View 
		_this.aryModelImageControl =[];
		//View 
		_this.aryImageControls =[];
		
		//n*n, n*-1
		_this.bShowPageNumber = false;

		_this.ratio = 0;

		_this.__InitEvents(cfg);
		
		registedObjsView.push(_this);
		
		if(!Dynamsoft.WebTwainEnv.ScanDirectly)
		{
		    //View
		    if(_this.canvas)
		        _this.canvas.style.backgroundColor = _this.BackgroundColor;
		    _this.__MousewheelValue = 0;
		}
	};
	ImageUIView.prototype.__InitEvents = function (cfg) {
		var _this = this;
		
		if(DL.isFunction(cfg["OnTopImageInTheViewChanged"]))
			_this["OnTopImageInTheViewChanged"] = cfg["OnTopImageInTheViewChanged"];
		if(DL.isFunction(cfg["OnGetImageInfo"]))
			_this["OnGetImageInfo"] = cfg["OnGetImageInfo"];
			
		if(DL.isFunction(cfg["onMouseMove"]))
			_this["onMouseMove"] = cfg["onMouseMove"];
		if(DL.isFunction(cfg["onMouseClick"]))
			_this["onMouseClick"] = cfg["onMouseClick"];
		if(DL.isFunction(cfg["onMouseRightClick"]))
			_this["onMouseRightClick"] = cfg["onMouseRightClick"];
		if(DL.isFunction(cfg["onMouseDoubleClick"]))
			_this["onMouseDoubleClick"] = cfg["onMouseDoubleClick"];
		if(DL.isFunction(cfg["onImageAreaDeSelected"]))
			_this["onImageAreaDeSelected"] = cfg["onImageAreaDeSelected"];
		if(DL.isFunction(cfg["onImageAreaSelected"]))
			_this["onImageAreaSelected"] = cfg["onImageAreaSelected"];
			
		if(DL.isFunction(cfg["onSelected"]))
			_this["onSelected"] = cfg["onSelected"];
		if(DL.isFunction(cfg["onRefreshUI"]))
			_this["onRefreshUI"] = cfg["onRefreshUI"];
		if(DL.isFunction(cfg["onResetCurrentIndex"]))
			_this["onResetCurrentIndex"] = cfg["onResetCurrentIndex"];
		
	};

	ImageUIView.prototype.__InitiHorizontalScrollBar = function (cfg) {
		var _this = this;
		
		 var cfgH = {
			 Width: cfg.Width,
			 Height: 16,
			 Value: 0,
			 MaxValue: 0,
			 Horizontal: true
		};
		cfgH['onValueChanged'] = function(params){
			_this.__UpdateImageByScrollBar(params.Value);
		};
		
	    //
		_this.horizontalScrollBar = new Dynamsoft.Lib.UI.ScrollBar(cfgH);
		 // 
		if(_this.canvas && _this.horizontalScrollBar)  
		    _this.canvas.appendChild(_this.horizontalScrollBar.GetEL());
		_this.__SetHLocation(0, cfg.Height-_this.__GetScrollWidth());
	};

	ImageUIView.prototype.__InitiVerticalScrollBar = function (cfg) {
		var _this = this;
		
		 var cfgV = {
			 Width: 16,
			 Height: cfg.Height,
			 Value: 0,
			 MaxValue: 0,
			 Horizontal: false
		};
		
		cfgV['onValueChanged'] = function(params){
			_this.__UpdateImageByScrollBar(params.Value);
		};
		
		//
		_this.verticalScrollBar = new Dynamsoft.Lib.UI.ScrollBar(cfgV);
		if(_this.canvas && _this.verticalScrollBar)
		    _this.canvas.appendChild(_this.verticalScrollBar.GetEL());
		_this.__SetVLocation(cfg.Width-_this.__GetScrollWidth(), 0);
	};

	ImageUIView.prototype.__UpdateImageByScrollBar = function (vlue) {
		var _this = this, oldRow = -1, topViewIndex = -1, newIndex = -1, newRow, firstControl;
		
		//topViewIndex(oldRow)
		if (_this.aryImageControls && _this.aryImageControls.length > 0) {
			firstControl = _this.aryImageControls[0];
			if(firstControl){
				topViewIndex = firstControl.GetCurrentIndex();
				oldRow = _this.__GetRow(topViewIndex);
			}
		}
		
		//
		if (_this.bVerticalMode == true)
		{
			// indexindex(newRow)
			newIndex = parseInt(_this.__GetVisibleRow(vlue)* _this.imagesPerColumn);
			newRow = _this.__GetRow(newIndex);
			
			// return
			if(oldRow == newRow){
				return;
			}
		}
		else
		{
			//
			newIndex = parseInt(_this.__GetVisibleRow(vlue));
			// indextopViewIndexreturn
			if(newIndex == topViewIndex){
				return;
			}
		}
		
		Funs2.output(_this, '__UpdateImageByScrollBar(value, newIndex): ' + [vlue, newIndex].join(','));
		//
		_this.__GoInner(newIndex, false, true);
	};


	ImageUIView.prototype.UpdateImage = function (imageIndex, image, iWidth, iHeight, aryOverlayRectangleData, imageUrl) {
		var _this = this;
		var objModelImageControl =  _this.aryModelImageControl[imageIndex];
		objModelImageControl.imageToShow = image;
		objModelImageControl.imageWidth = iWidth;
		objModelImageControl.imageHeight = iHeight;
		objModelImageControl.iImageControlWidth = iWidth;    
		objModelImageControl.iImageControlHeight = iHeight;
		objModelImageControl.aryOverlayRectangleData = aryOverlayRectangleData;
		objModelImageControl.imageUrl = imageUrl;
		
		var imgControl = _this.GetImageControl(imageIndex);	
		if(null != imgControl)
		{
			
			//index
			imgControl.SetCurrentIndex(imageIndex);
			if(image != null && (image.src == 'data:,'
               || image.width == 0 || image.height == 0 
               || image.src == '')){
               var controlIndex =  _this.__GetImageControlIndex(imageIndex);
		       if(controlIndex >= 0)
		         _this.__SetArrayControlLoadImage(controlIndex,imageIndex, imgControl, objModelImageControl, iWidth, iHeight, _this.AttachImagesForControl, false);
           }
           else
           {
                if(image == null)
                {
                    var controlIndex =  _this.__GetImageControlIndex(imageIndex);
		            if(controlIndex >= 0)
		            {
		               var iWidth = parseInt(_this.imageViewWidth/2);
		                var iHeight = parseInt(_this.imageViewHeight/2);
		                if(_this.imagesPerRow == 1 &&_this.imagesPerColumn == 1)  
	                    {
			                // -1 * -1, Original Size
	                        if (_this.bSingleMode == true)
	                        {
	                            iWidth = -1;
	                            iHeight = -1;
	                            objModelImageControl.bOriginalImage = true;
	                        }
	                        else
	                        {
				                // 1 * 1, Control Size
	                            iWidth = _this.imageViewWidth;
	                            iHeight = _this.imageViewHeight;
	                            objModelImageControl.bOriginalImage = false;
	                        }
	                    }
	                    else
	                    {
                            if(iWidth < 300)
	                            iWidth = 300;
	                        if(iHeight < 300)
	                            iHeight = 300;
	                             
	                        objModelImageControl.bOriginalImage = false;
	                    }
	                         
		                _this.__SetArrayControlLoadImage(controlIndex,imageIndex, imgControl, objModelImageControl, iWidth, iHeight, _this.AttachImagesForControl, true);
		            }
                }
                _this.AttachImagesForControl(imgControl,objModelImageControl);
           }
		}

		_this.iCurrentRow = -1;
		_this.iCurrentColumn = -1;
		return true;
	};

	ImageUIView.prototype.__AddImage = function (imageIndex, objModelImageControl) {
		 var _this = this;
		 //viewcanvascanvas
		 _this.__AddControl(); 

		 var imgControl = _this.GetImageControl(imageIndex);
		 
		 //index
		 imgControl.SetCurrentIndex(imageIndex);
		  _this.AttachImagesForControl(imgControl,objModelImageControl);
	};
	
	ImageUIView.prototype.UpdateAllImage = function (aryDateImageControl, currentIndex, startRefresh, endRefresh) {
	    var _this = this;
	    
		return _this.UpdateAllImageInner(aryDateImageControl, currentIndex, false, startRefresh, endRefresh);
	};
	
	ImageUIView.prototype.UpdateAllImageInner = function (aryDateImageControl, currentIndex, bIfProertyDirty, startRefresh, endRefresh) {
		var _this = this;

		_this.aryModelImageControl = aryDateImageControl;
		_this.__OnlySetCurrentIndex(currentIndex);
		
        //aryModelImageControl 
		_this.sHowManyImages =  _this.aryModelImageControl.length;
		var sHowManyRequired = (_this.imagesPerRow * _this.imagesPerColumn) > _this.sHowManyImages ? _this.sHowManyImages : _this.imagesPerRow * _this.imagesPerColumn;
		var i = 0;
		for (i = _this.aryImageControls.length - 1; i >= sHowManyRequired; i--) {
			//
			_this.__RemoveControl(i);
		}

		for (i =_this.aryImageControls.length; i < sHowManyRequired; i++) {
			//viewcanvascanvas
			_this.__AddControl();
		}
   
        if(!Dynamsoft.WebTwainEnv.ScanDirectly)
		{

		//, n*n, n*-1, 1*1
		_this.__ConfirmScrollMaxValue();
		//, n*n, n*-1, 1*1   
		_this.__ConfirmScrollVisibity();
		

		_this.iCurrentRow = -1;
		_this.iCurrentColumn = -1;

		_this.__SetCurrentIndex(_this.cCurrentIndex);

		//
		_this.__ReInitChildrenPosition();

		//viewcanvascanvasattach   
		_this.__AttachImages(bIfProertyDirty, startRefresh, endRefresh);
		}
		return true; 
	};

	ImageUIView.prototype.__AddControl = function () {
		var _this = this, cfg = {};
		if(!Dynamsoft.WebTwainEnv.ScanDirectly)
		{

		if(DL.isFunction(_this["onImageAreaDeSelected"]))
			cfg["onImageAreaDeSelected"] = _this["onImageAreaDeSelected"];
		if(DL.isFunction(_this["onImageAreaSelected"]))
			cfg["onImageAreaSelected"] = _this["onImageAreaSelected"];
			
		cfg['onMouseClick'] = function(params){
	        _this.__OnMouseClick(params);
			_this.__fireEvent('onMouseClick', params);
		};
		cfg['onMouseRightClick'] = function(params){
			_this.__fireEvent('onMouseRightClick', params);
		};
		cfg['onMouseMove'] = function(params){
			_this.__fireEvent('onMouseMove', params);
		};
		cfg['onMouseDoubleClick'] = function(params){
			_this.__fireEvent('onMouseDoubleClick', params);
		};		
		cfg['OnGetImageInfo'] = function(indexTemp){
			return _this.__fireEvent('OnGetImageInfo', indexTemp);
		};

        }

		var objImageControl = new Dynamsoft.Lib.UI.ImageControl(cfg);
		 //
		 _this.aryImageControls.push(objImageControl);
		 Dynamsoft.Lib.imageControlCount++;
		 
        _this.__InitImageControl(objImageControl);

        if(!Dynamsoft.WebTwainEnv.ScanDirectly)
		{
		 // 
		 if(_this.canvas)  
		    _this.canvas.appendChild(objImageControl.GetEL());
		 objImageControl.bindEvents();
		 }	 
	};
	
	ImageUIView.prototype.__InitImageControl = function (objImageControl) {
	    var _this = this;
		if(_this.imagesPerRow == 1 && _this.imagesPerColumn == 1)
		{
		    objImageControl.SetMouseShape(_this.bHand);
		    objImageControl.SetShowPageNumber(false);
		}
		else
		{
		    objImageControl.SetMouseShape(true);
		    objImageControl.SetShowPageNumber(_this.bShowPageNumber);
		}			

		objImageControl.SetSelectionRectAspectRatio(_this.ratio);

		objImageControl.SetBackgroundColor(_this.BackgroundColor);
		
		objImageControl.SetSelectionImageBorderColor(_this.SelectionImageBorderColor);	
		
		if (_this.bSingleMode)
		{
			// -1*-1
			if (_this.bIfFitWindow){
				objImageControl.SetIfFitWindow(true, _this.enumDWTFitWindowType);
			} else {
				objImageControl.SetZoom(_this.fZoom);
			}
		}
		else {
			 //Fit Window
			objImageControl.SetIfFitWindow(true, 0);
		}
	}
	
    ImageUIView.prototype.__OnMouseClick = function (params) {
        var _this = this;
	    var _nIndex = params.index;
	    var indexOfID = _this.aryCurrentSelectedImageIndicesInBuffer.indexOf(_nIndex), multiSelectByCtrl = params.e.ctrlKey, multiSelectByShift = params.e.shiftKey, multiSelectByCommand =  params.e.metaKey;

        if (indexOfID == -1) {
            if (multiSelectByCtrl || multiSelectByShift || multiSelectByCommand || _this.aryCurrentSelectedImageIndicesInBuffer.length < 1)
            {
                _this.aryCurrentSelectedImageIndicesInBuffer.push(_nIndex);
            }
            else if (_this.aryCurrentSelectedImageIndicesInBuffer.length == 1) {
                if(_this.aryCurrentSelectedImageIndicesInBuffer[0] == _nIndex)
                    return;
                _this.aryCurrentSelectedImageIndicesInBuffer[0] = _nIndex;
            }
            else {
                _this.aryCurrentSelectedImageIndicesInBuffer = [];
                _this.aryCurrentSelectedImageIndicesInBuffer.push(_nIndex);
            }
        }
        else {
            if ((multiSelectByCtrl || multiSelectByCommand) && _this.aryCurrentSelectedImageIndicesInBuffer.length > 1) {
                _this.aryCurrentSelectedImageIndicesInBuffer.splice(indexOfID, 1);
            }
            else if (multiSelectByShift) {
                _this.aryCurrentSelectedImageIndicesInBuffer.push(_nIndex);
            }
            else {
                if(_this.aryCurrentSelectedImageIndicesInBuffer.length == 1 && _this.cCurrentIndex == _nIndex)
                    return;
                _this.aryCurrentSelectedImageIndicesInBuffer = [];
                _this.aryCurrentSelectedImageIndicesInBuffer.push(_nIndex);
            }
        }
        if (multiSelectByShift) {
            var startIndex = _this.aryCurrentSelectedImageIndicesInBuffer[0], endIndex = _this.aryCurrentSelectedImageIndicesInBuffer[_this.aryCurrentSelectedImageIndicesInBuffer.length - 1];

            _this.aryCurrentSelectedImageIndicesInBuffer = [];
            if (endIndex == startIndex) {
                //only one remaining                    
                _this.aryCurrentSelectedImageIndicesInBuffer.push(parseInt(startIndex));
            }
            else if (endIndex > startIndex) {
                var indexesCount = endIndex - startIndex + 1;
                for (var i = 0; i < indexesCount; i++) {
                    _this.aryCurrentSelectedImageIndicesInBuffer.push(parseInt(startIndex + i));
                }
            }
            else {
                var indexesCount = startIndex - endIndex + 1;
                _this.aryCurrentSelectedImageIndicesInBuffer.push(parseInt(startIndex));
                for (var i = 0; i < indexesCount - 1; i++) {
                    _this.aryCurrentSelectedImageIndicesInBuffer.push(parseInt(endIndex + i));
                }
            }
        }

        if (_this.aryCurrentSelectedImageIndicesInBuffer.length == 1) {
            _this.__OnlySetCurrentIndex(_this.aryCurrentSelectedImageIndicesInBuffer[0]);
            _this.__SetCurrentIndexWithoutSetScroll(_this.cCurrentIndex); 
        }
        
        
        _this.__SortCurrentSelectedImageIndicesInBuffer();
        _this.__SetUnselectAll();
        var i = 0;
        for(i = 0; i<_this.aryCurrentSelectedImageIndicesInBuffer.length; i++)
        {
            var imgControl = _this.GetImageControl(_this.aryCurrentSelectedImageIndicesInBuffer[i]);
            if (null != imgControl){
				//
				imgControl.SetSelect(true);
			}
		}
		
		_this.__fireEvent('onSelected', _this.aryCurrentSelectedImageIndicesInBuffer);
    };
    
    ImageUIView.prototype.__SortCurrentSelectedImageIndicesInBuffer = function () {
        var _this = this;
        //saveselect
        var iCount = _this.aryCurrentSelectedImageIndicesInBuffer.length;
        if(iCount > 1)
        {
            var tmp, i, j;
            var exchanged = false;
            for (i = 0; i < iCount - 1; i++)
            {
                exchanged = false;
                for (j = 1; j < iCount; j++)
                {
                    if (_this.aryCurrentSelectedImageIndicesInBuffer[j] < _this.aryCurrentSelectedImageIndicesInBuffer[j - 1])   
                    {
                        exchanged = true;
                        tmp = _this.aryCurrentSelectedImageIndicesInBuffer[j - 1];
                        _this.aryCurrentSelectedImageIndicesInBuffer[j - 1] = _this.aryCurrentSelectedImageIndicesInBuffer[j];
                        _this.aryCurrentSelectedImageIndicesInBuffer[j] = tmp;
                    }
                }
                if(!exchanged)
                    return;
            }
        }
    };

	ImageUIView.prototype.__RemoveControl = function (index) {
		 var _this = this;
		 if(index < _this.aryImageControls.length && index >= 0)
		 {
			//
			var objImageControl = _this.aryImageControls[index];
			objImageControl.Destroy();

			_this.aryImageControls.splice(index, 1);
			 
			if(!Dynamsoft.WebTwainEnv.ScanDirectly)
			{
				if(_this.canvas)
					_this.canvas.removeChild(objImageControl.GetEL());
			}
			Dynamsoft.Lib.imageControlCount--;
		 }
	};

	ImageUIView.prototype.__ConfirmScrollMaxValue = function () {
		var _this = this;
		if (!_this.bSingleMode) {
			 if (_this.bVerticalMode == true)
			{
				var iHowManyImage = _this.__GetHowManyRows();
				_this.__SetVScrollMaxValue(iHowManyImage,_this.imagesPerRow);  
			}
			else
			{
				_this.__SetHScrollMaxValue(_this.sHowManyImages, _this.imagesPerColumn); 
			}
		 }
	}

	ImageUIView.prototype.__GetHowManyRows = function () {
		var _this = this;
		return parseInt((_this.sHowManyImages + _this.imagesPerColumn -1) / _this.imagesPerColumn);  //
	}

	ImageUIView.prototype.__ConfirmScrollVisibity = function () {
		var _this = this;
		if (_this.bSingleMode) {
			_this.__SetIfHScroll(false);
			_this.__SetIfVScroll(false);
		} else {
			if (_this.bVerticalMode == false)
			{
				//_this.bScrollBar false
				if (_this.bScrollBar && _this.sHowManyImages > _this.imagesPerRow * _this.imagesPerColumn) {
					// 
					_this.__SetIfHScroll(true);
				} else {
					_this.__SetIfHScroll(false);
				}
				
				//
				_this.__SetIfVScroll(false);
			}
			else
			{
				//n*n (n>=1)
				if (_this.bScrollBar && _this.sHowManyImages > _this.imagesPerRow * _this.imagesPerColumn) {
					//
					_this.__SetIfVScroll(true);
				} else {
					_this.__SetIfVScroll(false);
				}
				
				//
				_this.__SetIfHScroll(false);
			}
		}
	};
	
	ImageUIView.prototype.__SetCurrentIndex = function (index)
	{
	    var _this = this;
	    if(index >= 0)
	        _this.__SetCurrentIndexInnerInner(index, true, false);
	};
	
	ImageUIView.prototype.__SetCurrentIndexInner = function (index, bResetSelection, bSetFirstRow) {
	     var _this = this;
	     if(!bSetFirstRow)
	        _this.__SetCurrentIndexInnerInner(index, bResetSelection, bSetFirstRow);
	     else
	        _this.__SetCurrentIndexInnerInner(index, bResetSelection, true);
	};
	
	ImageUIView.prototype.__SetCurrentIndexWithoutSetScroll = function (index) {
	     var _this = this;
	     _this.__SetCurrentIndexInnerInner(index, true, false, true); 
	};
	
	ImageUIView.prototype.__SetCurrentIndexWithoutRefreshUI = function (index) {
	     var _this = this;
		 //
	     _this.__SetCurrentIndexInnerInner(index, true, false);
	};
	

	ImageUIView.prototype.__SetCurrentIndexInnerInner = function (index, bResetSelection, bSetFirstRow, bWithOutSetScroll) {
		var _this = this;
		if(index < 0 || index >= _this.aryModelImageControl.length)
			return;
		
		//
		if (_this.bVerticalMode == true)
		{
			var iOldRow = _this.iCurrentRow;
			_this.iCurrentRow = _this.__GetRow(index);

			if (_this.iCurrentRow != iOldRow &&
			(_this.iCurrentRow <= _this.iOldFirstVisibleRow || ((_this.iCurrentRow - _this.iOldFirstVisibleRow) >= _this.imagesPerRow))) {
				if ((_this.iCurrentRow - _this.iOldFirstVisibleRow) == _this.imagesPerRow) {
					if(bSetFirstRow == false)
					    _this.iCurrentRow = _this.iOldFirstVisibleRow + 1;
				}

				if (_this.bSingleMode == false) {
				    if(!bWithOutSetScroll || bWithOutSetScroll == false)
				    {
					    var yPosition = _this.iCurrentRow;
						//
					    _this.__SetVScrollPotion(yPosition);
					}
				}

				//
				var iFirstVisibleRow = _this.__GetFirstVisibleRow();

				if (_this.iOldFirstVisibleRow != iFirstVisibleRow) {
					_this.iOldFirstVisibleRow = iFirstVisibleRow;
					var indexTemp = iFirstVisibleRow * _this.imagesPerColumn;
					_this.__fireEvent('OnTopImageInTheViewChanged', indexTemp);
					//currentindex
					_this.__AttachImages(false);
				}
			}
		}
		else
		{
			//n *-1
			var iOldColumn = _this.iCurrentColumn;
			_this.iCurrentColumn = index;

			if (_this.iCurrentColumn != iOldColumn &&
			(_this.iCurrentColumn < _this.iOldFirstVisibleColum || ((_this.iCurrentColumn - _this.iOldFirstVisibleColum) >= _this.imagesPerColumn))) {
				if ((_this.iCurrentColumn - _this.iOldFirstVisibleColum) == _this.imagesPerColumn) {
					_this.iCurrentColumn = _this.iOldFirstVisibleColum + 1;
				}

				if (_this.bSingleMode == false) {
				    if(!bWithOutSetScroll || bWithOutSetScroll == false)
				    {
					    var xPosition = _this.iCurrentColumn;
						//
					    _this.__SetHScrollPotion(xPosition);
					}
				}

				//
				var iFirstVisibleColumn = _this.__GetFirstVisibleColumn();

				if (_this.iOldFirstVisibleColum != iFirstVisibleColumn) {
					_this.iOldFirstVisibleColum = iFirstVisibleColumn;
					var indexTemp = iFirstVisibleColumn;
					_this.__fireEvent('OnTopImageInTheViewChanged', indexTemp);
					//currentindex
					_this.__AttachImages(false);
				}
			}
		}

		
		if (bResetSelection) {
			_this.__SetUnselectAll();
            _this.__OnlySetCurrentIndex(index);
            
			var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl){
				//
				imgControl.SetSelect(true);
			}
		}
		
//		if(bFireRefreshUI == true)
//		    _this.__fireEvent('onRefreshUI', index);
	};
	
	
	ImageUIView.prototype.__SetScrollByIndex = function (index) {
		var _this = this;
  
		//
		if (_this.bVerticalMode == true)
		{
			var iOldRow = _this.iCurrentRow;
			_this.iCurrentRow = _this.__GetRow(index);

			if (_this.iCurrentRow != iOldRow &&
			(_this.iCurrentRow <= _this.iOldFirstVisibleRow || ((_this.iCurrentRow - _this.iOldFirstVisibleRow) >= _this.imagesPerRow))) {
				if ((_this.iCurrentRow - _this.iOldFirstVisibleRow) == _this.imagesPerRow) {
					//if(bSetFirstRow == false)
					//    _this.iCurrentRow = _this.iOldFirstVisibleRow + 1;
				}
			

				if (_this.bSingleMode == false) {
					var yPosition = _this.iCurrentRow;
					//
					_this.__SetVScrollPotion(yPosition);
				}

				//
				var iFirstVisibleRow = _this.__GetFirstVisibleRow();

				if (_this.iOldFirstVisibleRow != iFirstVisibleRow) {
					_this.iOldFirstVisibleRow = iFirstVisibleRow;
					var indexTemp = iFirstVisibleRow * _this.imagesPerColumn;
					_this.__fireEvent('OnTopImageInTheViewChanged', indexTemp);
					_this.__AttachImages(false);
				}
			}
		}
		else 
		{
			//n *-1
			 
			var iOldColumn = _this.iCurrentColumn;
			_this.iCurrentColumn = index;

			if (_this.iCurrentColumn != iOldColumn &&
			(_this.iCurrentColumn < _this.iOldFirstVisibleColum || ((_this.iCurrentColumn - _this.iOldFirstVisibleColum) >= _this.imagesPerColumn))) {
				if ((_this.iCurrentColumn - _this.iOldFirstVisibleColum) == _this.imagesPerColumn) {
					_this.iCurrentColumn = _this.iOldFirstVisibleColum + 1;
				}

				if (_this.bSingleMode == false) {
					var xPosition = _this.iCurrentColumn;
					//
					_this.__SetHScrollPotion(xPosition);
				}

				//
				var iFirstVisibleColumn = _this.__GetFirstVisibleColumn();

				if (_this.iOldFirstVisibleColum != iFirstVisibleColumn) {
					_this.iOldFirstVisibleColum = iFirstVisibleColumn;
					var indexTemp = iFirstVisibleColumn;
					_this.__fireEvent('OnTopImageInTheViewChanged', indexTemp);
					_this.__AttachImages(false);
				}
			}
		}
	};

	ImageUIView.prototype.__GetRow = function (index) {
		var _this = this;
		return  parseInt(index/ _this.imagesPerColumn);
	};

	ImageUIView.prototype.__GetFirstVisibleColumn = function () {
		var _this = this;
		return parseInt(_this.__GetVisibleRow(_this.__GetHScrollPosionValue()));
	}; 

	ImageUIView.prototype.__GetFirstVisibleRow = function () {
		var _this = this;
		return parseInt(_this.__GetVisibleRow(_this.__GetVScrollPosionValue()));
	};

	ImageUIView.prototype.__GetVisibleRow = function (iPos) {
		var _this = this;
		if (_this.__GetHowManyRows() == 0)
			return 0;

		var sRow = iPos;
		if (_this.bSingleMode) {
			return _this.cCurrentIndex;
		}
		else {
			if (_this.bVerticalMode == true) {
				if (_this.__GetHowManyRows() - sRow < _this.imagesPerRow) {
					sRow = sRow - (_this.imagesPerRow - (_this.__GetHowManyRows() - sRow));
				}
			}
			else {
				if (_this.sHowManyImages - sRow < _this.imagesPerColumn) {
					sRow = sRow - (_this.imagesPerColumn - (_this.sHowManyImages - sRow));
				}
			}
		}

		if (sRow < 0)
			sRow = 0;

		return sRow;
	}
	
	ImageUIView.prototype.__AttachImages = function (bIfProertyDirty, startRefresh, endRefresh) {
	    var _this = this;
	    _this.__AttachImagesInner(bIfProertyDirty, true, startRefresh, endRefresh);
	};

	ImageUIView.prototype.__AttachImagesInner = function (bIfProertyDirty, bAttachImages, startRefresh, endRefresh) {
		var _this = this;
		if (_this.aryImageControls && _this.aryImageControls.length > 0) {
			var baseIndex = 0;
			
			
			if (_this.bVerticalMode == true){
				//
				baseIndex = _this.__GetFirstVisibleRow() * _this.imagesPerColumn;
			} else {
				//
				baseIndex = _this.__GetFirstVisibleColumn();
			}
			
			if(baseIndex < 0)
				baseIndex = 0;
			
			//load	
			var i = 0;
			var iStart = baseIndex;
			var iEnd = baseIndex + _this.aryImageControls.length - 1;
			if(startRefresh && startRefresh> 0)
			    iStart = startRefresh;
		    if(endRefresh && endRefresh > 0)
		        iEnd = endRefresh;
			for (i = 0; i < _this.aryImageControls.length; i++) {
				var imgControl = _this.aryImageControls[i];
				if (imgControl) {
					var index = baseIndex + i;

					Funs2.output(_this, '__AttachImagesInner(baseIndex, index): ' + [baseIndex, index].join(','));
					if (index < _this.sHowManyImages) {
						if (bIfProertyDirty) {
						    _this.__InitImageControl(imgControl);
						}
                        
                        if(bAttachImages)
                        {
							//  index  this.aryModelImageControl
						    var objModelImageControl = _this.aryModelImageControl[index];
    						if(index>= iStart && index<= iEnd || objModelImageControl.bIsDirty == true || imgControl.GetCurrentIndex() != index){

								Funs2.output(_this, '__AttachImagesInner() attach Image index -> control index:' + [index, i].join('->'));
								
    						    _this.__GetImageAndAttach(imgControl, objModelImageControl, index, false);
							}
						}
						imgControl.SetVisible(true);
						
						Funs2.output(_this, '__AttachImagesInner() set control index Visible:' + [i].join());
					    if (_this.__IfContains(_this.aryCurrentSelectedImageIndicesInBuffer, index)){

							Funs2.output(_this, '__AttachImagesInner() set control index selected:' + [i].join());
							imgControl.SetSelect(true);
					    } else {
						    imgControl.SetSelect(false);
						}
					}
					else
					{
						Funs2.output(_this, '__AttachImagesInner() set control index InVisible:' + [i].join());
						imgControl.SetVisible(false);
					}
				}
			}
		}
	};
	
	ImageUIView.prototype.__IfContains = function (aryDataList, value) {
		var i = 0;
		if(aryDataList)
		{
		    for(i = 0; i< aryDataList.length; i++)
		    {
			    if(aryDataList[i] == value)
				    return true;
		    }
		}

		return false;
	};


	ImageUIView.prototype.__ReInitChildrenPosition = function () {
		var _this = this, x=0, y=0, i;
		_this.__InitControlsSize();

		if(!_this.bSingleMode){
			x = _this.ImageMargin;
			y = _this.ImageMargin;
		}

		for(i = 0; i< _this.aryImageControls.length; i++)
		{
			var imgControl =  _this.aryImageControls[i];
			imgControl.ChangeControlSize(_this.iControlWidth, _this.iControlHeight);

			if (_this.bSingleMode)  // -1*-1
			{
				imgControl.SetLocation(0, 0);
			}
			else
			{
			   imgControl.SetLocation(x, y);
			  
			   x = imgControl.Right + _this.ImageMargin;
			   if (_this.bVerticalMode == true)
			   {
				   // n*n; 1*1, 
				   
				   if((i + 1)%_this.imagesPerColumn == 0)
				   {
					    //
						
						//X
						x = _this.ImageMargin;

						y = imgControl.Bottom + _this.ImageMargin;
						if(_this.bScrollBar == false)
						{
							if((y+ iControlHeight) > _this.imageViewHeight)
								y =  _this.ImageMargin;
						}  
				   }
			   }
			}
		}
	};

	ImageUIView.prototype.__InitControlsSize = function () {
		//   _this.ImageMargin;_this.iControlWidth;  _this.iControlHeight; 
		var _this = this;
		if (_this.bSingleMode == false) {
			var sDelta = _this.__GetScrollWidth();
			if (_this.bVerticalMode == true) {
				if (_this.__GetHowManyRows() <= _this.imagesPerRow || _this.bScrollBar == false)
					sDelta = 0;
				if (_this.ImageMargin <= 0 || (_this.ImageMargin > (_this.imageViewWidth - sDelta - 3 * _this.imagesPerColumn)) ||
				(_this.ImageMargin > (_this.imageViewHeight - 3 * _this.imagesPerRow))) {
					var iMarginV = parseInt(_this.imageViewHeight / (_this.imagesPerRow * 10));
					var iMarginH = parseInt((_this.imageViewWidth - sDelta) / (_this.imagesPerColumn * 10));
					
					 var iMargin = iMarginV < iMarginH ? iMarginV : iMarginH;
					if (_this.ImageMargin <= 0)
						_this.ImageMargin = parseInt(iMargin);
					else
						_this.ImageMargin = parseInt(_this.ImageMargin < iMargin ? _this.ImageMargin : iMargin);
				}
			}
			else {  //n* -1
				if (_this.sHowManyImages <= _this.imagesPerColumn || _this.bScrollBar == false)
					sDelta = 0;
				if (_this.ImageMargin <= 0 || (_this.ImageMargin > (_this.imageViewWidth - 3 * _this.imagesPerColumn)) ||
				(_this.ImageMargin > (_this.imageViewHeight - sDelta - 3 * _this.imagesPerRow))) {
					var iMarginV = parseInt(_this.imageViewHeight - sDelta) / (_this.imagesPerRow * 10);
					var iMarginH = parseInt((_this.imageViewWidth) / (_this.imagesPerColumn * 10));
					
					 var iMargin = iMarginV < iMarginH ? iMarginV : iMarginH;
					if (_this.ImageMargin <= 0)
						_this.ImageMargin = parseInt(iMargin);
					else
						_this.ImageMargin = parseInt(_this.ImageMargin < iMargin ? _this.ImageMargin : iMargin);
				}
			}

		   

			if (_this.imagesPerColumn == _this.imagesPerRow && _this.imagesPerRow == 1) {
				_this.ImageMargin = 0;
			}
			
			var iTotalHeight = 0;
			var iTotalWidth = 0;
			if (_this.bVerticalMode == true) {
				iTotalHeight = _this.imageViewHeight - _this.ImageMargin - 2 * _this.borderWidth;
				iTotalWidth = _this.imageViewWidth - sDelta - _this.ImageMargin - 2 * _this.borderWidth;            
			}
			else
			{
				iTotalHeight = _this.imageViewHeight - sDelta - _this.ImageMargin - 2 * _this.borderWidth;
				iTotalWidth = _this.imageViewWidth - _this.ImageMargin - 2 * _this.borderWidth;
			}
	 
			_this.iControlWidth = parseInt(iTotalWidth / _this.imagesPerColumn - _this.ImageMargin);
			_this.iControlHeight = parseInt(iTotalHeight / _this.imagesPerRow - _this.ImageMargin);

		}
		else {
			_this.ImageMargin = 0;
			_this.iControlWidth = _this.imageViewWidth - 2 * _this.borderWidth;
			_this.iControlHeight = _this.imageViewHeight - 2 * _this.borderWidth;
		}

	};

	ImageUIView.prototype.GetDataImageControlList = function () {
		var _this = this;
		return  _this.aryModelImageControl;
	};

	ImageUIView.prototype.SetDataImageControl = function (imageIndex, imageRawWidth) {
		var _this = this;
		if(imageIndex > _this.aryModelImageControl.length || _this.aryModelImageControl.length <= 0)
		    return;
		
		var objModelImageControl;
		
		if(imageIndex == _this.aryModelImageControl.length)
		{
			//
		    objModelImageControl = new ModelImageControl(); 
		    objModelImageControl.imageIndex = imageIndex;
		    objModelImageControl.rawWidth = imageRawWidth;
			
		    _this.aryModelImageControl.push(objModelImageControl);
		}
		else 
		{
		    objModelImageControl = _this.aryModelImageControl[imageIndex];
		    objModelImageControl.rawWidth = imageRawWidth;
		}
		
		if(objModelImageControl != null)
		    objModelImageControl.bIsDirty = true;
		
		var imgControl = _this.GetImageControl(imageIndex);
		if (null != imgControl)
		{
		    _this.__GetImageAndAttach(imgControl, objModelImageControl, imageIndex, true);   
		}
		return true;
	};
	
	ImageUIView.prototype.AttachImagesForControl = function (ctl, data) {
		ctl.AttachImage(data.imageToShow, data.imageWidth, data.imageHeight, data.imageIndex, data.aryOverlayRectangleData, data.bOriginalImage);  
		ctl.Show();
		return true;
	};

	ImageUIView.prototype.__SetSelectionWinBorderColor = function (iColor) {
		var _this = this;
	};

	ImageUIView.prototype.__SetUnselectAll = function () {
		var _this = this;
		var i = 0;
		for (i = 0; i < _this.aryImageControls.length; i++) {
			var imgControl = _this.aryImageControls[i];
			imgControl.SetSelect(false);
		}
	};

	ImageUIView.prototype.GetImageControl = function (sImageIndex) {
		var _this = this;
		var index = _this.__GetImageControlIndex(sImageIndex);
		
		if (index >= 0 && index < _this.aryImageControls.length) {
			var imageControl = _this.aryImageControls[index];
			return imageControl;
		}
		else
			return null;
	};
	
	ImageUIView.prototype.__GetImageControlIndex = function (sImageIndex) {
		var _this = this;
		var index = -1;
		 if (_this.bSingleMode == true)
		 { 
		    index = 0;
		 }
		 else
		 {
		    if (_this.bVerticalMode == true)
		    {
				//
			    index = sImageIndex - _this.__GetFirstVisibleRow() * _this.imagesPerColumn;
		    }
		    else {
			    index = sImageIndex - _this.__GetFirstVisibleColumn();
		    }
		}
		if (index >= 0 && index < _this.aryImageControls.length) 
		    return index;
		else
		    return -1;
	};


	/////////////////////////////////////////////////////////////////////////////
	//ScrollBar
	/////////////////////////////////////////////////////////////////////////////
	ImageUIView.prototype.__SetIfHScroll = function (bVScroll) {
		var _this = this;
		Funs2.output(_this, "__SetIfHScroll" + bVScroll);
		
		 // 
		 if(_this.horizontalScrollBar)
		    _this.horizontalScrollBar.SetVisible(bVScroll);
	};

	ImageUIView.prototype.__GetIfHScroll = function () {
		var _this = this;
		//  
		if(_this.horizontalScrollBar)
		    return _this.horizontalScrollBar.GetVisible() == true? true:false;
		else
		    return true;
	};

	ImageUIView.prototype.__SetIfVScroll = function (bVScroll) {
		var _this = this;
		Funs2.output(_this, "__SetIfVScroll" + bVScroll);
		//  
		if(_this.verticalScrollBar)
		    _this.verticalScrollBar.SetVisible(bVScroll);
	};

	ImageUIView.prototype.__GetIfVScroll = function () {
		var _this = this;
		//  
		if(_this.verticalScrollBar)
		    return _this.verticalScrollBar.GetVisible() == true? true:false;
		else
		    return true;
	};

	ImageUIView.prototype.__GetHScrollPosionValue = function () {
		var _this = this;
		
		//  
		var value = 0;
		if(_this.horizontalScrollBar)
		    value = _this.horizontalScrollBar.GetCurrentPosition();
		if(value && value >= 0 )
		    return value;  
		else
		    return 0;
	};

	ImageUIView.prototype.__GetVScrollPosionValue = function () {
		var _this = this;
		var value = 0;
		
		//
		if(_this.verticalScrollBar)
		    value = _this.verticalScrollBar.GetCurrentPosition();
		    
		if(value && value >= 0 )
		    return value;  
		else
		    return 0;  
	};

	ImageUIView.prototype.__SetHScrollMaxValue = function (totalSize, pageSize) {
		var _this = this;
		Funs2.output(_this, "__SetHScrollMaxValue(totalSize,pageSize):" + totalSize + "," +pageSize);
		
		//  
		if(_this.horizontalScrollBar)
		    _this.horizontalScrollBar.InitScroll(totalSize, pageSize);
	};

	ImageUIView.prototype.__SetVScrollMaxValue = function (totalSize, pageSize) {
		var _this = this;
		Funs2.output(_this, "__SetVScrollMaxValue(totalSize,pageSize):" + totalSize + "," +pageSize);
		
		//  
		if(_this.verticalScrollBar)
		    _this.verticalScrollBar.InitScroll(totalSize, pageSize);
	};

	ImageUIView.prototype.__SetHScrollPotion = function (value) {
		var _this = this;
		//  
		if(_this.horizontalScrollBar)
		    _this.horizontalScrollBar.GoPosition(value);
	};

	ImageUIView.prototype.__SetVScrollPotion = function (value) { 
		var _this = this;
		
		// 
		if(_this.verticalScrollBar) 
		    _this.verticalScrollBar.GoPosition(value);
	};

	ImageUIView.prototype.__SetHLocation = function (x, y) {
		var _this = this;
		//  
		if(_this.horizontalScrollBar)
		    _this.horizontalScrollBar.SetLocation(x, y);
	};

	ImageUIView.prototype.__SetVLocation = function (x, y) {
		var _this = this;
		//  
		if(_this.verticalScrollBar)
		    _this.verticalScrollBar.SetLocation(x, y);
	};

	ImageUIView.prototype.__ChangeHControlSize = function (w, h) {
		var _this = this;
		//  
		if(_this.horizontalScrollBar)
		    _this.horizontalScrollBar.ChangeControlSize(w, h);
	};

	ImageUIView.prototype.__ChangeVControlSize = function (w, h) {
		var _this = this;
		// 
		if(_this.verticalScrollBar) 
		    _this.verticalScrollBar.ChangeControlSize(w, h);
	};

	ImageUIView.prototype.__GetScrollWidth = function () {
		//
		 return 16;
	};




	 //////////////////////////////////////////////////////////////////////////


	// 
	ImageUIView.prototype.SetSelectedImageArea = function (sImageIndex, iLeft, iTop, iRight, iBottom){
		var _this = this;

		var imgControl = _this.GetImageControl(sImageIndex);
		if (null != imgControl)
		{
		    if(_this.imagesPerRow == 1 && _this.imagesPerColumn == 1){
				//
			    return imgControl.SetSelectedImageArea(iLeft, iTop, iRight, iBottom);
			}
			else
			    return false;
		}

		return false;
	};

	// Overlay
	ImageUIView.prototype.OverlayRectangle = function (sImageIndex, iLeft, iTop, iRight, iBottom, ColorRGB, Opacity){
		var _this = this;

		var imgControl = _this.GetImageControl(sImageIndex);
		if (null != imgControl){
			//
			imgControl.OverlayRectangle(iLeft, iTop, iRight, iBottom, ColorRGB, Opacity);
		}
			
		var objModelImageControl = _this.aryModelImageControl[sImageIndex];
		var objOverlayRectangleData = new OverlayRectangleData(iLeft, iTop, iRight, iBottom, ColorRGB, Opacity);
		return objModelImageControl.aryOverlayRectangleData.push(objOverlayRectangleData);
	};

	// 
	ImageUIView.prototype.GetMousePosition = function () {
		var _this = this;

		var imgControl = _this.GetImageControl(_this.cCurrentIndex);
		if (null != imgControl)
			return imgControl.GetMousePosition();
		else
			return null;
	};


	ImageUIView.prototype.ChangeImageViewSize = function (w, h) {
		var _this = this;
		if(w >= 0)
		{
			//view
			_this.imageViewWidth = w;
			_this.__ChangeHControlSize(w,16);
			_this.__SetVLocation(w-_this.__GetScrollWidth(), 0);
			
		}
		if(h >=0)
		{
			//view
			_this.imageViewHeight = h;
			_this.__ChangeVControlSize(16,h);
			_this.__SetHLocation(0, h-_this.__GetScrollWidth());
		}
		
		if(_this.canvas)
		{
		    _this.canvas.style.width = w + 'px';
		    _this.canvas.style.height = h + 'px';
		}

		_this.UpdateAllImage(_this.aryModelImageControl, _this.cCurrentIndex);
		return true;
	};

	ImageUIView.prototype.SetViewMode = function (sHorizontalImageCount, sVerticalImageCount) {
		var _this = this;

		var iOldColums = _this.imagesPerColumn;
		var iOldRows = _this.imagesPerRow;
		var bOldSingleMode = _this.bSingleMode;
		var bVerticalMode = _this.bVerticalMode;

		if (sHorizontalImageCount > 0)
			_this.imagesPerColumn = sHorizontalImageCount;

		if (sVerticalImageCount > 0)
			_this.imagesPerRow = sVerticalImageCount;
			

		if (sHorizontalImageCount == -1 && sVerticalImageCount == -1) {
			_this.imagesPerRow = 1;
			_this.imagesPerColumn = 1;
			_this.bSingleMode = true;
		}
		else
		{
			_this.bSingleMode = false;
			if(sVerticalImageCount == -1)
			{   
				_this.imagesPerRow = 1;
				_this.bVerticalMode = false;
			}
			else
				_this.bVerticalMode = true;
			
		}

		 _this.iOldFirstVisibleRow = 0;
		 _this.iOldFirstVisibleColum = 0;
		
		if(_this.bSingleMode == false){
			var i = 0;
			for(i =0; i< _this.aryImageControls.length; i++)
			{
				var imgControl = _this.aryImageControls[i];
				if(imgControl != null){
					imgControl.SetOrigMode(false);
				}
			}
		
		} 

		if ((iOldColums != _this.imagesPerColumn || iOldRows != _this.imagesPerRow) ||
		(bOldSingleMode != _this.bSingleMode) || (bVerticalMode != _this.bVerticalMode)) {
		    
		    if(_this.imagesPerRow == 1&& _this.imagesPerColumn == 1)
		    {
		        var i = 0;
		        for(i =0; i< _this.aryImageControls.length; i++)
		        {
		            var imgControl = _this.aryImageControls[i];
		            if(imgControl != null)
		                imgControl.ClearControl();
		        }
		    }
		
			_this.UpdateAllImageInner(_this.aryModelImageControl, _this.cCurrentIndex, true);
		}
		
		return true;
	};

	//
	ImageUIView.prototype.RemoveAllImages = function () {
		return this.Clear();
	};
	
	ImageUIView.prototype.Clear = function (){  
		var _this = this;
		
		var iCount = _this.aryImageControls.length;
		for (i = iCount - 1; i >= 0; i--) {
			//
			_this.__RemoveControl(i);
		}

        var i =0;
        for(i = 0; i< _this.aryModelImageControl.length; i++)
        {
			_this.aryModelImageControl[i].Clear();
        } 
		_this.aryModelImageControl = [];
		
		if(!Dynamsoft.WebTwainEnv.ScanDirectly)
		{
		_this.__SetVScrollMaxValue(0,0);  
        _this.__SetHScrollMaxValue(0,0); 
        _this.__SetIfHScroll(false);
        _this.__SetIfVScroll(false);
        }
		
		// delete image to load
		for(i = 0; i< Dynamsoft.Lib.aryControlLoadImage.length; i++)
	    {
	        var objControlLoadImage = Dynamsoft.Lib.aryControlLoadImage[i];
	        if(objControlLoadImage.imgControl)
	        {
	            objControlLoadImage.imgControl.SetBindIndex(-1);
	        }
	    }
		Dynamsoft.Lib.aryControlLoadImage = [];
		
		return true;
	};


	ImageUIView.prototype.ShowImage = function (imageIndex, objModelImageControl) {
		 var _this = this;
		 _this.__OnlySetCurrentIndex(imageIndex);
		
		 if (_this.bSingleMode == true)
		 { 
			var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{			    
			   _this.__GetImageAndAttach(imgControl, objModelImageControl, imageIndex, false);
			}
		}
		return true;
	};
	
	ImageUIView.prototype.__GetImageAndAttach = function (imgControl, data, imageIndex, bOnlyFromServer) {
	    var _this = this;
	    var iWidth = parseInt(_this.imageViewWidth/2);
		var iHeight = parseInt(_this.imageViewHeight/2);
			   
	    if(_this.imagesPerRow == 1 &&_this.imagesPerColumn == 1)  
	    {
			// -1* -1
	        if (_this.bSingleMode == true)
	        {
	            iWidth = -1;
	            iHeight = -1;
	            data.bOriginalImage = true;
	        }
	        else
	        {
				//1*1
	            iWidth = _this.imageViewWidth;
	            iHeight = _this.imageViewHeight;
	            data.bOriginalImage = false;
	        }
	    }
	    else
	    {
	       if(iWidth < 300)
	            iWidth = 300;
	       if(iHeight < 300)
	            iHeight = 300;
	            
	        data.bOriginalImage = false;
	    }
        
        var bNeedFromServer = false;
        if(bOnlyFromServer)
        {
            bNeedFromServer = true;
        }
        else
        {
	        if (data.bIsDirty == true|| 
				    data.iImageControlWidth < iWidth ||
				    data.iImageControlHeight < iHeight||
				    (data.iImageControlWidth > 0 && iWidth == -1)||
				    (data.iImageControlHeight > 0 && iHeight == -1)) {
				   bNeedFromServer = true;
	        }
	        else {
	            bNeedFromServer = false;
	        }
	    }
			
		imgControl.ClearImage();
		//index
		imgControl.SetCurrentIndex(imageIndex);
		var controlIndex =  _this.__GetImageControlIndex(imageIndex);
		if(controlIndex >= 0)
		    _this.__SetArrayControlLoadImage(controlIndex,imageIndex, imgControl, data, iWidth, iHeight, _this.AttachImagesForControl, bNeedFromServer);
	};
	
	ImageUIView.prototype.__SetArrayControlLoadImage = function (controlIndex,imageIndex, imgControl, data, iWidth, iHeight, attachImagesForControl, bOnlyFromServer) {
	    var _this = this;
	    var i = 0;
	    for(i = 0; i< Dynamsoft.Lib.aryControlLoadImage.length; i++)
	    {
	        var objControlLoadImage = Dynamsoft.Lib.aryControlLoadImage[i];
	        if(objControlLoadImage.iControlIndex == controlIndex && objControlLoadImage.View == _this)
	        {
	            objControlLoadImage.iImageIndex = imageIndex;
	            objControlLoadImage.imgControl = imgControl;
	            objControlLoadImage.modelImageControl = data;
	            objControlLoadImage.iWidth = iWidth; 
	            objControlLoadImage.iHeight = iHeight; 
	            objControlLoadImage.AttachImagesForControl = attachImagesForControl;
	            objControlLoadImage.bOnlyFromServer = bOnlyFromServer;
	            return;
	        }
	    }
	    
	    Dynamsoft.Lib.aryControlLoadImage.push(new ControlLoadImage(controlIndex,imageIndex, _this, imgControl, data, iWidth, iHeight, attachImagesForControl, bOnlyFromServer, _this.BaseUrl));
	};
	
	
	
	

	ImageUIView.prototype.SetIfFitWindowAndType = function (data) {
		 var _this = this;
		 
		 if (_this.bSingleMode == true)
		 { 
			 _this.bIfFitWindow = true;
			 _this.enumDWTFitWindowType = data;
			 
			var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			  imgControl.SetIfFitWindow(true, data);
			  imgControl.Show();
			}
		}
		else
		{
			_this.bIfFitWindow = true;
		}
		return true;
	};

	ImageUIView.prototype.GetAllowMultiSelect = function () {
		var _this = this;
		return _this.AllowMultiSelect;
	};

	ImageUIView.prototype.SetAllowMultiSelect = function (v) {
		var _this = this;
		_this.AllowMultiSelect = v;  
		return true;
	};

	ImageUIView.prototype.GetFitWindowType = function () {
		var _this = this;
		return _this.enumDWTFitWindowType;
	};

    ImageUIView.prototype.SetSelectionRectAspectRatio = function (v) {
		var _this = this;
		_this.ratio = v;
		
		_this.__AttachImagesInner(true, false);  
		return true;
	};

	ImageUIView.prototype.SetFitWindowType = function (v) {
		var _this = this;
		_this.enumDWTFitWindowType = v;
		
		if (_this.bSingleMode)  // -1*-1
		{
			_this.__AttachImagesInner(true, false);  
		}
		else
		{
			_this.bIfFitWindow = true;
			_this.enumDWTFitWindowType = 0;
		}
		return true;
	};

	ImageUIView.prototype.GetIfFitWindow = function () {
		var _this = this;
		return _this.bIfFitWindow;
	};

	ImageUIView.prototype.SetIfFitWindow = function (v) {
		var _this = this;
		_this.bIfFitWindow = v;
		
		 if (_this.bSingleMode)  // -1*-1
		 {
			_this.__AttachImagesInner(true,false);  
		 }
		 else
		 {
			_this.bIfFitWindow = true;
			_this.enumDWTFitWindowType = 0;
		 }
		return true;
	};

	ImageUIView.prototype.GetImageMargin = function () {
		var _this = this;
		return _this.ImageMargin;
	};

	ImageUIView.prototype.SetImageMargin = function (v) {
		var _this = this;
		_this.ImageMargin = v;
		
		_this.__ReInitChildrenPosition();
		_this.__AttachImagesInner(false, false);
		return true;
	};

	ImageUIView.prototype.GetSelectionImageBorderColor = function () {
		var _this = this;
		return _this.SelectionImageBorderColor;
	};

	ImageUIView.prototype.SetSelectionImageBorderColor = function (v) {
		var _this = this;
		_this.SelectionImageBorderColor = v;
		
		_this.__AttachImagesInner(true, false);
		return true;
	};

	ImageUIView.prototype.GetZoom = function () {
		var _this = this;
		if(_this.bIfFitWindow){
			var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
				return imgControl.GetZoom();
			}
		}
		return _this.fZoom;
	};

	ImageUIView.prototype.SetZoom = function (fZoom) {
		 var _this = this;
		if(fZoom <  _this.MIN_ZOOM)
			fZoom = _this.MIN_ZOOM;
		if(fZoom >  _this.MAX_ZOOM)
			fZoom = _this.MAX_ZOOM;

		_this.fZoom = fZoom;

		if (_this.bSingleMode == true)
		{
			_this.bIfFitWindow = false;
			_this.enumDWTFitWindowType = 0;
			 
			var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
				imgControl.SetZoom(_this.fZoom);
			}
		}
		else
		{
			_this.bIfFitWindow = true;
		}
		return true;
	};
	
	 ImageUIView.prototype.ZoomIn = function () {
        var _this = this;
        if(_this.bSingleMode == true)
        {   var SIZE_LIMIT = 15000;
            var ModelImageControl = _this.aryModelImageControl[_this.cCurrentIndex];
            var fZoomValue = _this.fZoom;
			if(_this.bIfFitWindow){
				var imgControl = _this.GetImageControl(_this.cCurrentIndex);
				if (null != imgControl)
				{
					fZoomValue = imgControl.GetZoom();
				}
			}
			
			tempZoom = (Math.floor(fZoomValue * 100 * _this.zoomInStep) + 1);
            if (1 < tempZoom && tempZoom < 2501) {
                if (parseInt(ModelImageControl.imageWidth * _this.fZoom) > SIZE_LIMIT || parseInt(ModelImageControl.imageHeight * _this.fZoom) > SIZE_LIMIT) {//too big
                    Funs2.output(_this, 'You have reached the limit for zooming in');
                    return false;
                }
                else {
				    _this.SetZoom(tempZoom / 100.0);            
			    }
            }
            else {
                Funs2.output(_this, 'You have reached the limit for zooming in');
                alert('You have reached the limit for zooming in');
                return false;
            }
        }
        return true;
    };
    
    ImageUIView.prototype.ZoomOut = function () {
        var _this = this;
         if(_this.bSingleMode == true)
         {
            var fZoomValue = _this.fZoom;
			if(_this.bIfFitWindow){
				var imgControl = _this.GetImageControl(_this.cCurrentIndex);
				if (null != imgControl)
				{
					fZoomValue = imgControl.GetZoom();
				}
			}
			
            var tempZoom = (Math.floor(fZoomValue * 100.0 * _this.zoomOutStep) - 1);
            if (1 < tempZoom && tempZoom < 6501) {
                _this.SetZoom(tempZoom / 100.0); 
		    }
            else {
                Funs2.output(_this, 'You have reached the limit for zooming out');
                return false;
            }
        }
        return true;
    };

	ImageUIView.prototype.GetMouseShape = function () {
		var _this = this;
		return _this.bHand;
	};

	ImageUIView.prototype.SetMouseShape = function (v) {
		var _this = this;
		_this.bHand = v;
		_this.__AttachImagesInner(true, false);  
		return true;
	};

	ImageUIView.prototype.SetMouseShapeByIndex = function (imageIndex, bHand) {
		 var _this = this;
		 _this.__OnlySetCurrentIndex(imageIndex);
		 _this.bHand = bHand;
		 
		var imgControl = _this.GetImageControl(imageIndex);
		if (null != imgControl)
		{
			imgControl.SetMouseShape(_this.bHand);
			imgControl.Show();
			return true;
		}
		return false;
	};

	ImageUIView.prototype.GetShowPageNumber = function () {
		var _this = this;
		return _this.bShowPageNumber;
	};

	ImageUIView.prototype.SetShowPageNumber = function (v) {
		var _this = this;
		_this.bShowPageNumber = v;
		
		_this.__AttachImagesInner(true, false);
		return true;
	};

	ImageUIView.prototype.SetBackgroundColor = function (v) {
		var _this = this;
		_this.BackgroundColor = v;
		
		if(_this.canvas)
		    _this.canvas.style.backgroundColor = v;
		_this.__AttachImagesInner(true, false);
		return true;
	};
	
	ImageUIView.prototype.Go = function (cIndex) {
		var _this = this;
		_this.__GoInner(cIndex, true, false);
		return true;
	};
	
	ImageUIView.prototype.SetCurrentIndexOnly = function (cIndex) {
		var _this = this;
		return _this.__GoInner(cIndex, true, false);
	};

	ImageUIView.prototype.__GoInner = function (cIndex, bNeedSet, bNeedAttach) {
		var _this = this, oldIndex = _this.cCurrentIndex;
		
		if(cIndex < _this.aryModelImageControl.length && cIndex >= 0)
		{
		    if(bNeedAttach == false)
		    {
		        _this.__OnlySetCurrentIndex(cIndex);
			}

            if(bNeedSet == true)
            {
                 if(bNeedAttach == true)
			        _this.__SetCurrentIndex(_this.cCurrentIndex);
			     else{
					//
			        _this.__SetCurrentIndexWithoutRefreshUI(_this.cCurrentIndex);
				 }
		    }
		    
		    if(bNeedAttach == true){
				//viewcanvascanvasattach   
			    _this.__AttachImages(false);
			}

			
			 _this.iCurrentRow = -1;
            _this.iCurrentColumn = -1;
        
			if(bNeedSet == false)
			{
				//
			    if (_this.bVerticalMode == true)
	            {
		            var iOldRow = _this.iCurrentRow;
		            _this.iCurrentRow = _this.__GetRow(cIndex);

		            if (_this.iCurrentRow != iOldRow &&
		            (_this.iCurrentRow <= _this.iOldFirstVisibleRow || (_this.iCurrentRow > _this.iOldFirstVisibleRow))) {
						//
			            var iFirstVisibleRow = _this.__GetFirstVisibleRow();
//                             var indexTemp = iFirstVisibleRow * _this.imagesPerColumn;
//					            _this.__fireEvent('OnTopImageInTheViewChanged', indexTemp);
				            
			            if (_this.iOldFirstVisibleRow != iFirstVisibleRow) {
				            _this.iOldFirstVisibleRow = iFirstVisibleRow;
				            var indexTemp = iFirstVisibleRow * _this.imagesPerColumn;
				            _this.__fireEvent('OnTopImageInTheViewChanged', indexTemp);
			            }
		            }
	            }
	            else
	            {
					//n *-1
		            var iOldColumn = _this.iCurrentColumn;
		            _this.iCurrentColumn = cIndex;

		            if (_this.iCurrentColumn != iOldColumn &&
		            (_this.iCurrentColumn < _this.iOldFirstVisibleColum || (_this.iCurrentColumn > _this.iOldFirstVisibleColum))) {

						//
						var iFirstVisibleColumn = _this.__GetFirstVisibleColumn();

			            if (_this.iOldFirstVisibleColum != iFirstVisibleColumn) {
				            _this.iOldFirstVisibleColum = iFirstVisibleColumn;
				            var indexTemp = iFirstVisibleColumn;
				            _this.__fireEvent('OnTopImageInTheViewChanged', indexTemp);
			            }
		            }
	            }

			}
		}
		return true;
	};
	
	ImageUIView.prototype.PrintCurrent = function (){
	    var _this = this;
        if (_this.cCurrentIndex < 0) {
            return;
        }
       // var url = Funs2.getUrlByAct(_this.BaseUrl, _this.cCurrentIndex, 1);
       var url = Funs2.getImageUrl(_this.BaseUrl, _this.cCurrentIndex, -1, -1);
       
        var objModelImageControl = _this.aryModelImageControl[_this.cCurrentIndex]; 
        
        var aryPrintUrl = [];
        var objPrintUrl = new PrintUrl(url, objModelImageControl.imageWidth, objModelImageControl.imageHeight);
		aryPrintUrl.push(objPrintUrl);
		    
        Funs2.print(aryPrintUrl);
		return true;
	};
	
	ImageUIView.prototype.Print = function (){
	    var _this = this;
        if (_this.cCurrentIndex < 0) {
            return;
        }
        var aryPrintUrl = [];
       for(i = 0; i<  _this.aryModelImageControl.length; i++)
       {
             var url = Funs2.getImageUrl(_this.BaseUrl, i, -1, -1);
             var objModelImageControl = _this.aryModelImageControl[i]; 
             var objPrintUrl = new PrintUrl(url, objModelImageControl.imageWidth, objModelImageControl.imageHeight);
		     aryPrintUrl.push(objPrintUrl);
       } 
        
        Funs2.print(aryPrintUrl);

		return true;
	};

	ImageUIView.prototype.SetSelectedImageCount = function (_count){   
		var _this = this;
		_this.aryCurrentSelectedImageIndicesInBuffer.splice(_count);

		_this.__SetUnselectAll();
		_this.__SetSelectedImageIndicesInBuffer();
		return true;
	};
	
	ImageUIView.prototype.SetSelectedImageIndex = function (sIndex, sImageIndex){   
		var _this = this;
		_this.aryCurrentSelectedImageIndicesInBuffer[sIndex] =  sImageIndex;
		
		_this.__SetUnselectAll();
		_this.__SetSelectedImageIndicesInBuffer();
		
		// find minimal index in aryCurrentSelectedImageIndicesInBuffer
		var minIndex = -1, _count = _this.aryCurrentSelectedImageIndicesInBuffer.length, tmpIndex;
		for(var i=0; i<_count; i++){
			var tmpIndex = _this.aryCurrentSelectedImageIndicesInBuffer[i];

			if(minIndex == -1){
				minIndex = tmpIndex;
			} else if(tmpIndex < minIndex) {
				minIndex = tmpIndex;
			}
		}
		
		// set current index
		if(minIndex >= 0 && minIndex<_this.aryModelImageControl.length && _this.cCurrentIndex != minIndex){
		    _this.cCurrentIndex = minIndex;
	        _this.__fireEvent('onResetCurrentIndex', _this.cCurrentIndex);
		}
		
		return true;
	};

	ImageUIView.prototype.__SetSelectedImageIndicesInBuffer = function (){
		var _this = this;
		if(_this.aryCurrentSelectedImageIndicesInBuffer.length == 0)
		{   
		    if(_this.cCurrentIndex >= 0)
		        _this.aryCurrentSelectedImageIndicesInBuffer.push(_this.cCurrentIndex);
		}
	   var i = 0;
	   for(i =0; i< _this.aryCurrentSelectedImageIndicesInBuffer.length; i++)
	   {
			var indexTemp = _this.aryCurrentSelectedImageIndicesInBuffer[i];
			var imgControl = _this.GetImageControl(indexTemp);
			if (null != imgControl)
			{
				imgControl.SetSelect(true);
				imgControl.Show();
			}
	   }
	};
	
	ImageUIView.prototype.__OnlySetCurrentIndex = function (cIndex) {
	    var _this = this;
		_this.cCurrentIndex = cIndex;
	    _this.__fireEvent('onResetCurrentIndex', cIndex);
	     if(_this.aryCurrentSelectedImageIndicesInBuffer[0] != _this.cCurrentIndex)
        {
            _this.aryCurrentSelectedImageIndicesInBuffer = [];
            _this.aryCurrentSelectedImageIndicesInBuffer.push(_this.cCurrentIndex);
        }
	};
	
	
	
	ImageUIView.prototype.__MousewheelChanged = function (_ImageUIView) {
		if(_ImageUIView.__MousewheelValue > 0){
			_ImageUIView.__MousewheelUp(_ImageUIView.__MousewheelValue);

		} else if(_ImageUIView.__MousewheelValue < 0){
			_ImageUIView.__MousewheelDown(-_ImageUIView.__MousewheelValue);
		}

		_ImageUIView.__MousewheelValue = 0;
	};
	
	ImageUIView.prototype.__MousewheelUp = function (value) {
        var _this = this;
         if (_this.bSingleMode == false)
		 { 
		    if(_this.__GetIfHScroll() == true || _this.__GetIfVScroll() == true)
		    {
		        //_this.Go(_this.cCurrentIndex -1);
		        var baseIndex = 0, index = 0;
			    if (_this.bVerticalMode == true)
				{
					//
				    baseIndex = _this.__GetFirstVisibleRow() * _this.imagesPerColumn;
					index = baseIndex - value * _this.imagesPerColumn;
				}
			    else
				{
					//
				    baseIndex = _this.__GetFirstVisibleColumn();
					index = baseIndex - value;
				}
    			
				if(index < 0)
					index = 0;

				Funs2.output(_this, '__MousewheelUp(baseIndex, index): ' + [baseIndex, index].join(',')); 	
				_this.__SetScrollByIndex(index);

            }
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMoveUp();
			}
		}
    };
    
    ImageUIView.prototype.__MousewheelDown = function (value) {
        var _this = this;
        if (_this.bSingleMode == false)
		{
		    if(_this.__GetIfHScroll() == true || _this.__GetIfVScroll() == true)
		    {
		        var baseIndex = 0, index = 0;
			    if (_this.bVerticalMode == true)
				{
					//
				    baseIndex = _this.__GetFirstVisibleRow() * _this.imagesPerColumn;
					index = baseIndex + value * _this.imagesPerColumn;
				}
			    else
				{
					//
				    baseIndex = _this.__GetFirstVisibleColumn();
					index = baseIndex + value;
				}

                if(baseIndex + _this.imagesPerColumn * _this.imagesPerRow < _this.aryModelImageControl.length)
                {
					 Funs2.output(_this, '__MousewheelDown(baseIndex, index): ' + [baseIndex, index].join(','));
					_this.__SetScrollByIndex(index, true);
					//_this.__AttachImages(false);
				}

            }
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMoveDown();
			}
		}
    };
		
	ImageUIView.prototype.__Previous = function () {
        var _this = this;
		_this.Go(_this.cCurrentIndex -1);
		
		return true;
    };
    
    ImageUIView.prototype.__DoLeftArrow = function () {
        var _this = this;
         if (_this.bSingleMode == false)
		 { 
		    _this.Go(_this.cCurrentIndex -1);
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMoveLeft();
			}
		}
		return true;
    };
    
    
    ImageUIView.prototype.__Next = function () {
        var _this = this;
        _this.Go(_this.cCurrentIndex +1);
		return true;
    };
    
    ImageUIView.prototype.__DoRightArrow = function () {
        var _this = this;
        if (_this.bSingleMode == false)
		{
		    _this.__SetCurrentIndexInner(_this.cCurrentIndex+1, true);
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMoveRight();
			}
		}
		return true;
    };
    
    ImageUIView.prototype.__PreviousUp = function () {
        var _this = this;
        if (_this.bSingleMode == false)
		{
			//
			//n
			//
			//n-<0, 
            var index = _this.cCurrentIndex - _this.imagesPerColumn;
            if(index >= 0)
                _this.Go(index); 
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMoveUp();
			}
		}
		return true;
    };
    
    ImageUIView.prototype.__NextDown = function () {
        var _this = this;
        if (_this.bSingleMode == false)
		{
			//
			//n
			//
			//n+>=, 
            var index = _this.cCurrentIndex + _this.imagesPerColumn;
            if(index < _this.aryModelImageControl.length)
	        {
	            _this.__SetCurrentIndexInner(index, true);
	        }
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMoveDown();
			}
		}
		return true;
    };
    
    ImageUIView.prototype.__PageUp = function () {
        var _this = this;
        if (_this.bSingleMode == false)
		{
		    //
		    //viewerviewer
		    //viewer
		    //

		    if (_this.bVerticalMode == true)
		    {
				//
		        var baseIndex = _this.__GetFirstVisibleRow() * _this.imagesPerColumn;
                var index = baseIndex - _this.imagesPerColumn * _this.imagesPerRow;
                if(index >= 0)
                {   
		            _this.__SetCurrentIndexInner(index, false);
			    }
			    else
			    {
			        _this.__SetCurrentIndexInner(0, false);
			    }
		    }
		    else
		    {
				// PageUp
		    }
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMovePageUp();
			}
		}
		return true;
    };

    ImageUIView.prototype.__PageDown = function () {
        var _this = this;
        if (_this.bSingleMode == false)
		{
		    //viewerviewer
		    //viewer
		    //
		    if (_this.bVerticalMode == true)
		    {
				//
                var baseIndex = _this.__GetFirstVisibleRow() * _this.imagesPerColumn;
                var index = baseIndex + _this.imagesPerColumn * _this.imagesPerRow;
                if(index < _this.aryModelImageControl.length)
                {   
		            _this.__SetCurrentIndexInner(index, false);
			    }
			    else
			    {
			        _this.__SetCurrentIndexInner(_this.aryModelImageControl.length - 1, false, false);
			    }  
		    }
		    else
		    {
				// PageDown
		    }
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMovePageDown();
			}
		}
		return true;
    };
    
    ImageUIView.prototype.__Home = function () {
        var _this = this;
        if (_this.bSingleMode == false)
		{
		    //viewer 
            _this.__SetCurrentIndexInner(0, false);   
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMoveHome();
			}
		}
		return true;
    };
    
    ImageUIView.prototype.__End = function () {
        var _this = this;
        if (_this.bSingleMode == false)
		{
		    //viewer 
            _this.__SetCurrentIndexInner(_this.aryModelImageControl.length - 1, false); 
		}
		else
		{
		    var imgControl = _this.GetImageControl(_this.cCurrentIndex);
			if (null != imgControl)
			{
			    imgControl.ImageMoveEnd();
			}
		}
		return true;
    };
	
	// Events:
	ImageUIView.prototype.__fireEvent = function (evtName, params) {
		var _this = this;
		if (DL.isFunction(_this[evtName])) {
			return _this[evtName](params);
		}
		return true;
	};
	
	
	ImageUIView.prototype.AddImage = function (iImageIndex, _maxIndex, imageRawWidth) {
		
		var _this = this, _index = iImageIndex * 1, 
			_count, aryImages, i, tmpObj;

		aryImages = _this.GetDataImageControlList();
		_count = aryImages.length;
		
		if (_index < 0 || _index > _maxIndex)
			return false;
			
		// 
		i=_index;
		for(;i<_count;i++){
			tmpObj = aryImages[i];
			tmpObj.imageIndex = (i+1);
		}
		
		tmpObj = new Dynamsoft.Lib.UI.ModelImageControl();
		tmpObj.bIsDirty = true;
		// raw width
		tmpObj.rawWidth = imageRawWidth;
		
		if (_index >= _count) {
			tmpObj.imageIndex = _count;
			_index = _count;
			aryImages.push(tmpObj);
		} else {
			tmpObj.imageIndex = _index;
			aryImages.splice(_index, 0, tmpObj);
		}
		
		// update image index in [_index, _count]
		_this.UpdateAllImage(aryImages, _index, _index, _count);		
		
		return true;
	};
	
	
	ImageUIView.prototype.RemoveImage = function (_i, _cIndex) {

		var _this = this, _index = _i * 1, cIndex = _cIndex * 1, 
			_count, aryImages, _deletedImage;
			
		if (typeof(_index) === 'undefined' || _index < 0) {
			return;
		}

		aryImages = _this.GetDataImageControlList();
		_count = aryImages.length;
		if(_count == 1){
			_this.RemoveAllImages();
			return;
		}
		
		if (_index >= _count) {
			_index = _count - 1;
		} else {
		
			// 
			var i=_index, tmpObj;
			for(;i<aryImages.length;i++){
				tmpObj = aryImages[i];
				tmpObj.imageIndex = (i-1);
			}
		}
		
		// 
		_deletedImage = aryImages.splice(_index, 1);
		if(_deletedImage && _deletedImage[0]){
			_deletedImage[0].Clear(); 
		}
		
		// update image index in [_index, _count-2]
		_this.UpdateAllImage(aryImages, cIndex, _index, _count - 2);
		return true;
	};
	
	ImageUIView.prototype.MoveImage = function (sSourceImageIndex, sTargetImageIndex) {
		var _this = this, 
			_count, aryImages, i, tmpObj, objSourceMoveObject, refreshStart, refreshEnd;
			
		aryImages = _this.GetDataImageControlList();
		_count = aryImages.length;
		
		// delete
		i=sSourceImageIndex;
		objSourceMoveObject = aryImages[sSourceImageIndex];
		for(;i<aryImages.length;i++){
			tmpObj = aryImages[i];
			tmpObj.imageIndex = (i-1);
		}
		aryImages.splice(sSourceImageIndex, 1);

		// add
		i=sTargetImageIndex;
		for(;i<aryImages.length;i++){
			tmpObj = aryImages[i];
			tmpObj.imageIndex = (i+1);
		}
		aryImages.splice(sTargetImageIndex, 0, objSourceMoveObject);
		objSourceMoveObject.imageIndex = sTargetImageIndex;

		if(sSourceImageIndex < sTargetImageIndex){
			refreshStart = sSourceImageIndex;
			refreshEnd = sTargetImageIndex;
		} else {
			refreshStart = sTargetImageIndex;
			refreshEnd = sSourceImageIndex;
		}
		
		// refresh UI
		_this.UpdateAllImage(aryImages, _this.GetCurrentImageIndex(), refreshStart, refreshEnd);
		return true;
	};
	
	ImageUIView.prototype.GetCurrentImageIndex = function () {
		return this.cCurrentIndex;
	};
	
	ImageUIView.prototype.GetSelectedIndexes = function () {
		return this.aryCurrentSelectedImageIndicesInBuffer;
	};
	
	ImageUIView.prototype.HowManyImagesInBuffer = function () {
		return this.GetDataImageControlList().length;
	};
	
	ImageUIView.prototype.SwitchImage = function (sImageIndex1, sImageIndex2) {
		var _this = this, 
			_count, aryImages, tmpObj1, tmpObj2;
			
		aryImages = _this.GetDataImageControlList();
		_count = aryImages.length;
		
		if(sImageIndex1<aryImages.length && sImageIndex1 >= 0 
			&& sImageIndex2<aryImages.length && sImageIndex2 >= 0){
			
			// swap image index
			tmpObj1 = aryImages[sImageIndex1];
			tmpObj1.imageIndex = sImageIndex2;
			
			tmpObj2 = aryImages[sImageIndex2];
			tmpObj2.imageIndex = sImageIndex1;
			
			// swap image object
			aryImages[sImageIndex2] = tmpObj1;
			aryImages[sImageIndex1] = tmpObj2;
			
			
			// refresh UI
			_this.UpdateImage(sImageIndex1, tmpObj2.imageToShow, tmpObj2.imageWidth, tmpObj2.imageHeight, tmpObj2.aryOverlayRectangleData, tmpObj2.imageUrl);
			_this.UpdateImage(sImageIndex2, tmpObj1.imageToShow, tmpObj1.imageWidth, tmpObj1.imageHeight, tmpObj1.aryOverlayRectangleData, tmpObj1.imageUrl);

		}
		
		return true;
	};
	
	
	
    ImageUIView.prototype.handlerKeyDownView = function (e) {
        var _this = this, bGoOn = true;
        if (!_this.bFocus)
            return bGoOn;
            
        _this.iCurrentRow = -1;
        _this.iCurrentColumn = -1;
        switch (e.keyCode) {
            case 37: //left arrow
                bGoOn = false;
                _this.__DoLeftArrow();
                break;
            case 39: //right arrow
                bGoOn = false;
                _this.__DoRightArrow();
                break;
            case 38: //up arrow
                bGoOn = false;
                _this.__PreviousUp();
                break;
            case 40: //down arrow
                bGoOn = false;
                _this.__NextDown();
                break;
            case 33: //page up
                bGoOn = false;
                _this.__PageUp();
                break;
            case 34: //page down
                bGoOn = false;
                _this.__PageDown();
                break;
            case 35: //end
                bGoOn = false;
                _this.__End();
                break;
            case 36: //home
                bGoOn = false;
                _this.__Home();
                break;
            case 82:
                //_this.RotateEx(45, false, 1);
                break;
            case 107: //add key
                _this.ZoomIn();
                break;
            case 109://substract key
                _this.ZoomOut();
                break;
        }

        if(bGoOn == false)
            DL.stopPropagation(e);
        return bGoOn;
    };

    Dynamsoft.Lib.UI = Dynamsoft.Lib.UI || {};
	Dynamsoft.Lib.UI['ImageUIView'] = ImageUIView;
	Dynamsoft.Lib.UI['ModelImageControl'] = ModelImageControl;
	
	 //Add keydown / keyup Events
    var handlerKeydownEventView = function (e) {
        var _ret = true;
        Dynamsoft.Lib.each(registedObjsView, function (item) {
            if (item instanceof Dynamsoft.Lib.UI.ImageUIView) {
                if (item.bFocus) {
                    _ret = item.handlerKeyDownView(e);
                    if (!_ret)
                        return false;
                }
            }
        });
        return _ret;
    };
    
    Dynamsoft.Lib.addEventListener(document.documentElement, 'keydown', handlerKeydownEventView);

})(Dynamsoft.Lib);


//View 
Dynamsoft.Lib.aryControlLoadImage = [];

Dynamsoft.Lib.imageControlCount = 0;
Dynamsoft.Lib.AttachAndShowImage = function () {
     if(Dynamsoft.WebTwainEnv.ScanDirectly)
        return;
        
     if(Dynamsoft.Lib.aryControlLoadImage.length == 0)
     {
        setTimeout(Dynamsoft.Lib.AttachAndShowImage, 500);
        return; 
     }
        
    var i = 0;
    var objControlLoadImage = Dynamsoft.Lib.aryControlLoadImage[0];
    Dynamsoft.Lib.aryControlLoadImage.splice(0, 1);
    if(objControlLoadImage.iControlIndex>=0 && objControlLoadImage.iControlIndex < Dynamsoft.Lib.imageControlCount)
    {
		var borderWidth = 2, w = objControlLoadImage.iWidth, h = objControlLoadImage.iHeight;
		if(w>borderWidth)
			w-=borderWidth;
		if(h>borderWidth)
			h-=borderWidth;
		
        if(objControlLoadImage.bOnlyFromServer)
        {
            Dynamsoft.Lib.OnGetImageFromServer(objControlLoadImage.imgControl, objControlLoadImage.modelImageControl, objControlLoadImage.iImageIndex, w, h, objControlLoadImage.BaseUrl, objControlLoadImage.AttachImagesForControl);
        }
        else
        {
            Dynamsoft.Lib.OnGetImageByURL(objControlLoadImage.imgControl, objControlLoadImage.modelImageControl, objControlLoadImage.iImageIndex, w, h, objControlLoadImage.BaseUrl, objControlLoadImage.AttachImagesForControl);
        }  
    }
    else
        setTimeout(Dynamsoft.Lib.AttachAndShowImage, 0);
   
};

Dynamsoft.Lib.OnGetImageByURL = function (ctl, data, index, w, h,  baseUrl, callbackFun) {
	var url, objImage;

	if(callbackFun){
	    if(data.imageUrl && data.imageUrl!= "")
	    {
	        ctl.ClearImage();	   
		    objImage = new Image();
			//objImage.crossOrigin = "Anonymous";
		    objImage.src = data.imageUrl;
		    ctl.SetBindIndex(index);
		    objImage.onload = function(){
		        ctl.tmpImage = false;
			    if(ctl.GetBindIndex() == index)
			    {
			        data.imageToShow = objImage;
			        data.imageWidth = objImage.width;
			        data.imageHeight = objImage.height;
			        data.iImageControlWidth = w;    
	                data.iImageControlHeight = h;
			        data.bIsDirty = false;
			        callbackFun(ctl, data);   
			       
			    }
				objImage.onerror = null;
			    setTimeout(Dynamsoft.Lib.AttachAndShowImage, 0);
		    };
		    
		    objImage.onerror = function(e){
				if(ctl.GetBindIndex() >= 0){
					objImage.src = data.imageUrl;
				}
		    };
		    
		    if(ctl.tmpImage){
		        ctl.tmpImage.src = 'data:,';
                ctl.tmpImage.onload = undefined;
            }
            
            ctl.tmpImage = objImage;
		}
		else
		{
		    Dynamsoft.Lib.OnGetImageFromServer(ctl, data, index, w, h,  baseUrl, callbackFun);
		}
	}
	else
	    setTimeout(Dynamsoft.Lib.AttachAndShowImage, 0);
	
	return true;
};


Dynamsoft.Lib.OnGetImageFromServer = function (ctl, data, index, w, h,  baseUrl, callbackFun) {
	var url, objImage;

    if(callbackFun && baseUrl){
        ctl.ClearImage();	   
	    url = Funs2.getImageUrl(baseUrl, index, w, h);
	    objImage = new Image();
	    //objImage.crossOrigin = "Anonymous";
	    objImage.src = url;
	    ctl.SetBindIndex(index);
	    objImage.onload = function(){
	        ctl.tmpImage = false;
	        if(ctl.GetBindIndex() == index)
		    {
		        data.imageToShow = objImage;
		        data.imageWidth = objImage.width;
		        data.imageHeight = objImage.height;
		        data.imageUrl = url;
		        data.iImageControlWidth = w;    
                data.iImageControlHeight = h;
		        data.bIsDirty = false;
		        callbackFun(ctl, data);  
			    
		    }
			objImage.onerror = null;
		    setTimeout(Dynamsoft.Lib.AttachAndShowImage, 0);
	    };
		
	     objImage.onerror = function(e){
			 
			if(ctl.GetBindIndex() >= 0){
				url = Funs2.getImageUrl(baseUrl, ctl.GetBindIndex(), w, h);
				objImage.src = url;
			}
	     };
		
	     if(ctl.tmpImage){
            ctl.tmpImage.src = 'data:,';
            ctl.tmpImage.onload = undefined;
        }
        
        ctl.tmpImage = objImage;	
    }
    else
        setTimeout(Dynamsoft.Lib.AttachAndShowImage, 0);
	
	return true;
};	

setTimeout(Dynamsoft.Lib.AttachAndShowImage, 500);// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 


(function (DL) {
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}
	
    var language = 'eng',
	
		DOM = DL.DOM,

		__buttons = {
		    btninfo: ['previous', 'next', 'rotateleft', 'rotate', 'rotateright', 'deskew', 'crop', 'changeimagesize', 'flip', 'mirror',
				'zoomin', 'originalsize', 'zoomout', 'stretch', 
				//'fullscreen', 
				'fit', 'fitw', 'fith', 'print', 'hand', 'rectselect', 'restore', 'save'],
		    titlelan: ['eng', 'chi'],
		    titles: [['Previous Image', 'Next Image', 'Rotate Left', 'Rotate', 'Rotate Right', 'Deskew', 'Crop Selected Area', 'Change Image Size', 'Flip', 'Mirror',
				'Zoom In', 'Original Size', 'Zoom Out', 'Stretch Mode', 
				//'Full Screen', 
				'Fit Canvas', 'Fit Horizontally', 'Fit Vertically', 'Print', 'Hand', 'Select', 'Restore', 'Save Changes'],
					['Previous Image', 'Next Image', 'Rotate Left', 'Rotate', 'Rotate Right', 'Deskew', 'Crop Selected Area', 'Change Image Size', 'Flip', 'Mirror',
				'Zoom In', 'Original Size', 'Zoom Out', 'Stretch Mode', 
				//'Full Screen', 
				'Fit Canvas', 'Fit Horizontally', 'Fit Vertically', 'Print', 'Hand', 'Select', 'Restore', 'Save Changes']]
		},
	Funs = {
	    isFunction: function (_fun) {
	        return _fun && typeof (_fun) === 'function';
	    },

	    init: function (_ImageBaseUI, cfg) {
	        var _this = _ImageBaseUI, config = cfg || {}, randomId = Math.floor(Math.random() * 100000 + 1);

			//_this._UIManager = _UIManager;
            _this.container = config.Container;
			
			// remember containerWidth & containerHeight
	        _this.containerWidth = config.width ? config.width : 0;
	        _this.containerHeight = config.height ?  config.height : 0;
			
	        _this.width = _this.containerWidth;
	        _this.height = _this.containerHeight;
			
	        _this.defaultIndex = 0;

	        _this.bEdit = config.bEdit || false;

	        _this.evt_switch = config.evt_switch || '';
	        _this.evt_mouseMove = config.evt_mouseMove || '';
	        _this.evt_mouseIn = config.evt_mouseIn || '';
	        _this.evt_mouseOut = config.evt_mouseOut || '';
	        _this.evt_mouseClick = config.evt_mouseClick || '';
	        _this.evt_mouseDblClick = config.evt_mouseDblClick || '';

	        _this.selectionImageBorderColor = false;
	        _this.backgroundColor = 'rgb(255, 255, 255)';//white; //false;

	        _this['onRefreshUI'] = config['onRefreshUI'] || false;
	        _this['onMouseRightClick'] = config['onMouseRightClick'] || false;
	        _this['onMouseClick'] = config['onMouseClick'] || false;
	        _this['onMouseDoubleClick'] = config['onMouseDoubleClick'] || false;
	        _this['onMouseMove'] = config['onMouseMove'] || false;
	    },
	    
	    addClass: function (el, _css) {
	        DOM.one(el).addClass(_css);
	    },
	    removeClass: function (el, _css) {
	        DOM.one(el).removeClass(_css);
	    },

	    getToolBar: function (editor, width, height) {
	        var titles;
	        for (var j = 0; j < __buttons.titlelan.length; j++) {
	            if (__buttons.titlelan[j] == language) {
	                titles = __buttons.titles[j];
	                break;
	            }
	            else {
	                titles = __buttons.titles[0];//English
	            }
	        }
	        var o = document.createElement('ul');
	        var buttonsCount = __buttons.btninfo.length;
	        var imgDimention = width / buttonsCount > height ? height * 0.8 : width / buttonsCount * 0.8;
	        imgDimention = Math.floor(imgDimention);
	        var li = document.createElement('li');
	        li.style.padding = '0';
	        li.style.margin = '0';
	        li.style.width = width + 'px';
	        li.style.height = height + 'px';
	        for (var i = 0; i < buttonsCount; i++) {
	            var img = document.createElement('img');
	            img.src = Dynamsoft.WebTwainEnv.ResourcesPath + '/reference/imgs/' + __buttons.btninfo[i] + '.png';
	            img.className = 'Class_D_DWT_Editor_Buttons_' + __buttons.btninfo[i];
	            img.title = titles[i];
	            img.style.width = imgDimention + 'px';
	            img.style.height = imgDimention + 'px';
	            img.style.paddingTop = imgDimention / 8 + 'px';
	            switch (__buttons.btninfo[i]) {
	                case 'previous': img.onclick = function () { editor.previous_btn(); }; break;
	                case 'next': img.onclick = function () { editor.next_btn(); }; break;
	                case 'rotateleft': img.style.marginLeft = imgDimention + 'px'; img.onclick = function () { editor.RotateLeft(); }; break;
	                case 'rotate': img.onclick = function () { editor.RotateAnyAngle(this); }; break;
	                case 'rotateright': img.onclick = function () { editor.RotateRight(); }; break;
	                case 'deskew': img.onclick = function () { editor.Deskew(); }; break;
	                case 'crop': img.onclick = function () { editor.Crop_btn(); }; break;
	                case 'changeimagesize': img.onclick = function () { editor.ChangeImageSizeGetinput(this); }; break;
	                case 'flip': img.onclick = function () { editor.Flip(); }; break;
	                case 'mirror': img.onclick = function () { editor.Mirror(); }; break;
	                case 'zoomin': img.style.marginLeft = imgDimention + 'px'; img.onclick = function () { editor.ZoomIn(); }; break;
	                case 'originalsize': img.onclick = function () { editor.OriginalSize(); }; break;
	                case 'zoomout': img.onclick = function () { editor.ZoomOut(); }; break;
	                case 'stretch': img.onclick = function () { editor.StrechMode(); }; break;
	                // case 'fullscreen': img.onclick = function () { editor.fullscreen(); }; break;
	                case 'fit': img.onclick = function () { editor.FitsWindowSize(); }; break;
	                case 'fitw': img.onclick = function () { editor.FitsWindowWidth(); }; break;
	                case 'fith': img.onclick = function () { editor.FitsWindowHeight(); }; break;
	                case 'print': img.onclick = function () { editor.print(); }; break;
	                case 'hand': img.style.marginLeft = imgDimention + 'px'; img.onclick = function () { editor.setMouseShape(true); }; break;
	                case 'rectselect': img.style.marginLeft = imgDimention + 'px'; img.onclick = function () { editor.setMouseShape(false); }; break;
	                case 'restore': img.style.display = 'none'; img.style.marginLeft = imgDimention + 'px'; img.onclick = function () { editor.RestoreImage(); }; break;
	                case 'save': img.style.display = 'none'; img.onclick = function () { editor.SaveImage(); }; break;
	            }
	            li.appendChild(img);
	        }
	        var closer = document.createElement('img');
	        closer.src = Dynamsoft.WebTwainEnv.ResourcesPath + '/reference/imgs/close.png';
	        closer.style.width = imgDimention + 'px';
	        closer.style.height = imgDimention + 'px';
	        closer.style.paddingTop = imgDimention / 8 + 'px';
	        closer.title = 'Click to Close Window';
	        closer.className = 'floatRight';
	        closer.onclick = function () {
	            editor.CloseImageEditor();
	        }
	        li.appendChild(closer);
	        o.appendChild(li);
	        return o;
	    },
		
	    output: function (_ImageBaseUI, msg) {

	        if (Dynamsoft.WebTwainEnv.Debug) {
	            DL.log(msg);
	        }

	    }
	};
	
	 function ImageUIEditor(_UIManager, cfg) {
      var _this = this, config = cfg || {}, container,
		divUI = '<div class="D_ImageUIEditor noPaddingnoMarginInside thinborder"></div>';
		
		_this._UIManager = _UIManager;
		_this.aryModelImageControl = _this.__NewAryModelImageControl(cfg.aryModelImageControl); //newview
		_this._UIView;
		_this.iControlWidth = 0;   
        _this.iControlHeight = 0;
        _this._stwain = cfg.stwain;

        _this.BaseUrl = cfg.BaseUrl;
        _this.cIndex = cfg.cIndex;
        _this.totalImagesCount = _this.aryModelImageControl.length;
        _this._IfImageChanged = false;
        
        Funs.init(_this, config);
		
        container = _this.container;
        container.append(divUI);

	    _this.UIEditor = container.one('.D_ImageUIEditor');
        _this.bShow = false;
	    
	    // zoom: The valid range is from 2 to 6500 percent (Value: 0.02 ~ 65.0)
        _this.zoom = 1.0;
        
         //aspectRatio: The aspect ratio to be used when fitting the window
		_this.aspectRatio = 1;
			
		_this.__fitWindowType = 0;
		
		_this.toolbar =
            {
                self: null,
                filled: false,
                width: 0,
                height: 0
            };
            
         _this.Left = 0;
         _this.Top = 0;
         _this.Right = 0;
         _this.Bottom = 0;
         
        //Add Events
        window.onresize = function () {
            _this.ShowImageEditorEx(-1, -1, -1, -1);//maxmize the editor
        }
	 };
	 
  ImageUIEditor.prototype.__NewAryModelImageControl = function (aryModelImageControl) {
    var _this = this;
    var aryTemp = [];
    var i = 0;
    for(i = 0; i< aryModelImageControl.length; i++)
    {
        var modelImageControl = new Dynamsoft.Lib.UI.ModelImageControl();
        modelImageControl.bIsDirty = true;
        modelImageControl.imageToShow = null;
        modelImageControl.imageWidth =  -1;
        modelImageControl.imageHeight = -1;
        modelImageControl.iImageControlWidth =  -1;    
		modelImageControl.iImageControlHeight = -1;
        modelImageControl.imageIndex = aryModelImageControl[i].imageIndex;
        modelImageControl.aryOverlayRectangleData = [];
        aryTemp.push(modelImageControl);
    }
    return aryTemp;
  }
	 
	 
    ImageUIEditor.prototype.ShowImageEditorEx = function (x, y, cx, cy) {
        var _this = this;

        cx = window.innerWidth;
		cy = window.innerHeight;
        x = 0;
        y = 0;
        _this.width = cx - 2;
        _this.height = cy - 2;

        _this.UIEditor.css({
            'display': '',
            'width': _this.width + 'px',
            'height': _this.height + 'px',
            'position': 'fixed',
            'left': x,
            'top': y,
			'z-index': '9999'
        });

		_this.isFitWindow = true;

		document.documentElement.scrollLeft = 0;
		document.documentElement.scrollTop = 0;
        document.body.style.overflow = 'hidden';
		
         if (_this.toolbar.filled) {
            _this.toolbar.filled = false;
        }
        _this.toolbar.width = _this.width;
        _this.toolbar.height = Math.floor(_this.height / 20 < 20 ? 20 : _this.height / 20);
                            
		this.updateEditor();
		return true;
    };
    
    
    ImageUIEditor.prototype.updateEditor = function () {
        var _this = this;
        Funs.output(_this, 'Editor is under mode "' + _this.mode + '"');

        if (_this.toolbar.self) {
            if (!_this.bShow) // if the editor is hidden, then there is no need to update it
                return;
            //Already created
            if (_this.toolbar.width + _this.toolbar.height == 0) {
                Funs.addClass(_this.toolbar.self, 'notdisplayed');
            }
            else {
                _this.toolbar.self.style.width = _this.toolbar.width + 'px';
                _this.toolbar.self.style.height = _this.toolbar.height + 'px';
                if (!_this.toolbar.filled) {
                    _this.toolbar.filled = true;
                    while (_this.toolbar.self.firstChild) {
                        _this.toolbar.self.removeChild(_this.toolbar.self.firstChild);
                    }
                    _this.toolbar.self.appendChild(Funs.getToolBar(_this, _this.toolbar.width, _this.toolbar.height));
                    if (_this._IfImageChanged) {   
						var btnSave = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_save'),
							btnRestore = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_restore');

                        btnSave[0].style.display = '';
                        btnRestore[0].style.display = '';
                    }
                }
           
                Funs.removeClass(_this.toolbar.self, 'notdisplayed');
                Funs.removeClass(_this.toolbar.self, 'overlay');
               
            }
            
            _this.iControlWidth = _this.width - 2;   
            _this.iControlHeight = (_this.height - _this.toolbar.height - 2);
            
            DL.log('ChangeImageViewSize: ' + [_this.iControlWidth, _this.iControlHeight].join(','));
            _this._UIView.ChangeImageViewSize(_this.iControlWidth, _this.iControlHeight);

            _this.updateMode();
        }
        else {
            //Create elements at runtime
			var randomId = (Math.floor(Math.random() * 1000 + 1)).toString();
			var topDIV, leftDIV,
				cssClass = ['D_ImageUIEditor', 'noPaddingnoMarginInside', 'thinborder'];
			
            topDIV = document.createElement('div');
            topDIV.id = 'ds-dwt-viewerToolbar' + randomId;
            topDIV.style.width = _this.toolbar.width + 'px';
            topDIV.style.height = _this.toolbar.height + 'px';
			topDIV.style.whiteSpace = 'normal';
			topDIV.className = 'ds-dwt-viewerToolbar';

            leftDIV = document.createElement('div');
            leftDIV.id = 'ds-dwt-imageViewer' + randomId;
            leftDIV.style.width = _this.width + 'px';
            leftDIV.style.height = (_this.height - _this.toolbar.height) + 'px';
            leftDIV.style.backgroundColor = _this.backgroundColor;
            leftDIV.className = 'floatLeft ds-dwt-imageViewer';			

            _this.UIEditor.css({
                'width': _this.width + 'px',
                'height': _this.height + 'px'
            });

            _this.UIEditor.append(topDIV);
            _this.UIEditor.append(leftDIV);
            
            _this.iControlWidth = _this.width - 2;   
            _this.iControlHeight = (_this.height - _this.toolbar.height - 2);

	        var _view_cfg = {
				Container: _this.container.one('.ds-dwt-imageViewer'),
				Width: _this.iControlWidth,
				Height: _this.iControlHeight,
				borderWidth: 0
			};
			
            _view_cfg['onImageAreaSelected'] = function(params){
                DL.log('__onImageAreaSelected: ' + [params.left, params.top, params.right, params.bottom].join(',')); 
                    _this.Left = params.left;  //
                    _this.Top = params.top;
                    _this.Right = params.right;
                    _this.Bottom = params.bottom;
                    
                     var oCropButton = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_crop');
				
                    if (oCropButton && oCropButton[0]) {
                        var tmpstr = oCropButton[0].src;
                        tmpstr = tmpstr.replace('crop_grey.', 'crop.');
                        oCropButton[0].src = tmpstr;
                        oCropButton.style('cursor', 'pointer');
                    }
            };
            
             _view_cfg['onImageAreaDeSelected'] = function(){
                DL.log('__onImageAreaDeSelected: '); 
                    _this.Left = 0;  //
                    _this.Top = 0;
                    _this.Right = 0;
                    _this.Bottom = 0;
                    
                    if(DOM.one(_this.toolbar.self))
                    {
                        _this.__SetCropButtonGrey(false); 
                    }
        
            };
            
	        _this._UIView = new Dynamsoft.Lib.UI.ImageUIView(_view_cfg);
	        _this._UIView.BaseUrl =  _this.BaseUrl;
	        _this._UIView.aryModelImageControl = _this.aryModelImageControl;  //ImageEditor 
	        _this._UIView.cCurrentIndex = _this.cIndex;
	        _this._UIView.__fireEvent('onResetCurrentIndex', _this.cIndex);

	        _this._UIView.SetViewMode(-1, -1);

            _this.UIEditor.attr('class', cssClass.join(' '));

            _this.toolbar.self = document.getElementById('ds-dwt-viewerToolbar' + randomId);
            _this.updateEditor();
        }
    };
    
      ImageUIEditor.prototype.updateMode = function (isDrawDirectly) {
        var _this = this, tmpstr;			
		
		var btnNext = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_next'),
			btnPrevious = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_previous');

        if (_this.totalImagesCount > 1) {

            if (btnNext && btnNext[0]) {
                if (_this.cIndex == _this.totalImagesCount - 1) {
                    tmpstr = btnNext[0].src;
                    tmpstr = tmpstr.replace('next.', 'next_grey.');
                    btnNext[0].src = tmpstr;
                    btnNext[0].style.cursor = 'auto';
                }
                else {
                    tmpstr = btnNext[0].src;
                    tmpstr = tmpstr.replace('next_grey.', 'next.');
                    btnNext[0].src = tmpstr;
                    btnNext[0].style.cursor = 'pointer';
                }
                if (_this.cIndex == 0) {
                    tmpstr = btnPrevious[0].src;
                    tmpstr = tmpstr.replace('previous.', 'previous_grey.');
                    btnPrevious[0].src = tmpstr;
                    btnPrevious[0].style.cursor = 'auto';
                }
                else {
                    tmpstr = btnPrevious[0].src;
                    tmpstr = tmpstr.replace('previous_grey.', 'previous.');
                    btnPrevious[0].src = tmpstr;
                    btnPrevious[0].style.cursor = 'pointer';
                }
            }
        } 
         else {
            if (btnNext && btnNext[0]) {
                tmpstr = btnNext[0].src;
                tmpstr = tmpstr.replace('next.', 'next_grey.');
                btnNext[0].src = tmpstr;
                btnNext[0].style.cursor = 'auto';
                tmpstr = btnPrevious[0].src;
                tmpstr = tmpstr.replace('previous.', 'previous_grey.');
                btnPrevious[0].src = tmpstr;
                btnPrevious[0].style.cursor = 'auto';
            }
        }
        
         _this.__SetCropButtonGrey(true); 
        
         _this.setMouseShape(false);
    };
    
     ImageUIEditor.prototype.CloseImageEditor = function () {
        var _this = this;
        Dynamsoft.Lib.hide('J_ImgSizeEditor');
        Dynamsoft.Lib.hide('J_RotateAnyAngle');
        window.onresize = null;
        
        if (_this._IfImageChanged) {
			_this.ShowDialogForSaveImage(-1, true);
			return;
        }
       
		document.body.style.overflow = '';
		_this.__HideImageEditorInner();
    }; 
    
    ImageUIEditor.prototype.__HideImageEditorInner = function () {
        var _this = this;
       
        _this._UIView.Clear();
	    _this.aryModelImageControl = [];
	    
		_this.container.remove();
    };
    
    ImageUIEditor.prototype.previous_btn = function () {
        var _this = this, tmpstr,
			oBtnPrevious = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_previous');
			
        if (oBtnPrevious && oBtnPrevious[0]) {
            tmpstr = oBtnPrevious[0].src;
            if (tmpstr.indexOf('grey') != -1) {
                return;
            }
            else {
                _this.previous();
            }
        }
    };

    ImageUIEditor.prototype.next_btn = function () {
        var _this = this, tmpstr,
			oBtnNext = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_next');
			
        if (oBtnNext && oBtnNext[0]) {
            tmpstr = oBtnNext[0].src;
            if (tmpstr.indexOf('grey') != -1) {
                return;
            }
            else {
                _this.next();
            }
        }
    };
    
    ImageUIEditor.prototype.previous = function () {
        var _this = this;
		_this.go(_this.cIndex-1);
    };
    ImageUIEditor.prototype.next = function () {
        var _this = this;
		_this.go(_this.cIndex+1);
    };

    ImageUIEditor.prototype.go = function (_cIndex) {
        var _this = this;
        if (_this._IfImageChanged) {
           _this.ShowDialogForSaveImage(_cIndex, false);
            return;
        }

		 _this.__goInner(_cIndex);
    };

    ImageUIEditor.prototype.__goInner = function (_cIndex) {
     var _this = this;		
		if (typeof(_cIndex) !== 'undefined') {
            if (_cIndex < 0 || _cIndex >= _this.totalImagesCount) {
				return;
			}
			
			_this.cIndex = _cIndex;
            _this._UIView.ShowImage(_cIndex, _this.aryModelImageControl[_this.cIndex]);   
           _this._UIManager.getView().SetCurrentIndexOnly(_cIndex); //imageview
        }
		
		var btnPrevious = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_previous'),
			btnNext = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_next');

        if(_cIndex == 0){
			if (btnPrevious && btnPrevious[0]) {
                var tmpstr = btnPrevious[0].src;
                tmpstr = tmpstr.replace('previous.', 'previous_grey.');
                btnPrevious[0].src = tmpstr;
                btnPrevious[0].style.cursor = 'auto';
                if (_this.totalImagesCount > 1) {
                    tmpstr = btnNext[0].src;
                    tmpstr = tmpstr.replace('next_grey.', 'next.');
                    btnNext[0].src = tmpstr;
                    btnNext[0].style.cursor = 'pointer';
                }
            }
		} else if (_cIndex == _this.totalImagesCount - 1) {
            //last image
            if (btnNext && btnNext[0]) {
                var tmpstr = btnNext[0].src;
                tmpstr = tmpstr.replace('next.', 'next_grey.');
                btnNext[0].src = tmpstr;
                btnNext[0].style.cursor = 'auto';
                if (_this.totalImagesCount > 1) {
                    tmpstr = btnPrevious[0].src;
                    tmpstr = tmpstr.replace('previous_grey.', 'previous.');
                    btnPrevious[0].src = tmpstr;
                    btnPrevious[0].style.cursor = 'pointer';
                }
            }
        }
        else if(_this.totalImagesCount > 1)
        {
            if (btnPrevious && btnPrevious[0]) {
                var tmpstr = btnPrevious[0].src;
                tmpstr = tmpstr.replace('previous_grey.', 'previous.');
                btnPrevious[0].src = tmpstr;
                btnPrevious[0].style.cursor = 'pointer';
            }
             if (btnNext && btnNext[0]) {
                var tmpstr = btnNext[0].src;
                tmpstr = tmpstr.replace('next_grey.', 'next.');
                btnNext[0].src = tmpstr;
                btnNext[0].style.cursor = 'pointer';
            }
        }
		
		_this._stwain._OnBitmapChanged(["0", _this._UIView.cCurrentIndex.toString(), 4, _this._UIView.cCurrentIndex,_this._UIView.sHowManyImages]);
		
		if (_this._IfImageChanged) {
			return;
		}
    };
    
     ImageUIEditor.prototype.Rotate = function (fAngle, bKeepSize) {
        var _this = this;
        if (typeof fAngle === 'undefined' || typeof bKeepSize === 'undefined') {
            alert('Not enough paramters');
        }
        else {        
             //an image has been edited
	        _this._IfImageChanged = true;
	        
            _this._stwain.Rotate(_this.cIndex, fAngle, bKeepSize);   
        }
    };
    ImageUIEditor.prototype.RotateEx = function (fAngle, bKeepSize, enumNumbererpolationMethod) {
        var _this = this;
        if (typeof fAngle === 'undefined' || typeof bKeepSize === 'undefined' || typeof enumNumbererpolationMethod === 'undefined') {
            alert('Not enough paramters');
        }
        else {
             //an image has been edited
	        _this._IfImageChanged = true;
	        
            _this._stwain.RotateEx(_this.cIndex, fAngle, bKeepSize, enumNumbererpolationMethod);
        }
    };
    
    ImageUIEditor.prototype.RotateLeft = function () {
        var _this = this;
        
         //an image has been edited
	     _this._IfImageChanged = true;
	        
        _this._stwain.RotateLeft(_this.cIndex);
    };
    
    ImageUIEditor.prototype.RotateAnyAngle = function (oButton) {
         var _this = this;
         Dynamsoft.Lib.hide('J_ImgSizeEditor');
                
        if (!Dynamsoft.Lib.get('J_RotateAnyAngle')) {
            var ObjString = ['<div id="J_RotateAnyAngle" class="ds-dwt-imgSizeEditor" style="display:none; z-index: 99999;">',
	        '<ul>',
		        '<li><label for="J_Angle"><b>Angle :</b>',
			        '<input type="text" id="J_Angle" style="width:50%;" size="10"/></label></li>',
		        '<li><label for="J_Angle_InterpolationMethod"><b>Interpolation:</b>&nbsp;',
			        '<select size="1" id="J_Angle_InterpolationMethod"><option value = ""></option></select></li>',
		        '<li><label for="J_KeepSize"><b></b>',
			        '<input type="checkbox" id="J_KeepSize"/>Keep size</label></li>',
	        '</ul>',
	        '<div>',
		        '<input id="J_btnRotateAnyAngleOK" type="button" value="  OK  "/>',
		        '<span><input id= "J_btnCancelRotateAnyAngle" type="button" value="Cancel" /></span>',
	        '</div>',
            '</div>'];
            DOM.one('body').append(ObjString.join(''));
        }	
    
        var vInterpolationMethod = Dynamsoft.Lib.get("J_Angle_InterpolationMethod");
        vInterpolationMethod.options.length = 0;
        vInterpolationMethod.options.add(new Option("NearestNeighbor", 1));
        vInterpolationMethod.options.add(new Option("Bilinear", 2));
        vInterpolationMethod.options.add(new Option("Bicubic", 3));
    	
        var vbtnRotateAnyAngleOK = Dynamsoft.Lib.get("J_btnRotateAnyAngleOK");
        vbtnRotateAnyAngleOK.onclick = function () {
            var angle = Dynamsoft.Lib.get("J_Angle").value;

            Dynamsoft.Lib.get("J_Angle").className = '';
	
            re = /^\d+$/;
            if (!re.test(angle) || angle<=0) {
                Dynamsoft.Lib.get("J_Angle").className += " invalid";
                Dynamsoft.Lib.get("J_Angle").focus();
                alert("Error: The angle you entered is invalid.");
                return;
            }

           var chkKeepSize = Dynamsoft.Lib.get("J_KeepSize");
           var bKeepSize = chkKeepSize.checked;

           var ret = _this.RotateEx(angle, bKeepSize, Dynamsoft.Lib.get("J_Angle_InterpolationMethod").selectedIndex + 1);
            if (_this._stwain.ErrorCode == 0) {
	            Dynamsoft.Lib.hide('J_RotateAnyAngle');
                return;
            }
        };

        var vbtnCancelRotateAnyAngle = Dynamsoft.Lib.get("J_btnCancelRotateAnyAngle");
        vbtnCancelRotateAnyAngle.onclick = function () {
            Dynamsoft.Lib.hide('J_RotateAnyAngle');
        };

	    var o = Dynamsoft.Lib.get('J_RotateAnyAngle');
	    Dynamsoft.Lib.toggle('J_RotateAnyAngle');
	
	    var y = oButton.y;
	    if(!y)
	        y = oButton.offsetTop + 1;
	    var x = oButton.x;
	    if(!x)
	        x = oButton.offsetLeft + 1;
        o.style.top = y + oButton.offsetHeight + document.documentElement.scrollTop + 'px'; 
        o.style.left = x + document.documentElement.scrollLeft + 'px';  

        Dynamsoft.Lib.get("J_Angle").value = "45";
    };
    
     ImageUIEditor.prototype.RotateRight = function () {
        var _this = this;
        
        //an image has been edited
	    _this._IfImageChanged = true;
	        
        _this._stwain.RotateRight(_this.cIndex);
    };
    ImageUIEditor.prototype.Deskew = function () {
        var _this = this;
        _this.RotateEx(_this._stwain.GetSkewAngle(_this.cIndex), true, 1);
    };
    ImageUIEditor.prototype.Flip = function () {
        var _this = this;
        
        //an image has been edited
	    _this._IfImageChanged = true;
	        
        _this._stwain.Flip(_this.cIndex);
    };
    ImageUIEditor.prototype.Mirror = function () {
        var _this = this;
        
        //an image has been edited
	    _this._IfImageChanged = true;
	        
        _this._stwain.Mirror(_this.cIndex);
    };
    ImageUIEditor.prototype.ChangeImageSize = function (lNewwidth, lnewheight, enumNumbererpolationMethod) {
        var _this = this;
        
        //an image has been edited
	    _this._IfImageChanged = true;
	        
        _this._stwain.ChangeImageSize(_this.cIndex, lNewwidth, lnewheight, enumNumbererpolationMethod);
    };
    ImageUIEditor.prototype.ChangeImageSizeGetinput = function (oButton) {
         var _this = this;
         Dynamsoft.Lib.hide('J_RotateAnyAngle');
         
    if (!Dynamsoft.Lib.get('J_ImgSizeEditor')) {
        var ObjString = ['<div id="J_ImgSizeEditor" class="ds-dwt-imgSizeEditor" style="display:none;z-index: 99999;">',
	    '<ul>',
		    '<li><label for="J_img_height"><b>New Height :</b>',
			    '<input type="text" id="J_img_height" style="width:50%;" size="10"/>pixel</label></li>',
		    '<li><label for="J_img_width"><b>New Width :</b>&nbsp;',
			    '<input type="text" id="J_img_width" style="width:50%;" size="10"/>pixel</label></li>',
		    '<li>Interpolation method:',
			    '<select size="1" id="J_InterpolationMethod"><option value = ""></option></select></li>',
	    '</ul>',
	    '<div>',
		    '<input id="J_btnChangeImageSizeOK" type="button" value="  OK  "/>',
		    '<span><input id= "J_btnCancelChange" type="button" value="Cancel" /></span>',
	    '</div>',
        '</div>'];
        DOM.one('body').append(ObjString.join(''));	
        }
    
        var vInterpolationMethod = Dynamsoft.Lib.get("J_InterpolationMethod");
        vInterpolationMethod.options.length = 0;
        vInterpolationMethod.options.add(new Option("NearestNeighbor", 1));
        vInterpolationMethod.options.add(new Option("Bilinear", 2));
        vInterpolationMethod.options.add(new Option("Bicubic", 3));
    	
        var vbtnChangeImageSizeOK = Dynamsoft.Lib.get("J_btnChangeImageSizeOK");
        vbtnChangeImageSizeOK.onclick = function () {
	        var newWidth = Dynamsoft.Lib.get("J_img_width").value, newHeight = Dynamsoft.Lib.get("J_img_height").value;

            Dynamsoft.Lib.get("J_img_width").className = '';
            Dynamsoft.Lib.get("J_img_height").className = '';
	        re = /^\d+$/;
            if (!re.test(newHeight) || newHeight<=0) {
                Dynamsoft.Lib.get("J_img_height").className += " invalid";
                Dynamsoft.Lib.get("J_img_height").focus();
                alert("Error: The height you entered is invalid.");
                return;
            }
	
            if (!re.test(newWidth) || newWidth<=0) {
                Dynamsoft.Lib.get("J_img_width").className += " invalid";
                Dynamsoft.Lib.get("J_img_width").focus();
                alert("Error: The width you entered is invalid.");
                return;
            }
	        var ret = _this.ChangeImageSize(newWidth, newHeight, Dynamsoft.Lib.get("J_InterpolationMethod").selectedIndex + 1); 

            if (_this._stwain.ErrorCode == 0) {
		        Dynamsoft.Lib.hide('J_ImgSizeEditor');
                return;
            }
        };

        var vbtnCancelChange = Dynamsoft.Lib.get("J_btnCancelChange");
        vbtnCancelChange.onclick = function () {
            Dynamsoft.Lib.hide('J_ImgSizeEditor');
        };

	    var o = Dynamsoft.Lib.get('J_ImgSizeEditor');
	    Dynamsoft.Lib.toggle('J_ImgSizeEditor');
	
	    var y = oButton.y;
	    if(!y)
	        y = oButton.offsetTop + 1;
	    var x = oButton.x;
	    if(!x)
	        x = oButton.offsetLeft + 1;
        o.style.top = y + oButton.offsetHeight + document.documentElement.scrollTop + 'px'; 
        o.style.left = x + document.documentElement.scrollLeft + 'px';  

        if(_this.aryModelImageControl[_this.cIndex].imageToShow)
        {
            Dynamsoft.Lib.get("J_img_width").value = _this.aryModelImageControl[_this.cIndex].imageToShow.width;
            Dynamsoft.Lib.get("J_img_height").value = _this.aryModelImageControl[_this.cIndex].imageToShow.height;
        }
        else
        {
            Dynamsoft.Lib.get("J_img_width").value = 0;
            Dynamsoft.Lib.get("J_img_height").value = 0;
        }
		return false;
    };
    
    
    ImageUIEditor.prototype.Crop_btn = function () {
        var _this = this, tmpstr,
			oCropButton = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_crop');
			
        if (oCropButton && oCropButton[0]) {
            tmpstr = oCropButton[0].src;
            if (tmpstr.indexOf('grey') != -1) {
                return;
            }
            else {
                _this.Crop();
            }
        }
    };

    ImageUIEditor.prototype.Crop = function () {
        var _this = this;

        var left = _this.Left;
        var top = _this.Top;
        var right = _this.Right;
        var bottom = _this.Bottom;
     
        if (parseInt(left) - parseInt(right) != 0 &&
            parseInt(top) - parseInt(bottom) != 0) {

            //an image has been edited
	        _this._IfImageChanged = true;
	        
            _this._stwain.Crop(_this.cIndex, parseInt(left), parseInt(top), parseInt(right), parseInt(bottom));
           _this.__SetCropButtonGrey(true); 
        }
        else {
            Funs.output(_this, 'No area selected for cropping');
            return;
        }
    };
    
    ImageUIEditor.prototype.StrechMode = function () {
        var _this = this;
        
        _this._UIView.SetIfFitWindowAndType(4); 
        _this.__SetZoomInButtonEnable(true);
        _this.__SetZoomOutButtonEnable(true);
        _this.__SetCropButtonGrey(true);     
        return;
    };
    
    ImageUIEditor.prototype.FitsWindowSize = function () {
        var _this = this;
        
        _this._UIView.SetIfFitWindowAndType(0); 
        _this.__SetZoomInButtonEnable(true);
        _this.__SetZoomOutButtonEnable(true); 
        _this.__SetCropButtonGrey(true);    
        return;
    };
    
    ImageUIEditor.prototype.FitsWindowWidth = function (bestFit) {
        var _this = this;
        
        _this._UIView.SetIfFitWindowAndType(2);  
        _this.__SetZoomInButtonEnable(true);
        _this.__SetZoomOutButtonEnable(true);
        _this.__SetCropButtonGrey(true);   
        return;
    };
    
    ImageUIEditor.prototype.FitsWindowHeight = function (bestFit) {
        var _this = this;
        
        _this._UIView.SetIfFitWindowAndType(1);
        _this.__SetZoomInButtonEnable(true);
        _this.__SetZoomOutButtonEnable(true);  
        _this.__SetCropButtonGrey(true);    
        return;
    };
    
    ImageUIEditor.prototype.ZoomIn = function () {
        var _this = this;
        if(_this._UIView.ZoomIn())
        {
            _this.__SetZoomInButtonEnable(true);
            _this.__SetZoomOutButtonEnable(true);
        }
        else
        {
            _this.__SetZoomInButtonEnable(false);
            _this.__SetZoomOutButtonEnable(true);
        }
        _this.__SetCropButtonGrey(true);   
    };
    
    ImageUIEditor.prototype.ZoomOut = function () {
        var _this = this;
        if(_this._UIView.ZoomOut())
        {
            _this.__SetZoomOutButtonEnable(true);
            _this.__SetZoomInButtonEnable(true);
        }
        else
        {
            _this.__SetZoomOutButtonEnable(false);
            _this.__SetZoomInButtonEnable(true);
        }
        _this.__SetCropButtonGrey(true);   
    };
    
    ImageUIEditor.prototype.OriginalSize = function () {
        var _this = this;
        
        _this._UIView.SetZoom(1.0); 
        _this.__SetZoomInButtonEnable(true);
        _this.__SetZoomOutButtonEnable(true);
        _this.__SetCropButtonGrey(true);     
        return;
    };
    
    ImageUIEditor.prototype.setMouseShape = function (newShape) {
        var _this = this;
        if (typeof newShape == 'boolean') {
        _this._UIView.SetMouseShapeByIndex(_this.cIndex,newShape);
			var btnHand = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_hand'),
				btnRectSelect = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_rectselect');			
            if (newShape) {
                if (btnHand && btnHand[0]) {
                    btnHand[0].style.display = 'none';
                    btnRectSelect[0].style.display = '';
                }
//                _this.SetSelectedImageArea(0, 0, 0, 0);
            } else {
                if (btnHand && btnHand[0]) {
                    btnHand[0].style.display = '';
                    btnRectSelect[0].style.display = 'none';
                }
            };
        }
        else {
            Funs.output(_this, 'You need to use "ture" or "false" to set MouseShape.');
        }
    };
    
    ImageUIEditor.prototype.print = function () {
        var _this = this;    
        _this._UIView.PrintCurrent();
    };
    
    ImageUIEditor.prototype.RestoreImage = function () {
         var _this = this
         _this.__RestoreImageInner(true, -1);
    };
    
    ImageUIEditor.prototype.__RestoreImageInner = function (bShow, cIndex) {
        var _this = this, tmpUrl;
        if (_this.cIndex == -1) {
            //No images in buffer
            return;
        }
        
        var fun = function (ctl, data, index) {
            if(bShow == true)
            {
                DL.log('__RestoreImageInner: ' + [data.imageIndex].join(',')); 
                 data.bOriginalImage = true;
                _this._UIView.AttachImagesForControl(ctl, data);
            }
            
            _this._IfImageChanged = false;
            
             var objModelImageControl = _this.aryModelImageControl[index]; 
             if(objModelImageControl != null)
             {
                objModelImageControl.imageToShow = data.imageToShow;
                objModelImageControl.imageWidth = data.imageWidth;
                objModelImageControl.imageHeight = data.imageHeight;
                objModelImageControl.imageUrl = data.imageUrl;
             }
                
                //index index
             _this._UIManager.getView().SetDataImageControl(index); //imageview
            
            var btnSave = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_save'),
			btnRestore = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_restore');
            if (btnSave && btnSave[0]) {
                btnSave[0].style.display = 'none';
                btnRestore[0].style.display = 'none';
            }
            if(cIndex == -1)
                _this._stwain._OnBitmapChanged(["0", _this._UIView.cCurrentIndex.toString(), 4, _this._UIView.cCurrentIndex,_this._UIView.sHowManyImages]);
        }

        if (_this._IfImageChanged == true) {
            var imgControl = _this._UIView.GetImageControl(_this.cIndex);
            if (null != imgControl)
            {
			    _this.OnGetImageFromServer(imgControl, _this.aryModelImageControl[_this.cIndex], _this.cIndex, 1, fun);
				imgControl.SetCurrentIndex(_this.cIndex);  //index
			}
        }
    };
    
    
    ImageUIEditor.prototype.OnGetImageFromServer = function (ctl, data, index, type,callbackFun) {
	    var _this = this, url, objImage;

	    if(callbackFun && _this.BaseUrl){
		    url = Funs2.getUrlByAct(_this.BaseUrl, index, type);   //1:undo;  2:Save
		    objImage = new Image();
		    objImage.src = url;
		    objImage.onload = function(){
			    data.imageToShow = objImage;
			    data.imageWidth = objImage.width;
			    data.imageHeight = objImage.height;
			    data.imageUrl = url;
			    data.bIsDirty = false;
			    callbackFun(ctl, data, index);
		    };	
	    }
    	
	    return true;
    };
    
     ImageUIEditor.prototype.ChangeSize = function (w, h) {
        var _this = this;
		
		if(w>=0)
			_this.containerWidth = w;
			
		if(h>=0)
			_this.containerHeight = h;
		
		_this.width = _this.containerWidth - 2;
		if(_this.width < 0){
			_this.width = 0;
		}
		
		_this.height = _this.containerHeight - 2;
		if(_this.height < 0){
			_this.height = 0;
		}
		
		_this.UIEditor.css({
			'width': _this.width + 'px',
			'height': _this.height + 'px'
		});
    };

    
    ImageUIEditor.prototype.SaveImage = function () {
         var _this = this;
         _this.__SaveImageInner(true);
    };
    
    ImageUIEditor.prototype.__SaveImageInner = function (bShow) {
        var _this = this, tmpUrl;
        if (_this.cIndex == -1) {
            //No images in buffer
            return;
        }
        if (!_this._IfImageChanged) {
            alert('You have not changed the current image');
            return; // the image is not changed
        }

        var fun = function (ctl, data, index) {
            if(bShow == true)
            {
                DL.log('__SaveImageInner: ' + [data.imageIndex].join(',')); 
                data.bOriginalImage = true;
                _this._UIView.AttachImagesForControl(ctl, data);
            }
            _this._IfImageChanged = false;
            
             var objModelImageControl = _this.aryModelImageControl[index]; 
             if(objModelImageControl != null)
             {
                objModelImageControl.imageToShow = data.imageToShow;
                objModelImageControl.imageWidth = data.imageWidth;
                objModelImageControl.imageHeight = data.imageHeight;
                objModelImageControl.imageUrl = data.imageUrl;
            }

            _this._UIManager.getView().SetDataImageControl(index); //imageview

            var btnSave = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_save'),
			btnRestore = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_restore');
            if (btnSave && btnSave[0]) {
                btnSave[0].style.display = 'none';
                btnRestore[0].style.display = 'none';
            } 
        }

        if (_this._IfImageChanged == true) {
            var imgControl = _this._UIView.GetImageControl(_this.cIndex);
            if (null != imgControl)
            {
			    _this.OnGetImageFromServer(imgControl, _this.aryModelImageControl[_this.cIndex], _this.cIndex, 2, fun);    
			    imgControl.SetCurrentIndex(_this.cIndex);  //index
			}
        }
    };
    
    ImageUIEditor.prototype.ShowDialogForSaveImage = function (cIndex, bCloseEditor) {
       var _this = this;
        var ObjString =
        [ '<div id="J_waiting">',
		'<P style="white-space:nowrap;">',
		'You have changed the image, do you want to keep the change(s)?',
		'</P>',
		'<div style="width: 200px;white-space:nowrap;margin-left: auto;margin-right: auto;">',
		    '<input id="J_btnSave" style="width: 100px; height:30px; margin-right: 10px; margin-top: 10px;"  type="button" value="  OK  "/>',
		    '<input id= "J_btnCancel" style="width: 100px; height:30px;"  type="button" value="  NO  " />',
	    '</div>',
		'</div>'];

        Dynamsoft.WebTwainEnv.ShowDialog(422, 107, ObjString.join(''), true);
        var vbtnSave = Dynamsoft.Lib.get("J_btnSave");
        vbtnSave.onclick = function () {
			_this.__SaveImageInner(false);
			var containerID = _this._stwain._strDWTControlContainerID;
			Dynamsoft__OnclickCloseInstallEx(containerID);
			Dynamsoft.Lib.bChangeImage = 1;
			if(cIndex == -1)
				_this.__HideImageEditorInner();
			else
				_this.__goInner(cIndex);
				
			if(bCloseEditor)
				document.body.style.overflow = '';
        };

        var vbtnCancel = Dynamsoft.Lib.get("J_btnCancel");
        vbtnCancel.onclick = function () {
            _this.__RestoreImageInner(false, cIndex);
             var containerID = _this._stwain._strDWTControlContainerID;
            Dynamsoft__OnclickCloseInstallEx(containerID);
            Dynamsoft.Lib.bChangeImage = 0;
             if(cIndex == -1)
               _this.__HideImageEditorInner();
            else
               _this.__goInner(cIndex);
			   
			if(bCloseEditor)
				document.body.style.overflow = '';
        };
    };
    
    ImageUIEditor.prototype.__SetCropButtonGrey = function (bNeedDeSelect) {   
        var _this = this;
         _this.Left = 0;  //
        _this.Top = 0;
        _this.Right = 0;
        _this.Bottom = 0;
        
        var oCropButton = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_crop');
			
        if (oCropButton && oCropButton[0]) {
            var tmpstr = oCropButton[0].src;
            tmpstr = tmpstr.replace('crop.', 'crop_grey.');
            oCropButton[0].src = tmpstr;
            oCropButton.style('cursor', 'auto');
        }  
        
        if(bNeedDeSelect)
        {
            var imgControl = _this._UIView.GetImageControl(_this.cIndex);
            if (null != imgControl)
	            imgControl.SetSelectedImageArea(0,0,0,0);  
	    }
    };
    
    ImageUIEditor.prototype.__SetZoomInButtonEnable = function (bEnable) {   
        var _this = this;
        
        var oZoomInButton = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_zoomin');
			
        if (oZoomInButton && oZoomInButton[0]) {
            var tmpstr = oZoomInButton[0].src;
            if(bEnable == true)
            {
                tmpstr = tmpstr.replace('zoomin_grey.', 'zoomin.');
                oZoomInButton[0].src = tmpstr;
                oZoomInButton.style('cursor', 'pointer');
            }
            else
            {
                tmpstr = tmpstr.replace('zoomin.', 'zoomin_grey.');
                oZoomInButton[0].src = tmpstr;
                oZoomInButton.style('cursor', 'auto');
            }
        }  
    };
    
    ImageUIEditor.prototype.__SetZoomOutButtonEnable = function (bEnable) {   
        var _this = this;
        
        var oZoomOutButton = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_zoomout');
			
        if (oZoomOutButton && oZoomOutButton[0]) {
            var tmpstr = oZoomOutButton[0].src;
            if(bEnable == true)
            {
                tmpstr = tmpstr.replace('zoomout_grey.', 'zoomout.');
                oZoomOutButton[0].src = tmpstr;
                oZoomOutButton.style('cursor', 'pointer');
            }
            else
            {
                tmpstr = tmpstr.replace('zoomout.', 'zoomout_grey.');
                oZoomOutButton[0].src = tmpstr;
                oZoomOutButton.style('cursor', 'auto');
            }
        }  
    };
    
    ImageUIEditor.prototype.refresh = function (_index) {
        var _this = this;
       // _this._UIView.UpdateAllImage(aryDateImageControl, _index);
        _this.cIndex = _index;
  
                    
        _this._UIView.SetDataImageControl(_index);
       if (_this._IfImageChanged) {   
			var btnSave = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_save'),
				btnRestore = DOM.one(_this.toolbar.self).one('.Class_D_DWT_Editor_Buttons_restore');
                
                if (btnSave && btnSave[0]) {
			    btnSave[0].style.display = '';
			    btnRestore[0].style.display = '';
    			
            }
        }      
         _this.__SetCropButtonGrey(true);   
    }
	
    Dynamsoft.Lib.UI = Dynamsoft.Lib.UI || {};
	Dynamsoft.Lib.UI['ImageUIEditor'] = ImageUIEditor;

})(Dynamsoft.Lib);// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 

(function (DL) {
	if (!DL.product.bChromeEdition){
		return;
	}
	
	var DOM = DL.DOM, Funs = {
			getServerImageUrlPrefix: function (_stwain) {
				var httpUrl = _stwain.httpUrl, _bFullImage = false,
					tmp = [httpUrl, 'img?id=', _stwain.clientId];

				return tmp.join('');
			},			
			output: function (msg) {
				if (Dynamsoft.WebTwainEnv.Debug) {
					DL.log(msg);
				}
			}
		};

	function ImageUIManager(_stwain, viewcfg){
		var _this = this;
		_this._stwain = _stwain;
		_this.__SelectionImageBorderColor =  0x7DA2CE;//0x800000;
		_this.__BackgroundColor = 0xFFFFFF;//0xDDDDDD;
		_this.__BackgroundFillColor = 0xFFFFFF;
		_this.__Ratio = 0;

		viewcfg["OnTopImageInTheViewChanged"] = function (cIndex)
        {
            if (Dynamsoft.Lib.isFunction(_stwain.__OnTopImageInTheViewChanged))
                _stwain.__OnTopImageInTheViewChanged(cIndex);
        };
		viewcfg['OnGetImageInfo'] = function(_index){
			var _width=-1, _height=-1;
			
			_width = _this.GetImageWidth(_index);
			// zoom
			//_height = _this._stwain.GetImageHeight(_index);
			
				
			/*
			 * 10.1.2 server or newer can using GetImageInfo
			imgInfo = Dynamsoft.Lib.html5.Funs.GetImageInfo(_this.DWObject, _this.cIndex);
			aryImageInfo = imgInfo.split(",");
			if(aryImageInfo.length === 2){
				_this.Image.width = aryImageInfo[0];
				_this.Image.height = aryImageInfo[1];
			} else {
				Dynamsoft.Lib.log('Error: Failed to get image width and height from server.');
				return false;
			}
			*/
			return {'width': _width, 'height': _height};
		};

		_this._UIView = new Dynamsoft.Lib.UI.ImageUIView(viewcfg);
		_this._UIEditor = false;
	};

	// ----- OK 
	ImageUIManager.prototype.getTwain = function () {
		var _this = this;
		return _this._stwain;
	};

	ImageUIManager.prototype.getView = function () {
		var _this = this;
		return _this._UIView;
	};

	ImageUIManager.prototype.OnReady = function () {
		var _this = this, _view = _this.getView();
		_view.BaseUrl = Funs.getServerImageUrlPrefix(_this._stwain);
		return true;
	};

	ImageUIManager.prototype.count = function () {
		return this.getView().HowManyImagesInBuffer();
	};

	ImageUIManager.prototype.clear = function (){
		return this.getView().RemoveAllImages();
	};

	ImageUIManager.prototype.ChangeSize = function (_w, _h) {
		return this.getView().ChangeImageViewSize(_w, _h);
	};
	
	ImageUIManager.prototype.GetCurrentImageIndex = function () {
		return this.getView().GetCurrentImageIndex();
	};
	ImageUIManager.prototype.GetSelectedImageIndex = function (sIndex) {
		var buffer = this.GetSelectedIndexes();
		if(sIndex>=0 && sIndex < buffer.length){
			return buffer[sIndex];
		}
		
		return -1;
	};
	
	ImageUIManager.prototype.GetSelectedIndexes = function () {
		return this.getView().GetSelectedIndexes();
	};
	
	// insert before index
	ImageUIManager.prototype.add = function (iImageIndex, _maxIndex, imageRawWidth) {
		return this.getView().AddImage(iImageIndex, _maxIndex, imageRawWidth);
	};

	ImageUIManager.prototype.remove = function (iImageIndex, _cIndex) {
		return this.getView().RemoveImage(iImageIndex, _cIndex);
	};

	ImageUIManager.prototype.MoveImage = function (sSourceImageIndex, sTargetImageIndex) {
		return this.getView().MoveImage(sSourceImageIndex, sTargetImageIndex);
	};

	ImageUIManager.prototype.SwitchImage = function (sImageIndex1, sImageIndex2) {
		return this.getView().SwitchImage(sImageIndex1, sImageIndex2);
	};	

	ImageUIManager.prototype.SetViewMode = function (sHorizontalImageCount, sVerticalImageCount) {
		return this.getView().SetViewMode(sHorizontalImageCount, sVerticalImageCount);
	};
	
	ImageUIManager.prototype.GetImageWidth = function (_i) {
		var _this = this, _index = _i * 1, 
			_count, _view, aryImages, objImage, _width;
			
		_view = _this.getView();
		aryImages = _view.GetDataImageControlList();
		_count = aryImages.length;

		if (_index < 0 || _index > _count)
			return 0;
		
		objImage = aryImages[_index];
		if(objImage && objImage.rawWidth){
			_width = objImage.rawWidth;
		} else {
			_width = _this._stwain.GetImageWidth(_index);
		}

		return _width;
	};

	ImageUIManager.prototype.get = function (_cIndex) {
		var _this = this, _index = parseInt(_cIndex), 
			_count, _view, aryImages;
			
		_view = _this.getView();
		aryImages = _view.GetDataImageControlList();
		_count = aryImages.length;

		if (_index < 0 || _index > _count)
			return false;

		return aryImages[_index];
	};

	ImageUIManager.prototype.refresh = function (_i, _maxIndex, bReplace, imageRawWidth) {
		var _this = this;

		if (bReplace) {
		
			var _index = _i * 1, 
			_count, _view, aryImages, objImage;
			
			_view = _this.getView();
			aryImages = _view.GetDataImageControlList();
			_count = aryImages.length;

			if (_index < 0 || _index > _count)
				return false;

//			objImage = aryImages[_index];
//		
//			objImage.bIsDirty = true;
//			objImage.imageToShow = false;
//			objImage.imageWidth = 0;
//			objImage.imageHeight = 0;

			// refresh UI
			if(_this._UIEditor && _this._UIEditor._UIView){
				_this._UIEditor.refresh( _index);//(aryImages, _index);
			}
			//_view.UpdateAllImage(aryImages, _index);
			
			_view.SetDataImageControl(_index, imageRawWidth);
		}

		return true;
	}
	
    /*
    nCmdShow
    * 0 -- the first 4 parameters work only when cCmdShow is 0
    * 1 -- maximize the editor
    * 2 -- show editor in the view window
    * 3 -- Close Editor
    * 4 -- check whether a window exists
    */
	ImageUIManager.prototype.ShowImageEditorEx = function (x, y, cx, cy, nCmdShow) {
		var _this = this, _viewer = _this.getView();
	
		var _newUI, _newEditWindow, doc=document, newContainer, _editor_cfg;
		newContainer = doc.createElement('div');
		doc.body.appendChild(newContainer);
		
		_editor_cfg = {
			Container: DOM.one(newContainer),
			aryModelImageControl:_viewer.GetDataImageControlList(),
			BaseUrl:_viewer.BaseUrl,
			cIndex:_viewer.cCurrentIndex,
			stwain : _this.getTwain()
		};
	
		_newEditWindow = new Dynamsoft.Lib.UI.ImageUIEditor(_this, _editor_cfg);
		
		_this._UIEditor = _newEditWindow;
		
		_newEditWindow.bShow = false;
		//_newEditWindow.refresh(_this._stwain.__cIndex, _this._stwain._HowManyImagesInBuffer);
		_newEditWindow.bShow = true;
		
		return _newEditWindow.ShowImageEditorEx(x, y, cx, cy, 0);

	};
	ImageUIManager.prototype.refreshEditor = function (cIndex, howMany) {
		var _this = this;
	
		if(_this._UIEditor){
			_this._UIEditor.refresh(cIndex);
		}
		return true;
	};

	// 
	ImageUIManager.prototype.GetSelectionImageBorderColor = function () {
		return this.__SelectionImageBorderColor;
	};
	// 
	ImageUIManager.prototype.SetSelectionImageBorderColor = function (v) {
		var _this = this, _v = v, _viewer = _this.getView();

		_this.__SelectionImageBorderColor = _v;

		if (Dynamsoft.Lib.isNumber(_v)) {
			_v = Dynamsoft.Lib.getColor(_v);
		}
		return _viewer.SetSelectionImageBorderColor(_v);
	};
	
	// 
	ImageUIManager.prototype.GetBackgroundColor = function () {
		return this.__BackgroundColor;
	};
	// 
	ImageUIManager.prototype.SetBackgroundColor = function (v) {
		var _this = this, _v = v, container, containerBox, _viewer = _this.getView();

		_this.__BackgroundColor = _v;

		if (Dynamsoft.Lib.isNumber(_v)) {
			_v = Dynamsoft.Lib.getColor(_v);
		}
		
		container = DOM.one('#' + _this._stwain._strDWTControlContainerID);
		if(container){
			containerBox = container.one('.ds-dwt-container-box');
			if(containerBox){
				containerBox.style('background-color', _v);
			}
		}
		
		return _viewer.SetBackgroundColor(_v);
	};
	
	// 
	ImageUIManager.prototype.SetSelectionRectAspectRatio = function (v) {
		var _this = this, _v = v, container, containerBox, _viewer = _this.getView();

		_this.__Ratio = _v;

		return _viewer.SetSelectionRectAspectRatio(_v);
	};
	
	
	ImageUIManager.prototype.GetSelectionRectAspectRatio = function () {
		return this.__Ratio;
	};


	Dynamsoft.Lib.UI = Dynamsoft.Lib.UI || {};
	Dynamsoft.Lib.UI['ImageUIManager'] = ImageUIManager;

})(Dynamsoft.Lib);
// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: html5
// final js: build\src.html5.js
// 

(function (S) {
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}

	Dynamsoft.Lib.env.WSVersion = "10.0.1";

    // get urls
    Dynamsoft.Lib.getHttpUrl = function (o) {
        var _ip = Dynamsoft.Lib.product.ip;

        if (o.ssl) {
            return ['https://', _ip, ':', o.port, '/'].join('');
        } else {
            return ['http://', _ip, ':', o.port, '/'].join('');
        }
    }

    Dynamsoft.Lib.getWSUrl = function (o) {
        var _ip = Dynamsoft.Lib.product.ip;

        if (o.ssl) {
            return ['wss://', _ip, ':', o.port].join('');
        } else {
            return ['ws://', _ip, ':', o.port].join('');
        }
    }

    Dynamsoft.Lib.getWS = function (port) {
        var _this = this,
			obj,
			wsurl = Dynamsoft.Lib.getWSUrl(port),
			wsprotocol = Dynamsoft.Lib.product.wsProtocol;

        if (_this.detect.OnCreatWS)
            _this.detect.OnCreatWS(wsurl, wsprotocol);

        if (typeof MozWebSocket != 'undefined') {
			if(wsprotocol)
				obj = new MozWebSocket(wsurl, wsprotocol);
			else
				obj = new MozWebSocket(wsurl);
        } else {
			if(wsprotocol)
				obj = new WebSocket(wsurl, wsprotocol);
			else
				obj = new WebSocket(wsurl);
        }

        return obj;
    }

    // config function
    Dynamsoft.Lib._init = function () {
        var _this = Dynamsoft.Lib,
			_last_port = _this.LS.item('D_port'),
			_last_ssl = _this.LS.item('D_ssl'),
			lastPort = null;

        _this.detect.urls.splice(0);
        _this.detect.cUrlIndex = 0;

        if (_last_port && _last_ssl) {

            lastPort = {
                port: _last_port,
                ssl: (_last_ssl == 'true')
            };
        }

        var notEqualToLastPort = function (o) {
            if (!lastPort)	// lastPort is null or undefined
                return true;
                
            if(o){
                if (o.port != lastPort.port || o.ssl != lastPort.ssl)
                    return true;	// not equal
            }
            return false;
        };

        var o;
        if (_this.detect.detectType === 1) {
            if (lastPort !== null && lastPort.ssl)
                _this.detect.urls.push(lastPort);

            for (var index in _this.detect.ports) {
                o = _this.detect.ports[index];
                if (o.ssl) {
                    if (notEqualToLastPort(o))
                        _this.detect.urls.push(o);
                }
            }

        } else if (_this.detect.detectType === 0) {
            if (lastPort !== null && !lastPort.ssl)
                _this.detect.urls.push(lastPort);

            for (var index in _this.detect.ports) {
                o = _this.detect.ports[index];
                if (o.ssl === false) {
                    if (notEqualToLastPort(o))
                        _this.detect.urls.push(o);
                }
            }
        } else {
            if (lastPort !== undefined && lastPort !== null)
                _this.detect.urls.push(lastPort);

            for (var index in _this.detect.ports) {
                o = _this.detect.ports[index];
                if (notEqualToLastPort(o))
                    _this.detect.urls.push(o);
            }
        }
        o = null;
    };
	
    Dynamsoft.Lib._reconnect = function () {
        var _this = Dynamsoft.Lib,
			_last_port = _this.LS.item('D_port'),
			_last_ssl = _this.LS.item('D_ssl'),
			lastPort = null;
			
        _this.detect.urls.splice(0);
        _this.detect.cUrlIndex = 0;

        if (_last_port && _last_ssl) {

            lastPort = {
                port: _last_port,
                ssl: (_last_ssl == 'true')
            };
			_this.detect.urls.push(lastPort);
			
			var objSTwain;
			if (_this.detect.cTwainIndex < _this.detect.arySTwains.length) {
				objSTwain = _this.detect.arySTwains[_this.detect.cTwainIndex];
			} 

			if(!objSTwain){
				return;
			}

			try {

				var ws = _this.getWS(lastPort);


				ws.onopen = function () {
				
					if(ws.readyState == 1){
						objSTwain._objWS = ws;
						if (!objSTwain.bReady) {
							objSTwain._OnReady(true);
						}
						Dynamsoft.Lib.detect.hideMask();
						_this.detect.bOK = true;
					} else if(ws.readyState == 0) {
						setTimeout(ws.onopen, 100);
					} else {
						// closed or closing
					}

				};

				ws.onclose = function () {

					ws.onopen = null;
					if (!objSTwain.bReady) {
						objSTwain.__wsRetry++;
						if(objSTwain.__wsRetry<5){
							setTimeout(Dynamsoft.Lib._reconnect, 1000);
						} else {
							Dynamsoft.Lib.closeProgress('Reconnect');
							Dynamsoft.Lib.Errors.Server_Restarted(objSTwain);
						}
					} else {
						Dynamsoft.Lib.closeProgress('Reconnect');
						Dynamsoft.Lib.detect.hideMask();
					}
				};

			} catch (exception) {
				Dynamsoft.Lib.log(exception);
				if (!objSTwain.bReady) {
					objSTwain.__wsRetry++;
					if(objSTwain.__wsRetry<5){
						setTimeout(Dynamsoft.Lib._reconnect, 1000);
					}
				} else {
					Dynamsoft.Lib.detect.hideMask();
				}
			}
			
        }

    };
	
    // detect function
    Dynamsoft.Lib.startWS = function () {
        var _this = Dynamsoft.Lib;	// because this function will invoke by setTimeout

        if (!Dynamsoft.Lib.product.bChromeEdition) {
            Dynamsoft.Lib.appendMessage('This browser is currently not supported. Please try Chrome or Firefox!');
            return;
        }

        if (!_this.detect.bNoControlEvent)
            Dynamsoft.Lib.detect.showMask();

        if (_this.detect.OnDetectNext)
            _this.detect.OnDetectNext();
			
		if(_this.detect.tryTimes == 0 && _this.detect.cUrlIndex > 0){
		
            if (!_this.detect.bNoControlEvent) {
                Dynamsoft.Lib.detect.hideMask();

                if (Dynamsoft.Lib.isFunction(_this.detect.onNoControl)){
					var _objSTwain = _this.detect.arySTwains[_this.detect.cTwainIndex], _width, _height;
					 _width = _objSTwain._width;
					 _height = _objSTwain._height;
					 
					 if(_width <= 0)
						_width = 270;

					 if(_height <= 0)
						_height = 350;
					 
					 
                    _this.detect.onNoControl(_objSTwain._strDWTControlContainerID, _width, _height);
				}
				
                _this.detect.bNoControlEvent = true;

            }
		}

        if (_this.detect.cUrlIndex >= _this.detect.urls.length) {
            _this.detect.cUrlIndex = 0;
            _this.detect.tryTimes++;
        }
		
		

        var objSTwain;
        if (_this.detect.cTwainIndex < _this.detect.arySTwains.length) {
            objSTwain = _this.detect.arySTwains[_this.detect.cTwainIndex];
        } else {
            // never here
            Dynamsoft.Lib.detect.hideMask();
            _this.detect.bOK = true;
            return;
        }

        if (objSTwain.bReady) {
            _this.detect.cTwainIndex++;
            if (_this.detect.cTwainIndex >= _this.detect.arySTwains.length) {
                Dynamsoft.Lib.detect.hideMask();
                _this.detect.bOK = true;
            } else {
                setTimeout(Dynamsoft.Lib.startWS, 100);
            }

            return;
        }

        try {

            var o = _this.detect.urls[_this.detect.cUrlIndex],
				ws = _this.getWS(o);

			Dynamsoft.Lib.log(['connecting ... [port:', o.port, ']'].join(''));

            ws.onopen = function () {

				if(ws.readyState == 1){
					objSTwain._objWS = ws;
					if (!objSTwain.bReady) {
						objSTwain._OnReady();
					}
					
					// OK attach property / addon
					Dynamsoft.Lib.attachProperty(objSTwain);
					Dynamsoft.Lib.attachAddon(objSTwain);
					
					_this.detect.cTwainIndex++;
					
					if (_this.detect.cTwainIndex >= _this.detect.arySTwains.length) {
						Dynamsoft.Lib.detect.hideMask();
						_this.detect.bOK = true;
					} else {
						setTimeout(Dynamsoft.Lib.startWS, 100);
					}
				} else if(ws.readyState == 0) {
					setTimeout(ws.onopen, 100);
				} else {
					// closed or closing
				}

            };

            ws.onclose = function () {

                ws.onopen = null;
                if (!objSTwain.bReady) {
                    _this.detect.cUrlIndex++;
                    setTimeout(Dynamsoft.Lib.startWS, 100);
                } else {
                    Dynamsoft.Lib.detect.hideMask();
                }
            };

        } catch (exception) {
			Dynamsoft.Lib.log(exception);
			if (!objSTwain.bReady) {
				_this.detect.cUrlIndex++;
				setTimeout(Dynamsoft.Lib.startWS, 100);
			} else {
				Dynamsoft.Lib.detect.hideMask();
			}
        }

    };

    Dynamsoft.Lib.html5.closeAll = function () {
        var _this = this,
			n, o, ws;

        for (n = 0; n < _this.detect.arySTwains.length; n++) {
            o = _this.detect.arySTwains[n];
            if (o.bReady) {
				//o._innerSend('RemoveAllImages', null, true);
				o._UIManager.clear();
				
                ws = o._objWS;
                if (ws) {
                    ws.close();
                    o._objWS = null;
                    o.bReady = false;
                }
            }
        }

        Dynamsoft.Lib.dlgProgress = false;
        _this.detect.bOK = false;
        _this.detect.arySTwains.splice(0);
        _this.detect.cTwainIndex = 0;
        _this.detect.bFirst = true;

    };

    Dynamsoft.Lib.bio = false;
    Dynamsoft.Lib.progressMessage = "";
    Dynamsoft.Lib.dialogShowStatus = false;
    Dynamsoft.Lib.needShowTwiceShowDialog = false;
    Dynamsoft.Lib.dlgProgress = false;
    Dynamsoft.Lib.cancelFrome = 0;  //0: other, 1:HTTP Upload,  2: HTTP Download 3:FTP Upload 4:FTP Download
    Dynamsoft.Lib.dlgRef = 0;

    Dynamsoft.Lib.showProgress = function (swt, m, bVisible) {
        var _this = swt;
        Dynamsoft.Lib.log('showProgress:' + m + ',bCancel:' + bVisible);
        if ((Dynamsoft.Lib.cancelFrome == 0 && _this.__IfShowProgressBar == true) || 
        ( Dynamsoft.Lib.cancelFrome != 0 && _this.__IfShowCancelDialogWhenImageTransfer == true)) {
            var btnCancel = S.one('#btnCancel');
            if (bVisible == false)
                btnCancel[0].style.display = 'none';
            else
                btnCancel[0].style.display = '';

            if (Dynamsoft.Lib.dialogShowStatus == false) {
                Dynamsoft.Lib.dlgProgress.showModal();
                Dynamsoft.Lib.dialogShowStatus = true;

                var finalMessage = S.one('#finalMessage');
                var bar = S.one('#progressBar'), barEl = bar[0];
                var status = S.one('#status');
                finalMessage.html("");
                status.html("0%");

				if(Dynamsoft.Lib.env.bIE){
					if(barEl.objProgressBar){
						barEl.objProgressBar.setValue(0);
					} else {
						barEl.value = 0;
					}
				} else {
					barEl.value = 0;
				}
            }

			Dynamsoft.Lib.dlgRef++;
        }

    };

    Dynamsoft.Lib.closeProgress = function (m) {
        Dynamsoft.Lib.log('closeProgress:' + m);
        var btnCancel = S.one('#btnCancel');
        if (Dynamsoft.Lib.needShowTwiceShowDialog == true && Dynamsoft.Lib.cancelFrome == 1) {
			if(btnCancel)
				btnCancel.html("Canceling");
        }
        else {
			if(btnCancel)
				btnCancel.html("Cancel");
            if (Dynamsoft.Lib.dialogShowStatus == true) {
                Dynamsoft.Lib.dlgProgress.close();
                Dynamsoft.Lib.dialogShowStatus = false;
            }
            Dynamsoft.Lib.needShowTwiceShowDialog = false;
            Dynamsoft.Lib.cancelFrome = 0; 
        }

		Dynamsoft.Lib.dlgRef--;
		if(Dynamsoft.Lib.dlgRef <= 0)
			Dynamsoft.Lib.dlgRef = 0;

    };

})(KISSY);


(function () {
	if (!Dynamsoft.Lib.product.bChromeEdition){
		return;
	}

    var Funs = Dynamsoft.Lib.html5.Funs;

    // entry
    Dynamsoft.Lib.html5.DynamicWebTwain = function (cfg) {
        var _Dself = Dynamsoft.Lib,
			objSTwain = new Dynamsoft.Lib.html5.STwain(cfg);

        _Dself.detect.arySTwains.push(objSTwain);

        if (_Dself.detect.bFirst) {
            _Dself._init();
        }
        _Dself.detect.bFirst = false;

        return objSTwain;
    };

})();

// 
// Dynamsoft JavaScript Library
// Product: Dynamsoft Web Twain
// Web Site: http://www.dynamsoft.com
// 
// Copyright 2016, Dynamsoft Corporation 
// Author: Dynamsoft R&D Department
// 
// Version: 11.3
// 
// Module: launch
// final js: build\src.launch.js
// 

(function(){
	
	var doc = window['document'];

	Dynamsoft.Lib.DynamicWebTwain = false;
	Dynamsoft.Lib.__dwtEditionMain = function (FUN) {
		KISSY.use(['json','node','dom','event'],function(S,JSON,Node,DOM,EVENT){

			if(Dynamsoft.Lib.product.bPluginEdition){
			
				Dynamsoft.Lib.DynamicWebTwain = Dynamsoft.Lib.plugin.DynamicWebTwain;
				Dynamsoft.Lib.closeAll = Dynamsoft.Lib.plugin.closeAll;
				
				if (Dynamsoft.Lib.isFunction(FUN)) {
					FUN();
				}
			} else if (Dynamsoft.Lib.product.bActiveXEdition){
			
				Dynamsoft.Lib.DynamicWebTwain = Dynamsoft.Lib.ie.DynamicWebTwain;
				Dynamsoft.Lib.closeAll = Dynamsoft.Lib.ie.closeAll;
				
				if (Dynamsoft.Lib.isFunction(FUN)) {
					FUN();
				}
			} else if (Dynamsoft.Lib.product.bChromeEdition){
			
			}
		});
	};

	Dynamsoft.Lib.__chromeEditionMain = function(FUN) {

		Dynamsoft.Lib.log('Run Dynamsoft.Lib.__chromeEditionMain() ...');

		KISSY.use(['io','json','node','dom','event','kg/bio/1.2/index'],function(S,IO,JSON,Node,DOM,EVENT,BIO){
			var LoadHtml5Js, callback;

			KISSY.BIO = BIO;
			Dynamsoft.Lib.getCss('reference/html5_editor.css');

			Dynamsoft.Lib.DynamicWebTwain = Dynamsoft.Lib.html5.DynamicWebTwain;
			Dynamsoft.Lib.closeAll = Dynamsoft.Lib.html5.closeAll;
			
			if (Dynamsoft.Lib.isFunction(FUN)) {
				FUN();
			}
		});
	};

	Dynamsoft.Lib.__innerInitEvents = function(_stwain, configs) {
		var cfg = configs || {};
		
		_stwain.__OnAfterOperate = cfg.onAfterOperate || '';
		_stwain.__OnBeforeOperate = cfg.onBeforeOperate || '';
		_stwain.__OnOperateStatus = cfg.onOperateStatus || ''; 
		_stwain.__OnBitmapChanged = cfg.onBitmapChanged || ''; 
		_stwain.__OnGetFilePath = cfg.onGetFilePath || ''; 
		_stwain.__OnImageAreaDeSelected = cfg.onImageAreaDeSelected || ''; 
		_stwain.__OnImageAreaSelected = cfg.onImageAreaSelected || ''; 
		_stwain.__OnMouseClick = cfg.onMouseClick || ''; 
		_stwain.__OnMouseDoubleClick = cfg.onMouseDoubleClick || ''; 
		_stwain.__OnMouseMove = cfg.onMouseMove || ''; 
		_stwain.__OnMouseRightClick = cfg.onMouseRightClick || ''; 
		_stwain.__OnPreAllTransfers = cfg.onPreAllTransfers || ''; 
		_stwain.__OnPreTransfer = cfg.onPreTransfer || ''; 
		_stwain.__OnPostLoad = cfg.onPostLoad || ''; 
		_stwain.__OnPostTransfer = cfg.onPostTransfer || ''; 
		_stwain.__OnPostAllTransfers = cfg.onPostAllTransfers || ''; 
		_stwain.__OnSourceUIClose = cfg.onSourceUIClose || ''; 
		_stwain.__OnTopImageInTheViewChanged = cfg.onTopImageInTheViewChanged || ''; 
		_stwain.__OnTransferCancelled = cfg.onTransferCancelled || ''; 
		_stwain.__OnTransferError = cfg.onTransferError || ''; 
		_stwain.__OnInternetTransferPercentage = cfg.onInternetTransferPercentage || ''; 
		_stwain.__OnInternetTransferPercentageEx = cfg.onInternetTransferPercentageEx || '';

	};

})();

// ------------------------------ WebTwain Main START -------------------------------


Dynamsoft.Lib.initGlobalConfig = function(cfg){
	var _this = Dynamsoft.Lib, config = cfg || {};

	// set Dynamsoft.Lib.evn
	if(config.basePath)
		_this.env.basePath = config.basePath;

	if(config.pathType)
		_this.env.pathType = config.pathType;

	// set Dynamsoft.WebTwainEnv
	if(config.resourcesPath){
		Dynamsoft.WebTwainEnv.ResourcesPath = config.resourcesPath;
	}
	
	if(typeof(config.trial) != 'undefined')
		Dynamsoft.WebTwainEnv.Trial = config.trial;
		
	if(typeof(config.debug) != 'undefined')
		Dynamsoft.WebTwainEnv.Debug = config.debug;
		
	if(config.productKey)
		Dynamsoft.WebTwainEnv.ProductKey = config.productKey;
	
	if(config.version)
		Dynamsoft.WebTwainEnv.ServerVersionInfo = config.version;
	
	if(config.IEVersion)
		Dynamsoft.WebTwainEnv.ActiveXVersion = config.IEVersion;
	
	// set Dynamsoft.Lib.config
		
	if(typeof(config.bDiscardBlankImage) != 'undefined')
		_this.config.bDiscardBlankImage = config.bDiscardBlankImage;
	
	if(config.msgPrefix)
		_this.config.msgPrefix = config.msgPrefix;
	
	if(config.msgSuffix)
		_this.config.msgSuffix = config.msgSuffix;
	
	// global detect setting
	if(config.detectType)
		_this.detect.detectType = config.detectType;
	
	if(config.tryTimes)
		_this.detect.tryTimes = config.tryTimes;
	
	
	if(config.onReady)
		_this.detect.OnReady = config.onReady;
	
	if(config.onDetectNext)
		_this.detect.OnDetectNext = config.onDetectNext;
	

	if(config.onNotAllowedForChrome)
		_this.detect.onNotAllowedForChrome = config.onNotAllowedForChrome;
		
	if(config.onNoControl)
		_this.detect.onNoControl = config.onNoControl;
	
	if(config.onCreatWS)
		_this.detect.OnCreatWS = config.onCreatWS;
	
};

Dynamsoft.Lib.replaceControl = function(id, newObj, callback){

		Dynamsoft.WebTwainEnv.ContainerMap[id] = newObj;

};


//
// Fire Event:
// Dynamsoft.WebTwainEnv.OnWebTwainNeedUpgradeWebJavascript
// Dynamsoft.WebTwainEnv.OnWebTwainReady
// Dynamsoft.WebTwainEnv.OnWebTwainNeedUpgrade
// 

function Dynamsoft__noControlEx(containerID, _strWidth, _strHeight) {
    //Dynamsoft.Lib.tmp.bShowNoControl = true;
    ua = (navigator.userAgent.toLowerCase());
    // For mac, create the message to tell the user to install the plugin.
    if (Dynamsoft.Lib.env.bMac) {

        // Display the message and hide the main control
        var container = KISSY.one('#' + containerID);
		container.before(Dynamsoft.Lib.install._strNonInstallDIV);
		
		var noneUI = Dynamsoft.Lib.get(Dynamsoft.Lib.install._divDWTNonInstallContainerID);
		if(noneUI){
			noneUI.style.width = _strWidth;
			noneUI.style.height = _strHeight;
		}
		
        Dynamsoft.Lib.show(Dynamsoft.Lib.install._divDWTNonInstallContainerID);
        Dynamsoft.Lib.hide(containerID);
		
        if (Dynamsoft.Lib.install._divDWTemessageContainer != '')
            Dynamsoft.Lib.hide(Dynamsoft.Lib.install._divDWTemessageContainer);
			
		if(Dynamsoft.Lib.isFunction(OnWebTwainNotFoundOnMacCallback)){
			var strInstallerUrl = Dynamsoft.Lib.product.bChromeEdition ? Dynamsoft.Lib.product.getChromeEditionPath() : Dynamsoft.Lib.product.getPKGPath();
			OnWebTwainNotFoundOnMacCallback(Dynamsoft.Lib.product.name, strInstallerUrl, 
					Dynamsoft.Lib.product.bChromeEdition, Dynamsoft.Lib.env.bIE, Dynamsoft.Lib.env.bSafari,
					Dynamsoft.Lib.detect.ssl, Dynamsoft.Lib.env.strIEVersion);
		}

    }
        // For none-IE browsers on Windows, create the message to tell the user to install the plugin.
    else if (ua.match(/chrome\/([\d.]+)/) || ua.match(/opera.([\d.]+)/) || ua.match(/version\/([\d.]+).*safari/) || ua.match(/firefox\/([\d.]+)/)
    || Dynamsoft.WebTwainEnv.IfUseActiveXForIE10Plus == false || (!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB && Dynamsoft.Lib.env.bIE)) {


        // Display the message and hide the main control
		var container = KISSY.one('#' + containerID);
		container.before(Dynamsoft.Lib.install._strNonInstallDIV);
		
		var noneUI = Dynamsoft.Lib.get(Dynamsoft.Lib.install._divDWTNonInstallContainerID);
		if(noneUI){
			noneUI.style.width = _strWidth;
			noneUI.style.height = _strHeight;
		}
		
        Dynamsoft.Lib.show(Dynamsoft.Lib.install._divDWTNonInstallContainerID);
        Dynamsoft.Lib.hide(containerID);
        if (Dynamsoft.Lib.install._divDWTemessageContainer != '')
            Dynamsoft.Lib.hide(Dynamsoft.Lib.install._divDWTemessageContainer);
			
		if(Dynamsoft.Lib.isFunction(OnWebTwainNotFoundOnWindowsCallback)){
		     var strInstallerUrl = "";
		     if(!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB)
		     {
		        if(Dynamsoft.Lib.product.bChromeEdition){
				    strInstallerUrl = Dynamsoft.Lib.product.getChromeEditionPath();
			    }else if(Dynamsoft.Lib.env.bIE)
			    {
			        if(Dynamsoft.Lib.env.bWin64)
			            strInstallerUrl = Dynamsoft.Lib.product.getActiveXCABx64Path();
			        else
			            strInstallerUrl = Dynamsoft.Lib.product.getActiveXCABx86Path();
			    }else{
				    strInstallerUrl = Dynamsoft.Lib.product.getMSIPath();
			    }
			}
			else		
			    strInstallerUrl =  Dynamsoft.Lib.product.bChromeEdition ? Dynamsoft.Lib.product.getChromeEditionPath() : Dynamsoft.Lib.product.getMSIPath();
			
			OnWebTwainNotFoundOnWindowsCallback(Dynamsoft.Lib.product.name, strInstallerUrl, 
				Dynamsoft.Lib.product.bChromeEdition, Dynamsoft.Lib.env.bIE, Dynamsoft.Lib.env.bSafari,
				Dynamsoft.Lib.detect.ssl, Dynamsoft.Lib.env.strIEVersion);
		}
    } else if(Dynamsoft.WebTwainEnv.bLinux){
		
        // Display the message and hide the main control
		var container = KISSY.one('#' + containerID);
		container.before(Dynamsoft.Lib.install._strNonInstallDIV);
		
		var noneUI = Dynamsoft.Lib.get(Dynamsoft.Lib.install._divDWTNonInstallContainerID);
		if(noneUI){
			noneUI.style.width = _strWidth;
			noneUI.style.height = _strHeight;
		}
		
        Dynamsoft.Lib.show(Dynamsoft.Lib.install._divDWTNonInstallContainerID);
        Dynamsoft.Lib.hide(containerID);
        if (Dynamsoft.Lib.install._divDWTemessageContainer != '')
            Dynamsoft.Lib.hide(Dynamsoft.Lib.install._divDWTemessageContainer);
	
		if(Dynamsoft.Lib.isFunction(OnWebTwainNotFoundOnLinuxCallback)){
			
			strInstallerUrl =  Dynamsoft.Lib.product.getLinuxChromeEditionPath();
			
			OnWebTwainNotFoundOnLinuxCallback(Dynamsoft.Lib.product.name, strInstallerUrl, 
				Dynamsoft.Lib.product.bChromeEdition, Dynamsoft.Lib.env.bIE, Dynamsoft.Lib.env.bSafari,
				Dynamsoft.Lib.detect.ssl, Dynamsoft.Lib.env.strIEVersion);
			
		}
	}
}

function Dynamsoft__notAllowedForChromeEx(containerID) {
    var ua = (navigator.userAgent.toLowerCase());
    // For mac, create the message to tell the user to install the plugin.
    if (ua.match(/chrome\/([\d.]+)/)) {

        // Display the message and hide the main control
        KISSY.one('#' + containerID).before(Dynamsoft.Lib.install._strNonInstallDIV);
        Dynamsoft.Lib.show(Dynamsoft.Lib.install._divDWTNonInstallContainerID);
        Dynamsoft.Lib.hide(containerID);
        if (Dynamsoft.Lib.install._divDWTemessageContainer != '')
            Dynamsoft.Lib.hide(Dynamsoft.Lib.install._divDWTemessageContainer);
			
		if(Dynamsoft.Lib.isFunction(OnWebTwainOldPluginNotAllowedCallback)){
			OnWebTwainOldPluginNotAllowedCallback(Dynamsoft.Lib.product.name);
		}
		
    }
}

function Dynamsoft_OnClickInstallButton() {
    var btnInstall = Dynamsoft.Lib.get('dwt-btn-install');
	if(btnInstall)
		btnInstall.style.display = 'none';
}

Dynamsoft.Lib.detect.getVersionArray = function (ver) {
	var vString = ver.toLowerCase().replace(Dynamsoft.Lib.product.name.toLowerCase() + ' ', '');
    vString = vString.replace('trial'.toLowerCase(), '');
    vString = Dynamsoft.Lib.replaceAll(vString, '[.]', ',');

    return vString.split(',');
}	

Dynamsoft.Lib.detect.isDWTVersionLatest = function (v) {
	
	if(Dynamsoft.Lib.isUndefined(v))
		return false;
	
	var versionInfoFromServer = v.toString().toLowerCase();
	
    var currentArray = Dynamsoft.Lib.detect.getVersionArray(versionInfoFromServer),
		latest,
		latestArray;
		
	if(Dynamsoft.Lib.env.bIE && (Dynamsoft.Lib.product.bPluginEdition || Dynamsoft.Lib.product.bActiveXEdition)) {
		latest = Dynamsoft.WebTwainEnv.ActiveXVersion;
	} else {
	    if(Dynamsoft.Lib.product.bPluginEdition)
	        latest = Dynamsoft.WebTwainEnv.PluginVersion;
	    else
		    latest = Dynamsoft.WebTwainEnv.ServerVersionInfo;
	}
	
    latest = Dynamsoft.Lib.replaceAll(new String(latest), '[.]', ',');
    latestArray = latest.split(',');

    index = currentArray.length > latestArray.length ? currentArray.length : latestArray.length;
    for (var i = 0; i < index; i++) {
        if (currentArray[i] == null)
            currentArray[i] = 0;
        if (latestArray[i] == null)
            latestArray[i] = 0;

        if (parseInt(currentArray[i]) < parseInt(latestArray[i])) {
            return false;
        }
		else if (parseInt(currentArray[i]) > parseInt(latestArray[i])) {
            return true;
        }
    }
    return true;
};


Dynamsoft.Lib.detect.__checkUpgrade = function (containerID, _objDWObject){
	if(Dynamsoft.Lib.install.bNeedUpgrade){
		
		var versionInfoFromServer = _objDWObject.VersionInfo;
		if (Dynamsoft.Lib.detect.isDWTVersionLatest(versionInfoFromServer)) {
			// is latest version, close the dialog
			Dynamsoft__OnclickCloseInstallEx(containerID);			
		} else {
			// continue check
			setTimeout(function(){Dynamsoft.Lib.detect.__checkUpgrade(containerID, _objDWObject);}, 500);
		}
	}
};


Dynamsoft.Lib.detect._needUpgradeHtml5Server = function(containerID, _objDWObject) {

    if (!Dynamsoft.Lib.detect.isDWTVersionLatest(_objDWObject.VersionInfo)) {

		Dynamsoft.Lib.install.bNeedUpgrade = true;
		if(!Dynamsoft.WebTwainEnv.UseDefaultInstallUI 
			&& Dynamsoft.Lib.isFunction(Dynamsoft.WebTwainEnv.OnWebTwainNeedUpgrade)){
			
			// exec customer upgrade
			Dynamsoft.WebTwainEnv.OnWebTwainNeedUpgrade();
			return;
		}
		
		// Display the message and hide the main control
		KISSY.one('#' + containerID).before(Dynamsoft.Lib.install._strNonInstallDIV);
		Dynamsoft.Lib.show(Dynamsoft.Lib.install._divDWTNonInstallContainerID);
		Dynamsoft.Lib.hide(containerID);
		if (Dynamsoft.Lib.install._divDWTemessageContainer != '')
			Dynamsoft.Lib.hide(Dynamsoft.Lib.install._divDWTemessageContainer);
    
		if(Dynamsoft.Lib.isFunction(OnWebTwainNeedUpgradeCallback)){
			var strInstallerUrl;
			if(Dynamsoft.Lib.product.bChromeEdition) {
				// HTML5 Edition (contains Windows & Mac & Linux)
				strInstallerUrl = Dynamsoft.Lib.product.getChromeEditionPath();
			} else {
				if (Dynamsoft.Lib.env.bWin) {
					// Windows
					if(!Dynamsoft.WebTwainEnv.ActiveXInstallWithCAB && Dynamsoft.Lib.env.bIE)
					{
						// IE && Cab
						if(Dynamsoft.Lib.env.bWin64){
							strInstallerUrl = Dynamsoft.Lib.product.getActiveXCABx64Path();
						} else {
							strInstallerUrl = Dynamsoft.Lib.product.getActiveXCABx86Path();
						}
					} else {
						// FF or Chrome or IE && MSI
						strInstallerUrl = Dynamsoft.Lib.product.getMSIPath();
					}
				} else {
					// Mac or Linux
					strInstallerUrl = Dynamsoft.Lib.product.getPKGPath();
				}
			}
			
			
			OnWebTwainNeedUpgradeCallback(Dynamsoft.Lib.product.name, strInstallerUrl,
					Dynamsoft.Lib.product.bChromeEdition, Dynamsoft.Lib.env.bMac,
					Dynamsoft.Lib.env.bIE, Dynamsoft.Lib.env.bSafari,
					Dynamsoft.Lib.detect.ssl, Dynamsoft.Lib.env.strIEVersion);
		}

		// start from 11.0, it does not detect upgrade automatically
		// setTimeout(function(){Dynamsoft.Lib.detect.__checkUpgrade(containerID, _objDWObject);}, 5000);
    }
};

function Dynamsoft__onReadyEx() {

	var ids = Dynamsoft.WebTwainEnv.Containers, tmp, k, cid, _containerID, _objDWObject;

	if(ids.length > 0){

		Dynamsoft__OnclickCloseInstallEx();

		_containerID = ids[0].ContainerId;
		_objDWObject = Dynamsoft.WebTwainEnv.ContainerMap[_containerID];
		_objDWObject.IfAllowLocalCache = true;
		_objDWObject.BrokerProcessType = 1;
		_objDWObject.IfShowFileDialog = true;
		_objDWObject.IfDisableSourceAfterAcquire = true;
		if(Dynamsoft.Lib.env.bMac)
		    _objDWObject.ImageCaptureDriverType = 3;

		if (Dynamsoft.Lib.product.bChromeEdition) {

			// check websocket version
			var _loglevel = _objDWObject.LogLevel;
			if(_objDWObject.ErrorCode == -2207){
				if(!Dynamsoft.WebTwainEnv.UseDefaultInstallUI 
					&& Dynamsoft.Lib.isFunction(Dynamsoft.WebTwainEnv.OnWebTwainNeedUpgradeWebJavascript)){
					
					// exec customer upgrade
					Dynamsoft.WebTwainEnv.OnWebTwainNeedUpgradeWebJavascript(_objDWObject.ErrorString);
				} else {
					alert(_objDWObject.ErrorString + 'Please contact the administrator or the developer of the website for more information.');
				}
			}
		}			
		//No more new edition for the old plug-in, so upgrade only makes sense for version 10 and above (new HTML5 edition)
		//If the new HTML5 edition is not installed, the user will get prompted to install it too
		//for IE and plugin
		if((Dynamsoft.Lib.env.bIE && !Dynamsoft.WebTwainEnv.IfUseActiveXForIE10Plus) || !Dynamsoft.Lib.env.bIE)
		    Dynamsoft.Lib.detect._needUpgradeHtml5Server(_containerID, _objDWObject);
	}

	if (Dynamsoft.Lib.isFunction(Dynamsoft.WebTwainEnv.OnWebTwainReady)){
		Dynamsoft.WebTwainEnv.OnWebTwainReady();
	} else {
		if (Dynamsoft.Lib.isFunction(Dynamsoft_OnReady))
		Dynamsoft_OnReady();
	}
	
	// Html Edition will check control width & height After OnReady
	if (Dynamsoft.Lib.product.bChromeEdition) {
		for(k=0;k<ids.length;k++){
			cid = ids[k].ContainerId;
			tmp = Dynamsoft.WebTwainEnv.ContainerMap[cid];
			if(tmp && (tmp.Width <= 0 || tmp.Height <= 0)) {
				if(tmp.Width <= 0)
					tmp.Width = 270;
					
				if(tmp.Height <= 0)
					tmp.Height = 350;
			}
		}
	}
}

// ---------- main -----------

(function(){
	Dynamsoft.Lib.detect.__WebTwainCommonMain = function DWT(cfg, callback){
		var useDefaultUIEvent = Dynamsoft.WebTwainEnv.UseDefaultInstallUI;

		// compatible for 10.0
		if (Dynamsoft.Lib.isFunction(Dynamsoft_ChangeConfig)) {
			Dynamsoft_ChangeConfig(cfg);
		}
		
		if(useDefaultUIEvent){
			cfg['onNotAllowedForChrome'] = Dynamsoft__notAllowedForChromeEx;
			cfg['onNoControl'] = Dynamsoft__noControlEx;
		} else {
			cfg['onNotAllowedForChrome'] = Dynamsoft.WebTwainEnv.OnWebTwainOldPluginNotAllowed;
			cfg['onNoControl'] = Dynamsoft.WebTwainEnv.OnWebTwainNotFound;		
		}

		Dynamsoft.Lib.initGlobalConfig(cfg);
		if (Dynamsoft.Lib.isFunction(callback)) {
			callback();
		}
	}

	// define Dynamsoft.Lib.detect.__WebTwainMain function
    Dynamsoft.Lib.detect.__WebTwainMain = function (containerObject) {
		
		var cfg;
		if(!containerObject || !containerObject.ContainerId || containerObject.ContainerId == ''){
			Dynamsoft.Lib.log('Error: the containerID cannot be empty.');
			return;
		}
	
        cfg = {
			'containerID': containerObject.ContainerId || 'dwtcontrolContainer',
			'width': containerObject.Width,
			'height': containerObject.Height,
			'HTTPPort': (Dynamsoft.Lib.detect.ssl? 443 : 80)
		};

        if(Dynamsoft.Lib.detect.arySTwains.length > 0)
        {
            for(j = Dynamsoft.Lib.detect.arySTwains.length-1; j>= 0; j--)
            {
                var objSTwain = Dynamsoft.Lib.detect.arySTwains[j];
                if(objSTwain._strDWTControlContainerID === cfg.containerID)
                    return;
            }
        }
		
		Dynamsoft.Lib.detect.__WebTwainCommonMain(cfg, function(){
				var gWebTwain;
				if (Dynamsoft.Lib.product.bChromeEdition) {
					cfg.onWSReady = function () {
						//When Web Sockets is ready to use, DWObject points to the Dynamic Web TWAIN object
						Dynamsoft.Lib.replaceControl(cfg.containerID, gWebTwain);
					};
					cfg.onWSReconnect = function() {
						// tips
						Dynamsoft.Lib.log('re-connected');
						Dynamsoft.Lib.log(gWebTwain.ErrorString);
					};
				} else {
					cfg.onPluginReady = function () {
						Dynamsoft.Lib.replaceControl(cfg.containerID, gWebTwain.getInstance());
					};
					cfg.onPluginNotReady = function () {
						if (Dynamsoft.Lib.isFunction(Dynamsoft_OnNotReady)) {
							Dynamsoft_OnNotReady();
						}
					};		
				}
				
				/*Create one instance of Dynamic Web TWAIN*/
				if(Dynamsoft.Lib.DynamicWebTwain) {
					gWebTwain = new Dynamsoft.Lib.DynamicWebTwain(cfg);

					// compatible for 10.0
					if (Dynamsoft.Lib.isFunction(Dynamsoft_OnLoad)) {
						Dynamsoft_OnLoad();
					}
					
					if (Dynamsoft.Lib.product.bChromeEdition) {
					} else {
						
						// detect the first instance
						if (Dynamsoft.Lib.detect.arySTwains.length == Dynamsoft.WebTwainEnv.Containers.length) {
							//Set interval to check if the control is fully loaded.
							Dynamsoft.Lib.detect._varSeed = setInterval(Dynamsoft.Lib.detect._controlDetect, 200);
						}
					}
				} else {
					// init failed
					Dynamsoft.Lib.log('Error: the Dynamic Web Twain install failed.');
				}
		});
    };
	
	// compatible for 10.0
	DynamLib = Dynamsoft.Lib;
	DynamLib.main = function(FUN, cfg){
		var callback_compatible = function(){
				if(Dynamsoft.Lib.DynamicWebTwain) {
					DynamLib.WebTwain = Dynamsoft.Lib.DynamicWebTwain;
					
					DynamLib.product._strChromeEditionPath = Dynamsoft.Lib.product.getChromeEditionPath();
					DynamLib.product._strMSIPath = Dynamsoft.Lib.product.getMSIPath();
					DynamLib.product._strPKGPath = Dynamsoft.Lib.product.getPKGPath();
					DynamLib.product.version = Dynamsoft.WebTwainEnv.ServerVersionInfo;
					DynamLib.product.IEVersion = Dynamsoft.WebTwainEnv.ActiveXVersion;

					if (Dynamsoft.Lib.isFunction(FUN)) {
						FUN();
					}
					if (Dynamsoft.Lib.product.bChromeEdition) {
					} else {
						//Set interval to check if the control is fully loaded.
						Dynamsoft.Lib.detect._varSeed = setInterval(Dynamsoft.Lib.detect._controlDetect, 200);
					}
				} else {
					// init failed
					Dynamsoft.Lib.log('Error: the Dynamic Web Twain install failed.');
				}
			}, callback = function(){
				if(Dynamsoft.Lib.product.bChromeEdition){
					Dynamsoft.Lib.__chromeEditionMain(callback_compatible);
				} else {
					Dynamsoft.Lib.__dwtEditionMain(callback_compatible);
				}
			};
		
		Dynamsoft.Lib.config.usingMainMode = true;
		Dynamsoft.WebTwainEnv.UseDefaultInstallUI = false;
		Dynamsoft.WebTwainEnv.OnWebTwainOldPluginNotAllowed = cfg['onNotAllowedForChrome'];
		Dynamsoft.WebTwainEnv.OnWebTwainNotFound = cfg['onNoControl'];
		
		//cfg.onNotAllowedForChrome
		//cfg.onNoControl

		Dynamsoft.Lib.detect.__WebTwainCommonMain(cfg,callback);
	};

})();


Dynamsoft.Lib.detect.checkMultiReady = function(){
	var ids = Dynamsoft.WebTwainEnv.Containers, tmp, k, cid;

	for(k=0;k<ids.length;k++){
		cid = ids[k].ContainerId;
		tmp = Dynamsoft.WebTwainEnv.ContainerMap[cid];
		if(!tmp){
			setTimeout(Dynamsoft.Lib.detect.checkMultiReady, 200);
			return;
		}
	}
	
	// all ready
	Dynamsoft__onReadyEx();
};

function Dynamsoft_getContainerById(obj){

	if(Dynamsoft.Lib.isString(obj)){
		return Dynamsoft.Lib.get(obj);
	}else{
		return Dynamsoft.Lib.get(obj.ContainerId);
	}

}
Dynamsoft.WebTwainEnv.Unload = function () {
	Dynamsoft.Lib.page.bUnload = true;
	
	if(Dynamsoft.Lib.closeAll)
		Dynamsoft.Lib.closeAll();
	if(Dynamsoft.Lib.page.OnUnload)
		Dynamsoft.Lib.page.OnUnload();

	Dynamsoft.WebTwainEnv.ContainerMap = false;

	var ids = Dynamsoft.WebTwainEnv.Containers, o;
	if (ids)
	    for (k = ids.length - 1; k >= 0; k--) {
			o = document.getElementById(ids[k].ContainerId);
			if (o) {
				o.innerHTML = '';
			}
		}
}

Dynamsoft.WebTwainEnv.Load = function () {
    Dynamsoft.Lib.page.bUnload = false;
	KISSY.ready(function(S){
		var ids1 = Dynamsoft.WebTwainEnv.Containers, k;

		var objJWaiting = Dynamsoft.Lib.get('J_waiting');
		if (objJWaiting) {
			objJWaiting.parentNode.removeChild(objJWaiting);
		}

		if (ids1)
			for (k = ids1.length - 1; k >= 0; k--) {
				if (Dynamsoft_getContainerById(ids1[k].ContainerId)) {
					continue;
				} else {
					Dynamsoft.Lib.log('The container "' + ids1[k].ContainerId + '" not found.');
					ids1.splice(k, 1);
				}
			}

		Dynamsoft.Lib.log(ids1);

		Dynamsoft.WebTwainEnv.ContainerMap = {};

		if (Dynamsoft.Lib.config.usingMainMode){
			Dynamsoft.Lib.getCss('reference/hint.css');
			return;
		}

		// Load install js
		Dynamsoft.Lib.getScript('dynamsoft.webtwain.install.js', false, function(){
			var ids = Dynamsoft.WebTwainEnv.Containers, FUN = function () {

				// code
				if (ids === false || ids.length === 0) {

					Dynamsoft.Lib.log('Dynamsoft.WebTwainEnv.Containers does not set');
					return;
				}

				// plugin/ActiveX, init all then check all
				for (k = 0; k < ids.length; k++) {
					Dynamsoft.Lib.detect.__WebTwainMain(ids[k]);
				}

				if (Dynamsoft.Lib.product.bChromeEdition) {
					Dynamsoft.Lib.startWS();
				}

				setTimeout(Dynamsoft.Lib.detect.checkMultiReady, 100);

			};

			Dynamsoft.Lib.getCss('reference/hint.css');			
			if (Dynamsoft.Lib.product.bChromeEdition) {
				Dynamsoft.Lib.__chromeEditionMain(FUN);
			} else {
				Dynamsoft.Lib.__dwtEditionMain(FUN);
			}
		});
	});

}

Dynamsoft.WebTwainEnv.__checkConfigLoaded = function () {
    if (Dynamsoft.WebTwainEnv.Containers) {
        // OK
        if(Dynamsoft.WebTwainEnv.AutoLoad)
            Dynamsoft.WebTwainEnv.Load();
    } else {
        setTimeout(Dynamsoft.WebTwainEnv.__checkConfigLoaded, 100);
    }
}

KISSY.ready(function (S) {
    Dynamsoft.WebTwainEnv.__checkConfigLoaded();
});


